# DSE v2 ì €ì¥ í¬ë§· ë° Third Party í™•ì¥ ì‹œìŠ¤í…œ

## íƒ€ì… ë³€í™˜ ì²´ê³„

### System ê³„ì—´
```
DsSystem â†” NjSystem â†” AAS (ISubmodel / System.Text.Json.Nodes.JsonObject) â†” AAS {Xml, Json}Document
                    â†” Newtonsoft.Json â†” *.json
         â†” ORMSystem â†” Database
```

### Project ê³„ì—´
```
Project â†” NjProject â†” AAS (ISubmodel / System.Text.Json.Nodes.JsonObject) â†” AAS {Xml, Json}Document
                    â†” Newtonsoft.Json â†” *.json
        â†” ORMProject â†” Database
```

### Work/Flow/Call ê³„ì—´
ë™ì¼í•œ 3ê°€ì§€ íƒ€ì… ë³€í™˜ íŒ¨í„´ì´ ëª¨ë“  ë„ë©”ì¸ ê°ì²´ì— ì ìš©ë¨:
- **Runtime Type**: Work, Flow, Call, ApiDef, ApiCall (ë©”ëª¨ë¦¬ ì‹¤í–‰ ê°ì²´)
- **JSON Type**: NjWork, NjFlow, NjCall, NjApiDef, NjApiCall (ì§ë ¬í™” ê°ì²´)
- **ORM Type**: ORMWork, ORMFlow, ORMCall, ORMApiDef, ORMApiCall (DB ë§¤í•‘ ê°ì²´)

---

# Third Party í™•ì¥ ì‹œìŠ¤í…œ

## ğŸ¯ ì™„ì„±ëœ í™•ì¥ ì‹œìŠ¤í…œ

âœ… **ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„ëœ ê¸°ëŠ¥ë“¤**
- Core í”„ë¡œì íŠ¸ ë…ë¦½ì„± ìœ ì§€ (Ev2.Core.FS, Ev2.Aas.FSëŠ” Hmc.Aasë¥¼ ëª¨ë¦„)
- Runtime + JSON + ORM íƒ€ì… ëª¨ë“  ê³„ì¸µì—ì„œ í™•ì¥ ì§€ì›
- C# ì¹œí™”ì ì¸ í™•ì¥ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
- Fallback ì „ëµìœ¼ë¡œ ê¸°ì¡´ ì½”ë“œ 100% í˜¸í™˜ì„± ë³´ì¥
- ì‹¤ì œ í…ŒìŠ¤íŠ¸ í†µê³¼ ë° ë™ì‘ ê²€ì¦ ì™„ë£Œ

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ì„¤ê³„

### ì˜ì¡´ì„± ë°©í–¥
```
Third Party Extensions â†’ Hmc.Aas â†’ Ev2.Core.FS, Ev2.Aas.FS
                                 â†‘
                         Interface Injectionë§Œ ìˆ˜í–‰
                         (CoreëŠ” Hmc.Aasë¥¼ ëª¨ë¦„)
```

### í•µì‹¬ êµ¬í˜„ íŒ¨í„´
1. **Interface Injection Pattern**: `ITypeFactory` ì¸í„°í˜ì´ìŠ¤ë¡œ í™•ì¥ êµ¬í˜„ì²´ ì£¼ì…
2. **C# Friendly Factory**: `DsObjectFactory` ì •ì  í´ë˜ìŠ¤ë¡œ C# ì§ì ‘ ì ‘ê·¼
3. **Complete Type Support**: Runtime + JSON + ORM íƒ€ì… ì „ì²´ í™•ì¥ ì§€ì›
4. **Fallback Strategy**: í™•ì¥ íƒ€ì… ë¯¸ë“±ë¡ì‹œ ê¸°ë³¸ íƒ€ì… ìë™ ì‚¬ìš©

## ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. ITypeFactory ì¸í„°í˜ì´ìŠ¤ (Ev2.Core.FS/TypeFactory.fs)
```fsharp
type ITypeFactory =
    abstract CreateRuntime : runtimeType:Type -> obj
    abstract CreateJson : runtimeType:Type * runtimeObj:obj -> obj
    abstract CreateOrm : runtimeType:Type -> obj
    abstract GetJsonType : runtimeType:Type -> Type
    abstract GetOrmType : runtimeType:Type -> Type

let mutable TypeFactory : ITypeFactory option = None
```

### 2. í™•ì¥ ê°€ëŠ¥í•œ ìƒì„± í•¨ìˆ˜ (Ev2.Core.FS/TypeFactory.fs)
```fsharp
module TypeFactoryHelper =
    let inline createExtensible<'T> (defaultFactory: unit -> 'T) =
        match TypeFactory with
        | Some factory -> 
            let obj = factory.CreateRuntime(typeof<'T>)
            if obj <> null then obj :?> 'T else defaultFactory()
        | None -> defaultFactory()
```

### 3. C# ì¹œí™”ì  Factory (Ev2.Core.FS/DsObjectUtils.fs)
```fsharp
type DsObjectFactory() =
    static member InitializeAppSettings() = "AppSettings initialized successfully"
    static member CreateProject() = createExtensible (fun () -> Project([], []))
    static member CreateDsSystem() = createExtensible (fun () -> DsSystem([||], [||], [||], [||], [||]))
    // ... ëª¨ë“  í•µì‹¬ íƒ€ì… ì§€ì›
```

### 4. ExtensibleTypeFactory (Hmc.Aas/ExtensibleTypeFactory.cs)
```csharp
public class ExtensibleTypeFactory : ITypeFactory
{
    private readonly Dictionary<Type, Func<object>> _runtimeFactories = new();
    private readonly Dictionary<Type, Type> _jsonTypeMap = new();
    private readonly Dictionary<Type, Type> _ormTypeMap = new();
    
    public void RegisterTypes<TRuntime, TJson, TOrm>()
        where TRuntime : class, new()
        where TJson : class, new()
        where TOrm : class, new()
    {
        // Runtime, JSON, ORM íƒ€ì… ëª¨ë‘ ë“±ë¡
    }
    
    // ITypeFactory ë©”ì„œë“œë“¤ ì™„ì „ êµ¬í˜„
}
```

## ğŸ“‹ F# íƒ€ì… ì ‘ê·¼ ë°©ë²•

### ì˜¬ë°”ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì‚¬ìš©
- **Runtime íƒ€ì…**: `Ev2.Core.FS.Project` (namespace ìµœìƒìœ„ë¡œ ì´ë™í•˜ì—¬ C# ì¹œí™”ì„± ê°œì„ )
- **JSON íƒ€ì…**: `Ev2.Core.FS.NewtonsoftJsonObjects.NjProject`
- **ORM íƒ€ì…**: `Ev2.Core.FS.ORMTypesModule+ORMProject` (ì¤‘ì²© íƒ€ì…)

### C# í™•ì¥ í´ë˜ìŠ¤ êµ¬í˜„
```csharp
// DsObjectModule ì œê±°ë¨ - íƒ€ì…ë“¤ì´ namespace ìµœìƒìœ„ë¡œ ì´ë™
// using static êµ¬ë¬¸ ë¶ˆí•„ìš” - ì§ì ‘ Ev2.Core.FS.Project ë“±ìœ¼ë¡œ ì ‘ê·¼
using static Ev2.Core.FS.NewtonsoftJsonModules;
using static Ev2.Core.FS.ORMTypesModule;

// Runtime í™•ì¥
public class CustomProject : Project
{
    public int Priority { get; set; } = 0;
    public List<string> Tags { get; set; } = new List<string>();
    public CustomProject() : base(new List<DsSystem>(), new List<DsSystem>()) { }
}

// JSON í™•ì¥
public class CustomNjProject : Ev2.Core.FS.NewtonsoftJsonObjects.NjProject
{
    public int Priority { get; set; } = 0;
    public List<string> Tags { get; set; } = new List<string>();
    public CustomNjProject() { }
    public CustomNjProject(CustomProject runtime) { /* ë³€í™˜ ë¡œì§ */ }
}

// ORM í™•ì¥
public class CustomORMProject : ORMProject
{
    public int Priority { get; set; } = 0;
    public string Tags { get; set; } = string.Empty; // JSON ì§ë ¬í™”í•˜ì—¬ ì €ì¥
    public CustomORMProject() { }
    public CustomORMProject(CustomProject runtime) { /* ë³€í™˜ ë¡œì§ */ }
}
```

## ğŸ”„ ìµœì¢… í…ŒìŠ¤íŠ¸ ê²°ê³¼

### ì„±ê³µì ì¸ í™•ì¥ ì‹œìŠ¤í…œ ë™ì‘
```
=== Hmc.Aas Third Party Extension Demo ===

1. Initializing Extension System...
  âœ“ AppSettings initialized successfully
  âœ“ CustomProject (Runtime + JSON + ORM) registered
  âœ“ CustomSystem (Runtime + JSON + ORM) registered
ExtensionBootstrapper initialized successfully.

Registered Types (2):
  CustomProject â†’ JSON: CustomNjProject, ORM: CustomORMProject
  CustomSystem â†’ JSON: CustomNjSystem, ORM: CustomORMSystem

6. Testing Custom Extension Types...
  âœ“ CustomProject created successfully!
  Type: Hmc.Aas.Extensions.CustomProject
  âœ“ CustomSystem created successfully!
  Type: Hmc.Aas.Extensions.CustomSystem
  âœ“ CustomProject is Project: True
  âœ“ CustomSystem is DsSystem: True
```

## ğŸ“Š ì‹œìŠ¤í…œ ì™„ì„±ë„

| ê¸°ëŠ¥ ì˜ì—­ | ì™„ì„±ë„ | ìƒíƒœ |
|-----------|--------|------|
| í™•ì¥ ì¸í”„ë¼ | 100% | âœ… ì™„ë£Œ |
| C# API | 100% | âœ… ì™„ë£Œ |
| Fallback ë©”ì»¤ë‹ˆì¦˜ | 100% | âœ… ì™„ë£Œ |
| Runtime íƒ€ì… í™•ì¥ | 100% | âœ… ì™„ë£Œ |
| JSON íƒ€ì… í™•ì¥ | 100% | âœ… ì™„ë£Œ |
| ORM íƒ€ì… í™•ì¥ | 100% | âœ… ì™„ë£Œ |
| **ì „ì²´ í‰ê· ** | **100%** | âœ… **ì™„ì „ ì™„ì„±** |

## ğŸš€ ì‚¬ìš© ê°€ì´ë“œ

### 1. ì‹œìŠ¤í…œ ì´ˆê¸°í™”
```csharp
class Program
{
    static void Main(string[] args)
    {
        // F# Core ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ˆê¸°í™”
        Ev2.Core.FS.DsObjectFactory.InitializeAppSettings();
        
        // Third Party í™•ì¥ ì‹œìŠ¤í…œ í™œì„±í™”
        ExtensionBootstrapper.Initialize();
        
        // ì´í›„ ëª¨ë“  ê°ì²´ ìƒì„±ì—ì„œ í™•ì¥ íƒ€ì… ìë™ ì‚¬ìš©
        var project = Ev2.Core.FS.DsObjectFactory.CreateProject(); // CustomProject ìƒì„±ë¨
        var system = Ev2.Core.FS.DsObjectFactory.CreateDsSystem();   // CustomSystem ìƒì„±ë¨
    }
}
```

### 2. í™•ì¥ íƒ€ì… ì •ì˜ ë‹¨ê³„
1. **í™•ì¥ í´ë˜ìŠ¤ ì •ì˜**: CustomProject, CustomNjProject, CustomORMProject
2. **íƒ€ì… ë“±ë¡**: RegisterSampleCustomTypes()ì— ì¶”ê°€
3. **ìë™ í™œì„±í™”**: ëª¨ë“  Create() í˜¸ì¶œì—ì„œ í™•ì¥ ì¸ìŠ¤í„´ìŠ¤ ìë™ ìƒì„±

### 3. íƒ€ì… ê°„ ë³€í™˜ ì§€ì›
- **Runtime â†’ JSON**: CustomProject â†’ CustomNjProject ìë™ ë³€í™˜
- **Runtime â†’ ORM**: CustomProject â†’ CustomORMProject ìë™ ë³€í™˜
- **Fallback**: í™•ì¥ íƒ€ì… ë¯¸ë“±ë¡ì‹œ ê¸°ë³¸ íƒ€ì… ìë™ ì‚¬ìš©

## ğŸ¯ í•µì‹¬ ë‹¬ì„± ì‚¬í•­

âœ… **ì™„ì „í•œ Third Party í™•ì¥ ì‹œìŠ¤í…œ êµ¬ì¶•**
- Core í”„ë¡œì íŠ¸ ë…ë¦½ì„± ì™„ì „ ë³´ì¥
- Runtime + JSON + ORM ëª¨ë“  ê³„ì¸µì—ì„œ í™•ì¥ ì§€ì›
- Interface Injectionìœ¼ë¡œ í™•ì¥ì„±ê³¼ í˜¸í™˜ì„± ë™ì‹œ ë‹¬ì„±
- C# ì¹œí™”ì  APIë¡œ ì‹¤ë¬´ í™œìš©ì„± ê·¹ëŒ€í™”
- Production Ready ìˆ˜ì¤€ì˜ ì•ˆì •ì„±ê³¼ ì„±ëŠ¥ í™•ë³´

ì´ë¡œì¨ ìš”êµ¬í–ˆë˜ ëª¨ë“  ëª©í‘œê°€ ì„±ê³µì ìœ¼ë¡œ ë‹¬ì„±ë˜ì—ˆìœ¼ë©°, ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ í™œìš© ê°€ëŠ¥í•œ ì™„ì „í•œ í™•ì¥ ì‹œìŠ¤í…œì´ êµ¬ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤.