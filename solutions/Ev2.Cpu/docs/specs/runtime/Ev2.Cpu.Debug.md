# Ev2.Cpu.Debug 개발 사양 및 유지보수 로드맵

## 1. 개요
Ev2.Cpu.Debug 프로젝트는 AST, 프로그램, 런타임 상태를 분석·시각화 하는 도구 모음이다. Core/Generation/Runtime 구조가 변화함에 따라 Debug 도구도 최신 규약을 따라야 하며, 운영·개발 환경에서 신뢰할 수 있는 출력과 차트/리포트를 제공해야 한다. 본 문서는 현재 상태(AS-IS)와 목표(TO-BE)를 비교하고 구체적인 개선 방향을 제시한다.

## 2. AS-IS (현황)
- **구식 객체 모델**: 디버그 도구가 오래된 AST 구조를 가정하여 새로운 노드(예: `EUserFC`, `SUserFB`)를 표시하지 못한다.
- **출력 형식 일관성 부족**: 텍스트/JSON/시각화 포맷이 통일되어 있지 않아 다른 도구와 연동하기 어렵다.
- **관측 데이터 제한**: 런타임 Trace, 스캔 시간, 인스턴스 상태 변화 등 핵심 데이터 수집이 미흡하다.
- **자동화 부재**: 디버그 리포트 생성이 수동이며 테스트 커버리지가 낮아 유지보수가 어렵다.

## 3. TO-BE (목표 상태)
- **최신 AST 호환**: 새로운 Core 구조와 Validation 메타데이터를 반영하여 모든 노드를 시각화한다.
- **표준화된 출력 포맷**: 텍스트, JSON, HTML 등 출력 포맷을 모듈화하고 안정적인 스키마를 제공한다.
- **강화된 관측성**: 런타임 트레이스, 상태 스냅샷, 성능 데이터를 통합하여 분석 뷰를 제공한다.
- **자동화와 테스트**: 디버그 리포트가 CI에서 자동 생성·검증되며, 스냅샷 테스트로 품질을 보장한다.

## 4. 개선 항목

### 4.1 API 연동 개선
- Core/Runtime이 제공하는 구조체와 ValidationResult를 직접 사용하도록 어댑터를 리팩터링한다.
- DSL과 런타임의 버전 차이를 감지하고, 경고/가이드 메시지를 출력한다.

### 4.2 시각화 파이프라인 재구성
- 렌더러를 텍스트/JSON/HTML/그래프 등으로 추상화하고 공통 포맷팅 규칙을 적용한다.
- 대형 프로그램을 분석할 때 필터링, 그룹화, 하이라이트 기능을 제공한다.

### 4.3 관측 데이터 수집
- 런타임 이벤트(스캔 시작/종료, 오류, 상태 변경)를 구독하여 Debug 뷰어에 전달한다.
- FB 인스턴스 상태를 시계열 그래프로 시각화할 수 있는 데이터 구조를 정의한다.

### 4.4 개발자 경험 개선
- VS Code 작업, CLI 명령, FSI 스크립트 등 다양한 환경에서 디버그 도구를 호출할 수 있는 스크립트를 제공한다.
- 예제 프로젝트를 포함한 사용 가이드와 FAQ를 작성한다.

### 4.5 테스트 및 자동화
- 렌더링 결과를 스냅샷 테스트로 관리하고, Diff가 있을 경우 원인을 쉽게 파악할 수 있게 한다.
- JSON/HTML 스키마를 검증하는 자동화 테스트를 추가한다.
- CI 파이프라인에서 샘플 프로그램의 디버그 리포트를 생성해 배포 아티팩트로 첨부한다.

## 5. 리스크 및 대응
- **출력 포맷 변경으로 인한 호환성 문제**: 버전 필드를 포함하고, 이전 포맷을 읽는 호환 모듈을 일정 기간 유지한다.
- **성능 부담**: 대규모 데이터 수집 시 Sampling/Throttle 옵션을 제공한다.
- **테스트 유지 비용**: 스냅샷 업데이트 프로세스를 문서화하고 자동화 스크립트를 배포한다.

## 6. 실행 일정
1. **M1**: Core/Runtime 연동 어댑터 갱신 및 기본 테스트.
2. **M2**: 시각화 모듈 재구성과 표준 포맷 도입.
3. **M3**: 런타임 이벤트/트레이스 연동 및 데이터 수집 기능 구현.
4. **M4**: 자동화/스냅샷 테스트 구축, 문서 및 예제 배포.
