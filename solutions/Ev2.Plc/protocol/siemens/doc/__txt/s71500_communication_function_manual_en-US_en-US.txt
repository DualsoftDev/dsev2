1
Introduction
2
Security
information
3
Industrial
cybersecurity
SIMATIC
4
Product
overview
S7-1500, ET 200MP, ET 200SP,
ET
200AL,
ET
200pro,
ET
200eco
5
Communications
services
PN
Communication
Function
Manual
6
PG
communication
7
HMI
communication
8
Open
User
Communication
9
S7
communication
10
Point-to-point link
11
OPC
UA
communication
12
Addressing
via
DHCP
13
Routing
14
Connection
resources
15
Diagnostics
and
fault
correction
11/2024
A5E03735815-AM
Continued
on
next
page
16
Communication
with
the
redundant
system
S7-1500R/H
17
Industrial
Ethernet
Security
with
CP
1543-1
Continued
S7-1500, ET 200MP, ET 200SP,
ET
200AL,
ET
200pro,
ET
200eco
PN
Communication
Function
Manual
Legal
information
Warning
notice
system
DANGER
WARNING
This manual contains notices you have to observe in order to ensure your personal safety, as well as to prevent
damage
to
property.
The
notices
referring
to
your
personal
safety
are
highlighted
in
the
manual
by
a
safety
alert
symbol, notices referring only to property damage have no safety alert symbol. These notices shown below are
graded
according
to
the
degree
of
danger.
indicates
that
death
or
severe
personal
injury
will
result
if
proper
precautions
are
not
taken.
indicates
that
death
or
severe
personal
injury
may
result
if
proper
precautions
are
not
taken.
indicates
that
minor
personal
injury
can
result
if
proper
precautions
are
not
taken.
indicates
that
property
damage
can
result
if
proper
precautions
are
not
taken.
NOTICE
CAUTION
If
more
than
one
degree
of
danger
is
present,
the
warning
notice
representing
the
highest
degree
of
danger
will
be used. A notice warning of injury to persons with a safety alert symbol may also include a warning relating to
property
damage.
Qualified
Personnel
The
product/system
described
in
this
documentation
may
be
operated
only
by
personnel
qualified
for
the
specific
task
in
accordance
with
the
relevant
documentation,
in
particular
its
warning
notices
and
safety
instructions.
Qualified
personnel
are
those
who,
based
on
their
training
and
experience,
are
capable
of
identifying
risks
and
avoiding
potential
hazards
when
working
with
these
products/systems.
Proper
use
of
Siemens
products
WARNING
Note
the
following:
Siemens products may only be used for the applications described in the catalog and in the relevant technical
documentation.
If
products
and
components
from
other
manufacturers
are
used,
these
must
be
recommended
or
approved by Siemens. Proper transport, storage, installation, assembly, commissioning, operation and
maintenance are required to ensure that the products operate safely and without any problems. The permissible
ambient
conditions
must
be
complied
with.
The
information
in
the
relevant
documentation
must
be
observed.
Trademarks
All
names
identified
by
®
are
registered
trademarks
of
Siemens
Aktiengesellschaft.
The
remaining
trademarks
in
this
publication
may
be
trademarks
whose
use
by
third
parties
for
their
own
purposes
could
violate
the
rights
of
the
owner.
Disclaimer
of
Liability
We have reviewed the contents of this publication to ensure consistency with the hardware and software
described. Since variance cannot be precluded entirely, we cannot guarantee full consistency. However, the
information
in
this
publication
is
reviewed
regularly
and
any
necessary
corrections
are
included
in
subsequent
editions.
Siemens
Aktiengesellschaft
Digital
Industries
Postfach
48
48
90026
NÜRNBERG
GERMANY
A5E03735815-AM
Ⓟ
10/2024
Subject to
change
Copyright © Siemens 2013 - 2024.
All
rights
reserved
Table
of
contents
10
1
Introduction........................................................................................................................................
17
17
19
21
21
21
23
1.1
Function
Manuals
documentation
guide...........................................................................
1.1.1
Information
classes
Function
Manuals...............................................................................
1.1.2
Basic
tools........................................................................................................................
1.1.3
S7
Port
Configuration
Tool
(S7-PCT)..................................................................................
1.1.4
S7
Failsafe
Configuration
Tool
(S7-FCT).............................................................................
1.1.5
MultiFieldbus
Configuration
Tool
(MFCT)..........................................................................
1.1.6
SIMATIC
Technical
Documentation....................................................................................
25
2
Security
information...........................................................................................................................
25
2.1
General
security
information.............................................................................................
26
3
Industrial
cybersecurity......................................................................................................................
26
3.1
Cybersecurity
information.................................................................................................
27
3.2
Security-relevant
information
in
this
manual.....................................................................
28
4
Product
overview................................................................................................................................
33
5
Communications
services...................................................................................................................
33
5.1
Overview
of
communication
options.................................................................................
36
5.2
Communications
protocols
and
port
numbers
used
for
Ethernet
communication...............
44
5.3
Overview
of
connection
resources.....................................................................................
45
5.4
Setting
up
a
connection....................................................................................................
49
5.5
Data
consistency...............................................................................................................
52
52
52
55
57
60
64
64
65
68
73
76
77
77
80
81
83
85
5.6
Secure
Communication.....................................................................................................
5.6.1
Basics
of
Secure
Communication.......................................................................................
5.6.1.1
Useful
information
on
Secure
Communication...................................................................
5.6.1.2
Device-dependent
security
features...................................................................................
5.6.1.3
Confidentiality
through
encryption....................................................................................
5.6.1.4
Authenticity
and
integrity
through
signatures....................................................................
5.6.2
Managing
certificates........................................................................................................
5.6.2.1
What
you
should
know
about
the
certificate
management.................................................
5.6.2.2
Certificate
management
with
TIA
Portal............................................................................
5.6.2.3
Examples
for
the
management
of
certificates....................................................................
5.6.2.4
How
communication
with
certificates
works:
HTTP
over
TLS..............................................
5.6.2.5
Tip:
Updating
loaded
certificates
in
RUN............................................................................
5.6.3
Requirements
for
secure
communication..........................................................................
5.6.3.1
Protection
of
confidential
configuration
data.....................................................................
5.6.3.2
Useful
information
for
the
protection
of
confidential
PLC
configuration
data......................
5.6.3.3
Changing
your
password...................................................................................................
5.6.3.4
Resetting
the
password.....................................................................................................
5.6.3.5
Assign
password
via
SIMATIC
Memory
Card.......................................................................
Communication
4
Function
Manual,
11/2024,
A5E03735815-AM
Table
of
contents
87
88
89
90
90
92
94
97
5.6.3.6
Special
features
when
backing
up
and
restoring
a
CPU......................................................
5.6.3.7
Tips
for
error
avoidance
and
error
handling.......................................................................
5.6.3.8
Rules
for
the
replacement
parts
scenario...........................................................................
5.6.4
Secure
Open
User
Communication....................................................................................
Secure
OUC
of
an
S7-1500
CPU
as
TLS
client
to
an
external
PLC
(TLS
server)......................
Secure
OUC
of
an
S7-1500
CPU
as
TLS
server
to
an
external
PLC
(TLS
client)......................
5.6.4.3
Secure
OUC
between
two
S7-1500
CPUs...........................................................................
5.6.4.4
Secure
OUC
via
CP
interface..............................................................................................
102
104
107
107
109
110
112
114
116
117
5.6.4.5
Secure
OUC
with
Modbus
TCP...........................................................................................
5.6.4.6
Secure
OUC
via
e-mail.......................................................................................................
5.6.5
Secure
PG/HMI
communication.........................................................................................
5.6.5.1
PG/HMI
communication
based
on
standardized
security
mechanisms.................................
5.6.5.2
Additional
settings
for
the
secure
PG/HMI
communication.................................................
5.6.5.3
Tip
for
certificate-based
communication
between
PG
and
CPU...........................................
5.6.5.4
CPU
behavior
from
loading
to
operational
readiness..........................................................
5.6.5.5
Using
secure
HMI
communication.....................................................................................
5.6.5.6
Using
Legacy
PG/PC
communication
for
TIA
Portal.............................................................
5.6.5.7
Information
about
compatibility........................................................................................
119
119
122
123
5.7
SNMP...............................................................................................................................
5.7.1
Activating
and
deactivating
SNMP.....................................................................................
Activating/deactivating
SNMP
by
data
record
transfer:
Example
for
a
CPU
1516-3
PN/DP....
Activating/deactivating
SNMP
by
data
record
transfer
with
S7-1500R/H
CPUs.....................
127
6
PG
communication..............................................................................................................................
129
7
HMI
communication...........................................................................................................................
131
8
Open
User
Communication.................................................................................................................
131
8.1
Overview
of
Open
User
Communication............................................................................
132
8.2
Protocols
for
Open
User
Communication...........................................................................
134
8.3
Instructions
for
Open
User
Communication.......................................................................
138
Open
User
Communication
with
addressing
via
domain
names.........................................
140
Setting
up
Open
User
Communication
via
TCP,
ISO-on-TCP,
UDP
and
ISO...........................
145
8.6
Setting
up
communication
over
FDL..................................................................................
147
8.7
Setting
up
communication
with
Modbus
TCP.....................................................................
150
8.8
Setting
up
communication
via
e-mail................................................................................
151
8.9
Setting
up
communication
via
FTP....................................................................................
154
8.10
Establishment
and
termination
of
communications
relations.............................................
155
9
S7
communication..............................................................................................................................
163
10
Point-to-point
link...............................................................................................................................
168
11
OPC
UA
communication......................................................................................................................
168
168
169
11.1
What
you
need
to
know
about
OPC
UA..............................................................................
11.1.1
OPC
UA
and
Industrie
4.0..................................................................................................
11.1.2
General
features
of
OPC
UA...............................................................................................
Communication
Function
Manual,
11/2024,
A5E03735815-AM
5
Table
of
contents
172
174
178
182
183
11.1.3
OPC
UA
for
S7-1200/S7-1500
CPUs...................................................................................
11.1.4
Access
to
OPC
UA
applications...........................................................................................
11.1.5
Addressing
nodes.............................................................................................................
11.1.6
Namespace
overview
for
the
OPC
UA
server
of
the
S7-1200/1500
CPUs.............................
11.1.7
What
you
need
to
know
about
OPC
UA
clients...................................................................
186
186
188
191
192
193
196
199
199
202
203
205
210
214
217
217
11.2
Security
at
OPC
UA............................................................................................................
11.2.1
Security
settings...............................................................................................................
11.2.2
Certificates
pursuant
to
ITU
X.509.....................................................................................
11.2.3
Certificates
with
OPC
UA...................................................................................................
11.2.4
Creating
self-signed
certificates.........................................................................................
11.2.5
Generating
PKI
key
pairs
and
certificates
yourself..............................................................
11.2.6
Secure
transfer
of
messages..............................................................................................
11.2.7
Certificate
management
via
Global
Discovery
Server
(GDS)................................................
11.2.7.1
Automated
certificate
management
with
GDS...................................................................
11.2.7.2
Configuration
limits
for
Push
function...............................................................................
11.2.7.3
Setting
and
loading
GDS
parameters.................................................................................
11.2.7.4
GDS
commissioning..........................................................................................................
11.2.7.5
Address
model
for
the
push
certificate
management.........................................................
11.2.7.6
CertificateGroups
in
the
address
model
............................................................................
11.2.8
Role-based
security
in
OPC
UA...........................................................................................
11.2.8.1
Interesting
facts
about
role-based
security.........................................................................
221
221
221
223
225
228
230
230
235
237
238
240
242
243
244
244
246
246
248
250
252
254
255
261
264
265
268
269
269
269
11.3
Using
the
S7-1500
as
an
OPC
UA
server.............................................................................
11.3.1
Interesting
information
about
the
OPC
UA
server
of
the
S7-1500
CPUs...............................
11.3.1.1
The
OPC
UA
server
of
the
S7-1500
CPUs............................................................................
11.3.1.2
End
points
of
the
OPC
UA
server........................................................................................
11.3.1.3
Mapping
of
data
types......................................................................................................
11.3.1.4
Runtime
behavior
of
the
OPC
UA
server.............................................................................
11.3.2
Accessing
OPC
UA
server
data...........................................................................................
11.3.2.1
Client
accesses
and
local
accesses
to
the
OPC
UA
server.....................................................
11.3.2.2
Managing
write
and
read
rights........................................................................................
11.3.2.3
Managing write
and
read
rights
for a
complete
DB............................................................
11.3.2.4
Coordinating
write
and
read
rights
for
CPU
tags.................................................................
11.3.2.5
Consistency
of
CPU
tags....................................................................................................
11.3.2.6
Write
accesses
to
OPC
UA variables
from
S7-1500
Motion
Control......................................
11.3.2.7
Accessing
OPC
UA
server
data...........................................................................................
11.3.2.8
MinimumSamplingInterval
attribute..................................................................................
11.3.2.9
Export
OPC
UA
XML
file.....................................................................................................
11.3.3
Configuring
the
OPC
UA
server..........................................................................................
11.3.3.1
Enabling
the
OPC
UA
server...............................................................................................
11.3.3.2
Access
to
the
OPC
UA
server..............................................................................................
11.3.3.3
General
settings
of
the
OPC
UA
server...............................................................................
11.3.3.4
Settings
of  the
server
for  subscriptions..............................................................................
11.3.3.5
Using
the
TransferSubscription
service..............................................................................
11.3.3.6
Handling
client
and
server
certificates...............................................................................
11.3.3.7
Generating
server
certificates
with
STEP
7.........................................................................
11.3.3.8
User
authentication..........................................................................................................
11.3.3.9
Users
and
roles
with
OPC
UA
function
rights......................................................................
11.3.3.10
Diagnostic
settings
of
the
server........................................................................................
11.3.3.11
License
for
OPC
UA...........................................................................................................
11.3.4
OPC
UA
server
interface
configuration...............................................................................
11.3.4.1
What
is
a
server
interface?.................................................................................................
Communication
6
Function
Manual,
11/2024,
A5E03735815-AM
Table
of
contents
271
278
283
290
291
293
295
299
300
303
307
307
307
310
312
312
316
319
321
322
324
326
329
333
336
336
337
338
340
341
341
343
346
11.3.4.2
Using
OPC
UA
companion
specifications............................................................................
11.3.4.3
Creating
a
server
interface
for
companion
specification.....................................................
11.3.4.4
Creating
a
user-defined
server
interface............................................................................
11.3.4.5
Data
types
for
companion
specifications............................................................................
11.3.4.6
LocalizedText
and
ByteString
data
types............................................................................
11.3.4.7
Using
additional OPC UA data types
for
companion
specifications......................................
11.3.4.8
Dynamic
arrays.................................................................................................................
11.3.4.9
Rules
for
OPC
UA
XML
files................................................................................................
11.3.4.10
Creating
a
server
interface
for
reference
namespace..........................................................
Generating
OPC
UA
nodes
based
on
local
data
mappings
of
FB
types
and
UDTs..................
Notes
on
configuration
limits
when
using
server
interfaces...............................................
11.3.5
Providing
methods
on
the
OPC
UA
server..........................................................................
11.3.5.1
Useful
information
about
server
methods..........................................................................
11.3.5.2
Boundary
conditions
for
using
server
methods..................................................................
11.3.6
Providing
alarms
on
the
OPC
UA
server..............................................................................
11.3.6.1
Useful
information
on
alarms............................................................................................
11.3.6.2
OPC
UA
Events..................................................................................................................
11.3.6.3
OPC
UA
conditions
and
OPC
UA
alarms..............................................................................
11.3.6.4
Activating
Alarms
and
Conditions......................................................................................
11.3.6.5
Subscribing
to
events
of
an
OPC
UA
server........................................................................
11.3.6.6
Processing
associated
values
of
alarms..............................................................................
11.3.6.7
Simultaneous
receipt
of
alarms
in
multiple
languages.......................................................
11.3.6.8
Methods
for
OPC
UA
Alarms
and
Conditions......................................................................
11.3.6.9
Handling
memory
limits
for
OPC
UA
Alarms
and
Conditions...............................................
11.3.7
Using
diagnostics
options.................................................................................................
11.3.7.1
Diagnostics
of
the
OPC
UA
server......................................................................................
11.3.7.2
Running
diagnostics
for
OPC
UA
servers
in
the
program.....................................................
11.3.7.3
Server
state
transition
diagnostics.....................................................................................
11.3.7.4
Session
state
transition
diagnostics...................................................................................
11.3.7.5
Check
for
security
events..................................................................................................
11.3.7.6
Request
of
a
remote
client
failed.......................................................................................
11.3.7.7
Subscription
diagnostics...................................................................................................
11.3.7.8
Summarizing
diagnostics..................................................................................................
349
349
350
352
354
355
363
366
368
370
370
373
376
377
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client.......................................................................
11.4.1
Overview
and
requirements..............................................................................................
11.4.2
Useful
information
about
the
client
instructions................................................................
11.4.3
Number
of
client
instructions
that
can
be
used
simultaneously..........................................
11.4.4
Example
configuration
for
OPC
UA....................................................................................
11.4.5
Creating
client
interfaces..................................................................................................
11.4.6
Determine
server
interface
online.....................................................................................
11.4.7
Using
multilingual
texts....................................................................................................
11.4.8
Rules
for
the
access
to
structures.......................................................................................
11.4.9
Using
connection
parameter
assignment...........................................................................
11.4.9.1
Creating
and
configuring
connections...............................................................................
11.4.9.2
Handling
of
the
client
certificates
of
the
S7-1500
CPU.......................................................
11.4.9.3
User
authentication..........................................................................................................
11.4.9.4
Using
a
configured
connection..........................................................................................
383
11.5
Tips
and
recommendations...............................................................................................
Communication
Function
Manual,
11/2024,
A5E03735815-AM
7
Table
of
contents
383
384
385
11.5.1
Rules
for
subscriptions......................................................................................................
11.5.2
Rules
for
the
user
program................................................................................................
11.5.3
Master
copies
for
OPC
UA
communication.........................................................................
387
12
Addressing
via
DHCP...........................................................................................................................
389
12.1
Principle
of
address
assignment
via
DHCP..........................................................................
391
12.2
DHCP
with
DNS.................................................................................................................
395
12.3
Activate
DHCP...................................................................................................................
396
12.4
Configuring
the
client
ID...................................................................................................
397
12.5
Get
addresses
of
the
DNS
servers
via
DHCP........................................................................
398
12.6
Get
addresses
of
the
NTP
servers
via
DHCP........................................................................
398
12.7
Obtain
host
and
domain
name via
DHCP...........................................................................
400
13
Routing...............................................................................................................................................
400
13.1
Overview
of
the
routing
mechanisms
of
S7-1500
CPUs......................................................
401
13.2
S7
routing........................................................................................................................
405
13.3
IP
forwarding....................................................................................................................
412
13.4
Data
record
routing...........................................................................................................
414
13.5
Virtual
interface
for
IP-based
applications..........................................................................
418
14
Connection
resources.........................................................................................................................
418
14.1
Connection
resources
of
a
station.....................................................................................
421
14.2
Allocation
of
connection
resources....................................................................................
425
14.3
Display
of
the
connection
resources..................................................................................
429
15
Diagnostics
and
fault
correction.........................................................................................................
429
15.1
Connection
diagnostics.....................................................................................................
432
15.2
Emergency        address...........................................................................................................
433
16
Communication
with
the
redundant
system
S7-1500R/H..................................................................
434
16.1
System
IP
addresses
for
R/H
CPUs......................................................................................
440
16.2
System
IP
addresses
for
communications
processors..........................................................
445
16.3
Improved
accessibility
by
switching
the
system
IP
address.................................................
445
16.4
Response
to
Snycup..........................................................................................................
446
16.5
Response
to
primary-backup
switchover............................................................................
446
16.6
Connection
resources
of
the
redundant
system
S7-1500R/H..............................................
448
448
16.7
HMI
communication
with
the
redundant
system
S7-1500R/H.............................................
16.7.1
HMI
connection
via
the
system
IP
address..........................................................................
450
Open
User
Communication
with
the
redundant
system
S7-1500R/H..................................
Communication
8
Function
Manual,
11/2024,
A5E03735815-AM
Table
of
contents
Setting
up
the
connection
of
the
Open
User
Communication
with
the
redundant
S7-1500R/H
system
....
456
451
Open
User
Communication
with
CP
1543-1
communications
processors............................
457
457
460
462
466
469
16.9
Using
an
OPC
UA
server in
an
S7-1500R/H
system..............................................................
16.9.1
Information
worth
knowing
on
the
OPC
UA
server
in
the
S7-1500R/H
system.....................
16.9.2
Transparent
Mode
(transparent
Redundancy)....................................................................
16.9.3
Non-transparent Mode
(non-transparent Redundancy)......................................................
16.9.4
Information
model
in
detail...............................................................................................
16.9.5
Updated
instructions
for
server
methods...........................................................................
473
17
Industrial
Ethernet
Security
with
CP
1543-1.......................................................................................
474
17.1
Firewall............................................................................................................................
475
17.2
Logging............................................................................................................................
475
17.3
NTP
client.........................................................................................................................
476
17.4
SNMP...............................................................................................................................
476
17.5
VPN..................................................................................................................................
477
Glossary..............................................................................................................................................
489
Index...................................................................................................................................................
Communication
Function
Manual,
11/2024,
A5E03735815-AM
9
Introduction
1
Purpose
of
the
documentation
This
Function
Manual
provides
you
with
an
overview
of
the
communication
options,
the
CPUs,
communications
modules
and
processors
and
PC
systems
of
the
systems
SIMATIC
S7‑1500, ET 200MP, ET 200SP, ET 200AL, ET 200pro and SIMATIC Drive Controller. This
Function
Manual
describes
connection-oriented,
asynchronous
communication.
The
documentation
covers
the
following:
Overview
of
communications
services
Properties
of
communications
services
Overview
of
user
activities
for
setting
up
communications
services
Basic
knowledge
required
The
following
knowledge
is
required
in
order
to
understand
the
Function
Manual:
General
knowledge
of
automation
technology
Knowledge
of
the
industrial
automation
system
SIMATIC
Knowledge
about
how
to
use
STEP
7
(TIA
Portal)
Scope
of
the
documentation
This
documentation
is
the
basic
documentation
for
all
products
of
the
SIMATIC
S7‑1500,
ET 200MP, ET 200SP, ET 200AL and ET 200pro systems. The product documentation is based
on
this
documentation.
Communication
10
Function
Manual,
11/2024,
A5E03735815-AM
Introduction
What&apos;s
new
in
the
Communication
Function
Manual,
Edition
11/2024
as
compared
to
Edition
11/2023
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
Table for communication proto­
cols
and
port
numbers
used
in
Eth­
ernet communication interface
modules
Information
on
protocols
and
ports
used
by
inter­
face modules. You can see at first glance which
default
settings
apply.
This
allows
you
to
specific­
ally
adjust
only
those
settings
that
are
relevant
to
your
application.
Section Communications protocols
and
port
numbers
used
for
Ethernet
communication
(Page
36)
OPC UA: Increased configuration
limits
for
the
following
S7‑1500
CPUs
as
of
FW
version
V4.0
CPU
151x(F)‑3
PN
CPU
151xT(F)‑3
PN
The
S7‑1500
CPUs
151x(F)‑3
PN
and
151xT(F)‑3
PN
from
FW
version
V4.0
allow
the
cre­
ation of a larger number of nodes for server inter­
faces
and
a
larger
number
of
server
methods.
In addition, the performance for read, write and
subscriptions
has
been
improved.
Equipment
Manual
of
the
respective
CPU
OPC
UA:
Simultaneous
receipt
of
messages
in
multiple
languages
For S7-1500 CPUs, OPC UA clients as of firmware
V4.0 can, for example, select one of the available
languages
for
messages.
In
addition,
an
OPC
UA
client
can
request
the
mes­
sage
texts
in
all
three
active
project
languages
sim­
ultaneously. For example, the messages are collec­
ted
on
a
central
server
so
that
the
messages
can
be
evaluated
by
people
in
different
languages.
Section Simultaneous receipt of
alarms
in
multiple
languages
(Page
326)
OPC UA: Role-based security for
S7-1500 CPUs as of FW version
V4.0
With the implementation of the role-based
concept for the S7‑1500 CPUs as of FW version
V4.0,
the
OPC
UA
server
can
manage
in
detail
the
access of specific OPC UA clients to the address
space.
Section
Role-based
security
in
OPC
UA
(Page
217)
OPC UA: Support of the &quot;Transfer
Subscription&quot;
function
for
S7-1500
The
&quot;Transfer
Subscription&quot;
function
is
available
for
S7‑1500 CPUs as of version V3.1.4 to support
applications for load distribution on different OPC
UA
clients.
With
this,
a
subscription
can
be
transferred
to
another
OPC
UA
client.
It
is
not
necessary
to
configure
the
function.
Section Using the
TransferSubscription
service
(Page
254)
What&apos;s
new
in
the
Communication
Function
Manual,
Edition
11/2023
as
compared
to
Edition
11/2022?
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
&quot;Industrial
cybersecurity&quot;
section
Due to the digitalization and increasing network­
ing of machines and industrial plants, the risk of
cyber
attacks
is
also
growing.
Appropriate
protect­
ive measures are therefore mandatory, particularly
in
the
case
of
critical
infrastructure
facilities.
The
section
contains
the
following
information:
Basic
information
on
the
subject
of
industrial
cybersecurity
Measures
to
protect
individual
components
and
the
entire
system
against
manipulation
and
unwanted
access.
Industrial
cybersecurity
(Page
26)
Communication
Function
Manual,
11/2024,
A5E03735815-AM
11
Introduction
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
Revision of the tables for commu­
nication protocols and port num­
bers
used
in
Ethernet
communica­
tion
Updated information on protocols and ports used.
You can see at first glance which default settings
apply. This allows you to specifically adjust only
those
settings
that
are
relevant
to
your
application.
Communications
protocols
and
port
numbers
used
for
Ethernet
commu­
nication
(Page
36)
Updated information about the
connection
resources
of
the
CPU
and
HMI.
Updated
information
on
the
following
connection
resources:
Maximum
number
of
connection
resources
supported
for
some
CPU
types
Maximum
occupied
connection
resources
for
different
HMI
devices
Connection
resources
(Page
418)
Expanding
the
redundant
system
with
communications
processors
As
of
STEP
7
V19,
you
can
expand
an
S7‑1500R/H
redundant system as of FW version V3.1 with the
CP
1543-1
communications
processors.
System
IP
addresses
for
communica­
tions
processors
(Page
440).
Secure
Open
User
Communication
with
the
redundant
system
As
of
STEP
7
V19,
an
S7‑1500R/H
redundant
sys­
tem FW version V3.1 and higher also supports
Secure
Open
User
Communication.
Open User Communication with the
redundant system S7-1500R/H
(Page
450)
What&apos;s
new
in
the
Communication
Function
Manual,
Edition
11/2022
as
compared
to
Edition
05/2021?
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
Revision of the tables for commu­
nication protocols and port num­
bers
used
in
Ethernet
communica­
tion
Updated information on protocols and ports used.
You can see at first glance which default settings
apply. This allows you to specifically adjust only
those
settings
that
are
relevant
to
your
application.
Communications
protocols
and
port
numbers
used
for
Ethernet
commu­
nication
(Page
36)
Activate
/
Deactivate
the
SNMP
Depending on the FW version of the S7-1500
CPUs,
the
SNMP
is
activated
or
deactivated
in
the
default settings. You can change the default set­
tings
as
required.
SNMP
(Page
119)
Revision
of
the
virtual
interface
for
IP-based
applications
With a CP 1543-1 with firmware version V3.0 or
higher, the internal CP firewall is available. This is
used
to
secure
data
traffic
via
the
virtual
interface.
Virtual
interface
for
IP-based
applica­
tions
(Page
414)
OPC UA server: Reading the dia­
gnostics
status
of
the
own
address
space
By using the OPC UA instruction for reading
(&quot;OPC_UA_ReadList&quot;), the own namespace of the
OPC
UA
Server
can
be
accessed.
This
makes
it
pos­
sible to read out the status of the own OPC UA
server as well as the connections of OPC UA cli­
ents, the session as well as the subscriptions and
to react to them in the user program. This allows
connection problems to be quickly detected, for
example,
and
plant
availability
to
be
increased.
Running
diagnostics
for
OPC
UA
serv­
ers
in
the
program
(Page
337)
OPC
UA
server:
Time
stamping
of
the
source
time
of
nodes
By using the OPC UA instruction for writing
(&quot;OPC_UA_WriteList&quot;), it is possible to change the
&quot;SourceTimestamp&quot;
as
well
as
the
status
code
of
an
OPC UA variable (node). This makes it possible to
distinguish
between
the
&quot;Source&quot;
and
&quot;Server&quot;
time
as
of
V18.
Client
accesses
and
local
accesses
to
the
OPC
UA
server
(Page
230)
Communication
12
Function
Manual,
11/2024,
A5E03735815-AM
Introduction
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
OPC UA GDS mechanism: Now
also
usable
for
Web
server
certific­
ates
The Web server certificate for HTTPS communica­
tion
can
now
also
be
managed
via
the
OPC
UA
GDS
mechanism, without separate download of the
hardware
configuration.
What
you
should
know
about
the
cer­
tificate management
(Page 64)
Automated certificate management
with
GDS
(Page
199)
What&apos;s
new
in
the
Communication
Function
Manual,
Edition
05/2021
as
compared
to
Edition
11/2019?
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
Improved
security
for
SIMATIC
PG/HMI
communication
Allows
unique
identification
of
each
PLC
based
on
individual
certificates
Provides additional confidentiality
protection
through
encrypted
communication
Protection
of
the
configuration
data
through
individual
passwords
Secure
PG/HMI
communication
(Page
107)
Security
wizard
for
new
PLC
secur­
ity
mechanisms
Quick
and
easy
configuration
of
the
new
secur­
ity
mechanisms
of
the
PLC
in
one
operation
Supporting
information
to
select
suitable
set­
tings
for
own
application
Protection
of
confidential
configura­
tion
data
(Page
77)
Certificate
management
via
OPC
UA
Global
Discovery
Server
(GDS)
Certificate
update
during
runtime
Support
of
CRLs
Access
protection
for
certificate
management
Certificate
management
via
Global
Discovery
Server
(GDS)
(Page
199)
Transferring
CPU
alarms
to
OPC
UA
clients
Subscriptions
allow
clients
to
subscribe
to
CPU
alarms as &quot;Alarms and Conditions&quot; from the
OPC
UA
server
of
the
CPU.
Program
messages
including
associated
values
are
made
available
by
the
OPC
UA
server
Alarms requiring acknowledgement can be
acknowledged
by
the
OPC
UA
client
(can
be
disabled)
An alarm burst is displayed as &quot;overload&quot; and
clients
can
be
reloaded
with
the
refresh
meth­
od
Providing
alarms
on
the
OPC
UA
serv­
er
(Page
312)
Dynamic
assignment
of
the
net­
work
configuration
with
DHCP
Deployment
of
the
CPU
in
IT
managed
networks
using
the
following
functions:
Connection of the CPU to an existing network
without additional manual configuration of the
network
interface
Request for network parameters for the CPU
according to RFC 2131 from a DHCPv4 server
(IP address and subnet mask, default IP router
address
and
further
optional
network
paramet­
ers
such
as
DNS
and
NTP
server
addresses)
Addressing
via
DHCP
(Page
387)
Communication
Function
Manual,
11/2024,
A5E03735815-AM
13
Introduction
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
Name-based
addressing
with
DNS
DNS
server
addresses
can
be
obtained
from
the
CPU
via
DHCP
The
CPU
can
obtain
host
and
domain
names
from
a
DHCP
server
for
applications
that
are
implemented
with
OPC
UA
or
(Secure)
OUC.
The CPU may transfer configured host or
domain
names
to
DHCP
servers
coupled
with
DNS
servers
for
dynamic
matching
(Dynamic
DNS).
The
NTP
client
of
the
CPU
can
address
NTP
serv-
ers
with
names
Network parameters can be written with the
new
&quot;CommConfig&quot;
instruction,
for
example,
IP
address parameters, DNS server, host and
domain
name
DHCP
with
DNS
(Page
391)
What&apos;s
new
in
the
Communication
Function
Manual,
Edition
11/2019
as
compared
to
Edition
10/2018?
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
IP
forwarding
Simple access from the control level to the field
level
for
configuration
and
parameter
assignment
of
devices,
e.g.
via
PDM
or
Web
browser.
IP
forwarding
(Page
405)
OPC
UA
server
expansion
For S7-1500 CPUs as of firmware V2.8 and TIA
Portal version 16, with a corresponding Runtime
license,
you
can
benefit
from
the
following
expan-
sions
of
the
integrated
OPC
UA
server:
Improved diagnostics: The OPC UA user
receives information on the status of the OPC
UA
server
via
alarms
in
the
diagnostics
buffer,
an OPC UA category in the Online & Dia-
gnostics area of TIA Portal as well as an
improved
connection
resources
display.
Download
behavior:
In
RUN
mode,
the
OPC
UA
server
only
performs
a
restart
during
download
from the TIA Portal when the newly down-
loaded
data
has
an
effect
on
the
data
manage-
ment
of
the
OPC
UA
server.
Server
interface
modeling:
It
is
now
possible
in
the TIA Portal to model server interfaces or
import OPC UA Companion
Specifications and
map
them
to
the
PLC
data
management.
Section
OPC
UA
communication
(Page
168)
Communication
14
Function
Manual,
11/2024,
A5E03735815-AM
Introduction
What&apos;s
new
in
the
Communication
Function
Manual,
Edition
10/2018
as
compared
to
Edition
12/2017?
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
Description of communication
with
the
S7‑1500R/H
redundant
system
You receive information on the particularities of
communication
with
the
S7-1500R/H
redundant
system
Section Communication with the
redundant
system
S7-1500R/H
(Page
433)
Scope of the Function Manual
expanded to include the
S7‑1500R/H
redundant
system
Functions with which you are familiar from the
SIMATIC
S7‑1500
automation
system
are
imple-
mented
for
the
S7‑1500R/H
redundant
system.
S7-1500R/H
redundant
system
Sys-
tem Manual
(
https://support.industry.siemens.
com/cs/ww/en/view/109754833
)
What&apos;s
new
in
the
Communication
Function
Manual,
Edition
12/2017
compared
to
Edition
09/2016
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
OPC
UA
Companion
Specification
Through OPC
UA Companion Specification, meth-
ods can be specified in a uniform and manufac-
turer-neutral way. Using these specified methods,
you
can
easily
integrate
devices
from
various
man-
ufacturers into the plant and the production pro-
cesses.
Section
OPC
UA
server
interface
con-
figuration
(Page
269)
Setting
up
a
secure
connection
to
a mail server over the CPU inter-
face
You
can
set
up
a
secure
connection
to
a
mail
serv-
er
without
additional
hardware.
Section
Secure
OUC
via
e-mail
(Page
104)
Secure
communication
over
Mod-
bus
TCP
You
can
establish
secure
TCP
connections
between
a
Modbus
TCP
client
and
a
Modbus
TCP
server.
Section
Secure
OUC
with
Modbus
TCP
(Page
102)
What&apos;s
new
in
the
Communication
Function
Manual,
Edition
09/2016
compared
to
Edition
12/2014
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
OPC
UA
server
OPC
UA
is
a
uniform
standard
for
data
communica-
tion
and
is
independent
of
any
particular
operating
system
platforms.
OPC UA uses integrated safety mechanisms on
various
automation
systems,
for
example
with
data
exchange,
at
application
level,
for
the
legitim-
ation
of
the
user.
The
OPC
UA
server
provides
a
large
amount
of
data:
Values
of
PLC
tags
that
clients
can
access
Data
types
of
these
PLC
tags
Information
about
the
OPC
UA
server
itself
and
the
CPU
In this way, clients can gain an overview of the tag
management
and
can
read
and
write
values.
Section
OPC
UA
communication
(Page
168)
Communication
Function
Manual,
11/2024,
A5E03735815-AM
15
Introduction
What&apos;s
new?
What
are
the
customer
benefits?
Where
can
I
find
the
information?
Secure
Open
User
Communication
Secure
data
exchange
with
other
devices.
Section
Secure
Open
User
Communic-
ation
(Page
90)
Certificate
handling
in
STEP
7
You
can
manage
certificates
for
the
following
applications
in
STEP
7:
OPC
UA
server
Secure
Open
User
Communication
Web
server
of
the
CPU
Section Certificate management with
TIA
Portal
(Page
65)
Deactivating
SNMP
for
the
CPU
You can deactivate SNMP for the CPU. This can
make
sense
under
certain
conditions,
for
example
if the security guidelines in your network do not
permit
SNMP.
Section
SNMP
(Page
119)
Conventions
STEP
7:
We
refer
to
&quot;STEP
7&quot;
in
this
documentation
as
a
synonym
for
the
configuration
and
programming
software
&quot;STEP
7
as
of
V12
(TIA
Portal)&quot;.
Due
to
continuous
controller
functions,
the
term
&quot;S7-1500
CPUs&quot;
also
usually
refer
to
the
CPU
variants
S7‑1500F,
S7‑1500T,
S7‑1500TF,
S7‑1500C,
S7‑1500R/H,
S7‑1500pro,
ET200SP,
S7‑1500 Software Controller, as well as SIMATIC Drive Controller. Variations arise due to
different
designs
and
applications
between
Advanced
Controllers,
Distributed
Controllers,
and
Software
Controllers.
This
documentation
contains
pictures
of
the
devices
described.
The
figures
may
differ
slightly
from
the
device
supplied.
You
should
also
pay
particular
attention
to
notes
such
as
the
one
shown
below:
NOTE
A
note
contains
important
information
on
the
product,
on
handling
of
the
product
and
on
the
section
of
the
documentation
to
which
you
should
pay
particular
attention.
Industry
Mall
The
Industry
Mall
is
the
catalog
and
order
system
of
Siemens
AG
for
automation
and
drive
solutions
on
the
basis
of
Totally
Integrated
Automation
(TIA)
and
Totally
Integrated
Power
(TIP).
You
can
find
catalogs
for
all
automation
and
drive
products
on
the
Internet
(
https://mall.industry.siemens.com
).
Communication
16
Function
Manual,
11/2024,
A5E03735815-AM
Introduction
1.1
Function
Manuals
documentation
guide
Function
Manuals
documentation
guide
Information
classes
Function
Manuals
The
documentation
for
the
SIMATIC
S7‑1500
automation
system,
for
the
1513/1516pro-2
PN,
SIMATIC
Drive
Controller
CPUs
based
on
SIMATIC
S7‑1500
and
the
SIMATIC
ET
200MP,
ET
200SP,
ET
200AL
and
ET
200eco
PN
distributed
I/O
systems
is
arranged
into
three
areas.
(
https://support.industry.siemens.com/cs/ww/en/view/109742705
).
This
arrangement
enables
you
to
access
the
specific
content
you
require.
You
can
download
the
documentation
free
of
charge
from
the
Internet
Basic
information
The
system
manuals
and
Getting
Started
describe
in
detail
the
configuration,
installation,
wiring
and
commissioning
of
the
SIMATIC
S7‑1500,
SIMATIC
Drive
Controller,
ET
200MP,
ET
200SP,
ET
200AL
and
ET
200eco
PN
systems.
Use
the
corresponding
operating
instructions
for
1513/1516pro-2
PN
CPUs.
The
STEP
7
online
help
supports
you
in
the
configuration
and
programming.
Examples:
Getting
Started
S7-1500
System
manuals
Operating
instructions
ET
200pro
and
1516pro-2
PN
CPU
Online
help
TIA
Portal
Device
information
Equipment
manuals
contain
a
compact
description
of
the
module-specific
information,
such
as
properties,
wiring
diagrams,
characteristics
and
technical
specifications.
Examples:
Equipment
manuals
for
CPUs
Equipment
manuals
for
interface
modules
Equipment
manuals
for
digital
modules
Equipment
manuals
for
analog
modules
Equipment
manuals
for
communication
modules
Equipment
manuals
for
technology
modules
Equipment
manuals
for
power
supply
modules
Equipment
manuals
for
BaseUnits
Communication
Function
Manual,
11/2024,
A5E03735815-AM
17
Introduction
Function
Manuals
documentation
guide
General
information
The
function
manuals
contain
detailed
descriptions
on
general
topics
relating
to
the
SIMATIC
Drive
Controller
and
the
S7-1500
automation
system.
Examples:
Function
Manual
Diagnostics
Function
Manual
Communication
Function
Manuals
Motion
Control
Function
Manual
Web
Server
Function
Manual
Cycle
and
Response
Times
PROFINET
Function
Manual
PROFIBUS
Function
Manual
Product
Information
Changes
and
supplements
to
the
manuals
are
documented
in
a
Product
Information.
The
Product
Information
takes
precedence
over
the
device
and
system
manuals.
You
will
find
the
latest
Product
Information
on
the
Internet:
S7-1500/ET
200MP
(
https://support.industry.siemens.com/cs/de/en/view/68052815
)
SIMATIC Drive Controller
(
https://support.industry.siemens.com/cs/de/en/view/109772684/en
)
Motion
Control
(
https://support.industry.siemens.com/cs/de/en/view/109794046/en
)
ET
200SP
(
https://support.industry.siemens.com/cs/de/en/view/73021864
)
ET
200eco PN
(
https://support.industry.siemens.com/cs/ww/en/view/109765611
)
Manual
Collections
The
Manual
Collections
contain
the
complete
documentation
of
the
systems
put
together
in
one
file.
You
will
find
the
Manual
Collections
on
the
Internet:
S7-1500/ET 200MP/SIMATIC Drive Controller
(
https://support.industry.siemens.com/cs/ww/en/view/86140384
)
ET
200SP
(
https://support.industry.siemens.com/cs/ww/en/view/84133942
)
ET
200AL
(
https://support.industry.siemens.com/cs/ww/en/view/95242965
)
ET
200eco PN
(
https://support.industry.siemens.com/cs/ww/en/view/109781058
)
Communication
18
Function
Manual,
11/2024,
A5E03735815-AM
Introduction
1.1
Function
Manuals
documentation
guide
Basic
tools
Tools
The
tools
described
below
support
you
in
all
steps:
from
planning,
over
commissioning,
all
the
way
to
analysis
of
your
system.
TIA Selection Tool
The
TIA
Selection
Tool
tool
supports
you
in
the
selection,
configuration,
and
ordering
of
devices
for
Totally
Integrated
Automation
(TIA).
As
successor
of
the
SIMATIC
Selection
Tools
,
the
TIA
Selection
Tool
assembles
the
already
known
configurators
for
automation
technology
into
a
single
tool.
With
the
TIA
Selection
Tool
,
you
can
generate
a
complete
order
list
from
your
product
selection
or
product
configuration.
(
https://support.industry.siemens.com/cs/ww/en/view/109767888
)
You
can
find
the
TIA
Selection
Tool
on
the
Internet.
SIMATIC
Automation
Tool
You
can
use
the
SIMATIC
Automation
Tool
to
perform
commissioning
and
maintenance
activities
on
various
SIMATIC
S7
stations
as
bulk
operations
independent
of
TIA
Portal.
The
SIMATIC
Automation
Tool
offers
a
wide
range
of
functions:
Scanning
of
a
PROFINET/Ethernet
system
network
and
identification
of
all
connected
CPUs
Assignment
of
addresses
(IP,
subnet,
Gateway)
and
device
name
(PROFINET
device)
to
a
CPU
Transfer
of
the
date
and
the
programming
device/PC
time
converted
to
UTC
time
to
the
module
Program
download
to
CPU
RUN/STOP
mode
switchover
CPU
localization
through
LED
flashing
Reading
out
of
CPU
error
information
Reading
the
CPU
diagnostic
buffer
Reset
to
factory
settings
(
https://support.industry.siemens.com/cs/ww/en/view/98161300
)
Firmware update of the CPU and connected modules
You
can
find
the
SIMATIC
Automation
Tool
on
the
Internet.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
19
Introduction
1.1
Function
Manuals
documentation
guide
PRONETA
SIEMENS
PRONETA
(PROFINET
network
analysis)
is
a
commissioning
and
diagnostic
tool
for
PROFINET
networks.
PRONETA
Basic
has
two
core
functions:
In the network analysis, you get an overview of the PROFINET topology. Compare a real
configuration with a reference installation or make simple parameter changes, e.g. to the
names
and
IP
addresses
of
the
devices.
The
&quot;IO
test&quot;
is
a
simple
and
rapid
test
of
the
wiring
and
the
module
configuration
of
a
plant,
including
documentation
of
the
test
results.
(
https://support.industry.siemens.com/cs/ww/en/view/67460624
)
You
can
find
SIEMENS
PRONETA
Basic
on
the
Internet:
SIEMENS PRONETA Professional is a licensed product that offers you additional functions. It
offers you simple asset management in PROFINET networks and supports operators of
automation
systems
in
automatic
data
collection/acquisition
of
the
components
used
through
various
functions:
The
user
interface
(API)
offers
an
access
point
to
the
automation
cell
to
automate
the
scan
functions
using
MQTT
or
a
command
line.
With PROFIenergy diagnostics, you can quickly detect the current pause mode or the
readiness
for
operation
of
devices
that
support
PROFIenergy
and
change
these
as
needed.
The
data
record
wizard
supports
PROFINET
developers
in
reading
and
writing
acyclic
PROFINET
data
records
quickly
and
easily
without
PLC
and
engineering.
(
https://www.siemens.com/proneta-professional
)
You
can
find
SIEMENS
PRONETA
Professional
on
the
Internet.
SINETPLAN
SINETPLAN,
the
Siemens
Network
Planner,
supports
you
in
planning
automation
systems
and
networks
based
on
PROFINET.
The
tool
facilitates
professional
and
predictive
dimensioning
of
your
PROFINET
installation
as
early
as
in
the
planning
stage.
In
addition,
SINETPLAN
supports
you
during
network
optimization
and
helps
you
to
exploit
network
resources
optimally
and
to
plan reserves. This helps to prevent problems in commissioning or failures during productive
operation even in advance of a planned operation. This increases the availability of the
production
plant
and
helps
improve
operational
safety.
The
advantages
at
a
glance
Network
optimization
thanks
to
port-specific
calculation
of
the
network
load
Increased
production
availability
thanks
to
online
scan
and
verification
of
existing
systems
Transparency
before
commissioning
through
importing
and
simulation
of
existing
STEP
7
projects
Efficiency
through
securing
existing
investments
in
the
long
term
and
the
optimal
use
of
resources
(
https://new.siemens.com/global/en/products/automation/industrial-
communication/profinet/sinetplan.html
).
You
can
find
SINETPLAN
on
the
Internet
Communication
20
Function
Manual,
11/2024,
A5E03735815-AM
Introduction
1.1
Function
Manuals
documentation
guide
S7
Port
Configuration
Tool
(S7-PCT)
SIMATIC
S7-PCT
The
Port
Configuration
Tool
(PCT)
is
a
PC-based
software
for
the
parameter
assignment
of
Siemens
IO-Link
Master
modules
and
IO-Link
devices
from
any
manufacturer.
You
integrate
IO-Link-devices
using
the
standardized
device
description
&quot;IODD&quot;,
which
you
get from the respective device manufacturer. S7-PCT supports version 1.0 and V1.1 of the
IODD.
S7-PCT
is
called
via
the
hardware
configuration
of
the
IO-Link
Master
from
STEP
7.
When
STEP
7 is not used or the IO-Link Master is not operated on a SIMATIC controller, &quot;standalone&quot;-
operation
is
also
possible.
(
https://new.siemens.com/global/en/products/automation/industrial
-communication/io-
ink.html
).
You
can
find
additional
information
on
IO-Link
on
the
Internet
l
S7
Failsafe
Configuration
Tool
(S7-FCT)
SIMATIC
S7-FCT
Failsafe
Configuration
Tool
(FCT)
enables
you
to
GSD
configure
the
following
devices
in
third-
party
engineering
systems:
Selected,
functionally
fail-safe
SIMATIC
I/O
devices
Functionally
fail-safe
SIRIUS
ACT
PROFINET
interfaces
The
engineering
system
must
meet
the
following
requirements
for
this:
Support
of
the
CPD
system
integration
acc.
to
&quot;PROFIsafe
-
Profile
for
Safety
Technology
on
PROFIBUS
DP
and
PROFINET
IO&quot;
TCI
implementation
to
Conformance
Class
C3
Additional
information
on
S7-FCT
can
be
found
on
the
Internet
(
https://support.industry.siemens.com/cs/ww/en/view/109762827
).
MultiFieldbus
Configuration
Tool
(MFCT)
MultiFieldbus
Configuration
Tool
MultiFieldbus Configuration Tool (MFCT) is a PC-based software and supports the
configuration of MultiFieldbus- and DALI-devices. In addition, the MFCT offers convenient
options
for
mass
firmware
updates
of
ET
200
devices
with
MultiFieldbus-
support
and
reading
service
data
for
many
other
Siemens
devices.
Functional
scope
of
the
MFCT
MultiFieldbus
configuration:
Engineering,
configuration
and
diagnostics
of
MultiFieldbus-devices,
provision
of
the
required
project
files
(project,
UDT-,
CSV-
and
EDS-file),
transfer/export
of
the
files
to
device
and/or
data
memory.
DALI
configuration:
Device
selection
and
online
configuration
of
DALI
devices.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
21
Introduction
Function
Manuals
documentation
guide
TM
FAST:
Generation
and
download
of
FPGA-UPD-
and
FPGA-DB-files.
Maintenance:
Topology
scan
of
a
Ethernet
network,
reading
of
service
data,
parameter
assignment
and
firmware
update.
Settings:
Language
switching
German
/
English,
network
scanner
speed,
setting
of
the
network
adapter,
installation
of
GSDML-and
EDS-files.
System/installation
requirements
for
MFCT
The
MFCT
runs
under
Microsoft
Windows
and
does
not
require
installation
or
administrator
rights.
For
MFCT
you
must
also
install
the
following
software:
(
https://support.microsoft.com/en
-us/topic/microsoft-net-framework-4-8-offline-installer-
or-windows-9d23f658-3b97-68ab-d013-aa3c3e7495e0
))
Microsoft
.NET
Framework
4.8
(You
can
find
an
Offline
Installer
on
the
Internet.
f
NPcap
from
directory
&quot;Misc&quot;
PG/PC
interface
from
directory
&quot;Misc&quot;
Microsoft
C++
Redistributable
for
x86-systems
(you
can
find
the
installation
data
for
download
on
the
Internet.
(
https://aka.ms/vs/15/release/vc_redist.x86.exe
))
(
https://support.industry.siemens.com/cs/de/en/view/109773881
)
The
download
of
the
tool
and
further
information
as
well
as
documentation
on
the
individual
functions
of
the
MFCT
can
be
found
on
the
Internet.
Communication
22
Function
Manual,
11/2024,
A5E03735815-AM
719962
214599
Introduction
1.1
Function
Manuals
documentation
guide
SIMATIC
Technical
Documentation
Additional
SIMATIC
documents
will
complete
your
information.
You
can
find
these
documents
and
their
use
at
the
following
links
and
QR
codes.
The
Industry
Online
Support
gives
you
the
option
to
get
information
on
all
topics.
Application
examples
support
you
in
solving
your
automation
tasks.
Overview
of
the
SIMATIC
Technical
Documentation
Here
you
will
find
an
overview
of
the
SIMATIC
documentation
available
in
Siemens
Industry
Online
Support:
1799970
89446
(
https://support.industry.siemens.com/cs/ww/en/view/109742705
)
Industry
Online
Support
International
Watch this short video to find out where you can find the overview directly in Siemens
Industry
Online
Support
and
how
to
use
Siemens
Industry
Online
Support
on
your
mobile
device:
1799970
69749
2855283
187817
Quick
introduction
to
the
technical
documentation
of
automation
products
per
video
(
https://support.industry.siemens.com/cs/us/en/view/109780491
)
1799970
132146
2932626
250047
YouTube
video:
Siemens
Automation
Products
-
Technical
Documentation
at
a
Glance
(
https://youtu.be/TwLSxxRQQsA
)
Retention
of
the
documentation
Retain
the
documentation
for
later
use.
For
documentation
provided
in
digital
form:
Download
the
associated
documentation
after
receiving
your
product
and
before
initial
installation/commissioning.
Use
the
following
download
options:
4347660
62058
Industry
Online
Support
International:
(
https://support.industry.siemens.com
)
The article number is used to assign the documentation to the product. The article
number is specified on the product and on the packaging label. Products with new,
non-compatible
functions
are
provided
with
a
new
article
number
and
documentation.
ID
link:
Your product may have an ID link. The ID link is a QR code with a frame and a black
frame
corner
at
the
bottom
right.
The
ID
link
takes
you
to
the
digital
nameplate
of
your
product.
Scan
the
QR
code
on
the
product
or
on
the
packaging
label
with
a
smartphone
camera,
barcode
scanner,
or
reader
app.
Call
up
the
ID
link.
Retain
this
version
of
the
documentation.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
23
Introduction
Function
Manuals
documentation
guide
Updating
the
documentation
The
documentation
of
the
product
is
updated
in
digital
form.
In
particular
in
the
case
of
function
extensions,
the
new
performance
features
are
provided
in
an
updated
version.
Download
the
current
version
as
described
above
via
the
Industry
Online
Support
or
the
ID
link.
Also
retain
this
version
of
the
documentation.
mySupport
With
&quot;mySupport&quot;
you
can
get
the
most
out
of
your
Industry
Online
Support.
Registration
You
must
register
once
to
use
the
full
functionality
of
&quot;mySupport&quot;.
After
registra-
tion,
you
can
create
filters,
favorites
and
tabs
in
your
personal
workspace.
Support
requests
Your
data
is
already
filled
out
in
support
requests,
and
you
can
get
an
overview
of
your
current
requests
at
any
time.
Documentation
In
the
Documentation
area
you
can
build
your
personal
library.
Favorites
You
can
use
the
&quot;Add
to
mySupport
favorites&quot;
to
flag
especially
interesting
or
fre-
quently needed content. Under &quot;Favorites&quot;, you will find a list of your flagged
entries.
Recently
viewed
articles
The
most
recently
viewed
pages
in
mySupport
are
available
under
&quot;Recently
viewed
articles&quot;.
CAx
data
The
CAx
data
area
gives
you
access
to
the
latest
product
data
for
your
CAx
or
CAe
system.
You
configure
your
own
download
package
with
a
few
clicks:
Product images, 2D dimension drawings, 3D models, internal circuit diagrams,
EPLAN
macro
files
Manuals,
characteristics,
operating
manuals,
certificates
Product
master
data
You
can
find
&quot;mySupport&quot;
on
the
Internet.
(
https://support.industry.siemens.com/My/ww/en
)
Application
examples
The application examples support you with various tools and examples for solving your
automation
tasks.
Solutions
are
shown
in
interplay
with
multiple
components
in
the
system
-
separated
from
the
focus
on
individual
products.
(
https://support.industry.siemens.com/cs/ww/en/ps/ae
)
You
can
find
the
application
examples
on
the
Internet.
Communication
24
Function
Manual,
11/2024,
A5E03735815-AM
Security
information
2
General
security
information
(Page
26).
Note the security-relevant information provided in the corresponding system manual.
You
can
find
information
relevant
to
cybersecurity
in
the
section
Industrial
cybersecurity
Communication
Function
Manual,
11/2024,
A5E03735815-AM
25
Industrial
cybersecurity
3
Due
to
the
digitalization
and
increasing
networking
of
machines
and
industrial
plants,
the
risk
of cyber attacks is also growing. Appropriate protective measures are therefore mandatory,
particularly
in
the
case
of
critical
infrastructure
facilities.
Refer to the System Manual and the Security guidelines for SIMATIC HMI devices
(
https://support.industry.siemens.com/cs/us/en/view/109481300
)
for general information and
measures
regarding
industrial
cybersecurity.
This
section
provides
an
overview
of
security-related
information
pertaining
to
the
communication
of
your
SIMATIC
system.
NOTE
(Page
10).
Security-relevant
changes
to
software
or
devices
are
documented
in
the
section
Introduction
Cybersecurity
information
Siemens
provides
products
and
solutions
with
industrial
cybersecurity
functions
that
support
the
secure
operation
of
plants,
systems,
machines
and
networks.
In order to protect plants, systems, machines and networks against cyber threats, it is
necessary
to
implement
–
and
continuously
maintain
–
a
holistic,
state-of-the-art
industrial
cybersecurity concept. Siemens’ products and solutions constitute one element of such a
concept.
Customers are responsible for preventing unauthorized access to their plants, systems,
machines
and
networks.
Such
systems,
machines
and
components
should
only
be
connected
to an enterprise network or the internet if and to the extent such a connection is necessary
and only when appropriate security measures (e.g. firewalls and/or network segmentation)
are
in
place.
For
additional
information
on
industrial
cybersecurity
measures
that
may
be
implemented,
please
visit
https://www.siemens.com/cybersecurity-industry.
Siemens’ products and solutions undergo continuous development to make them more
secure. Siemens strongly recommends that product updates are applied as soon as they are
available and that the latest product versions are used. Use of product versions that are no
longer
supported,
and
failure
to
apply
the
latest
updates
may
increase
customer’s
exposure
to
cyber
threats.
To
stay
informed
about
product
updates,
subscribe
to
the
Siemens
Industrial
Cybersecurity
RSS
Feed
under
https://new.siemens.com/cert.
Communication
26
Function
Manual,
11/2024,
A5E03735815-AM
Industrial
cybersecurity
Security-relevant
information
in
this
manual
Security-relevant
information
in
this
manual
Observe
all
security-relevant
notes
on
topics
in
this
Communication
manual.
Security-relevant
notes
on
...
Section
Interfaces
Product
overview
(Page
28)
Ports
and
protocols
Overview of communication options
(Page 33)
Communications
protocols
and
port
numbers
used
for
Ether-
net
communication
(Page
36)
Secure
communication
Secure
communication
(Page
52)
Activate/deactivate
services
Activating
and
deactivating
SNMP
(Page
119)
Addressing
via
DHCP
(Page
387)
IP
forwarding
(Page
405)
Security
functions
of
OPC
UA
communic-
ation (authentication, certificates, user
creation and roles, secure message
transmission)
OPC
UA
communication
(Page
168)
Activating
security
functions
in
the
com-
munications
modules
Virtual
interface
for
IP-based
applications
(Page
414)
Communication
with
the
redundant
sys-
tem
S7‑1500R/H
Communication with the redundant system
S7‑1500R/H
(Page
433)
Protection
by
Industrial
Ethernet
Security
with
CP
1543-1
Industrial
Ethernet
Security
with CP
1543-1
(Page 473)
Secure
PG/HMI
communication
Secure
PG/HMI
communication
(Page
107)
Protection
of
confidential
data
Protection
of
confidential
configuration
data
(Page
77)
Communication
Function
Manual,
11/2024,
A5E03735815-AM
27
Product
overview
4
CPUs,
communications
modules
and
processors,
and
PC
systems
of
the
S7‑1500,
ET
200MP,
ET 200SP, ET 200pro and ET 200AL systems provide you with interfaces for communication
via
PROFINET,
PROFIBUS
and
point-to-point
connections.
CPUs,
communications
modules
and
communications
processors
PROFINET
and
PROFIBUS
DP
interfaces
are
integrated
in
the
S7‑1500
CPUs.
The
CPU
1516‑3
PN/DP
for
example
has
2
PROFINET
interfaces
and
1
PROFIBUS
DP
interface.
Other
PROFINET and PROFIBUS
DP interfaces are available by using communications modules (CM)
and
communications
processors
(CP).
2
1
3
4
$16
1516-3
1/I%1
$16
151241-1
1/
①
PROFINET
interface
(X2)
with
1
port
②
PROFINET
interface
(X1)
with
2-port
switch
③
PROFIBUS
DP
interface
(X3)
④
PROFINET
interface
(X1)
with
3-port
switch
Figure
4-1
Interfaces
of
the
CPU
1516‑3
PN/DP
and
CPU
1512SP-1
PN
Communication
28
Function
Manual,
11/2024,
A5E03735815-AM
Product
overview
Interfaces
of
communications
modules
Interfaces
of
communications
modules
(CMs)
extend
the
interfaces
of
CPUs
(for
example,
the
communication module CM 1542-5 adds a PROFIBUS interface to S7-1500 automation
system).
$
M
1
5
4
2
-
5
(
7
2
0
0
6
3
Z
i
W
K
&
0
D
3
1
1
①
PROFIBUS
DP
interface
Figure
4-2
PROFIBUS
DP
interface
of
the
CM
1542‑5
and
CM
DP
(to
an
ET
200SP
CPU)
Communication
Function
Manual,
11/2024,
A5E03735815-AM
29
Product
overview
Interfaces
of
communications
processors
Interfaces
of
communication
processors
(CP)
offer
additional
functionality
to
what
is
provided
by the integrated interfaces of the CPUs. CPs allow special applications, for example the CP
1543-1 provides security functions for protecting Industrial Ethernet networks via its
Industrial
Ethernet
interface.
1
$1
1543-1
①
Industrial
Ethernet
interface
Figure
4-3
Industrial
Ethernet
interface
of
the
CP
1543‑1
Communication
30
Function
Manual,
11/2024,
A5E03735815-AM
Product
overview
Interfaces
of
communications
modules
for
point-to-point
connections
The
communication
modules
for
point-to-point
connections
provide
communication
via
their
RS
232-,
RS
422-
and
RS
485
interfaces,
for
example,
Freeport
or
Modbus
communication.
1
$M
1U1
34422I485
BA
①
Interface
for
point-to-point
connections
Figure
4-4
Example
of
interface
for
point-to-point
connection
at
the
CM
PtP
RS422/485
BA
Communication
Function
Manual,
11/2024,
A5E03735815-AM
31
Product
overview
Interfaces
of
interface
modules
PROFINET
and
PROFIBUS
DP
interfaces
of
the
interface
modules
(IM)
in
ET
200MP,
ET
200SP
and ET 200AL are used to connect the distributed I/O ET 200MP, ET 200SP and ET 200AL to
PROFINET
or
PROFIBUS
of
the
higher-level
IO
controller
or
DP
master.
*M
155-5
1/
45
*M
155-6
1/
45
*M
157-1
1/
1
1
1
①
PROFINET
interface
with
2-port
switch
Figure
4-5
PROFINET
interfaces
IM
155‑5
PN
ST
(ET
200MP),
IM
155‑6
PN
ST
(ET
200SP),
and
IM
157-1
PN
(ET
200AL)
Deactivating
the
port
of
a
PROFINET
interface
Activated
ports
represent
a
potential
risk
of
unauthorized
access
to
the
network
and
programs.
To minimize the risk, deactivate all unused ports.
Procedure:
Select
the
port
of
the
PROFINET
interface
in
the
device
view
of
the
CPU/IM
in
STEP
7.
In
the
Inspector
window,
navigate
to
&quot;Advanced
options
>
Port
[x]>
Port
options
>
Activate
Clear
the
&quot;Activate&quot;
check
box.
At
least
one
port
of
a
CPU/IM
remains
activated.
Communications
services
The communications services described below use the interfaces and communication
mechanisms
provided
by
the
system
via
CPUs,
communication
modules
and
processors.
Communication
32
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5
5.1
Overview
of
communication
options
Overview
of
communications
options
The
following
communications
options
are
available
for
your
automation
task.
Table
5-1
Communications
options
Communications
options
Functionality
Via
interface:
PN/IE
1
DP
serial
PG
communication
2
On
commissioning,
testing,
diagnostics
X
X
-
HMI
communication
2
On
operator
control
and
monitoring
X
X
-
Open
communication
via
TCP/IP
2
Data
exchange
via
PROFINET/Industrial
Ethernet
with
TCP/IP
Instructions:
TSEND_C/TRCV_C
TSEND/TRCV
TCON
T_DISCON
X
-
-
Open
communication
using
ISO-on-TCP
2
Data
exchange
via
PROFINET/Industrial
Ethernet
with
ISO‑on‑TCP
Instructions:
TSEND_C/TRCV_C
TSEND/TRCV
TCON
T_DISCON
X
-
-
Open
communication
via
UDP
2
Data
exchange
via
PROFINET/Industrial
Ethernet
with
UDP
Instructions:
TSEND_C/TRCV_C
TUSEND/TURCV
TCON
T_DISCON
X
-
-
Open communication via ISO (only CPs
with
PROFINET/Industrial
Ethernet
inter-
face)
Data
exchange
via
PROFINET/Industrial
Ethernet
with
the
ISO
protocol
Instructions:
TSEND_C/TRCV_C
TSEND/TRCV
TCON
T_DISCON
X
-
-
1
IE
-
Industrial
Ethernet
2
Observe
the
special
characteristics
for
S7‑1500R/H
3
Only
via
internal
PROFINET
interface
of
the
CPU
and
via
Ethernet
interface
CP
1543
1
with
activated
&quot;Access
to
PLC
via
communication
module&quot;
function
Communication
Function
Manual,
11/2024,
A5E03735815-AM
33
Communications
services
Overview
of
communication
options
Communications
options
Functionality
Via
interface:
PN/IE
1
DP
serial
Open communication with FDL (only
CM
1542‑5
as
of
firmware
V2.0)
Data
exchange
via
PROFIBUS
with
the
FDL
protocol
Instructions:
TSEND_C/TRCV_C
TSEND/TRCV
TUSEND/TURCV
TCON
T_DISCON
-
X
-
OPC
UA
server
3
Data
exchange
with
OPC
UA
clients
X
-
-
Communication
via
Modbus
TCP
Data
exchange
via
PROFINET
with
Modbus
TCP
pro-
tocol
Instructions:
MB_CLIENT
MB_SERVER
X
-
-
Email
Sending
process
alarms
via
email
Instruction:
TMAIL_C
X
-
-
FTP
(only
CPs
with
PROFINET/Industrial
Ethernet
interface)
File management and file access via FTP (File Transfer
Protocol); CP can be FTP client and FTP server
Instruction:
FTP_CMD
X
-
-
Fetch/Write (only CPs with
PROFINET/Industrial
Ethernet
interface)
Server
services
via
TCP/IP,
ISO-on-TCP
and
ISO
Via
special
instructions
for
Fetch/Write
X
-
-
S7
communication
Data
exchange
via
PROFINET/PROFIBUS
with
the
S7
protocol.
Instructions:
PUT/GET
BSEND/BRCV
USEND/URCV
X
X
-
Serial
point-to-point
connection
Data
exchange
via
point-to-point
with
Freeport,
3964(R),
USS
or
Modbus
protocol
Via
special
instructions
for
PtP,
USS
or
Modbus
RTU
-
-
X
Web
server
Data
exchange
via
HTTP(S),
for
example
for
dia-
gnostics
X
-
-
SNMP
(Simple
Network
Management
Pro-
tocol)
For monitoring and error recognition of IP networks,
possibly
parameterization
of
the
IP
network
compon-
ents
via
standard
SNMP
protocol
X
-
-
Time-of-day
synchronization
Via
PN/IE
interface:
CPU
is
NTP
client
(Network
Time
Protocol)
X
-
-
Via
DP
interface:
CPU/CM/CP
is
time-of-day
master
or
time
slave
-
X
-
1
IE
-
Industrial
Ethernet
2
Observe
the
special
characteristics
for
S7‑1500R/H
3
Only
via
internal
PROFINET
interface
of
the
CPU
and
via
Ethernet
interface
CP
1543
1
with
activated
&quot;Access
to
PLC
via
communication
module&quot;
function
Communication
34
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
Overview
of
communication
options
Information
on
S7-1500R/H
You
can
find
information
on
the
communication
possibilities
with
the
S7‑1500R/H
redundant
system
in
the
section
Communication
with
the
redundant
system
S7-1500R/H
(Page
433).
More
information
An
application
example
for
the
configuration
of
the
TLS-based
PG/HMI
communication
and
protection of confidential configuration data of the CPU can be found in this Application
example
(
https://support.industry.siemens.com/cs/ww/en/view/109798583
).
A
general
application
example
for
CPU-CPU
communication
with
SIMATIC
controllers
(compendium)
can
be
found
in
this
application
example
(
https://support.industry.siemens.com/cs/ww/en/view/20982954
).
A
TIA
library
&quot;LOpcUa&quot;,
which
provides
you
with
function
blocks
for
the
implementation
of
OPC
UA
PubSub
for
SIMATIC
S7-1500,
can
be
found
in
this
Application
example
(
https://support.industry.siemens.com/cs/ww/en/view/109782455
).
This FAQ (
https://support.industry.siemens.com/cs/ww/en/view/102420020
)
describes
how
to
configure
fetch/write
communication
via
CP1543-1
with
S7‑1500.
More
information
about
the
Fetch/Write
services
is
available
in
the
STEP
7
online
help.
You
can
find
more
information
on
the
PtP
connection
in
the
function
manual
CM
PtP
-
Configurations
for
Point-to-Point
Connections
(
https://support.industry.siemens.com/cs/us/en/view/59057093
).
You
will
find
the
description
of
the
web
server
functionality
in
the
function
manual
Web
server
(
https://support.industry.siemens.com/cs/us/en/view/59193560
).
You can find general information about the standard protocol SNMP on the Service &
Support pages on the Internet
(
https://support.industry.siemens.com/cs/us/en/view/15166742
).
Answers to the question
of which SNMP requests support S7-1500 CPUs and S7-1200 CPUs can be found in this
FAQ
(
https://support.industry.siemens.com/cs/at/en/view/79993228
).
You
will
find
information
about
time-of-day
synchronization
in
this
FAQ
(
https://support.industry.siemens.com/cs/ww/en/view/86535497
).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
35
Communications
services
Communications
protocols
and
port
numbers
used
for
Ethernet
communication
5.2
Communications
protocols
and
port
numbers
used
for
Ethernet
communication
This
section
provides
an
overview
of
the
supported
protocols
and
port
numbers
used
for
communication over PN/IE interfaces. For each protocol the address parameters, the
respective communications layer as well as the communications role and the
communications
direction
are
specified.
This information makes it possible to match the security measures for protection of the
automation system to the used protocols (for example firewall). Because the security
measures
are
limited
to
Ethernet
or
PROFINET
networks,
the
tables
do
not
include
PROFIBUS
protocols.
NOTE
Port
numbers
used
The specified port numbers are the standard port numbers used by S7‑1500 CPUs,
communications
modules
and
ET
200
interface
modules.
Many
communication
protocols
and
implementations
enable
you
to
use
other
port
numbers.
The
following
tables
show
the
different
layers
and
protocols
used
in
S7‑1500
CPUs,
S7‑1500
communications
modules
and
ET
200
interface
modules.
Layers
and
protocols
of
the
S7-1500
CPUs
and
Software
Controllers
(via
PROFINET
interface
of
the
CPU)
The
following
table
shows
the
protocols
supported
by
S7‑1500
CPUs,
ET
200SP
CPUs,
and
the
1513/1516pro‑2
PN
CPUs.
The
S7‑1500
Software
Controllers
also
support
the
protocols
listed
in
the
following
table
for
the
Ethernet
interfaces
that
are
assigned
to
the
Software
Controller.
Table
5-2
Layers
and
protocols
of
the
S7‑1500
CPUs
and
Software
Controllers
(via
PROFINET
interface
of
the
CPU)
Protocol
/
Role
Port
num­
ber
(2)
Link
layer
(4) Transport
lay­
er
Description
/
function
Default
setting
/
notes
PROFINET
protocols
DCP
Not relev-
ant
(2)
Ethertype
0x8892
(PROFINET)
PROFINET
Discovery
and
Basic
Config-
uration
Protocol.
DCP
determines
PROFINET
devices
and
enables
the
basic
settings.
Default: Up to FW version V3.0
enabled, as of FW version V3.1 write
protection
enabled.
DCP does not allow DCP Set com-
mands
from
the
outside
in
write-pro-
tected mode during an active com-
munication
relationship.
Function can be deactivated in the
CPU properties by Boundary &quot;End
of
detection
of
accessible
nodes&quot;
of
the
interface.
DHCP
Client
68
(4)
UDP
Dynamic
Host
Configuration
Protocol.
The IP address suite is obtained from
a DHCP server during the startup of
the
PROFINET
interface.
Default:
Deactivated.
Can
be
changed
in
the
CPU
properties
(as
of
FW
version
2.9).
1
Note:
OUC
(open
communication)
provides
direct
access
to
the
UDP
and
TCP
protocols.
You
must
take
into
consideration
the
IANA
(Internet
Assigned
Numbers
Authority)
port
restrictions
and
definitions.
2
Do
not
use
ports
for
OUC,
which
are
already
used
by
other
protocols.
Communication
36
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.2
Communications
protocols
and
port
numbers
used
for
Ethernet
communication
Protocol
/
Role
Port num­
ber
(2)
Link
layer
(4) Transport lay­
er
Description
/
function
Default
setting
/
notes
LLDP
Not
relev-
ant
(2) Ethertype
0x88CC
(LLDP)
PROFINET Link Layer Discovery Pro-
tocol.
LLDP
determines
and
manages
neigh-
borhood relations between PROFINET
devices.
Default:
Activated.
Send function can be deactivated by
Boundary
&quot;End
of
topology
discovery&quot;
in the CPU properties; readiness to
receive
remains
active.
LLDP
uses
the
special
multicast
MAC
address
01-80-C2-00-00-0E.
MRP
Not
relev-
ant
(2) Ethertype
0x88E3 (IEC
62493-2-2010)
Media
Redundancy
Protocol.
MRP enables control of redundant
transmission
paths
in
a
ring
topology.
Default:
&quot;Manager
(Auto)&quot;.
Can be changed in the CPU proper-
ties. If you configure the CPU and
connect
the
PN
interface
with
a
sub-
net, the default setting in the TIA
Portal
is
&quot;Not
device
in
the
ring&quot;.
MRP
uses
standard-compliant
multic-
ast
MAC
addresses.
PROFINET
IO
data
Not
relev-
ant
(2)
Ethertype
0x8892
(PROFINET)
PROFINET Cyclic IO Data Transfer.
With PROFINET IO telegrams,
IO data
is transferred cyclically between the
PROFINET
IO
controller
and
IO
devices
via
Ethernet.
Default:
Deactivated.
The
protocol
is
only
activated
for
PROFINET
IO
data
traffic.
PROFINET
Context
Man-
ager
34964
(4)
UDP
PROFINET communication.
Management
of
application
and
com-
munication relationships between IO
controller
and
IO
devices.
Default: Activated (UDP port open).
This
function
cannot
be
deactivated.
PTCP
Not
relev-
ant
(2)
Ethertype
0x8892
(PROFINET)
PROFINET
Precision
Transparent
Clock
Protocol,
based
on
IEEE
1588.
PTCP
provides
a
time
delay
measure-
ment between RJ45 ports and thus
the
send
clock
and
time
synchroniza-
tion.
Default:
Deactivated.
Can
be
activated
by
the
following
configurations:
IRT
with
a
sync
domain.
Port
interconnection
with
a
spe-
cified
cable
length.
Function can be deactivated in the
CPU properties by &quot;End of sync
domain&quot; Boundary of the interface.
PTCP
uses
standard-compliant
multic-
ast
MAC
addresses.
Connection-oriented
communication
protocols
HTTP
Server
80
(4)
TCP
Hypertext
Transfer
Protocol.
HTTP
is
used
for
communication
with
the
CPU-internal
web
server.
Default:
Deactivated.
Can
be
enabled
in
the
CPU
properties.
Requirement:
Web
server
in
the
CPU
properties
is
enabled.
HTTPS
Server
443
(4)
TCP
Hypertext Transfer Protocol Secure.
HTTPS is used for communication
with
the
CPU-internal
Web
server
via
Secure
Socket
Layer
(SSL).
Default:
Deactivated.
Can
be
enabled
in
the
CPU
properties.
Requirement:
Web
server
in
the
CPU
properties
is
enabled.
1
Note:
OUC
(open
communication)
provides
direct
access
to
the
UDP
and
TCP
protocols.
You
must
take
into
consideration
the
IANA
(Internet
Assigned
Numbers
Authority)
port
restrictions
and
definitions.
2
Do
not
use
ports
for
OUC,
which
are
already
used
by
other
protocols.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
37
Communications
services
5.2
Communications
protocols
and
port
numbers
used
for
Ethernet
communication
Protocol
/
Role
Port
num­
ber
(2)
Link
layer
(4) Transport
lay­
er
Description
/
function
Default
setting
/
notes
IGMPv2
Not relev-
ant
(3)
Network
layer
Internet
Group
Management
Pro-
tocol.
IGMPv2 is a network protocol for the
organization
of
multicast
groups
(UDP
multicast
only).
IGMPv2 is a functionality of the IP
stack.
This
system
function
is
activ-
ated
by
the
multicast
function.
ISO-on-TCP
Server
102
(4)
TCP
ISO-on-TCP
protocol
(according
to
RFC
1006).
The S7 protocol uses ISO-on-TCP
according to RFC 1006 for PG/HMI
communication with the engineering
system
(TIA
Portal).
Default:
Activated.
This
function
cannot
be
deactivated.
MODBUS
TCP
Server
/
Client
502
(4)
TCP
MODBUS
Transmission
Control
Pro-
tocol.
MODBUS/TCP is used by
MB_CLIENT/MB_SERVER
instructions
in
the
user
program.
Default:
Deactivated.
Can
be
activated
via
Modbus
instruc-
tions
in
the
user
program.
NTP
Client
123
(4)
UDP
Network
Time
Protocol.
NTP
is
used
for
synchronization
of
the
CPU system time with the time of an
NTP
server.
Default:
Deactivated.
Can
be
enabled
in
the
CPU
properties.
OPC
UA
Server
/
Client
4840
(4)
TCP
Open
Platform
Communications
Uni-
fied Architecture (based on TCP/IP
protocol).
A communication standard ranging
from
the
enterprise
level
to
the
field
level.
Default:
Deactivated.
Server
and
client
function
can
be
enabled
in
the
CPU
properties.
Client
access
can
be
configured
in
the
user
program.
OUC
1
Secure OUC
Server
/
Client
1
...
1999
can
be
used
to limited
extent
2
(4)
TCP
(4)
UDP
(4)
ISO-on-TCP
(Port:
102)
Open User Communication
(TCP/UDP).
Secure
Open
User
Communication
(TLS).
OUC
instructions
enable
connection
establishment, connection termina-
tion and data transfer via the user
program.
Default:
Deactivated.
You
activate
the
respective
protocol
with the corresponding Open User
Communication instruction in the
user
program
or
with
the
configura-
tion of connections in the network
view.
2000
...
5000
Recommen-
ded
1
Note:
OUC
(open
communication)
provides
direct
access
to
the
UDP
and
TCP
protocols.
You
must
take
into
consideration
the
IANA
(Internet
Assigned
Numbers
Authority)
port
restrictions
and
definitions.
2
Do
not
use
ports
for
OUC,
which
are
already
used
by
other
protocols.
Communication
38
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.2
Communications
protocols
and
port
numbers
used
for
Ethernet
communication
Protocol
/
Role
Port num­
ber
(2)
Link
layer
(4) Transport lay­
er
Description
/
function
Default
setting
/
notes
OUC
1
Secure OUC
Server
/
Client
As of FW
version
V3.0, the
following
applies
to
pro-
grammed
and con-
figured
connec-
tions:
5001
...
65535
can
be
used
to limited
extent
2
(4)
TCP
(4)
UDP
(4)
ISO-on-TCP
(Port:
102)
Open User Communication
(TCP/UDP).
Secure
Open
User
Communication
(TLS).
OUC
instructions
enable
connection
establishment, connection termina-
tion and data transfer via the user
program.
The
following
applies
to
FW
versions
lower
than
V3.0:
Programmed
connections:
5001
...
49152
Configured
connections:
5001
...
65535
SMTP
Client
25
(4)
TCP
Simple Mail Transfer Protocol.
SMTP
is
used
for
sending
emails.
Default:
Deactivated.
Can
be
enabled
via
TMAIL_C
instruc-
tion
in
the
user
program.
SMTPS
(SMTP
over
TLS)
Client
465
(4)
TCP
Simple
Mail
Transfer
Protocol
Secure.
SMTP
is
used
for
sending
emails
over
secure
connections.
Default:
Deactivated.
Can
be
enabled
via
TMAIL_C
instruc-
tion
in
the
user
program.
SMTP with
STARTTLS
Client
25
587
(4)
TCP
Simple
Mail
Transfer
Protocol
with
the
SMTP
command
&quot;STARTTLS&quot;.
SMTP
is
used
for
sending
emails.
Default:
Deactivated.
Can
be
enabled
via
TMAIL_C
instruc-
tion
in
the
user
program.
SNMP
Agent
161
162
(trap)
(4)
UDP
Simple
Network
Management
Pro-
tocol.
SNMP
is
used
for
reading
and
setting
of network management data
(SNMP-managed objects) by the
SNMP
manager
Default:
Activated
up
to
FW
version
V2.9, deactivated as of FW version
V3.0.
Can
be
enabled
via
data
record
in
the
user
program.
Can
be
enabled
in
the
CPU
properties
as
of
FW
version
V3.0.
As of FW version V3.1, can addition-
ally
be
enabled
as
write-protected
in
the
CPU
properties.
Syslog
(system
logging)
6514
514
(4)
TCP
(4)
UDP
Syslog
is
an
IETF
standard
protocol
(RFC 5424) for the transmission of
events
that
a
CPU
detects.
Default:
Deactivated.
Can
be
enabled
in
the
CPU
properties.
You can configure the forwarding of
syslog messages to a syslog server in
the CPU properties. The collection of
system logging events within a CPU
cannot
be
disabled
as
of
FW
version V3.1.
Reserved
49152
...
65535
(4)
TCP
(4)
UDP
If an application does not address a
local
port,
then
the
CPU
uses
this
port
range
for
the
active
connection
point.
-
1
Note:
OUC
(open
communication)
provides
direct
access
to
the
UDP
and
TCP
protocols.
You
must
take
into
consideration
the
IANA
(Internet
Assigned
Numbers
Authority)
port
restrictions
and
definitions.
2
Do
not
use
ports
for
OUC,
which
are
already
used
by
other
protocols.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
39
Communications
services
5.2
Communications
protocols
and
port
numbers
used
for
Ethernet
communication
Layers
and
logs
of
the
S7-1500
Software
Controller
(via
Ethernet
interface
on
the
Windows
side)
The
following
table
shows
the
protocols
that
are
supported
by
the
S7-1500
Software
Controller
via
the
Ethernet
interfaces
assigned
by
Windows.
Table
5-3
Layers
and
logs
of
the
S7-1500
Software
Controller
(via
Ethernet
interface
on
the
Windows
side)
Protocol
/
Role
Port
num­
ber
(2)
Link
layer
(4) Transport
lay­
er
Description
/
function
Notes
/
default
setting
PROFINET
protocols
DCP
Not relev-
ant
(2)
Ethertype
0x8892
(PROFINET)
PROFINET
Discovery
and
Basic
Config-
uration
Protocol.
DCP
determines
PROFINET
devices
and
enables
the
basic
settings.
Default: Enabled up to version V30.0.
Write-protection
enabled
as
of
version
V30.1
.
DCP does not allow DCP Set com-
mands
from
the
outside
in
write-pro-
tected mode during an active com-
munication
relationship.
Function
can
be
disabled
with
Bound-
ary &quot;End of detection of accessible
nodes&quot;
in
the
CPU
properties.
DHCP
Client
68
(4)
UDP
Dynamic
Host
Configuration
Protocol.
The IP address suite is obtained from
a DHCP server during the startup of
the
PROFINET
interface.
Default:
Deactivated.
Can
be
changed
in
the
CPU
properties
(as
of
FW
version
2.9).
Connection-oriented
communication
protocols
HTTP
Server
Adjustable
1
(4)
TCP
Hypertext
Transfer
Protocol.
HTTP
is
used
for
communication
with
the
CPU-internal
web
server.
Default:
Deactivated.
Can
be
changed
in
the
CPU
proper-
ties.
Adapt
the
port
number
to
avoid
con-
flicts with other web servers under
Windows. If you use the Web server
access of the S7-1500 Software Con-
troller,
you
must
enable
the
assigned
port
in
the
Windows
firewall.
IGMPv2
Not relev-
ant
(3)
Network
layer
Internet
Group
Management
Pro-
tocol.
IGMPv2 is a network protocol for the
organization
of
multicast
groups
(UDP
multicast
only).
IGMPv2 is a functionality of the IP
stack.
This
system
function
is
activ-
ated
by
the
multicast
function.
ISO-on-TCP
Server
102
(4)
TCP
ISO-on-TCP
protocol
(according
to
RFC
1006).
The S7 protocol uses ISO-on-TCP
according to RFC 1006 for PG/HMI
communication with the engineering
system
(TIA
Portal).
Default:
Deactivated.
1
Default
setting
for
Windows
assigned
interfaces:
81
2
Note:
OUC
(open
communication)
provides
direct
access
to
the
UDP
and
TCP
protocols.
You
must
take
into
consideration
the
IANA
(Internet
Assigned
Numbers
Authority)
port
restrictions
and
definitions.
3
Do
not
use
ports
for
OUC,
which
are
already
used
by
other
protocols.
4
Do
not
use
ports
for
OUC,
which
are
already
used
by
other
Windows
applications.
Communication
40
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.2
Communications
protocols
and
port
numbers
used
for
Ethernet
communication
Protocol
/
Role
Port num­
ber
(2)
Link
layer
(4) Transport lay­
er
Description
/
function
Notes
/
default
setting
OUC
2
and
Secure
OUC
1
...
1999
can
be
used
to limited
extent
3,
4
(4)
TCP
(4)
UDP
(4)
ISO-on-TCP
(Port:
102)
Open User Communication
(TCP/UDP).
Secure
Open
User
Communication
(TLS).
OUC
instructions
enable
connection
establishment, connection termina-
tion and data transfer based on the
socket
layer.
Default:
Deactivated.
Can
be
enabled
via
data
record
in
the
user
program.
If
you
want
to
use
OUC,
you
must
activate
the
ports
in
the
Windows
Firewall.
2000
...
5000
recommen-
ded
4
5001
...
49151
can
be
used
to limited
extent
3,
4
SMTP
Client
25
(4)
TCP
Simple Mail Transfer Protocol.
SMTP
is
used
for
sending
emails.
Default:
Deactivated.
Can
be
activated
by
calling
the
block
in the user program or as of version
V3.0
via
CPU
settings.
Syslog
(system
logging)
6514
514
(4)
TCP
(4)
UDP
Syslog
is
an
IETF
standard
protocol
(RFC 5424) for the transmission of
events
that
a
CPU
detects.
Default:
Deactivated.
Can
be
enabled
in
the
CPU
properties.
You can configure the forwarding of
syslog messages to a syslog server in
the CPU properties. The collection of
system logging events within a CPU
cannot
be
disabled
as
of
FW
version V3.1.
Reserved
49152
...
65535
(4)
TCP
(4)
UDP
If
the
application
does
not
specify
the
local port number, this dynamic port
range is used for the active connec-
tion
end
point.
If
you
want
to
use
this
communica-
tion, you must activate the ports in
the
Windows
Firewall.
1
Default
setting
for
Windows
assigned
interfaces:
81
2
Note:
OUC
(open
communication)
provides
direct
access
to
the
UDP
and
TCP
protocols.
You
must
take
into
consideration
the
IANA
(Internet
Assigned
Numbers
Authority)
port
restrictions
and
definitions.
3
Do
not
use
ports
for
OUC,
which
are
already
used
by
other
protocols.
4
Do
not
use
ports
for
OUC,
which
are
already
used
by
other
Windows
applications.
Layers
and
protocols
of
S7-1500
communications
modules
The documentation for the protocols of S7-1500 communications modules (e.g. CP 1543-1)
can
be
found
here
(
https://support.industry.siemens.com/cs/ww/en/view/67700710
).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
41
Communications
services
5.2
Communications
protocols
and
port
numbers
used
for
Ethernet
communication
Layers
and
protocols
of
interface
modules
The
following
table
shows
the
protocols
supported
by
ET
200
interface
modules.
To
find
out
which protocols your ET 200 interface module supports, refer to the technical specifications
in
the
relevant
equipment
manual.
Table
5-4
Layers
and
protocols
of
the
ET
200
interface
modules
Protocol
/
Role
Port
num­
ber
(2)
Link
layer
(4) Transport
lay­
er
Description
/
function
Default
setting
/
notes
PROFINET
protocols
DCP
Not relev-
ant
(2)
Ethertype
0x8892
(PROFINET)
PROFINET
Discovery
and
Basic
Config-
uration
Protocol.
DCP
determines
PROFINET
devices
and
enables
the
basic
settings.
Default
setting
for
supported
inter-
face modules if the higher-level IO
controller
also
supports
DCP:
Write-protection
enabled
DCP does not allow DCP Set com-
mands
from
the
outside
in
write-pro-
tected mode during an active com-
munication
relationship.
Function can be deactivated in the
properties
of
the
PROFINET
interface.
LLDP
Not relev-
ant
(2) Ethertype
0x88CC
(LLDP)
PROFINET Link Layer Discovery Pro-
tocol.
LLDP
determines
and
manages
neigh-
borhood relations between PROFINET
devices.
Default:
Activated.
Send function can be deactivated by
Boundary
&quot;End
of
topology
discovery&quot;
in the properties of the PROFINET
interface; readiness to receive
remains
active.
LLDP
uses
the
special
multicast
MAC
address
01-80-C2-00-00-0E.
MRP
Not relev-
ant
(2) Ethertype
0x88E3 (IEC
62493-2-2010)
Media
Redundancy
Protocol.
MRP enables control of redundant
transmission
paths
in
a
ring
topology.
Default: &quot;Not device in the ring&quot;.
Can
be
changed
in
the
properties
of
the
PROFINET
interface.
If
you
want
to
configure
the
interface
module
and
activate MRP, assign the &quot;Client&quot;
media redundancy role to the inter-
face
module.
MRP
uses
standard-compliant
multic-
ast
MAC
addresses.
PROFINET
IO
data
Not relev-
ant
(2)
Ethertype
0x8892
(PROFINET)
PROFINET Cyclic IO Data Transfer.
With PROFINET IO telegrams,
IO data
is transferred cyclically between the
PROFINET
IO
controller
and
IO
devices
via
Ethernet.
Default:
Deactivated.
Is activated indirectly as soon as the
interface
module
receives
a
valid
con-
figuration.
PROFINET
Context
Man-
ager
34964
(4)
UDP
PROFINET communication.
Management
of
application
and
com-
munication relationships between IO
controller
and
IO
devices.
Default: Activated (UDP port open).
This
function
cannot
be
deactivated.
PTCP
Not relev-
ant
(2)
Ethertype
0x8892
(PROFINET)
PROFINET
Precision
Transparent
Clock
Protocol,
based
on
IEEE
1588.
PTCP
enables
the
following
functions:
Time delay measurement
between
two
ports
Send
clock
and
time
synchroniza-
tion
Default
setting
for
time
delay
meas-
urement: Activated for supported
interface modules. PTCP cannot be
deactivated
for
time
delay
measure-
ment.
Default setting for send clock and
time synchronization: Deactivated.
Can
be
activated
by
the
higher-level
Communication
42
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
Communications
protocols
and
port
numbers
used
for
Ethernet
communication
Protocol
/
Role
Port num­
ber
(2)
Link
layer
(4) Transport lay­
er
Description
/
function
Default
setting
/
notes
IO
controller
according
to
the
config-
uration.
PTCP
uses
standard-compliant
multic-
ast
MAC
addresses.
Connection-oriented
communication
protocols
IGMPv2
Not
relev-
ant
(3)
Network
layer
Internet
Group
Management
Pro-
tocol.
IGMPv2 is a network protocol for the
organization
of
multicast
groups
(UDP
multicast
only).
IGMPv2 is a functionality of the IP
stack.
This
system
function
is
activ-
ated
by
the
multicast
function.
MODBUS
TCP
Slave
502
(4)
TCP
MODBUS
Transmission
Control
Pro-
tocol.
Default:
Deactivated.
Can
be
activated
via
MultiFieldbus
Configuration
Tool
(MFCT).
SNMP
Agent
161
162
(trap)
(4)
UDP
Simple
Network
Management
Pro-
tocol.
SNMP
is
used
for
reading
and
setting
of network management data
(SNMP-managed objects) by the
SNMP
manager
Default
setting
for
supporting
inter-
face
modules:
Synchronize default values from
IO
controller
Deactivated
EtherNet/IP
44818
(TCP)
2222
(UDP)
(4)
TCP
(4)
UDP
The
EtherNet/IP
protocol
and
Com-
mon Industrial Protocol
(CIP) proto-
cols
enable
communication
between
interface
modules
and
CPUs.
EtherNet/IP
use
MultiFieldbus
devices
for
data
exchange.
CIP
Implicit
Messaging
is
used
for
the
continuous transmission of real-time
data
in
time-critical
applications.
CIP
Explicit
Messaging
is
used
for
the
targeted retrieval or transmission of
configuration
and
diagnostic
data.
Default:
Deactivated.
Can
be
activated
via
MultiFieldbus
Configuration
Tool
(MFCT).
CIP
TCP/IP
Not
relev-
ant
(4)
TCP
Transmission
Control
Protocol.
TCP ensures a reliable connection
between
2
communication
partners.
Default:
Activated.
This
function
cannot
be
deactivated.
UDP
Not
relev-
ant
(4)
UDP
User
Datagram
Protocol.
UDP
works
without
a
connection
and
is based on the unsecured Internet
Protocol
(IP).
Default:
Activated.
This
function
cannot
be
deactivated.
ARP
Not
relev-
ant
(2)
Ethertype
0x0806
Adress Resolution Protocol.
Assignment
of
the
IP
addresses
to
the
MAC
addresses.
Default:
Activated.
This
function
cannot
be
deactivated.
IPv4
Not
relev-
ant
(3)
Network
layer
Internet Protocol Version 4.
Identification of devices by IP
addresses. IPv4 is used to send data
packets
from
their
origin
to
their
des-
tination.
Default:
Activated.
This
function
cannot
be
deactivated.
Reserved
49152
...
65535
(4)
TCP
(4)
UDP
If an application does not address a
local
port,
then
the
CPU
uses
this
port
range
for
the
active
connection
point.
-
Communication
Function
Manual,
11/2024,
A5E03735815-AM
43
Communications
services
Overview
of
connection
resources
Overview
of
connection
resources
Connection
resources
Some communications services require connections. Connections allocate resources on the
CPUs, CPs and CMs involved (for example memory areas in the CPU operating system). In
most
cases
one
resource
per
CPU/CP/CM
is
allocated
for
a
connection.
In
HMI
communication,
up
to
3
connection
resources
are
required
per
HMI
connection.
The
connection
resources
available
depend
on
the
CPU
being
used,
the
CPs
and
CMs
and
must
not
exceed
a
defined
high
limit
for
the
automation
system.
Available
connection
resources
in
a
station
The
maximum
number
of
resources
of
a
station
is
determined
by
the
CPU.
Each
CPU
has
reserved
connection
resources
for
PG,
HMI
and
web
server
communication.
In
addition, there are available resources for other communication services, e.g. for SNMP, e-
mail
connections,
HMI
and
S7
communication
as
well
as
for
open
communication.
When
are
connection
resources
allocated?
The
time
for
allocation
of
connection
resources
depends
on
how
the
connection
is
set
up,
automatic,
programmed
or
configured
(see
section
Setting
up
a
connection
(Page
45)).
Additional
information
You
will
find
more
detailed
information
on
the
allocation
of
connection
resources
and
the
display
of
connection
resources
in
STEP
7
in
the
section
Connection
resources
(Page
418).
Communication
44
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
Setting
up
a
connection
5.4
Setting
up
a
connection
Automatic
connection
STEP
7
sets
up
a
connection
automatically
(for
example
PG
or
HMI
connection)
if
you
have
connected the PG/PC interface to an interface of the CPU physically and have made the
interface
assignment
in
STEP
7
in
the
&quot;Go
online&quot;
dialog.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
45
Communications
services
5.4
Setting
up
a
connection
Setting
up
a
programmed
connection
You
set
up
the
programmed
connection
in
the
program
editor
of
STEP
7
in
the
context
of
a
CPU
by
assigning
instructions
for
communication,
for
example
TSEND_C.
When
specifying
the
connection
parameters
(in
the
Inspector
window,
in
the
properties
of
the
instruction),
you
are
supported
by
the
easy-to-use
user
interface.
540004
155055
Figure
5-1
Programmed
setup
Communication
46
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.4
Setting
up
a
connection
Setting
up
a
configured
connection
You
set
up
the
configured
connection
in
the
network
view
of
the
Devices
&
networks
editor
of
STEP
7
in
the
context
of
a
CPU
or
a
software
controller.
719962
154004
Figure
5-2
Configured
setup
Communication
Function
Manual,
11/2024,
A5E03735815-AM
47
Communications
services
Setting
up
a
connection
Effects
on
the
connection
resources
of
the
CPU
You can often choose between a configured or a programmed connection. Programmed
connection setup allows connection resources to be released following data transfer. Like
routed connections, programmed connections are not guaranteed, meaning that they are
only established when resources are available. With configured connection setup, the
resource is available after download of the configuration until the configuration changes
again. Corresponding resources are therefore reserved for connection establishment via
configured
connections.
The
&quot;Connection
resources&quot;
table
in
the
Inspector
window
of
the
CPU
displays
an
overview
of
connection
resources
already
used
and
those
still
available.
How
do
I
set
up
a
connection?
Table
5-5
Setting
up
the
connection
Connection
Automatically
Programmed
setup
Configured
setup
Programming
device
connection
X
-
-
HMI
connection
X
-
X
Web
communication
X
-
-
OPC
UA
server
communication
X
-
-
OPC
UA
client
communication
-
X
-
Open
communication
via
TCP/IP
con-
nection
-
X
X
Open
communication
via
ISO-on-TCP
connection
-
X
X
Open
communication
via
UDP
con-
nection
-
X
X
Open
communication
via
ISO
con-
nection
-
X
X
Open
communication
via
FDL
con-
nection
-
X
X
Communication
via
Modbus
TCP
connection
-
X
-
E-mail
connection
-
X
-
FTP
connection
-
X
-
S7
connection*
-
-
X
*
Note
that
for
an
S7-1500
CPU
you
must
enable
the
use
of
PUT/GET
communication
in
the
properties
of
the
CPU.
You
can
find
more
information
on
this
topic
in
the
STEP
7
online
help.
Additional
information
You
will
find
further
information
on
the
allocation
of
connection
resources
and
the
display
of
connection
resources
in
STEP
7
in
the
section
Connection
resources
(Page
418).
Communication
48
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
Data
consistency
5.5
Data
consistency
Definition
Data
consistency
is
important
for
data
transfer
and
you
need
to
take
this
into
account
when
configuring
the
communication
task.
Otherwise,
malfunctions
may
occur.
A data area which cannot be modified by concurrent processes is called a consistent data
area. This means that a data area which belongs together and which is larger than the
maximum
size
of
the
consistent
data
area
can
consist
in
part
of
new
and
of
old
data
at
the
same
time.
An inconsistency can occur when an instruction for communication is interrupted, for
example by a hardware interrupt OB with higher priority. This interrupts the transfer of the
data area. If the user program in this OB now changes the data that has not yet been
processed
by
the
communication
instruction,
the
transferred
data
originates
from
different
times:
1
5
(
&
2
5
D
The following figure shows a data area that is smaller than the maximum size of the
consistent data area. In this case, when transferring the data area, it is ensured that there is
no
interruption
by
the
user
program
during
data
access
so
that
the
data
is
not
changed.
2
6
R
X
U
F
H
G
D
W
D
D
U
H
D
7
D
U
J
H
W
G
D
W
D
D
U
H
D
①
The source data area is smaller than the maximum size of the consistent data area (②). The
instruction
transfers
the
data
together
to
the
destination
data
area.
②
Maximum
size
of
the
consistent
data
area
Figure
5-3
Consistent
transfer
of
data
Communication
Function
Manual,
11/2024,
A5E03735815-AM
49
Communications
services
5.5
Data
consistency
The
following
figure
shows
a
data
area
that
is
larger
than
the
maximum
size
of
the
consistent
data
area.
In
this
case,
the
data
can
be
changed
during
an
interruption
of
the
data
transfer.
An
interruption
also
occurs
if,
for
example,
the
data
area
needs
to
be
transferred
in
several
parts. If the data is changed during the interruption, the transferred data originates from
different
times.
6
R
X
U
F
H
G
D
W
D
D
U
H
D
D
W
W
i
P
H
7
1
6
R
X
U
F
H
G
D
W
D
D
U
H
D
D
W
W
i
P
H
7
2
7
D
U
J
H
W
G
D
W
D
D
U
H
D
1
3
2
7
D
U
J
H
W
G
D
W
D
D
U
H
D
①
The source data area is larger than the maximum size of the consistent data area (③). At time
T1, the instruction only transfers as much data from the source data area into the destination
data
area
as
fits
in
the
consistent
data
area.
②
At time T2, the instruction transfers the rest of the source data area to the destination data
area. After the transfer, data from different points in time exist in the destination data area. If
the
data
in
the
source
data
area
has
changed
in
the
meantime,
an
inconsistency
may
result.
③
Maximum
size
of
the
consistent
data
area
Figure
5-4
Transfer
of
data
larger
than
the
maximum
consistency
area
Example
of
an
inconsistency
The
figure
below
shows
an
example
of
changing
data
during
the
transfer.
The
destination
data
area
contains
data
from
different
points
in
time.
101010101010
1010101010
101010101010
8
1
110011001100
1100110011
101010101010
1100110011
1
①
Maximum
size
of
the
consistent
data
area
Figure
5-5
Example:
Changing
data
during
the
transfer
Communication
50
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
Data
consistency
System-specific
maximum
data
consistency
for
S7‑1500:
No
inconsistency
occurs
if
the
system-specific
maximum
size
of
the
consistent
data
is
kept
to.
With an S7-1500, communication data is copied consistently into or out of the user memory
in blocks of up to 512 bytes during the program cycle. Data consistency is not ensured for
larger data areas. Where defined data consistency is required, the length of communication
data in the user program of the CPU must not exceed 512 bytes. You can then access these
data
areas
consistently,
for
example
from
an
HMI
device
by
reading/writing
tags.
If
more
data
than
the
system-specific
maximum
size
needs
to
be
transferred
consistently,
you
yourself
must
ensure
the
data
consistency
with
suitable
measures
in
the
user
program.
Ensuring
data
consistency
Use
of
instructions
for
access
to
common
data:
If the user program contains instructions for communication that access common data, for
example
TSEND/TRCV,
you
can
coordinate
access
to
this
data
area
yourself,
for
example
using
the &quot;DONE&quot; parameter. The data consistency of the data areas that are transferred with an
instruction
for
communication
can
therefore
be
ensured
in
the
user
program.
NOTE
Measures
in
the
user
program
To achieve data consistency, you can copy transferred data to a separate data area (for
example,
global
data
block).
While
the
user
program
continues
to
work
with
the
original
data,
you can transfer the data saved in the separate data area consistently with the
communication
instruction.
For
the
copying,
use
uninterruptible
instructions
such
as
UMOVE_BLK
or
UFILL_BLK.
These
instructions
ensure
data
consistency
up
to
16
KB.
Use
of
PUT/GET
instructions
or
Write/Read
via
HMI
communication:
In S7 communication with the PUT/GET instructions or Write/Read via HMI communication,
you need to take into account the size of the consistent data areas during programming or
configuration. In the user program of an S7-1500 as server, there is no instruction available
that
can
coordinate
the
data
transfer
in
the
user
program.
The
data
exchanged
using
PUT/GET
instructions updates the S7-1500 while the user program is running. There is no point in time
within the processing of the cyclic user program at which the data is exchanged consistently.
The
length
of
the
data
area
to
be
transferred
should
be
smaller
than
512
bytes.
Additional
information
You
will
also
find
the
maximum
amount
of
consistent
data
in
the
device
manuals
of
the
communications
modules
in
the
Technical
Specifications.
You
will
find
further
information
on
data
consistency
in
the
description
of
the
instructions
in
the
STEP
7
online
help.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
51
Communications
services
Secure
Communication
Secure
Communication
Basics
of
Secure
Communication
Useful
information
on
Secure
Communication
For
STEP
7
(TIA
Portal)
as
of
V14
and
for
S7-1500
CPUs
as
of
firmware
V2.0,
the
options
for
secure
communication
have
been
broadened
considerably.
&quot;S7-1500
CPUs&quot;
also
refers
to
CPU
versions
S7-1500F,
S7-1500T,
S7-1500C
as
well
as
S7-1500pro
CPUs
and
ET200SP
CPUs.
In
subsequent
versions,
additional
components
will
support
Secure
Communication
(e.g.
secure
OUC),
see
next
section.
As
of
firmware
version
V4.4,
S7-1200
CPUs
also
support
Secure
Communication.
Requirement
•
CPUs
that
support
connection
description
DBs
with
the
structure
of
the
SDT
TCON_IP_V4_SEC
or
SDT
TCON_QDN_SEC.
These
are
the
following
CPUs:
–
S7-1200
as
of
firmware
V4.4
–
S7-1500
as
of
firmware
V2.0
•
Also
optional
via
the
following
CPs:
–
CP
1243-1 as of
firmware
V3.2
–
CP
1243-8
IRC
as
of
firmware
V3.2
–
CP
1543‑1 as of
firmware
V2.0
–
CP
1545‑1
–
CP
1543SP-1
Secure
Communication
via
CP
1242-7
GPRS
V2
is
not
possible.
Public
Key
Infrastructure
(PKI)
The attribute &quot;secure&quot; is used for the identification of communication mechanisms that are
based
on
a
Public
Key
Infrastructure
(PKI)
(for
example
RFC
5280
for
Internet
X.509
Public
Key
Infrastructure Certificate and Certificate Revocation List Profile). A Public Key Infrastructure
(PKI) is a system that can issue, distribute and check digital certificates. The digital certificates
issued
are
used
in
the
PKI
to
secure
computer-based
communication.
If
a
PKI
uses
asymmetric
key
cryptography,
the
messages
in
a
network
can
be
digitally
signed
and
encrypted.
Components
that
you
have
configured
in
STEP
7
(TIA
Portal)
for
secure
communication
use
an
asymmetric key encryption scheme with a public key (Public Key) and a private key (Private
Key). TLS
(Transport Layer
Security)
is
used
as
the encryption protocol.
TLS
is
the successor
for
the
SSL
(Secure
Sockets
Layer)
protocol.
Communication
52
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Objectives
of
secure
communication
Secure
communication
is
used
to
achieve
the
following
objectives:
•
Confidentiality
i.e.
the
data
are
secret
/
cannot
by
read
by
eavesdroppers.
•
Integrity
i.e. the message that reaches the recipient is the same message, unchanged, that the
sender
sent.
The
message
has
not
been
altered
on
the
way.
•
End
point
authentication
i.e.
the
end
point
communication
partner
is
exactly
who
it
claims
to
be
and
the
party
who
is
to
be
reached.
The
identity
of
the
partner
has
been
checked.
These objectives were in the past primarily relevant to IT and networked computers. Now,
industrial
machinery
and
control
systems
with
sensitive
data
are
at
equally
high
risk,
as
they
are
also
networked,
and
consequently
pose
strict
security
requirements
for
data
exchange.
Protection
of
the
automation
cell
by
means
of
the
cell
protection
concept
through
firewall,
or
via connection through VPN, for example with the security module, was common in the past
and
remains
so.
However,
it
is
becoming
increasingly
necessary
to
also
transfer
data
to
external
computers
in
encrypted
form
via
Intranet
or
public
networks.
Common
principles
of
secure
communication
Independent
of
the
context,
secure
communication
is
based
on
the
concept
of
the
Public
Key
Infrastructure
(PKI)
and
contains
the
following
components:
•
An
asymmetric
encryption
scheme
that
allows:
–
Encryption
or
decryption
of
messages
using
public
or
private
keys.
–
The
verification
of
signatures
in
messages
and
certificates.
The
messages/certificates
are
signed
by
the
sender/certificate
subject
with
their
private
key. The recipient/verifier checks the signature with the public key of the
sender/certificate
subject.
•
Transport
and
storage
of
the
public
key
using
X.509
certificates:
–
X.509 certificates are digitally signed data that allow public key authentication in terms
of
the
bound
identity.
–
X.509 certificates can contain information that describes in more detail or restricts use
of the public key. For example the date as of which a public key in a certificate is valid
and
when
it
expires.
–
X.509
certificates
contain
information about the
issuer of
the
certificate
in
secure
form.
The
following
paragraphs
give
an
overview
of
these
basic
concepts,
which
are
required
for
managing certificates in STEP 7 (TIA Portal), for example, and for programming
communication
instructions
for
secure
Open
User
Communication
(sOUC).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
53
+7736
6HFXUH
28&
28&
Communications
services
Secure
Communication
Secure
communication
with
STEP
7
STEP
7
as
of
V14
provides
the
required
PKI
for
the
configuration
and
operation
of
secure
communication.
Examples:
The Hypertext Transfer Protokoll (HTTP) turns into Hypertext Transfer Protokoll Secure
(HTTPS) with the help of the TLS (Transport Layer Security) protocol. Since HTTPS is a
combination of HTTP and TLS, it is called &quot;HTTP over TLS&quot; in the corresponding RFC. You
can see in the browser that HTTPS is being used; this is indicated by the URL &quot;https://&quot;
instead
of
&quot;http://&quot;
in
the
address
bar
of
the
browser.
Most
browsers
highlight
such
secure
connections.
Open
User
Communication
turns
into
secure
Open
User
Communication.
The
underlying
protocol
is
also
TLS.
Email
providers
also
offer
access
over
the
&quot;Secure
SMTP
over
TLS&quot;
protocol
to
increase
the
security
of
email
communication.
2SHQ
XVHU
FRPPXQiFDWiRQ
7&21
76(1D
75&9
...
3/&
SURJUDP
$SSOiFDWiRQ
/D\HU
(7)
:HE
VHUYHU
The
figure
below
shows
the
TLS
protocol
in
the
context
of
communication
layers.
6HVViRQ
/D\HU
(5)
7/6
7UDQVSRUW
/D\HU
(4)
7&3I8D3
1HWZRUN
/D\HU
(3)
,3Y4
DDWD
/iQN
/D\HU
(2)
(WKHUQHW
+773
3K\ViFDO
/D\HU
(1)
Figure
5-6
TLS
protocol
in
the
context
of
communication
layers
Secure
communication
with
OPC
UA
An
OPC
UA
server
is
implemented
in
S7-1500
CPUs
as
of
firmware
V2.0.
OPC
UA
Security
also
covers authentication, encryption and data integrity with digital X.509 certificates and also
uses a Public Key Infrastructure (PKI). Depending on the requirements placed by the
application, you can select different security levels for the end point security. The description
of
the
OPC
UA
server
functionality
is
covered
in
a
separate
section.
Communication
54
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Secure
communication
for
PG/HMI
communication
With the central components of the TIA Portal, STEP 7 and WinCC, an innovative and
standardized
Secure
PG/PC
and
HMI
Communication
-
PG/HMI
communication
for
short
-
is
implemented starting with version V17 together with the latest controllers and latest HMI
devices.
More
information
You
can
find
more
information
on
OPC
UA
in
the
section
Using
the
S7-1500
as
an
OPC
UA
server
(Page
221).
For
more
information
on
secure
programming
device/HMI
communication,
refer
to
the
section
Secure
PG/HMI
communication
(Page
107).
Device-dependent
security
features
Transport Layer Security (TLS) is a widespread security protocol that improves the data
security for communications. For the S7-1500 automation system, TLS is used for secure
communication
for
the
following
certificate-based
applications:
Web
server
(HTTPS
protocol
variant)
Secure
Open
User
Communication
(OUC)
including
secure
email
(TMAIL_C
instruction)
Secure
PG/HMI
communication
TLS takes care of the authenticity, confidentiality and integrity of the communication
between client and server for the listed applications, for example, between the web server of
CPU and web browsers, which, for example, have to display a diagnostics web page of the
CPU.
The
OPC
UA
server
and
OPC
UA
client
applications
do
not
actually
directly
use
TLS,
but
the
cryptographical
processes
used
are
comparable.
TLS is continuously being further developed, resulting in various TLS versions, which are
distinct
with
regard
to
the
cipher
suites
(standardized
collection
of
cryptographic
methods)
supported
and
the
performance.
The
Internet
Engineering
Task
Force
(IETF)
is
responsible
for
the
description
of
the
TLS
protocol.
The
following
correlation
applies:
TLS
1.3
corresponds
to
RFC
8446
TLS
1.2
corresponds
to
RFC
5246
In addition, not every device supports all the cryptographic methods defined in the RFCs.
Therefore,
after
establishing
the
connection,
the
client
and
server
negotiate
a
method
that
both
support
(Handshake)
as
well
as
the
parameters
to
be
used.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
55
Communications
services
5.6
Secure
Communication
Supported
TLS
versions
S7-1500
The
following
table
shows,
which
TLS
versions
are
supported
in
a
given
CPU
firmware
version.
CPU
firmware
version
Supported
TLS
version
V3.0
TLS
1.2,
TLS
1.3
V2.9
TLS
1.2,
TLS
1.3
V2.8
...
V2.0
TLS
1.2
Supported
encryption
methods
and
parameters
for
creating
certificates
To
generate
the
public
key
for
a
new
certificate,
in
the
TIA
Portal,
set
the
encryption
method
and encryption parameters. These certificate parameters are device-dependent and
dependent
on
the
application
used
One
possibility:
In
the
CPU
properties,
go
to
&quot;Protection
&
Security
>
Certificate
manager&quot;
and
generate a new device certificate. You can find settings for the encryption method and the
encryption
parameters
under
&quot;Certificate
Parameters&quot;
in
the
&quot;Generate
Certificates&quot;
dialog.
Example:
RSA
2048
stands
for
asymmetric
RSA
encryption
method
with
cryptographic
key
length
2048
bits.
The
following
table
shows
the
supported
encryption
methods
and
encryption
parameters
depending
on
the
CPU
application
or
services.
Encryption
meth-
Web
server
(HTTPS)
OPC
UA
od/parameters
Secure
PG/HMI
communication
S7-1500 (firmware
V3.0)
Secure
OUC
EC
prime256v1
yes
no
EC
secp384r1
yes
no
EC
secp256k1
no
no
RSA
1024
yes
yes
RSA
2048
yes
yes
RSA
4096
yes
yes
RSA
8192
no
no
Communication
56
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Confidentiality
through
encryption
Message
encryption
is
an
important
element
of
data
security.
When
encrypted
messages
are
intercepted by third parties during communication, these potential eavesdroppers cannot
access
the
information
they
contain.
There
is
a
wide
range
of
mathematical
processes
(algorithms)
for
encrypting
messages.
All
algorithms
process
a
&quot;key&quot;
parameter
to
encrypt
and
decrypt
messages.
Algorithm
+
key
+
message
=>
encrypted
message
Encrypted
message
+
key
+
algorithm
=>
(decrypted)
message
Symmetric
encryption
The central aspect of symmetric encryption is that both communication partners use the
same
key
for
message
encryption
and
decryption,
as
shown
in
the
figure
below.
Bob
uses
the
same key for encryption as Alice uses for decryption. In general, we also say that the two
sides
share
the
secret
key
with
which
they
encrypt
or
decrypt
a
message
as
a
secret.
1
2
%
R
E
$
O
i
F
H
①
Bob
encrypts
his
message
with
the
symmetric
key
②
Alice
decrypts
the
encrypted
message
with
the
symmetric
key
Figure
5-7
Symmetric
encryption
The
process
can
be
compared
to
a
briefcase
to
which
the
sender
and
recipient
have
the
same
key,
which
both
locks
and
opens
the
case.
Advantage:
Symmetric
encryption
algorithms
(such
as
AES,
Advanced
Encryption
Algorithm)
are
fast.
Disadvantages: How can the key be sent to a recipient without getting into the wrong
hands?
This
is
a
key
distribution
problem.
If
enough
messages
are
intercepted,
the
key
can
also
be
worked
out
and
must
therefore
be
changed
regularly.
If
there
are
a
large
number
of
communication
partners,
there
is
also
a
large
number
of
keys
to
distribute.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
57
Communications
services
5.6
Secure
Communication
Asymmetric
encryption
Asymmetric
encryption
works
with
a
pair
of
keys
consisting
of
one
public
key
and
one
private
key. Used with a PKI, it is also known as Public Key cryptography or simply PKI cryptography.
A communication partner, Alice in the figure below, has a private key and a public key. The
public
key
is
provided
to
the
public,
in
other
words
any
potential
communication
partner.
Anyone
with
the
public
key
can
encrypt
messages
for
Alice.
In
the
figure
below,
this
is
Bob.
Alice&apos;s
private
key,
which
she
must
not
disclose,
is
used
by
Alice
to
decrypt
an
encrypted
message
addressed
to
her.
1
3
X
E
O
i
F
N
H
\
2
3
3
U
i
Y
D
W
H
N
H
\
%
R
E
$
O
i
F
H
①
Alice
provides
Bob
with
her
public
key.
No
precautionary
measures
are
required
to
this
pur-
pose:
Anyone
can
use
the
public
key
for
messages
to
Alice
if
they
are
sure
that
it
is
actually
Alice&apos;s
public
key.
②
Bob
encrypts
his
message
with
Alice&apos;s
public
key.
③
Alice decrypts the encrypted message from Bob with her private key. As only Alice has the
private
key
and
never
discloses
it,
only
she
can
decrypt
the
message.
With
her
private
key,
she
can
decrypt
any
message
encrypted
with
her
public
key
-
not
only
messages
from
Bob.
Figure
5-8
Asymmetric
encryption
The
system
can
be
compared
to
a
mailbox
into
which
anyone
can
put
a
message,
but
from
which
only
the
person
with
the
key
can
remove
messages.
Advantages:
A
message
encrypted
with
a
public
key
can
only
be
decrypted
by
the
owner
of the private key. As another (private) key is required for decryption, it is also much
harder to work out the decryption key on the basis of large numbers of encrypted
messages. This means that the public key does not have to be kept strictly confidential,
unlike
with
symmetric
keys.
Another advantage is easier distribution of public keys. No specially secured channel is
required
in
asymmetric
cryptography
to
transfer
the
public
key
from
the
recipient
to
the
sender encrypting the messages. Less work is thus required in managing the keys than
would
be
the
case
in
symmetric
encryption
procedures.
Disadvantages: Complex algorithm (e.g. RSA, named after the three mathematicians
Rivest, Shamir and Adleman), and therefore poorer performance than with symmetric
encryption.
Communication
58
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Encryption
processes
in
practice
In practice, for example with a CPU Web server and Secure Open User Communication, the
TLS
protocol
is
used
below
the
relevant
application
layer.
Application
layers
are
HTTP
or
SMTP,
for
example,
as
detailed
above.
TLS
(Transport
Layer
Security)
uses
a
combination
of
asymmetric
encryption
and
symmetric
encryption (hybrid encryption) for secure data transfer, for example, over the Internet, and
uses
the
following
subprotocols:
TLS
Handshake
Protocol,
responsible
for
authentication
of
communication
partners
and
negotiation of the algorithms and keys to be used for subsequent data transfer on the
basis
of
asymmetric
encryption.
TLS
Record
Protocol,
responsible
for
encryption
of
user
data
with
symmetric
encryption
and
data
exchange.
Both
asymmetric
and
symmetric
encryption
are
considered
secure
encryption
schemes
-
there
is basically no difference in security between the two procedures. The degree of security
depends
on
parameters
such
as
the
selected
key
length.
Abuse
of
encryption
You cannot tell what identity is assigned to a public key from the bit string. A fraud could
provide their public key and claim to be someone else. If a third party then uses this key
thinking that they are addressing their required communication partner, confidential
information
could
end
up
with
the
fraud.
The
fraud
then
uses
their
private
key
to
decrypt
the
message that was not intended for them, and sensitive information falls into the wrong
hands.
To
prevent
this
type
of
abuse,
the
communication
partners
must
be
confident
that
they
are
dealing with the right communication partner. This trust is established by using digital
certificates
in
a
PKI.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
59
Communications
services
5.6
Secure
Communication
Authenticity
and
integrity
through
signatures
Attacks from programs that intercept communication between the server and client and act
as if they themselves were client or server, are called man-in-the-middle attacks. If the false
identity
of
these
programs
is
not
detected,
they
can
obtain
important
information
about
the
S7 program, for example, or set values in the CPU and attack a machine or plants. Digital
certificates
are
used
to
avoid
such
attacks.
Secure communication uses digital certificates that meet the X.509 standard of the
International Telecommunication Union (ITU). This allows the identity of a program, a
computer
or
an
organization
to
be
checked
(authenticated).
How
certificates
establish
trust
The main role of X.509 certificates is to bind an identity with the data of a certificate subject
(for example, e-mail address or computer name) to the public key of the identity. Identities
can
be
people,
computers
or
machines.
Certificates
are
issued
by
certificate
authorities
(Certificate
Authority,
CA)
or
by
the
subject
of
a certificate itself. PKI systems specify how users can trust the certificate authorities and the
certificates
that
they
issue.
The
certificate
process:
Anyone
wishing
to
own
a
certificate
submits
a
certificate
application
to
a
registration
authority
linked
to
the
certificate
authority.
The
certificate
authority
assesses
the
application
and
applicant
on
the
basis
of
set
criteria.
If
the
identity
of
the
applicant
can
be
clearly
established,
the
certificate
authority
confirms
that identity by issuing a signed certificate. The applicant has now become the certificate
subject.
The
figure
below
is
a
simplified
overview
of
the
process.
It
does
not
show
how
Alice
can
check
the
digital
signature.
7
Z
H
Q
W
(
&
$
)
F
R
Q
I
i
U
P
V
Z
i
W
K
K
i
V
V
i
J
Q
D
W
X
U
H
W
K
D
W
W
K
H
S
X
E
O
i
F
N
H
\
i
V
%RE&apos;V.
+H
KDV
FKHFNHG.
%RE
&$
$
O
i
F
H
J
H
W
V
%
R
E
&apos;
V
S
X
E
O
i
F
N
H
\
,
Z
K
i
F
K
i
V
V
i
J
Q
H
G
E
\
7
Z
H
Q
W
.
6
K
H
F
D
Q
E
H
F
R
Q
I
i
G
H
Q
W
W
K
D
W
W
K
i
V
S
X
E
O
i
F
N
H
\
i
V
U
H
D
O
O
\
%
R
E
&apos;
V
i
I
V
K
H
W
U
X
V
W
V
7
Z
H
Q
W
.
7
Z
H
Q
W
(
&
$
)
$
O
i
F
H
W
U
X
V
W
V
7
Z
H
Q
W
(
W
K
H
F
H
U
W
i
I
i
F
D
W
H
D
X
W
K
R
U
i
W
\
,
&
$
)
$
O
i
F
H
Figure
5-9
Signing
of
a
certificate
by
a
certificate
authority
Communication
60
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Self-signed
certificates
Self-signed
certificates
are
certificates
whose
signature
comes
from
the
certificate
subject
and
not
from
an
independent
certificate
authority.
Examples:
You can create and sign a certificate yourself, for example, to encrypt messages to a
communication partner. In the example above, Bob (instead of Twent) could himself sign
his certificate with his private key. Using Bob&apos;s public key, Alice can check that the
signature and public key from Bob match. This procedure is sufficient for simple internal
plant
communication
that
is
to
be
encrypted.
A
root
certificate
is,
for
example,
a
self-signed
certificate,
signed
by
the
certificate
authority
(CA),
that
contains
the
public
key
of
the
certificate
authority.
Features
of
self-signed
certificates
The
&quot;CN&quot;
(Common
Name
of
Subject)
for
the
certificate
subject
and
&quot;Issuer&quot;
attributes
of
self-
signed certificates are identical: You have signed your certificate yourself. The field &quot;CA&quot;
(Certificate Autority) must be set to &quot;False&quot;; the self-signed certificate should not be used to
sign
other
certificates.
Self-signed
certificates
are
not
embedded
in
a
PKI
hierarchy.
Certificate
content
A
certificate
to
the
X.509
V3
standard,
the
standard
that
is
also
used
by
STEP
7
and
the
S7-1500
CPUs,
consists
primarily
of
the
following
elements:
Public
key
Details of the certificate subject (i.e. the holder of the key), for example, the Common
Name
(CN)
of
Subject
.
Attributes
such
as
serial
number
and
validity
period
Digital
signature
from
the
certificate
authority
(CA)
confirming
that
the
information
is
correct.
There
are
also
extensions,
for
example:
Specification
of
what
the
public
key
may
be
used
for
(Key
Usage),
for
example,
signing
or
key
encryption.
When
you
create
a
new
certificate
with
STEP
7,
for
example
in
the
context
of
Secure
Open
User
Communication,
select
the
correct
entry
from
the
list
of
possible
usages,
e.g.
&quot;TLS&quot;.
Specification
of
a
Subject
Alternative
Name
(SAN),
which
is
used
in
secure
communication
with Web servers (HTTP over TLS), for example, to ensure that the certificate in the
address
bar
of
the
Web
browser
also
belongs
to
the
Web
server
specified
in
the
URL.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
61
Communications
services
Secure
Communication
How
signatures
are
generated
and
verified
Asymmetric
key
usage
ensures
that
certificates
can
be
verified:
The
example
of
the
&quot;MyCert&quot;
certificate
illustrates
the
&quot;Sign&quot;
and
&quot;Verify
signature&quot;
processes.
Generating
a
signature:
The
issuer
of
the
&quot;MyCert&quot;
certificate
generates
a
hash
value
from
the
certificate
data
using
a
specific
hash
function
(for
example
SHA-1,
Secure
Hash
Algorithm).
The
hash
value
is
a
bit
string
of
a
constant
length.
The
advantage
of
the
constant
length
of
the
hash
value
is
that
it
always
takes
the
same
amount
of
time
to
sign.
Using the hash value generated in this way and the private key, the issuer of the
certificate
then
generates
a
digital
signature.
The
RSA
signature
scheme
is
often
used.
The digital signature is saved in the certificate. The certificate is now signed.
Verifying
a
signature:
The
authenticator
of
the
&quot;MyCert&quot;
certificate
obtains
the
certificate
of
the
issuer
and
thus
the
public
key.
A new hash value is formed from the certificate data with the same hash algorithm that
was
used
for
signing
(for
example
SHA-1).
This hash value is then compared with the hash value that is determined by means of the
public
key
of
the
certificate
issuer
and
the
signature
algorithm
for
checking
the
signature.
If
the
signature
check
produces
a
positive
result,
both
the
identity
of
the
certificate
subject
as well as the integrity, meaning authenticity and genuineness, of the certificate content
are proven. Anyone who has the public key, i.e. the certificate from the certificate
authority, can check the signature and thus recognize that the certificate was actually
signed
by
the
certificate
authority.
The figure below shows how Alice uses the public key in the certificate from Twent (who
represents
the
certificate
authority,
CA)
to
verify
the
signature
on
Bob&apos;s
public
key.
All
that
is
required for verification is therefore the availability of the certificate from the certificate
authority at the moment of checking. The validation itself is executed automatically in the
TLS
session.
$
O
i
F
H
Y
H
U
i
I
i
H
V
%
R
E
&apos;
V
7
Z
H
Q
W
2595528
-159746
&$
V
i
J
Q
D
W
X
U
H
Z
i
W
K
W
K
H
S
X
E
O
i
F
N
H
\
I
U
R
P
7
Z
H
Q
W
(
&
$
)
&
$
%RE
Figure
5-10
Verification
of
a
certificate
with
the
public
key
of
the
certificate
of
a
certificate
authority
Communication
62
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Signing
messages
The
method
described
above
for
signing
and
verifying
certificates
also
uses
the
TLS
session
for
signing
and
verifying
messages:
If a hash value is generated by a message and this hash value is encrypted with the private
key
of
the
sender
and
attached
to
the
original
message,
the
receiver
of
the
message
is
able
to
check the integrity of the message. The recipient decrypts the hash value with the public key
of
the
sender,
puts
together
the
hash
value
from
the
message
received
and
compares
the
two
values. If the values are not the same, the message or the encrypted hash value has been
tampered
with
on
the
way.
Chain
of
certificates
to
root
certificate
The certificates of a PKI are often organized hierarchically: The top of the hierarchy is formed
by root certificates. Root certificates are certificates that are not signed by a higher-level
certificate authority. The certificate subject and certificate issuer of root certificates are
identical. Root certificates enjoy absolute trust. They form the &quot;anchor&quot; of trust and must
therefore
be
known
to
the
receiver
as
trusted
certificates.
They
are
stored
in
an
area
provided
for
trusted
certificates.
Depending on the PKI, the function of root certificates is, for example, to sign certificates
from lower-level certificate authorities, so-called intermediate certificates. This transfers the
trust from the root certificate to the intermediate certificate. An intermediate certificate can
sign
a
certificate
just
like
a
root
certificate;
both
are
therefore
referred
to
as
&quot;CA
certificates&quot;.
This
hierarchy
can
be
continued
over
multiple
intermediate
certificates
until
the
end-entity
certificate.
The
end-entity
certificate
is
the
certificate
of
the
user
who
is
to
be
identified.
The validation process runs through the hierarchy in the opposite direction: As described
above,
the
certificate
issuer
is
established
and
the
signature
checked
with
the
issuer&apos;s
public
key, then the certificate of the higher-level certificate issuer is established along the entire
chain
of
trust
to
the
root
certificate.
Conclusion: The chain of intermediate certificates to the root certificate, the certificate path,
must be available in every device that is to validate an end-entity certificate of the
communication
partner,
irrespective
of
the
type
of
secure
communication
that
you
configure.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
63
Communications
services
5.6
Secure
Communication
Managing
certificates
What
you
should
know
about
the
certificate
management
This section shows the available certificate management options of an S7-1500 CPU
depending
on
the
service
(CPU
application)
used
and
on
the
versions
of
the
TIA
Portal
/
the
CPU
firmware.
Overview
of
certificate
management
options
Since TIA Portal version V14 and CPU firmware version V2.0, it has been possible to manage
certificates
for
secure
communications
for
different
services
of
S7-1500
CPU
in
the
TIA
Portal
and
load
them
in
the
CPU.
TIA
Portal
as
of
version
V17,
along
with
the
S7-1500
CPUs
as
of
version
V2.9
support
another
option of certificate management: With GDS push methods, you can transfer or renew
certificates
in
the
CPU
at
runtime
without
having
to
reload
the
CPU.
Using
the
same
route,
as
of
TIA
Portal
version
V18,
you
can
also
transfer
web
server
certificates
for
a
S7-1500
CPU
(as
of
firmware
V3.0).
The
following
table
provides
an
overview
of
the
certificate
management
options
depending
on
the
service
used
and
the
TIA
Portal
firmware
version
or
CPU
firmware
version.
Service
Certificate
management
with
TIA
Portal
(TIA
Portal
version
/
S7-1500
CPU-FW
version)
Certificate
management
with
OPC
UA
GDS
push
methods
(TIA
Portal
version
/
S7-1500
CPU-FW
version)
Web
server
as
of
V14
/
as
of
V2.0
as
of
V18
/
as
of
V3.0
Secure
OUC
communica-
tion
as
of
V14
/
as
of
V2.0
-
OPC
UA
server
as
of
V14
/
as
of
V2.0
as
of
V17
/
as
of
V2.9
OPC
UA
client
as
of
V15.1
/
as
of
V2.6
-
Secure
PG/HMI
Communic-
ation
as
of
V17
/
as
of
V2.9
-
More
information
Click
here
for
a
description
of
the
certificate
management
with
GDS
push
methods:
Certificate
management
via
Global
Discovery
Server
(GDS)
(Page
199).
If
you
do
not
need
to
load
new
certificates,
but
need
to
renew
a
certificate,
e.g.
because
the
validity
period
has
expired,
this
is
also
possible
in
RUN
while
adhering
to
the
conditions:
See
Tip:
Updating
loaded
certificates
in
RUN
(Page
76).
Communication
64
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Certificate
management
with
TIA
Portal
STEP
7
as
of
version
V14
together
with
the
S7‑1500
CPUs
as
of
firmware
version
2.0
support
the
Internet
PKI
(RFC
5280)
in
as
far
as
an
S7‑1500
CPU
is
able
to
communicate
with
devices
that
also
support
the
Internet
PKI.
The
usage
of
X.509
certificates
for
verifying
certificates
as
described
in
the
preceding
sections,
for
example,
is
a
result
of
this.
STEP
7
as
of
V14
uses
a
PKI
similar
to
Internet
PKI.
Certificate
Revocation
Lists
(CRLs),
for
example,
are
not
supported.
Creating
or
assigning
certificates
in
the
TIA
Portal
You
create
certificates
for
various
applications
in
STEP
7
for
devices
with
security
properties,
such
as
an
S7-1500
CPU
as
of
firmware
V2.0.
The
following
areas
in
the
Inspector
window
of
the
CPU
allow
the
creation
of
new
certificates
or
the
selection
of
existing
ones:
&quot;Web
server
>
Security&quot;
-
for
the
generation
and
assignment
of
Web
server
certificates.
&quot;Protection
&
Security
>
Connection
mechanisms&quot;
-
for
the
generation
or
assignment
of
PLC
communication
certificates
(Secure
PG/HMI
communication,
as
of
TIA
Portal
V17).
&quot;Protection
&
Security
>
Certificate
manager&quot;
-
for
the
generation
and
assignment
of
all
types
of
certificates.
TLS
certificates
for
Secure
Open
User
Communication
are
preset
for
the
generation
of
certificates.
&quot;OPC
UA
>
Server
>
Security&quot;
-
for
the
generation
or
assignment
of
OPC
UA
server
certificates.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
65
Communications
services
Secure
Communication
Figure
5-11
Security
settings
for
an
S7‑1500
CPU
in
STEP
7
Special
features
of
the
section
&quot;Protection
&
Security
>
Certificate
manager&quot;
Only
in
this
section
of
the
Inspector
window
do
you
switch
between
the
global,
i.e.
project-
wide, and the local, i.e. device-specific, certificate manager (option &quot;Use global security
settings for certificate manager&quot;). The option decides whether you have access to all the
certificates
in
the
project
or
not.
If you do
not
use the certificate manager in the global security settings, you only have
access
to
the
local
certificate
memory
of
the
CPU.
You
do
not
have
access,
for
example,
to
imported certificates or root certificates. Without these certificates only a restricted
functionality
is
available.
You
can,
for
example,
only
generate
self-signed
certificates.
If you use the certificate manager in the global security settings and you are logged on as
an
administrator,
you
have
access
to
the
global,
project-wide
certificate
memory.
You
can,
for example, assign imported certificates to the CPU, or create certificates that are issued
and
signed
by
the
project
CA
(certificate
authority
of
the
project).
Communication
66
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
The
figure
below
shows
how
the
&quot;Global
security
settings&quot;
are
shown
in
the
project
tree
after
the &quot;Use global security settings for certificate manager&quot; option has been activated in the
Inspector
window
of
the
CPU.
When
you
double-click
&quot;User
login&quot;
in
the
project
tree
below
the
global
security
settings
and
log
in,
a
line
called
&quot;Certificate
manager&quot;
is
displayed,
among
other
data.
When
you
double-click
the
&quot;Certificate
manager&quot;
line,
you
obtain
access
to
all
the
certificates
in the project, divided into the tabs &quot;CA&quot; (certificate authorities), &quot;Device certificates&quot; and
&quot;Trusted
certificates
and
root
certificate
authorities&quot;.
Private
keys
STEP 7 generates private keys while generating device certificates and server certificates
(end-entity
certificates).
The
location
where
the
private
key
is
stored
encrypted
depends
on
the
use
of
the
global
security
settings
for
the
certificate
manager:
If
you
use
global
security
settings,
the
private
key
is
stored
encrypted
in
the
global
(project-wide)
certificate
memory.
If
you
do
not
use
global
security
settings,
the
private
key
is
stored
encrypted
in
the
local
(CPU-specific)
certificate
memory.
The
existence
of
the
private
key,
which
is
required
to
decrypt
data,
for
example,
is
displayed
in the &quot;Private key&quot; column of the &quot;Device certificates&quot; tab of the certificate manager in the
global
security
settings.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
67
Communications
services
5.6
Secure
Communication
When
the
hardware
configuration
is
loaded,
the
device
certificate,
the
public
key
as
well
as
the
private
key
are
loaded
into
the
CPU.
Enabling
the
&quot;Use
global
security
settings
for
certificate
manager&quot;
option
-
Consequences
The &quot;Use global security settings for certificate manager&quot; option influences the previously
used private key: If you have already created certificates without using the certificate
manager
in
the
global
security
settings
and
then
change
the
option
for
using
the
certificate
manager, the private keys are lost and the certificate ID can change. A warning draws your
attention to this fact. Therefore specify at the beginning of the project configuration which
option
is
required
for
the
certificate
manager.
NOTICE
Examples
for
the
management
of
certificates.
As explained in the preceding sections, certificates are required for every type of secure
communication. The following section shows as an example how you handle the certificates
with
STEP
7
so
that
the
requirements
for
Secure
Open
User
Communication
are
fulfilled.
The devices which are involved at the respective communication partners are differentiated
below. The respective steps for supplying the required certificates to the communications
participants
are
described.
An
S7‑1500
CPU
or
an
S7‑1500
Software
Controller
as
of
firmware
version
2.0
is
always
required.
The
general
rule
is:
While
a
secure
connection
is
being
established
(handshake&quot;),
the
communication
partners
as
a
rule
only
communicate
their
end-entity
certificates
(device
certificates).
Therefore
the
CA
certificates
required
to
verify
the
transmitted
device
certificate
must
be
located
in
the
certificate
memory
of
the
respective
communication
partner.
NOTE
The
current
date/time
must
be
set
in
the
CPU.
When
using
secure
communication
(for
example,
HTTPS,
secure
OUC,
OPC
UA),
make
sure
that
the
corresponding
modules
have
the
current
time
of
day
and
the
current
date.
Otherwise, the modules will evaluate the certificates used as invalid and secure
communication
will
not
work.
Secure
Open
User
Communication
between
2
S7-1500
CPUs
Two
S7-1500
CPUs
PLC_1
and
PLC_2
are
to
exchange
data
with
each
other
via
Secure
Open
User
Communication.
You
generate
the
required
device
certificates
with
STEP
7
and
assign
them
to
the
CPUs
as
described
below.
STEP
7
project
certificate
authorities
(CA
of
the
project)
are
used
to
sign
the
device
certificates.
The certificates are to be referenced by their certificate ID in the user program (TCON
communication
instruction
in
combination
with
the
associated
system
data
type,
for
example
Communication
68
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
TCON_IPV4_SEC).
STEP
7
assigns
the
certificate
ID
automatically
during
the
generation
or
creation
of
certificates.
1853226
159610
Procedure
STEP 7 automatically loads the required CA certificates together with the hardware
configuration
to
the
participating
CPUs
so
that
the
requirements
for
certificate
verification
exist for both CPUs. You therefore only have to generate the device certificates for the
respective
CPU;
STEP
7
does
the
rest
for
you.
Mark
PLC_1
and
activate
the
&quot;Use
global
security
settings
for
certificate
manager&quot;
option
in
the
&quot;Protection
&
Security&quot;
section.
Log
in
as
a
user
in
the
project
tree
in
the
&quot;Global
security
settings&quot;
section.
For
a
new
project,
the
&quot;Administrator&quot;
role
is
planned
for
the
first
login.
Return
to
the
PLC‑1
in
the
&quot;Protection
&
Security&quot;
section.
Click
in
an
empty
line
in
the
&quot;Certificate
subject&quot;
column
in
the
&quot;Device
certificates&quot;
table
to
add
a
new
certificate.
In
the
drop-down
list
for
selecting
a
certificate
click
the
&quot;Add&quot;
button.
The
&quot;Create
Certificate&quot;
dialog
opens.
Leave
the
default
settings
in
this
dialog.
They
are
tailored
to
the
usage
of
Secure
Open
User
Communication
(usage:
TLS).
Tip: Supplement the default name of the certificate subject, in this case the CPU name. In
order
to
differentiate
you
better
leave
the
default
CPU
name
in
case
you
have
to
manage
a
large
number
of
device
certificates.
Example:
PLC_1/TLS
becomes
PLC_1-SecOUC-Chassis17FactoryState.
Compile
the
configuration.
The
device
certificate
and
the
CA
certificate
are
part
of
the
configuration.
Repeat
the
steps
described
above
for
PLC_2.
In
the
next
step
you
have
to
create
the
user
programs
for
the
data
exchange
and
load
the
configurations
together
with
the
program.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
69
Communications
services
Secure
Communication
Using
self-signed
certificates
instead
of
CA
certificates
When
creating
device
certificates
you
can
select
the
&quot;Self-signed&quot;
option.
You
can
create
self-
signed certificates without being logged in for the global security settings. This procedure is
not recommended because the resulting certificates do not exist in the global certificate
memory
and
can
therefore
not
be
assigned
directly
to
a
partner
CPU.
As
described
above,
you
should
select
the
name
of
the
certificate
subject
with
care
so
that
the
right
certificate
can
be
assigned
to
a
device
without
any
doubt.
Verification with the CA certificates of the STEP 7 project is not possible for self-signed
certificates.
To
ensure
that
self-signed
certificates
can
be
verified
you
have
to
include
the
self-
signed certificates of the communication partner into the list of trusted partner devices for
each CPU. To this purpose you must have activated the &quot;Use global security settings for
certificate
manager&quot;
option
and
be
logged
in
as
a
user
in
the
global
security
settings.
Proceed
as
follows
to
add
the
self-signed
certificate
of
the
communication
partner
of
the
CPU:
Mark
PLC_1
and
navigate
to
the
&quot;Certificates
of
partner
devices&quot;
table
in
the
&quot;Protection
&
Security&quot;
section.
Click
in
an
empty
line
in
the
&quot;Certificate
subject&quot;
column
in
the
&quot;Device
certificates&quot;
table
to
add
a
new
certificate.
Select
the
self-signed
certificate
of
the
communication
partner
from
the
drop-down
list
and
confirm
the
selection.
In
the
next
step
you
have
to
create
the
user
programs
for
the
data
exchange
and
load
the
configurations
together
with
the
program.
Secure
Open
User
Communication
between
S7-1500
CPU
as
a
TLS
client
and
an
external
device
as
a
TLS
server
Two
devices
are
to
exchange
data
with
each
other
via
TLS
connection
or
TLS
session,
for
example,
exchanging
recipes,
production
data
or
quality
data:
An
S7‑1500‑CPU
(PLC_1)
as
TLS
client;
the
CPU
uses
Secure
Open
User
Communication
1
2
1677938
819816
An external device (for example a Manufacturing Execution System (MES)) as TLS server
The
S7-1500
CPU
establishes
the
TLS
connection
/
session
to
the
MES
system
as
TLS
client.
①
TLS
client
②
TLS
server
The S7-1500 CPU requires the CA certificates of the MES system to authenticate the TLS
server: The root certificate and, if appropriate, the intermediate certificates for verifying the
certificate
path.
You
have
to
import
these
certificates
into
the
global
certificate
memory
of
the
S7-1500
CPU.
Communication
70
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Proceed
as
follows
to
import
certificates
of
the
communication
partner:
Open
the
certificate
manager
in
the
global
security
settings
in
the
project
tree.
Select
the
appropriate
table
(trusted
certificates
and
root
certificate
authorities)
for
the
certificate
to
be
imported.
Right-click
in
the
table
to
open
the
shortcut
menu.
Click
&quot;Import&quot;
and
import
the
required
certificate
or
the
required
CA
certificates.
Through
the
import
the
certificate
has
a
certificate
ID
assigned
to
it
and
can
be
assigned
to
a
module
in
the
next
step.
Mark
PLC_1
and
navigate
to
the
&quot;Certificates
of
partner
devices&quot;
table
in
the
&quot;Protection
&
Security&quot;
section.
Click
in
an
empty
line
in
the
&quot;Certificate
subject&quot;
column
to
add
the
imported
certificates.
Select
the
required
CA
certificates
of
the
communication
partner
from
the
drop-down
list
and
confirm
the
selection.
Optionally
the
MES
system
can
also
request
a
device
certificate
of
the
CPU
to
authenticate
the
CPU (i.e., the TLS client). In this case, the CA certificates of the CPU must be made available to
the MES system. The prerequisite for importing the certificates into the MES system is a
preceding
export
of
the
CA
certificates
from
the
STEP
7
project
of
the
CPU.
Follow
these
steps:
Open
the
certificate
manager
in
the
global
security
settings
in
the
project
tree.
Select
the
matching
table
(CA
certificate)
for
the
certificate
to
be
exported.
Right-click
the
selected
certificate
to
open
the
shortcut
menu.
Click
&quot;Export&quot;.
Select
the
export
format
of
the
certificate.
In
the
next
step
you
have
to
create
the
user
programs
for
the
data
exchange
and
load
the
configurations
together
with
the
program.
Secure
Open
User
Communication
between
an
S7-1500
CPU
as
TLS
server
and
an
external
device
as
TLS
client
If the S7-1500 CPU acts as TLS server and the external device, for example an ERP system
(Enterprise
Resource
Planning
System)
establishes
the
TLS
connection
/
session,
you
require
the
following
certificates:
For the S7-1500 CPU, you generate a device certificate (server certificate) with a private
key
and
download
it
with
the
hardware
configuration
into
the
S7-1500
CPU.
You
use
the
&quot;Signed
by
certificate
authority&quot;
option
when
generating
the
server
certificate.
The
private
key
is
required
for
the
key
exchange
as
explained
in
the
figure
for
the
example
&quot;HTTP
over
TLS&quot;.
You
have
to
export
the
CA
certificate
of
the
STEP
7
project
for
the
ERP
system
and
import
/
load it into the ERP system. With the CA certificate the ERP system verifies the server
certificate
of
the
S7-1500
that
was
transferred
from
the
CPU
to
the
ERP
system
during
the
establishment
of
the
TLS
connection
/
session.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
71
Communications
services
Secure
Communication
1
2
1677937
365115
①
TLS
server
②
TLS
client
Figure
5-12
Secure
OUC
between
an
S7‑1500
CPU
and
ERP
system
The
required
steps
are
described
in
the
preceding
sections.
Secure
Open
User
Communication
to
a
mail
server
(SMTP
over
TLS)
An
S7-1500
CPU
can
establish
a
secure
connection
to
an
e-mail
server
with
the
communication
instruction
TMAIL-C.
The
system
data
types
TMail_V4_SEC
and
TMail_QDN_SEC
allow
you
to
determine
the
partner
port
of
the
e-mail
server
and
thus
to
reach
the
e-mail
server
via
&quot;SMTP
over
TLS&quot;.
1620011
161669
Figure
5-13
Secure
OUC
between
a
S7-1500
CPU
and
a
mail
server
Requirement for secure email connection is the importing of the root certificate and the
intermediate certificates of the mail server (provider) into the global certificate memory of
the
S7-1500
CPU.
By
means
of
these
certificates
the
CPU
can
check
the
server
certificate
that
is
sent
by
the
mail
server
during
the
establishment
of
the
TLS
connection
/
session.
Proceed
as
follows
to
import
certificates
of
the
mail
server:
Open
the
certificate
manager
in
the
global
security
settings
in
the
project
tree.
Select
the
appropriate
table
(trusted
certificates
and
root
certificate
authorities)
for
the
certificate
to
be
imported.
Right-click
in
the
table
to
open
the
shortcut
menu.
Click
&quot;Import&quot;
and
import
the
required
certificate
or
the
required
CA
certificates.
As
a
result
of
the
import,
the
certificate
has
a
certificate
ID
assigned
to
it
and
can
be
assigned
to
a
module
in
the
next
step.
Mark
PLC_1
and
navigate
to
the
&quot;Certificates
of
partner
devices&quot;
table
in
the
&quot;Protection
&
Security&quot;
section.
Communication
72
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Click
in
an
empty
line
in
the
&quot;Certificate
subject&quot;
column
to
add
the
imported
certificates.
Select
the
required
CA
certificates
of
the
communication
partner
from
the
drop-down
list
and
confirm
the
selection.
In
the
next
step
you
have
to
create
the
user
programs
for
the
email
client
function
of
the
CPU
and
load
the
configurations
together
with
the
program.
How
communication
with
certificates
works:
HTTP
over
TLS
The
following
paragraphs
show
how
the
mechanisms
described
are
used
to
establish
a
secure
communication
between
a
Web
browser
and
the
Web
server
of
an
S7-1500
CPU.
Initially the changes for the &quot;Permit access only with HTTPS&quot; option in STEP 7 are described.
As
of
STEP
7
V14
you
have
the
possibility
to
influence
the
server
certificate
of
the
Web
server
of an S7-1500 CPU as of firmware V2.0: The server certificate is generated as of these
versions
with
STEP
7.
In
addition
it
illustrates
the
processes
that
are
executed
when
a
website
of
the
CPU
Web
server
is
called
with
a
Web
browser
of
a
PC
through
an
encrypted
HTTPS
connection.
Using
Web
server
certificates
for
S7‑1500
CPUs,
FW
V2.0
or
higher
For
S7-1500
CPUs
with
a
firmware
version
before
V2.0,
you
were
able
to
set
&quot;Permit
access
only with HTTPS&quot; when setting the Web server properties, without specific requirements
applying.
You
did
not
have
to
handle
certificates
for
these
CPUs;
the
CPU
automatically
generates
the
certificates
required
for
the
Web
server.
For S7-1500 CPUs as of firmware V2.0, STEP 7 generates the server certificate (end-entity
certificate)
for
the
CPU.
You
assign
a
server
certificate
to
the
Web
server
in
the
properties
of
the
CPU
(Web
server
>
Security).
Because a server certificate name is always preset, there is no change to the easy
configuration
of
the
Web
server:
You
activate
the
Web
server.
The
&quot;Permit
access
only
with
HTTPS&quot;
option
is
enabled
by
default
-
STEP
7
generates
a
server
certificate
with
the
default
name
during
compiling.
Irrespective
of
whether
you
use
the
certificate
manager
in
the
global
security
settings
or
not:
STEP
7
has
all
the
information
required
to
generate
the
server
certificate.
In
addition,
you
have
the
possibility
to
determine
the
properties
of
the
server
certificate,
for
example,
the
name
or
the
validity
period.
NOTE
The
current
date/time
must
be
set
in
the
CPU.
When
using
secure
communication
(for
example,
HTTPS,
secure
OUC,
OPC
UA),
make
sure
that
the
corresponding
modules
have
the
current
time
of
day
and
the
current
date.
Otherwise, the modules will evaluate the certificates used as invalid and secure
communication
will
not
work.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
73
Communications
services
Secure
Communication
Loading
the
Web
server
certificate
The
server
certificate
generated
by
STEP
7
is
then
automatically
also
loaded
to
the
CPU
when
the
hardware
configuration
is
loaded.
If you use the certificate manager in the global security settings, the certificate authority
of
the
project
(CA
certificate)
signs
the
server
certificate
of
the
Web
server:
During
loading
the
CA
certificate
of
the
project
is
loaded
as
well
automatically.
If
you
do
not
use
the
certificate
manager
in
the
global
security
settings,
STEP
7
generates
the
server
certificate
as
a
self-signed
certificate.
When you address the Web server of the CPU over the IP address of the CPU, a new server
certificate (end-entity certificate) must be generated and loaded with each change in the IP
address of an Ethernet interface of the CPU. This is necessary because the identity of the CPU
changes
with
the
IP
address
–
and
the
identity
requires
a
signature
in
accordance
with
the
PKI
rules.
You can avoid this problem by addressing the CPU with a domain name instead of its IP
address, for example &quot;myconveyer-cpu.room13.myfactory.com&quot;. For this purpose, you have
to
manage
the
domain
names
of
the
CPU
via
a
DNS
server.
Supplying
a
Web
browser
with
a
CA
certificate
of
the
Web
server
In the Web browser the user who accesses the websites of the CPU through HTTPS should
install the CA certificate of the CPU. If no certificate is installed, a warning is output
recommending
that
you
do
not
use
the
page.
To
view
this
page,
you
must
explicitly
&quot;Add
an
exception&quot;.
The
user
receives
the
valid
root
certificate
for
download
from
the
&quot;Intro&quot;
Web
page
of
the
CPU
Web
server
under
&quot;Download
certificate&quot;.
STEP
7
offers
a
different
possibility:
Export
the
CA
certificate
of
the
project
with
the
certificate
manager into the global security settings in STEP 7. Subsequently import the CA certificate
into
the
browser.
Communication
74
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Course
of
the
secure
communication
The figure below shows, in simplified terms, how communication is established
(&quot;handshake&quot;)
focusing
on
the
negotiation
of
keys
used
for
data
exchange
(here
with
HTTP
over
TLS).
However,
the
course
can
be
applied
to
all
communication
options
that
are
based
on
the
usage of TLS, i.e. also for Secure Open User Communication (see Basics for secure
communication).
$
O
i
F
H
$
O
i
F
H
V
H
O
H
F
W
V
U
D
Q
G
R
P
V
\
P
P
.
NH\
&$
6
i
J
Q
H
G
S
X
E
O
i
F
N
H
\
D
Q
G
S
U
i
Y
D
W
H
N
H
\
R
I
W
K
H
:
H
E
VHUYHU
$
O
i
F
H
D
FF
H
V
V
H
V
Z
H
E
V
i
W
H
Z
i
W
K
&quot;
K
W
W
S
V
..
.
&quot;
:
H
E
V
H
U
Y
H
U
D
FF
H
S
W
V
W
K
H
F
R
Q
Q
H
F
W
i
R
Q
D
Q
G
V
H
Q
G
V
i
W
V
F
H
U
W
i
I
i
F
D
W
H
Z
i
W
K
S
X
E
O
i
F
NH\
&$
$
O
i
F
H
V
H
Q
G
V
W
K
H
V
\
PP
H
W
U
i
F
N
H
\
H
Q
F
U
\
S
W
H
G
Z
i
W
K
W
K
H
S
X
E
O
i
F
N
H
\
R
I
W
K
H
V
H
U
Y
H
U
$
O
i
F
H
D
Q
G
W
K
H
:
H
E
V
H
U
Y
H
U
Q
R
Z
X
V
H
V
\
PP
H
W
U
i
F
H
Q
F
U
\
S
W
i
R
Q
D
Q
G
G
H
F
U
\
S
W
i
R
Q
:
H
E
V
H
U
Y
H
U
G
H
F
U
\
S
W
V
W
K
H
V
\
PP
H
W
U
i
F
N
H
\
Z
i
W
K
i
W
V
S
U
i
Y
D
W
H
N
H
\
Figure
5-14
Handshake
with
https
The
figure
does
not
show
the
measures
taken
at
Alice&apos;s
end
(browser)
to
verify
the
certificate
sent by the Web server. Whether Alice can trust the Web server certificate received and
therefore the identity of the Web server, and can accept the exchange of data, depends on
positive
verification.
The
steps
for
verifying
the
authenticity
of
the
Web
server:
Alice must know the public keys of all relevant certificate authorities, which means she
requires
the
complete
certificate
chain
to
verify
the
Web
server
certificate
(i.e.
the
end-
entity
certificate
of
the
Web
server):
Alice will generally have the required root certificate in her certificate memory. When a
Web browser is installed, a range of trusted root certificates is also installed. If she does
not have the root certificate, she must download it from the certificate authority and
install it in the certificate authority of the browser. The certificate authority can also be the
device
on
which
the
Web
server
is
located.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
75
Communications
services
Secure
Communication
You
have
the
following
options
for
obtaining
the
intermediate
certificates:
The
server
itself
sends
the
required
intermediate
certificates
to
Alice
along
with
its
end-
entity certificate – in the form of a signed message so that Alice can verify the integrity
of
the
certificate
chain.
The
certificates
often
contain
the
URLs
of
the
certificate
issuer.
Alice
can
load
the
required
intermediate
certificates
from
these
URLs.
When you work with certificates in STEP 7 it is always assumed that you have imported
the
intermediate
certificates
and
the
root
certificate
into
the
project
and
assigned
them
to
the
module.
Alice
validates
the
signatures
in
the
certificate
chain
with
the
public
keys
of
the
certificates.
The
symmetric
key
must
be
generated
and
transferred
to
the
Web
server.
If the Web server is addressed by its domain name, Alice also verifies the identity of the
Web
server
in
accordance
with
the
Internet
PKI
rules
defined
in
RFC
2818.
She
is
able
to
do
this because the URL of the Web server, in this case the &quot;Fully Qualified Domain Name&quot;
(FQDN), is saved in the end-entity certificate of the Web server. If the certificate entry in
the &quot;Subject Alternative Name&quot; field corresponds to the entry in the address bar of the
browser,
everything
is
fine.
The process continues with the exchange of data with the symmetric key, as shown in the
figure
above.
Tip:
Updating
loaded
certificates
in
RUN
As
of
TIA
Portal
V19
and
firmware
version
V3.1
of
the
S7-1500
CPUs
(incl.
R/H-CPUs)
you
have
the
possibility
to
update
certificates
during
runtime,
i.e.
in
RUN
mode
of
the
CPU.
These
are
certificates
that
were
configured
through
the
TIA
Portal
and
downloaded.
This allows this you, for example, to renew or replace certificates without interrupting the
running
process.
Requirements
•
Project
protection
is
activated.
•
The project administrator (Engineering-Administrator) is logged on with the
corresponding
security
rights.
•
No further changes to the hardware configuration are present. These changes would
require
a
STOP
of
the
CPU
to
be
loaded.
Rule
The
existing
ID
of
the
certificate
to
be
updated
must
not
change.
Communication
76
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Procedure
In
TIA
Portal
(project
navigation),
navigate
to
the
certificate
manager
(Security
settings
>
Security
functions).
Select
the
&quot;Certificate
authority
(CA)&quot;
tab
or
the
&quot;Device
certificates&quot;
tab
-
depending
on
which
certificate
you
want
to
update.
Select
the
certificate
to
be
updated.
In
the
context
menu,
select
the
&quot;Renew&quot;
or
&quot;Replace&quot;
command,
depending
on
whether
you want to replace the existing certificate with a certificate from the file system or only
update
the
validity
data
of
the
existing
certificate,
for
example.
For
CA
certificates,
all
derived
device
certificates
are
automatically
digitally
signed
with
the
renewed
CA
certificate.
Load
the
changes
to
the
CPU
(Load
to
device
>
Hardware
configuration).
Requirements
for
secure
communication
Protection
of
confidential
configuration
data
As described in the basic information on secure communication, the proper functioning of
certificate-based
protocols
requires
private
keys
that
must
be
protected
as
best
as
possible.
As
of
STEP
7
V17,
you
can
use
a
password
to
protect
these
keys
and
other
data
worth
protecting:
The
password
to
protect
confidential
PLC
configuration
data.
It
is
possible
to
do
without
the
password
if
you
have
implemented
measures
to
prevent
unauthorized
access
to
the
TIA
Portal
project
and
the
configuration
of
the
CPU.
independently of whether you assign a password or not: The TIA Portal generates a key
information
that
provides
for
the
protection
of
the
confidential
PLC
configuration
data.
This
password has no influence on the secure communication process. However, the complexity
of the password for the protection of confidential PLC configuration data determines how
well
the
private
keys,
for
example,
are
protected.
The
presence
of
key
information
is
a
prerequisite
for
secure
communication
such
as
TLS-based
secure
PG/HMI
communication:
The
CPU
can
handle
certificates
which
are
required
for
Secure
Communication
only
if
this
key
information
is
available.
The
following
figure
shows
the
described
contexts.
1BTTXPSE
1
B
T
T
X
P
S
E
C
B
T
F
E
L
F
Z
J
O
G
P
S
N
B
U
J
P
O
4
&
$
6
3
*
5
:
4
F
D
V
S
F
$
P
NN
V
O
J
D
B
U
J
P
O
/
P
Q
B
T
T
X
P
S
E
=
F
N
Q
U
Z
Q
B
T
T
X
P
S
E
%
F
G
B
V
M
U
L
F
Z
J
O
G
P
S
N
B
U
J
P
O
Figure
5-15
Contexts
for
protecting
confidential
configuration
data
4
&
$
6
3
*
5
:
Communication
Function
Manual,
11/2024,
A5E03735815-AM
77
Communications
services
Secure
Communication
Security
settings
wizard
When
you
add
a
CPU
to
the
project
that
supports
secure
PG/HMI
communication
in
the
TIA
Portal
from
the
hardware
catalog,
a
wizard
starts
for
the
security
settings
of
the
CPU.
The
wizard
guides
you
step
by
step
through
the
following
CPU
settings:
Password
to
protect
confidential
PLC
configuration
data
PG/PC
and
HMI
communication
mode
Access
level
Each
of
these
settings
is
explained
in
detail
in
the
wizard.
At
the
end,
all
settings
are
once
again
summarized
in
an
overview.
The wizard also starts, for example, when you replace a module in the network view of the
TIA Portal and the new CPU, unlike the replaced CPU, supports secure PG/HMI
communication.
All
settings
in
the
wizard
are
applied
in
the
Inspector
window
(CPU
properties).
You
can
start
the
wizard
at
any
time
using
a
Start
button
in
the
&quot;Protection
&
Security&quot;
area
of
the
CPU
properties.
Requirement
•
TIA
Portal
as
of
version
V17
•
CPU
supports
secure
PG/HMI
communication
(for
S7-1500
CPUs
as
of
firmware
version
2.9)
•
The
CPU
is
not
yet
loaded
or
the
CPU
is
reset
to
factory
settings
with
the
option
&quot;Delete
password
for
protection
of
confidential
PLC
configuration
data&quot;
Procedure
Open
the
CPU
properties
in
the
network
view
or
in
the
device
view.
Navigate
to
the
area
&quot;Protection
&
Security
>
Protection
of
the
PLC
configuration
data&quot;.
Result:
The
&quot;Protect
confidential
PLC
configuration
data&quot;
option
is
enabled
first
and
the
empty
field
for
password
entry
is
highlighted
in
red.
Configure
the
password
(recommended)
via
the
&quot;Set&quot;
button
or
disable
the
&quot;Protect
confidential
PLC
configuration
data&quot;
option.
Complete
the
configuration
and
create
the
user
program.
Load
the
CPU.
When
loading
the
hardware
configuration,
you
will
be
asked
once
to
re-enter
the
password.
Background
: The configured password is used in the TIA Portal to generate the key
information
to
protect
confidential
configuration
data
and
thus
to
protect
this
data.
For
security reasons, however, neither the password nor the key information is saved in the
project. In order for the key information to reach the CPU, it is re-generated when the
hardware configuration is loaded, so that the password must be entered once at this
point.
Communication
78
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Certificate-based
communication
also
between
PG/HMI
and
CPU
Because, as of TIA Portal version V17 and CPU firmware version V2.9 (S7-1500) or V4.5
(S7-1200),
the
PG/HMI
communication
is
also
certificate-based,
you
will
be
prompted
to
accept
the
server
certificate
in
the
course
of
the
commissioning.
Tips
and
rules
for
password
management
Manage
your
passwords
in
a
password
manager.
To
check
the
newly
entered
passwords
for
compliance
and,
for
example,
prevent
trivial
passwords,
use
the
settings
for
checking
the
password
policies
in
the
TIA
Portal:
In
the
project
tree,
navigate
to
the
area
&quot;<Project
name>
>
Security
settings
>
Settings&quot;
area
and
select
the
&quot;Password
policies&quot;
area.
Specify, for example, the minimum number of characters the password must have or
the
minimum
number
of
special
characters.
You
do
not
have
to
assign
different
passwords
for
each
CPU
in
a
system
or
machine.
If
the
requirements are met, you can also define the same password for a group of CPUs. This
strategy also has advantages in the replacement parts scenario: If the group password is
also
assigned
to
the
replacement
CPU,
the
workload
of
replacing
the
CPU
is
reduced.
Note
here
the
risk
that
if
the
password
of
one
of
these
CPUs
is
compromised,
all
CPUs
with
the
same
password
are
vulnerable.
The definition of passwords also has an impact on the replacement part case, as the
password for confidential PLC configuration data must be transferred to the new
(replacement)
CPU
in
addition
to
the
configuration
(see
Rules
for
the
replacement
parts
scenario
(Page
89)).
With
S7-1500R/H CPUs
, the password for confidential PLC configuration data is only
loaded
onto
one
of
the
two
CPUs
during
loading.
In
order
that
the
sync-up
process
works
and that the partner CPU also works properly, the password must be transferred to the
partner
CPU
before
the
sync-up,
using
the
Online
and
Diagnostics
editor:
In
the
Online
and
diagnostics
view,
you
specify
the
area
&quot;Password
to
protect
confidential
PLC
configuration
data&quot;.
Enter
the
required
password
and
click
the
&quot;Set&quot;
button.
If
the
correct
password
has
been
entered,
the
partner
CPU
can
use
the
protected
PLC
configuration
data
and
start
the
sync-up
process.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
79
Communications
services
5.6
Secure
Communication
Useful
information
for
the
protection
of
confidential
PLC
configuration
data
The
concept
for
Secure
Communication
protected
by
security
standards
comprises
the
following
components:
A
password-based
key
information
that
is
used
for
protecting
confidential
configuration
data
(e.g.
private
keys
for
certificates,
passwords).
A standardized log (TLS) that ensures communication between the participants (e.g.
programming
device
and
CPU).
&quot;Protection
of
confidential
configuration
data&quot;
principle
The following figure shows in a simplified way how confidential configuration data, for
example of a standard S7-1500 CPU, is protected: The two components project and key
information
are
placed
in
different
memory
areas
when
loaded
for
the
first
time.
The
project
in
the
load
memory
(memory
card),
the
key
information
in
a
memory
area
in
the
CPU.
For other target systems (e.g. S7-1200 CPU, software controller) with different storage
concepts,
the
implementation
is
adapted
to
the
corresponding
storage
concepts,
but
the
principle
is
the
same.
1
2
①
Project
with
password-protected
confidential
configuration
data
(here:
in
load
memory
=
memory
card)
②
Key
information
(generated
from
password)
to
use
the
protected
confidential
configuration
data
(here:
in
the
memory
area
in
the
CPU)
Figure
5-16
Principle
for
protection
of
confidential
configuration
data
Communication
80
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Two
memory
areas
for
more
security
The charged components are related to each other like two matching puzzle pieces: The
project
is
bound
to
the
loaded
key
information,
the
loaded
key
information
is
bound
to
the
password
that
was
assigned
during
configuration.
Project
and
key
information
must
match,
otherwise
the
CPU
will
not
start.
The principle of two separate memory areas also applies to the S7-1200 CPUs and S7-1500
CPU
versions
without
a
memory
card,
e.g.
for
the
SW
controller
or
PLCSim/
PLCSim
Advanced.
In the versions without memory card, two separate partitions are used so that the two items
of
information
can
be
managed
independently
of
one
another.
Figure
5-17
Principle
of
two
separate
memory
areas
Changing
your
password
It makes a difference whether the CPU has already been loaded or not. If the CPU has already
been
loaded,
it
has
the
key
information
with
which
the
password-protected
PLC
configuration
data
can
be
used.
Change
password
-
configuration
not
yet
loaded
As
long
as
you
have
not
yet
loaded
a
configuration
into
the
CPU,
you
can
change
an
entered
password
or
you
can
revoke
the
activation
of
the
password
protection.
Requirement
The
CPU
is
not
yet
loaded
Procedure
Open
the
CPU
properties
in
the
network
view
or
in
the
device
view.
Navigate
to
the
area
&quot;Protection
&
Security
>
Protection
of
the
PLC
configuration
data&quot;.
Click
the
&quot;Change&quot;
button
or
deactivate
the
option
&quot;Protect
confidential
PLC
configuration
data&quot;.
Enter
the
previously
valid
password
in
the
dialog.
In
case
of
a
password
change,
also
enter
the
new
password
and
confirm
the
new
password.
As
long
as
you
have
not
yet
loaded
a
configuration
into
the
CPU,
the
CPU
is
in
a
provisioning
phase
(see
CPU
behavior
from
loading
to
operational
readiness
(Page
112))
and
you
can
load
any
valid
configuration
with
your
configured
password.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
81
Communications
services
Secure
Communication
Change
password
-
configuration
is
already
loaded
If the CPU has already been loaded with a configuration and the configuration is protected
with
a
password
for
confidential
PLC
configuration
data,
you
must
first
either
reset
the
CPU
to
the factory settings and delete the password for confidential PLC configuration data in the
CPU
or
delete
it
directly
online
and
then
set
it.
Requirements
You
have
write
access
to
the
CPU
The
CPU
must
be
in
STOP
mode.
Procedure
Select
the
CPU
in
the
network
view.
Select
the
&quot;Online
&
Diagnostics&quot;
command
from
the
shortcut
menu.
If
you
also
change
the
project
on
the
memory
card,
i.e.
then
want
to
reload
the
configuration:
Select
the
&quot;Reset
to
factory
settings&quot;
area
in
the
opened
online
and
diagnostics
view.
Activate
the
option
&quot;Delete
password
to
protect
confidential
PLC
configuration
data&quot;.
To
avoid
a
repeated
start-up
of
the
CPU,
also
select
the
&quot;Format
memory
card&quot;
option.
Then
load
the
project
with
the
changed
configuration
and
the
desired
password.
If
you
do
not
have
to
change
the
project
on
the
memory
card,
i.e.
only
the
wrong
password
is
set:
In
the
Online
and
diagnostics
view,
you
specify
the
area
&quot;Password
for
the
protection
of
confidential
PLC
configuration
data&quot;.
Click
the
&quot;Delete&quot;
button.
If
the
&quot;Delete&quot;
button
is
not
available,
no
password
has
been
set
in
the
CPU
yet.
Enter
the
required
password
and
click
the
&quot;Set&quot;
button.
If
the
correct
password
has
been
entered,
the
CPU
can
use
the
protected
PLC
configuration
data.
No
write
access
to
the
CPU
If
you
do
not
have
write
access
to
the
load
memory
(read
access
level),
remove
the
memory
card from the CPU or delete the memory card externally, e.g. in your computer, before you
reset to factory settings with the option &quot;Delete password to protect confidential PLC
configuration
data&quot;.
NOTE
Reset
to
factory
settings
via
the
mode
switch/mode
selector
keys
of
the
CPU
Restoring
the
factory
settings
of
the
CPU
via
the
mode
switch/mode
selector
keys
also
deletes
the
IP
address
of
the
CPU,
but
not
the
password
for
protecting
confidential
PLC
configuration
data.
Communication
82
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
NOTE
Reset
to
factory
settings
via
the
display
of
the
CPU
Resetting
the
CPU
to
factory
settings
via
the
display
deletes
the
password
for
the
protection
of
confidential
PLC
configuration
data.
More
information
Information
on
how
to
proceed
in
case
of
a
spare
part
can
be
found
in
section
Rules
for
the
replacement
parts
scenario
(Page
89).
Resetting
the
password
The
protection
of
the
confidential
PLC
configuration
data
can
be
reset.
This
may
be
necessary,
for
example,
if
you
want
to
change
the
password
but
no
longer
know
the
current
password.
Password
lost
-
configuration
not
yet
loaded
Since you have to enter the password when loading the CPU via TIA Portal for the first time,
the
CPU
configuration
for
this
CPU
can
no
longer
be
used.
To
change
the
password
in
the
CPU
properties,
you
must
also
enter
the
previously
valid
password.
If
you
forget
your
password,
do
the
following:
Requirement
The
CPU
is
not
yet
loaded
Procedure
Open
the
CPU
properties
in
the
network
view
or
in
the
device
view.
Navigate
to
the
area
&quot;Protection
&
Security
>
Protection
of
the
PLC
configuration
data&quot;.
Click
&quot;Reset&quot;.
Please note that the certificates of the CPU (e.g. certificates for web server, for OPC UA
server,
for
PG/PC
communication
and
HMI
communication)
may
no
longer
be
used
after
the
reset
and
may
have
to
be
created
again
and
reassigned.
If
you
use
the
global
security
settings
for
the
certificate
manager,
you
must
reassign
the
certificates
from
the
certificate
manager.
If
you
do
not
use
the
global
security
settings
for
the
certificate
manager,
you
must
recreate
and
reassign
the
certificates.
Confirm
the
reset
of
the
password.
The
option
for
the
protection
of
confidential
PLC
configuration
data
is
still
activated.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
83
Communications
services
Secure
Communication
Delete
password
–
Configuration
is
already
loaded
If the CPU has already been loaded with a configuration and the configuration is protected
with
a
password
for
confidential
PLC
configuration
data,
you
can,
for
loading
a
new
project,
delete the password for confidential PLC configuration data online and then specify a new
password.
Requirements
You
have
write
access
to
the
CPU
The
CPU
must
be
in
STOP
mode.
Procedure
Select
the
CPU
in
the
network
view.
Select
the
&quot;Online
&
Diagnostics&quot;
command
from
the
shortcut
menu.
In
the
area
&quot;Password
to
protect
confidential
PLC
configuration
data&quot;,
click
the
&quot;delete&quot;
button.
If
the
&quot;Delete&quot;
button
is
not
available,
no
password
has
been
set
in
the
CPU
yet.
Deleting
the
password
for
confidential
configuration
data
If
the
password
is
deleted
and
a
loaded
project
requires
a
corresponding
password,
this
project
may
no
longer
work
without
password.
NOTICE
If
required,
now
enter
a
new
password
via
the
&quot;Set&quot;
button.
Perform
a
restart
of
the
CPU.
NOTE
Password
for
protecting
confidential
configuration
data
after
resetting
the
CPU
to
factory
settings
Via
the
mode
switch
/
mode
selector
keys
(SIMATIC
Memory
Card
is
not
inserted):
The
password
for
protection
of
confidential
configuration
data
is
retained.
Using
the
display:
The
password
for
protection
of
confidential
configuration
data
is
deleted.
Using
STEP
7:
The
password
for
protection
of
confidential
configuration
data
is
retained.
The
password
is
only
deleted
when
the
&quot;Delete
password
for
protection
of
confidential
PLC
configuration
data&quot;
option
is
set.
More
information
(Page
81).
Information
on
changing
the
password
can
be
found
in
section
Changing
your
password
Communication
84
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Assign
password
via
SIMATIC
Memory
Card
If
you
want
to
transfer
the
password
to
protect
confidential
PLC
configuration
data
to
a
CPU
without
using
TIA
Portal,
you
can
also
use
a
SIMATIC
memory
card
for
this
function.
The
use
of
a
SIMATIC
memory
card
is
suitable
for
the
following
purposes:
Preparing
a
new
CPU
If
a
CPU
is
set
up
again,
it
should
be
configured
with
a
password
to
protect
the
confidential
PLC configuration data. After this configuration is completed, it is possible to use another
SIMATIC
memory
card
with
the
desired
project.
(S7-1200
CPU:
A
&quot;transfer&quot;
card
with
transfer
job
can
also
be
used
to
install
the
program
on
the
CPU).
CPU
has
a
password
to
protect
confidential
PLC
configuration
data,
but
the
password
does
not
match
the
project
If
the
passwords
are
not
identical,
you
can
set
the
correct
password
with
the
memory
card
in
the
CPU.
(S7-1200
CPU:
equipped
either
with
SIMATIC
&quot;transfer&quot;
card
or
with
SIMATIC
&quot;Program&quot;
card).
reset
the
password
for
the
protection
of
confidential
PLC
configuration
data
in
the
CPU
As
preparation
for
a
disposal
of
the
CPU
or
as
preparation
for
a
new
project
for
the
CPU.
Requirement
TIA
Portal
as
of
version
V17
Basic
procedure
Creating
a
SIMATIC
memory
card
with
&quot;SET
PASSWORD&quot;
job
This action creates a folder and file structure following a special pattern and writes a
password
for
the
protection
of
the
confidential
PLC
configuration
data
as
plain
text
to
a
special
file
on
the
SIMATIC
memory
card.
See
description
below.
Insertion
of
a
prepared
SIMATIC
memory
card
in
the
CPU
and
switch
on
the
CPU.
The
PLC
reads
the
password,
processes
it
and
stores
the
result
in
the
internal
memory.
Any
existing
entry
is
overwritten.
Remove
the
SIMATIC
memory
card
and
restart
the
CPU.
Results
(S7-1500):
While
the
CPU
is
reading
the
SIMATIC
memory
card,
the
LED
shows
the
same behavior as with a firmware update. The RUN/STOP LED flashes while the CPU is
setting the password. After the process has been completed successfully, the RUN/STOP
LED
lights
up
yellow
and
the
MAINT
LED
flashes
yellow.
The
result
of
the
operation
is
displayed
in
the
diagnostics
buffer
as
success
or
error
message.
If
the
password
could
not
be
set,
the
error
LED
flashes
together
with
the
other
LEDs.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
85
Communications
services
Secure
Communication
Creating
a
SIMATIC
memory
card
with
&quot;SET
PASSWORD&quot;
job
Create
a
folder
in
the
root
directory
named
&quot;SET_PWD.S7S&quot;.
Create
a
text
file
named
&quot;PWD.TXT&quot;
with
the
password
as
text-only
in
the
folder
just
created
on
the
memory
card.
Create
a
text
file
named
&quot;S7_JOB.S7S&quot;
in
the
root
directory
of
the
memory
card
with
the
content
&quot;SET_PWD&quot;.
This
file
is
the
&quot;Job
file&quot;
for
assigning
a
password
for
the
protection
of
the
confidential
PLC
configuration
data
of
the
PLC.
The
file
structure
on
the
SIMATIC
memory
card
then
looks
as
follows:
1872601
215656
NOTE
Safe
storage
of
the
SIMATIC
memory
card
Store
the
SIMATIC
memory
card
in
a
safe
location
to
which
only
authorized
persons
have
access.
Rules
and
recommendations
Setting
the
password
must
be
done
in
a
secure
environment.
The content of the text file &quot;PWD.TXT&quot; defines the password for the protection of
confidential
PLC
configuration
data.
It
must
match
the
password
that
you
have
also
assigned
in
the
CPU
configuration.
To
reset
an
existing
password
of
a
PLC,
the
text
file
&quot;PWD.TXT&quot;
must
be
empty,
i.e.
the
file
size
is
0
bytes.
Use
any
text
editor
to
create
the
text
file.
The
recommended
text
format
is
&quot;UTF-8&quot;.
The
folder
and
file
names
are
not
case-sensitive.
However,
the
password
itself
is
case-
sensitive.
Do
not
enter
a
CR/LF
character
at
the
end
(PWD.TXT
or
S7_JOB.S7S).
Communication
86
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Special
features
when
backing
up
and
restoring
a
CPU
You can back up a functional configuration of a CPU in the TIA Portal and access it at a later
time;
this
means
you
can
then
restore
the
originally
backed-up
configuration.
This
allows
you
to load a modified configuration, for example, to test product enhancements, to change
programs for troubleshooting in the system or you can replace components on a test basis.
You
can
then
restore
the
originally
backed-up
configuration
of
the
CPU.
Backing
up
the
configuration
In
backing
up
a
CPU
(&quot;Online&quot;
menu,
&quot;Load
backup
from
online
device”
in
TIA
Portal),
the
password
for
the
protection
of
confidential
PLC
configuration
data
is
backed
up
as
well.
Restoring
the
backup
When
restore
the
backup
of
a
CPU
(menu
&quot;Online&quot;,
command
“Download
to
device”
with
marked
backup
in
TIA
Portal)
the
CPU
can
only
communicate
with
a
PG/PC
or
HMI
if
the
following
condition
is
fulfilled:
After
the
restoration
of
a
configuration
protected
with
a
password
to
protect
confidential
PLC
configuration
data,
exactly
this
password
must
be
present
in
the
CPU.
Otherwise
the
CPU
cannot
access
the
configuration
data
and
therefore
does
not
start.
Remedy
If the above error occurs, that is, the password for protecting confidential PLC configuration
data does not match the backup, you must delete the password to protect confidential PLC
configuration
data
in
the
CPU
and
then
set
the
correct
password.
After
a
restart
the
CPU,
the
backup
is
functional.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
87
Communications
services
5.6
Secure
Communication
Tips
for
error
avoidance
and
error
handling
The
following
description
lists
some
use
cases
that
may
result
in
CPU
error
messages.
Diagnostic
buffer
provides
information
The CPU detects when the password protecting confidential configuration data and the
loaded
configuration
do
not
match.
A
message
in
the
diagnostic
buffer
indicates
possible
causes
and
remedies
and
usually
leads
to
a
solution
of
the
problem.
Typical
&quot;pitfalls&quot;
You
should
pay
attention
to
the
following
circumstances
in
order
to
avoid
or
correct
errors:
Configuration
loaded?
Regardless
of
whether
you
protect
your
confidential
configuration
data
with
a
password
or
not:
without
a
loaded
configuration,
the
CPU
does
not
leave
the
provisioning
phase.
You
are
trying
to
load
the
CPU
with
a
configured
password
and
the
CPU
has
already
received
another
password.
Example:
CPU
is
exchanged
for
another
CPU
from
the
stock.
The
replacement
CPU
was
not
completely reset (reset to factory settings with option &quot;Delete password for protection of
confidential
PLC
configuration
data&quot;).
Remedy:
Always
prepare
replacement
CPUs
with
the
appropriate
option
(password
deleted).
For
the
configuration
to
be
loaded,
use
the
same
password
that
was
already
used
for
the
configuration
already
loaded.
It
is
also
possible
that
the
wrong
project
/
CPU
configuration
was
loaded.
Check
whether
the
correct
CPU
configuration
is
available.
Use the online function &quot;Set password to protect confidential PLC configuration data&quot;
to
delete
the
password
or
to
set
the
same
password
as
in
the
CPU
configuration.
Then,
restart
the
device.
The
same
error
occurs
if
your
CPU
configuration
does
not
use
a
password
and
the
already
loaded
configuration
requires
a
user-defined
password.
Remedy:
Use the online function &quot;Set password to protect confidential PLC configuration data&quot;
to
delete
the
password
or
to
set
the
same
password
as
in
the
CPU
configuration.
Then,
restart
the
device.
Communication
88
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Rules
for
the
replacement
parts
scenario
The
assignment
of
passwords
to
protect
confidential
PLC
configuration
data
also
has
an
impact
on
the
replacement
parts
scenario.
Rules
for
the
replacement
parts
scenario
Observe
the
following
rules
for
the
replacement
parts
scenario:
Configuration
of
the
replacement
CPU
via
TIA
Portal
A
CPU
as
replacement
for
an
existing
CPU
should
not
have
a
configuration
or
a
configured
password
to
protect
confidential
PLC
configuration
data.
Advantage:
You
can
load
the
project
into
the
replacement
CPU
without
any
further
preparation
-
regardless
of
whether
a
password
is
configured
or
not.
If
the
replacement
CPU
has
already
been
configured,
you
must
reset
the
CPU
to
the
factory
settings
with
the
following
options
set:
&quot;Delete
password
for
protection
of
confidential
PLC
configuration
data&quot;
&quot;Format
memory
card&quot;
Replacement
CPU
is
supplied
with
configuration
data
via
memory
card
If
you
have
not
assigned
a
password
to
a
CPU
in
your
project
to
protect
confidential
PLC
configuration data, you can insert the memory card of the CPU to be replaced into a
brand-new,
unused
CPU
without
any
further
action
needed.
If the replacement CPU has already been configured with a password to protect
confidential PLC configuration data, you must first reset this CPU to the factory settings
using
the
option
&quot;Delete
password
for
protection
of
confidential
PLC
configuration
data&quot;.
If
you
have
assigned
the
same
password
to
a
group
of
CPUs,
you
can
also
assign
the
group
password to the replacement CPU via the TIA Portal or via an appropriately prepared
memory
card
(see
Protection
of
confidential
configuration
data
(Page
77)).
In
this
case
you
can,
for
example,
insert
a
memory
card
with
the
current
project
into
the
CPU
and
put
it
into
operation
without
any
further
password
handling.
If you assign different passwords to each CPU in your project, you must first set the
password valid for the respective CPU with the online and diagnostics editor when using
the
replacement
CPU
(area
&quot;Set
password
for
protection
of
confidential
PLC
configuration
data&quot;,
see
Changing
your
password
(Page
81)).
More
information
In
section
Assign
password
via
SIMATIC
Memory
Card
(Page
85)
you
can
read
how
to
use
the
SIMATIC
Memory
Card
to
assign
the
password
to
protect
confidential
PLC
configuration
data.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
89
Communications
services
5.6
Secure
Communication
Secure
Open
User
Communication
Secure
OUC
of
an
S7-1500
CPU
as
TLS
client
to
an
external
PLC
(TLS
server)
The
following
section
describes
how
you
can
set
up
Open
User
Communication
via
TCP
from
an
S7-1500
CPU
as
TLS
client
to
a
TLS
server.
Setting
up
a
secure
TCP
connection
from
an
S7-1500
CPU
as
TLS
client
to
a
TLS
server
S7‑1500
CPUs
as
of
firmware
version
V2.0
support
secure
communication
with
addressing
via
a
Domain
Name
System
(DNS).
For secure TCP communication over the domain name you need to create a data block with
the
TCON_QDN_SEC
system
data
type
yourself,
assign
parameters
and
call
it
directly
at
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON.
Requirements:
Current
date
and
time
are
set
in
the
CPU.
Your
network
includes
at
least
one
DNS
server.
You
have
configured
at
least
one
DNS
server
for
the
S7-1500
CPU.
TLS
client
and
TLS
server
have
all
the
required
certificates.
To
set
up
a
secure
TCP
connection
to
a
TLS
server,
follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
Define
a
tag
of
the
data
type
TCON_QDN_SEC
in
the
global
data
block.
The
example
below
shows
the
global
data
block
&quot;Data_block_1&quot;
in
which
the
tag
&quot;DNS
ConnectionSEC&quot;
of
the
data
type
TCON_QDN_SEC
is
defined.
719962
156049
Figure
5-18
Data
type
TCON_QDN_SEC
Set the connection parameters of the TCP connection in the &quot;Start value&quot; column. Enter
the
fully
qualified
domain
name
(FQDN)
of
the
TLS
server,
for
example,
for
&quot;RemoteQDN&quot;.
Communication
90
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Set
the
parameters
for
secure
communication
in
the
&quot;Start
value&quot;
column.
&quot;ActivateSecureConn&quot;: Activation of secure communication for this connection. If this
parameter has the value FALSE, the subsequent security parameters are irrelevant. You
can
set
up
a
non-secure
TCP
or
UDP
connection
in
this
case.
&quot;ExtTLSCapabilities&quot;: If you enter the value 1, the client validates the
subjectAlternateName
in
the
X.509-V3
certificate
of
the
server
to
verify
the
identity
of
the
server.
This
validation
is
executed
in
the
context
of
the
instruction.
&quot;TLSServerCertRef&quot;:
ID
of
the
X.509-V3
certificate
(usually
a
CA
certificate)
that
is
used
by the TLS client to validate the TLS server authentication. If this parameter is 0, the
TLS client uses all (CA) certificates currently loaded in the client certificate store to
validate
the
server
authentication.
5L4
DMJFOU
(47-1500)
$
A
DF
S
UJ꫼DB
U
F
G
S
PN
5L4
TFSWFS
(JNQPSUFE
)FMMP
)FMMP
BOE
BTTJHOFE)
5L4 TFSWFS (UIJSE-QBSUZ 1L$)
%FWJDF
DFSUJ꫼DBUF
7BMJEBUJPO
%FWJDF
DFSUJ꫼DBUF
GSPN5L4
TFSWFS
Figure
5-19
Certificate
handling
from
the
perspective
of
the
S7-1500
as
a
TLS
client
&quot;TLSClientCertRef&quot;:
ID
of
the
own
X.509-V3
certificate.
Create
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON
in
the
program
editor.
Interconnect
the
CONNECT
parameter
of
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON
with
the
tags
of
the
data
type
TCON_QDN_SEC.
In
the
example
below,
the
CONNECT
parameter
of
the
TCON
instruction
is
interconnected
with
the
tag
&quot;DNS
connectionSEC&quot;
(data
type
TCON_QDN_SEC).
Figure
5-20
TCON
instruction
Communication
Function
Manual,
11/2024,
A5E03735815-AM
91
Communications
services
5.6
Secure
Communication
Additional
information
You
can
find
more
information
on
the
TCON_QDN_SEC
system
data
type
in
the
STEP
7
online
help.
For
additional
information
on
secure
communication,
refer
to
the
section
Secure
Communication
(Page
52).
Secure
OUC
of
an
S7-1500
CPU
as
TLS
server
to
an
external
PLC
(TLS
client)
The
following
section
describes
how
you
can
set
up
Open
User
Communication
via
TCP
from
an
S7-1500
CPU
as
TLS
server
to
a
TLS
client.
Setting
up
a
secure
TCP
connection
via
the
domain
name
of
the
communication
partner
S7‑1500
CPUs
as
of
firmware
version
V2.0
support
secure
communication
with
addressing
via
a
Domain
Name
System
(DNS).
For secure TCP communication over the domain name you need to create a data block with
the
TCON_QDN_SEC
system
data
type
yourself,
assign
parameters
and
call
it
directly
at
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON.
Requirements:
Current
date
and
time
are
set
in
the
CPU.
Your
network
includes
at
least
one
DNS
server.
You
have
configured
at
least
one
DNS
server
for
the
S7-1500
CPU.
TLS
client
and
TLS
server
have
all
the
required
certificates.
To
set
up
a
secure
TCP
connection
to
a
TLS
client,
follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
Define
a
tag
of
the
data
type
TCON_QDN_SEC
in
the
global
data
block.
The
example
below
shows
the
global
data
block
&quot;Data_block_1&quot;
in
which
the
tag
&quot;DNS
ConnectionSEC&quot;
of
the
data
type
TCON_QDN_SEC
is
defined.
723773
154042
Figure
5-21
TCON_QDN_SEC_Server
Communication
92
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Set
the
connection
parameters
of
the
TCP
connection
in
the
&quot;Start
value&quot;
column.
Enter,
for
example,
the
local
ID
of
the
TCP
connection
for
&quot;ID&quot;.
Set
the
parameters
for
secure
communication
in
the
&quot;Start
value&quot;
column.
&quot;ActivateSecureConn&quot;: Activation of secure communication for this connection. If this
parameter has the value FALSE, the subsequent security parameters are irrelevant. You
can
set
up
a
non-secure
TCP
or
UDP
connection
in
this
case.
&quot;TLSServerReqClientCert&quot;:
Request
for
an
X.509-V3
certificate
from
the
TLS
client.
&quot;TLSServerCertRef&quot;:
ID
of
the
own
X.509-V3
certificate.
5L4
TFSWFS
(47-1500)
%FWJDF
DFSUJ꫼DBUF
(HFOFSBUFE
JO
5*A
)FMMP
)FMMP
5L4
DMJFOU
(UIJSE-QBSUZ
1L$)
$
A
DF
S
UJ꫼DB
U
F
G
S
PN
5L4
TFSWFS
1PSUBM)
(
F
YQP
S
U
FE
G
S
PN
5*A
1PSUBM)
7BMJEBUJPO
%FWJDF
DFSUJ꫼DBUF
G
S
PN
5
L
4
TF
S
W
FS
Figure
5-22
Certificate
handling
from
the
perspective
of
the
S7-1500
as
TLS
server
&quot;TLSClientCertRef&quot;: ID of the X.509-V3 certificate (or a group of X.509-V3 certificates)
that is used by the TLS server to validate TLS client authentication. If this parameter is
0,
the
TLS
server
uses
all
(CA)
certificates
currently
loaded
in
the
server
certificate
store
to
validate
the
client
authentication.
Create
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON
in
the
program
editor.
Interconnect
the
CONNECT
parameter
of
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON
with
the
tags
of
the
data
type
TCON_QDN_SEC.
In
the
example
below,
the
CONNECT
parameter
of
the
TCON
instruction
is
interconnected
with
the
tag
&quot;DNS
connectionSEC&quot;
(data
type
TCON_QDN_SEC).
Figure
5-23
TCON
instruction
Communication
Function
Manual,
11/2024,
A5E03735815-AM
93
Communications
services
5.6
Secure
Communication
More
information
You
can
find
more
information
about
the
system
data
types
TCON_QDN_SEC
in
the
STEP
7
online
help.
(Page
52).
For
more
information
on
secure
communication,
refer
to
the
section
Secure
Communication
Secure
OUC
between
two
S7-1500
CPUs
The following section describes how you can set Secure Open User Communication via TCP
between two S7-1500 CPUs. In the process one S7‑1500 CPU acts as TLS client (active
establishing
of
the
connection)
and
the
other
S7‑1500
CPU
as
TLS
server
(passive
establishing
of
the
connection).
Setting
up
a
secure
TCP
connection
between
two
S7-1500
CPUs
For secure TCP communication between two S7‑1500 CPUs you need to create a data block
with
the
TCON_IP_V4_SEC
system
data
type
yourself
in
every
CPU,
assign
parameters
and
call
it
directly
at
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON.
Requirements:
Current
date
and
time
are
set
in
the
CPU.
Both
S7‑1500
CPUs
have
at
least
firmware
version
V2.0
TLS
client
and
TLS
server
have
all
the
required
certificates.
7
/
6
-
&
O
i
H
Q
W
(
6
7
-
1
5
00
B
1
)
D
H
Y
i
F
H
F
H
U
W
i
I
i
F
D
W
H
+
H
O
O
R
+
H
O
O
R
7
/
6
-
6
H
U
Y
H
U
(
6
7
-
1
5
00
B
2
)
&
$
F
H
U
W
i
I
i
F
D
W
H
I
U
R
P
7/6
VHUYHU
&
$
F
H
U
W
i
I
i
F
D
W
H
I
U
R
P
7
/
6
F
O
i
H
Q
W
9
D
O
i
G
D
W
i
R
Q
9
D
O
i
G
D
W
i
R
Q
D
H
Y
i
F
H
F
H
U
W
i
I
i
F
D
W
H
I
U
R
P
7/6
VHUYHU
D
H
Y
i
F
H
F
H
U
W
i
I
i
F
D
W
H
I
U
R
P
7
/
6
F
O
i
H
Q
W
D
H
Y
i
F
H
F
H
U
W
i
I
i
F
D
W
H
Figure
5-24
Certificate
handling
for
Secure
OUC
between
two
S7-1500
CPUs
Communication
94
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Settings
at
the
TLS
client
To
set
up
a
secure
TCP
connection
in
the
TLS
client,
follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
Define
a
tag
of
the
data
type
TCON_IP_V4_SEC
in
the
global
data
block.
The
example
below
shows
the
global
data
block
&quot;Data_block_1&quot;
in
which
the
tag
&quot;SEC
connection
1
TLS-Client&quot;
of
the
data
type
TCON_IP_V4_SEC
is
defined.
901319
154310
Figure 5-25
IP_V4_SEC_Client
Set
the
connection
parameters
of
the
TCP
connection
in
the
&quot;Start
value&quot;
column.
For
example,
enter
the
IPv4
address
of
the
TLS
server
for
&quot;RemoteAddress&quot;.
NOTE
Connection
parameter
Interface
ID
Note that you can enter the value &quot;
0
&quot; for the interface ID in the data type
TCON_IP_V4_SEC.
In
this
case,
the
CPU
itself
searches
for
a
suitable
local
CPU
interface.
Set
the
parameters
for
secure
communication
in
the
&quot;Start
value&quot;
column.
&quot;ActivateSecureConn&quot;: Activation of secure communication for this connection. If this
parameter has the value FALSE, the subsequent security parameters are irrelevant. You
can
set
up
a
non-secure
TCP
or
UDP
connection
in
this
case.
&quot;TLSServerCertRef&quot;: Enter the value 2 (reference to the CA certificate of the TIA Portal
project
(SHA256)
or
the
value
1
(reference
to
the
CA
certificate
of
the
TIA
Portal
project
(SHA1)). If you use a different CA certificate, enter the corresponding ID from the
certificate
manager
of
the
global
security
settings.
&quot;TLSClientCertRef&quot;:
ID
of
the
own
X.509-V3
certificate.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
95
Communications
services
5.6
Secure
Communication
Create
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON
in
the
program
editor.
Interconnect
the
CONNECT
parameter
of
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON
with
the
tags
of
the
data
type
TCON_IP_V4_SEC.
Settings at
the TLS
server
To
set
up
a
secure
TCP
connection
in
the
TLS
server,
follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
Define
a
tag
of
the
data
type
TCON_IP_4_SEC
in
the
global
data
block.
The
example
below
shows
the
global
data
block
&quot;Data_block_1&quot;
in
which
the
tag
&quot;SEC
connection
1
TLS-Server&quot;
of
the
data
type
TCON_IP_V4_SEC
is
defined.
719962
155964
Figure
5-26
IP_V4_SEC_Server
Set
the
connection
parameters
of
the
TCP
connection
in
the
&quot;Start
value&quot;
column.
For
example,
enter
the
IPv4
address
of
the
TLS
client
for
&quot;RemoteAddress&quot;.
Set
the
parameters
for
secure
communication
in
the
&quot;Start
value&quot;
column.
&quot;ActivateSecureConn&quot;: Activation of secure communication for this connection. If this
parameter has the value FALSE, the subsequent security parameters are irrelevant. You
can
set
up
a
non-secure
TCP
or
UDP
connection
in
this
case.
&quot;TLSServerReqClientCert
&quot;:
Request
for
an
X.509-V3
certificate
from
the
TLS
client.
Enter
the
value
&quot;true&quot;.
&quot;TLSServerCertRef&quot;:
ID
of
the
own
X.509-V3
certificate.
&quot;TLSClientCertRef&quot;: Enter the value 2 (reference to the CA certificate of the TIA Portal
project
(SHA256)
or
the
value
1
(reference
to
the
CA
certificate
of
the
TIA
Portal
project
(SHA1)). If you use a different CA certificate, enter the corresponding ID from the
certificate
manager
of
the
global
security
settings.
Create
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON
in
the
program
editor.
Communication
96
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Interconnect
the
CONNECT
parameter
of
one
of
the
instructions
TSEND_C,
TRCV_C
or
TCON
with
the
tags
of
the
data
type
TCON_IP_V4_SEC.
In the example below, the CONNECT parameter of the TSEND_C instruction is
interconnected
with
the
&quot;SEC
connection
1
TLS
client&quot;
tags
(data
type
TCON_IP_4_SEC).
Figure
5-27
TSEND_C
Additional
information
You
can
find
more
information
about
the
system
data
types
TCON_IP_4_SEC
in
the
STEP
7
online
help.
For
additional
information
on
secure
communication,
refer
to
the
section
Secure
Communication
(Page
52).
Secure
OUC
via
CP
interface
The
following
sections
describes
the
particular
points
to
be
taken
into
consideration
in
the
case
of
Secure
Open
User
Communication
via
a
CP
interface.
At
least
one
station
is
an
S7-1500 station with
the following modules:
S7-1500 CPU
as of
firmware
version V2.0 (except
for
S7-1500 Software Controller)
CP
CP
1543-1 as of
firmware
version V2.0
CP
1545-1 as of
firmware
version V1.0
CP
1543SP-1
as
of
firmware
version
V1.0
The
CP
acts
in
an
S7‑1500
station
as
a
TLS
client
(active
connection
establishment)
or
a
TLS
server
(passive
connection
establishment).
The fundamental procedure and the concept for using secure communication via a CP
interface
is
similar
to
that
of
secure
communication
via
the
interfaces
of
the
S7-1500
CPUs.
Essentially, you have to assign the certificates to the CPU in the role of a TLS server or TLS
client
and
not
to
the
CPU.
Other
rules
and
procedures
therefore
apply.
These
are
described
below.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
97
Communications
services
Secure
Communication
Handling
certificates
for
CPs
The
following
applies
in
general:
You
have
to
be
logged
on
at
the
certificate
manager
in
the
global
security
settings.
The
generation
of
self-signed
certificates
also
requires
logon
for
the
global security settings. You have to have sufficient rights as a user (administrator or user
with
the
&quot;Standard&quot;
role
with
the
right
to
&quot;Configure
security&quot;).
The
starting
point
for
the
generation
or
assignment
of
certificates
at
the
CP
is
the
section
&quot;Security
>
Security
properties&quot;.
In
this
section,
you
log
on
for
the
global
security
settings.
Procedure:
In
the
network
view
of
STEP
7,
mark
the
CP
and
select
the
section
&quot;Security
>
Security
properties&quot;
in
the
Inspector
window.
Click
on
the
&quot;User
logon&quot;
button.
Log
on
using
your
user
name
and
password.
Enable
the
&quot;Activate
security
functions&quot;
option.
The
security
properties
are
initialized.
Click
in
the
first
line
of
the
&quot;Device
certificates&quot;
table
to
generate
a
new
certificate
or
select
an
existing
device
certificate.
If the communication partner is also an S7-1500 station, you also have to assign a device
certificate
to
the
communication
partner
with
STEP
7
as
described
here
or
for
the
S7-1500
CPU.
Example:
Setting
up
a
secure
TCP
connection
between
two
S7-1500
CPUs
via
CP
interfaces
In
order
to
establish
secure
TCP
communication
between
two
S7‑1500
CPs
you
have
to
create
a
data
block
with
the
system
data
type
TCON_IP_V4_SEC
in
each
CPU,
carry
out
the
parameter
assignment
and
call
it
directly
at
the
instruction.
Requirements:
Both
S7-1500
CPUs
have
one
of
the
firmware
versions
specified
above.
The
CPs
have
one
of
the
firmware
versions
specified
above.
TLS
client
and
TLS
server
have
all
the
required
certificates.
A
device
certificate
(end-entity
certificate)
for
the
CP
must
be
generated
and
be
located
in the certificate memory of the CP. If a communication partner is an external device
(for example an MES or ERP system), a device certificate also has to exist for this
device.
The root certificate (CA certificate) with which the device certificate of the
communication
partner
is
signed
must
also
be
located
in
the
certificate
memory
of
the
CP or in the certificate memory of the external device. If you use intermediate
certificates, you have to ensure that the complete certificate path exists in the
validating device. A device uses these certificates to validate the device certificate of
the
communication
partner.
The
communication
partner
must
always
be
addressed
via
its
IPv4
address,
not
via
its
domain
name.
Communication
98
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
The following figure shows the different certificates in the devices for a scenario in which
both communication partners communicate via one CP. In addition, the figure shows the
transfer
of
the
device
certificates
during
establishment
of
the
connection
(&quot;Hello&quot;).
5
L
4
-
$
M
J
F
O
U
(
$
1
1
5
4
3
-
1
@
1
)
D
H
Y
i
F
H
F
H
U
W
i
I
i
F
D
W
H
)
F
M
M
P
)
F
M
M
P
5L4-4FSWFS
($1
1543-1@2)
&
$
F
H
U
W
i
I
i
F
D
W
H
I
U
R
P
7/6
VHUYHU
&
$
F
H
U
W
i
I
i
F
D
W
H
I
U
R
P
7
/
6
F
O
i
H
Q
W
9
D
O
i
G
D
W
i
R
Q
9
D
O
i
G
D
W
i
R
Q
D
H
Y
i
F
H
F
H
U
W
i
I
i
F
D
W
H
I
U
R
P
7
/
6
V
H
U
Y
H
U
D
H
Y
i
F
H
F
H
U
W
i
I
i
F
D
W
H
I
U
R
P
7
/
6
F
O
i
H
Q
W
D
H
Y
i
F
H
F
H
U
W
i
I
i
F
D
W
H
Figure
5-28
Certificate
handling
in
secure
OUC
between
two
S7-1500
CPUs
via
CP
interfaces.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
99
Communications
services
Secure
Communication
Settings
at
the
TLS
client
To
set
up
a
secure
TCP
connection
in
the
TLS
client,
follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
Define
a
tag
of
the
data
type
TCON_IP_4_SEC
in
the
global
data
block.
To
do
so,
enter
the
string
&quot;TCON_IP_V4_SEC&quot;
in
the
&quot;Data
type&quot;
field.
The
example
below
shows
the
global
data
block
&quot;Data_block_1&quot;
in
which
the
tag
&quot;SEC
connection
1
TLS-Client&quot;
of
the
data
type
TCON_IP_V4_SEC
is
defined.
The
Interface
ID
has
the
value
of
the
HW
identifier
of
the
IE
interface
of
the
local
CP
(TLS
client).
721233
154128
Figure
5-29
IP_V4_SEC_Client
Set
the
connection
parameters
of
the
TCP
connection
in
the
&quot;Start
value&quot;
column.
For
example,
enter
the
IPv4
address
of
the
TLS
server
for
&quot;RemoteAddress&quot;.
Set
the
parameters
for
secure
communication
in
the
&quot;Start
value&quot;
column.
&quot;ActivateSecureConn&quot;: Activation of secure communication for this connection. If this
parameter has the value FALSE, the subsequent security parameters are irrelevant. You
can
set
up
a
non-secure
TCP
or
UDP
connection
in
this
case.
&quot;TLSServerCertRef&quot;: Enter the value 2 (reference to the CA certificate of the TIA Portal
project
(SHA256)
or
the
value
1
(reference
to
the
CA
certificate
of
the
TIA
Portal
project
(SHA1)).
&quot;TLSClientCertRef&quot;:
ID
of
the
own
X.509-V3
certificate.
Create
a
TCON
instruction
in
the
program
editor.
Connect
the
CONNECT
parameter
of
the
TCON
instruction
with
the
variable
of
data
type
TCON_IP_V4_SEC.
100
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Settings at
the
TLS
server
To
set
up
a
secure
TCP
connection
in
the
TLS
server,
follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
Define
a
tag
of
the
data
type
TCON_IP_4_SEC
in
the
global
data
block.
The
example
below
shows
the
global
data
block
&quot;Data_block_1&quot;
in
which
the
tag
&quot;SEC
connection
1
TLS-Server&quot;
of
the
data
type
TCON_IP_V4_SEC
is
defined.
The
interface
ID
has
the
value
of
the
HW
identifier
of
the
IE
interface
of
the
local
CP
(TLS
server).
900049
155480
Figure
5-30
IP_V4_SEC_Server
Set
the
connection
parameters
of
the
TCP
connection
in
the
&quot;Start
value&quot;
column.
For
example,
enter
the
IPv4
address
of
the
TLS
client
for
&quot;RemoteAddress&quot;.
Set
the
parameters
for
secure
communication
in
the
&quot;Start
value&quot;
column.
&quot;ActivateSecureConn&quot;: Activation of secure communication for this connection. If this
parameter has the value FALSE, the subsequent security parameters are irrelevant. You
can
set
up
a
non-secure
TCP
or
UDP
connection
in
this
case.
&quot;TLSServerReqClientCert
&quot;:
Request
for
an
X.509-V3
certificate
from
the
TLS
client.
Enter
the
value
&quot;true&quot;.
&quot;TLSServerCertRef&quot;:
ID
of
the
own
X.509-V3
certificate.
&quot;TLSClientCertRef&quot;: Enter the value 2 (reference to the CA certificate of the TIA Portal
project
(SHA256)
or
the
value
1
(reference
to
the
CA
certificate
of
the
TIA
Portal
project
(SHA1)).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
101
Communications
services
Secure
Communication
Create
a
TCON
instruction
in
the
program
editor.
Connect
the
CONNECT
parameter
of
the
TCON
instruction
with
the
variable
of
data
type
TCON_IP_V4_SEC.
Upload
device
as
new
station
When you upload a configuration with certificates and configured secure Open User
Communication as a new station into your STEP 7 project, the certificates of the CP are not
uploaded,
in
contrast
to
the
certificates
of
the
CPU.
After
the
device
has
been
loaded
as
a
new
station, no more certificates are contained in the corresponding tables of the CPs for the
device
certificates.
You have to perform configuration of certificates again after the upload. Otherwise, renewed
loading of the configuration results in the certificates that originally exist in the CP being
deleted
so
that
secure
communication
does
not
function.
Secure
OUC
connections
via
CPU
and
CP
interfaces
-
similarities
Connection
resources:
No differences between OUC and secure OUC. A programmed secure OUC connection
uses
a
connection
resource
just
like
an
OUC
connection,
irrespective
of
which
IE/PROFINET
interface
communicates
with
the
station.
Connection
diagnostics:
No
differences
between
OUC
and
secure
OUC
connection
diagnostics.
Loading
of
projects
with
secure
OUC
connections
into
the
CPU:
Only
possible
in
STOP
of
the
CPU,
if
certificates
are
loaded
as
well.
For
information
on
the
requirements for updating loaded certificates in RUN mode, see Tip: Updating loaded
certificates
in
RUN
(Page
76).
Recommendation:
Load
to
device
>
Hardware
and
software.
Reason:
Ensuring
consistency
between
programs
with
secure
OUC,
hardware
configuration
and
certificates.
The
reloading
of
blocks
that
utilize
further
secure
OUC
connections
is
only
possible
in
RUN
mode
if
the
certificates
required
for
this
purpose
are
already
located
on
the
module.
Secure
OUC
with
Modbus
TCP
For
secure
Modbus
TCP
connection
you
need
to
create
a
data
block
with
one
of
the
system
data types TCON_IP_V4_SEC or TCON_QDN_SEC yourself, assign parameters and call it
directly
at
the
MB_Server
or
MB_CLIENT
instruction.
Requirements:
S7‑1500
CPU
CPU
firmware
version
V2.5
or
higher
The
Modbus
client
(TLS
client)
can
reach
the
Modbus
server
(TLS
server)
over
IP
communication
in
the
network.
TLS
client
and
TLS
server
have
all
the
required
certificates.
102
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Example
of
setting
up
a
secure
Modbus
TCP
connection
to
a
Modbus
TCP
server
The
following
section
describes
how
you
can
set
up
a
Secure
Open
User
Communication
over
Modbus
TCP
from
a
Modbus
TCP
client
to
a
Modbus
TCP
server.
To
set
up
a
secure
connection
from
a
Modus
TCP
client
(TLS
client)
to
a
Modbus
TCP
server
(TLS
server)
and
set
up
the
IPv4
address
of
the
mail
server,
follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
Define
a
tag
of
the
data
type
TCON_IP_V4
SEC
in
the
global
data
block.
900049
152315
Figure
5-31
TCON_IP_V4_SEC
Set
the
connection
parameters
of
the
TCP
connection
in
the
&quot;Start
value&quot;
column.
Enter
the
IPv4
address
of
the
mail
server,
for
example,
for
the
&quot;MailServerAddress&quot;.
Set
the
parameters
for
secure
communication
in
the
&quot;Start
value&quot;
column.
Enter
the
certificate ID of the CA certificate of the communication partner, for example, for
&quot;TLSServerCertRef&quot;.
&quot;ActivateSecureConn&quot;:
Activation
of
secure
communication
for
this
connection.
If
this
parameter has the value FALSE, the subsequent security parameters are irrelevant. In
this
case
you
can
set
up
an
unsecured
Modbus
TCP
connection.
&quot;TLSServerCertRef&quot;: Reference to the X.509 V3 (CA) certificate of the Modbus TCP
server,
which
is
used
by
the
TLS
client
to
validate
the
authentication
of
the
Modbus
TCP
server.
Create
an
MB_CLIENT
instruction
in
the
program
editor.
Interconnect
the
CONNECT
parameter
of
the
MB_Client
instruction
with
the
tags
of
the
data
type
TCON_IP_4_SEC.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
103
Communications
services
5.6
Secure
Communication
Secure
OUC
via
e-mail
Setting
up
a
secure
connection
to
a
mail
server
over
the
CPU
interface
For
secure
communication
to
a
mail
server
you
need
to
create
a
data
block
with
one
of
the
system data types TMAIL_V4_SEC, TMAIL_QDN_SEC yourself, assign parameters and call it
directly
at
the
TMAIL_C
instruction.
Requirements:
TMAIL_C
instruction
version
V5.0
or
higher
STEP
7
V15
and
higher
S7‑1500
CPU
V2.5
and
higher
You
have
assigned
all
the
CA
certificates
of
the
mail
server
(TLS
server)
to
the
CPU
(TLS
client)
and
have
downloaded
the
configuration
to
the
CPU.
Current
date
and
time
are
set
in
the
CPU.
Process
for
establishing
a
secure
connection
to
the
mail
server
You
can
choose
between
two
processes
for
establishing
the
secure
connection
to
the
mail
server:
SMTPS:
The
client
attempts
to
immediately
establish
a
TLS
connection
to
the
mail
server
(&quot;handshake&quot; process). If the mail server does not support TLS, then no connection is
established.
STARTTLS: Client establishes a TCP connection to the mail server. The client sends a
request to &quot;upgrade&quot; the existing connection to a secure TLC connection over the TCP
connection. If the mail server supports TLS, the client sends the command to establish a
secure connection. The mail server uses the SMTP command &quot;STARTTLS&quot; to do this. The
client then establishes a secure connection to the mail server. Advantage: If the mail
server
does
not
support
TLS,
client
and
mail
server
can
communicate
unsecured
with
each
other.
You use the &quot;Remote Port&quot; setting in the data types at the block parameter
&quot;MAIL_ADDR_PARAM&quot;
to
define
which
process
is
used
for
the
communication.
Table
5-6
Port
numbers
for
the
SMTPS
and
STARTTLS
processes
Process
Port
SMTPS:
465
1
STARTTLS
Any
(≠465)
2
1
The
instruction
TMAIL_C
uses
SMTPS
only
for
Port
465.
For
all
other
ports
STARTTLS
is
used.
2
According
to
RFC,
mail
servers
use
Ports
25
and
587
for
secure
connections
with
STARTTLS.
The
use
of other port numbers for SMTP is not RFC-compliant, successful communication with such a mail
server
is
not
guaranteed.
104
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Example:
Setting
up
a
secure
connection
to
a
mail
server
over
IPv4
The
following
section
describes
how
to
set
up
a
secure
connection
to
an
IPv4
mail
server
with
the
TMAIL_C
communication
instruction.
To
set
up
a
secure
connection
via
the
IP4
address
of
the
mail
server,
follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
Define
a
tag
of
the
data
type
TMAIL_V4_SEC
in
the
global
data
block.
The
example
below
shows
the
global
data
block
&quot;MailConnDB&quot;
in
which
the
tag
&quot;MailConnectionSEC&quot;
of
the
data
type
TMAIL_V4_SEC
is
defined.
901953
153702
Figure
5-32
Data
type
TMAIL_V4_SEC
Set
the
connection
parameters
of
the
TCP
connection
in
the
&quot;Start
value&quot;
column.
Enter
the
IPv4
address
of
the
mail
server,
for
example,
for
the
&quot;MailServerAddress&quot;.
NOTE
Connection
parameter
Interface
ID
Note
that
as
of
instruction
version
V5.0
of
TMAIL_C
instruction
in
the
TMAIL_V4_SEC
data
type, you need to enter the value &quot;
0
&quot; for the Interface ID. In this case, the CPU itself
searches
for
a
suitable
local
CPU
interface.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
105
Communications
services
Secure
Communication
Set
the
parameters
for
secure
communication
in
the
&quot;Start
value&quot;
column.
Enter
the
certificate ID of the CA certificate of the communication partner, for example, for
&quot;TLSServerCertRef&quot;.
&quot;ActivateSecureConn&quot;: Activation of secure communication for this connection. If this
parameter has the value FALSE, the subsequent security parameters are irrelevant. You
can
set
up
a
non-secure
TCP
or
UDP
connection
in
this
case.
&quot;TLSServerCertRef&quot;: Reference to the X.509 V3 (CA) certificate of the mail server, which
is
used
by
the
TLS
client
to
validate
the
authentication
of
the
mail
server.
Create
a
TMAIL_C
instruction
in
the
program
editor.
Interconnect
the
MAIL_ADDR_PARAM
parameter
of
the
TMAIL_C
instruction
with
the
tag
of
the
data
type
TMAIL_V4_SEC.
In
the
following
example
the
MAIL_ADDR_PARAM
parameter
of
the
TMAIL_C
instruction
is
interconnected
with
the
tag
&quot;MailConnectionSEC&quot;
(data
type
TMAIL_V4_SEC).
Figure
5-33
TMAIL_C
instruction
Setting
up
a
secure
connection
to
a
mail
server
over
the
interface
of
a
communication
module
For
secure
communication
to
a
mail
server
over
a
communication
module,
you
need
to
create
a data block with one of the system data types TMAIL_V4_SEC, TMAIL_QDN_SEC or
TMAIL_V6_SEC
yourself,
assign
parameters
and
call
it
directly
at
the
TMAIL_C
instruction.
Requirements:
TMAIL_C
instruction
with
version
V4.0
S7-1500 CPU as of firmware version V2.0 with communication module CP 1543‑1 as of
firmware
version
V2.0
ET
200SP
CPU
as
of
firmware
version
V2.0
with
communication
module
CP
1542SP‑1
(IRC)
as
of
firmware
version
V1.0
You
have
assigned
all
the
CA
certificates
of
the
mail
server
(TLS
server)
to
the
CP
(TLS
client)
and
have
downloaded
the
configuration
to
the
CPU.
Current
date
and
time
are
set
in
the
CPU.
The
STEP
7
online
help
describes
how
to
set
up
a
secure
connection
to
a
mail
server
over
the
interface
of
a
communication
module.
106
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Application
example
This application example (
https://support.industry.siemens.com/cs/ww/en/view/46817803
)
show
how
you
can
use
the
CP
of
an
S7-1500
or
S7-1200
station
to
set
up
a
secure
connection
to
an
email
server
and
send
an
email
with
the
default
application
&quot;TMAIL_C&quot;
from
the
S7
CPU.
Additional
information
You
can
find
more
information
about
the
system
data
types
TMail_V4_SEC
and
TMAIL_QDN_SEC
in
the
STEP
7
online
help.
For
additional
information
on
secure
communication,
refer
to
the
section
Secure
Communication
(Page
52).
Secure
PG/HMI
communication
PG/HMI
communication
based
on
standardized
security
mechanisms
With the central components of the TIA Portal, STEP 7 and WinCC, an innovative and
standardized
Secure
PG/PC
and
HMI
Communication
-
PG/HMI
communication
for
short
-
is
implemented starting with version V17 together with the latest controllers and latest HMI
devices.
The
following
CPU
families
are
referred
to
in
detail:
S7-1500
controller
family
as
of
firmware
version
V2.9
S7-1200
controller
family
as
of
firmware
version
V4.5
Software controllers as
of firmware version
V21.9
SIMATIC
Drive
controllers
as
of
firmware
version
V2.9
PLCSim
and
PLCSim
Advanced
Version
V4.0
HMI
components
have
also
been
updated
to
support
Secure
PG/HMI
Communication:
Panels
or
PCs
configured
with
WinCC
Basic,
Comfort
and
Advanced
PCs
with
WinCC
RT
Professional
WinCC
Unified
PCs
and
Comfort
Panels
Also
updated
are
SINAMICS
RT
SW
as
of
version
V6.1
and
STARTDRIVE
as
of
version
V17.
Properties of
PG/HMI communication
One
characteristic
of
PG
communication
and
HMI
communication
above
all
is
their
simplicity:
Establishing an online connection from a programming device with installed TIA Portal to a
CPU, for example, to load a program, requires little effort. This online connection also meets
criteria such as confidentiality and integrity - based on a proven SIMATIC communication
standard.
In the course of integrating machines and systems into an open IT environment, however, it
must
be
ensured
that
the
communication
between
the
programming
device
/
HMI
device
and
the CPU is not only secure in the sense of maintaining integrity and confidentiality for
sensitive
data
but
also
that
this
security
meets
generally
accepted
standards
and
is
thus
ready
for
the
challenges
of
the
future.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
107
Communications
services
5.6
Secure
Communication
With
TIA
Portal
version
V14,
the
&quot;Open
User
Communication&quot;
procedure
for
communication
based on user programs has already been extended by the &quot;
Secure
Open User
Communication&quot;
variant.
Other
certificate-based
communication
mechanisms
have
become
established
(HTTPS,
Secure
SMTP
over
TLS
or
OPC
UA).
As
of
TIA
Portal
Version
V17,
PG/HMI
communication has also been upgraded: Here, too, the TLS (Transport Layer Security)
protocol
is
used
to
secure
PG/HMI
communication
using
standardized
security
mechanisms.
What
has
changed
Additional
optional
password
for
more
security
The
most
noticeable
change
in
the
frame
of
the
configuring
of
the
above
devices
is
the
ability
to
assign
a
password
to
protect
sensitive
configuration
data
of
the
respective
CPU.
This
refers
to data such as private keys that are required for the proper functioning of certificate-based
protocols
(Secure
Communication)
-
as
of
TIA
Portal
V17
also
for
the
PG/HMI
communication.
You
can
use
a
policy
setting
to
check
the
assigned
passwords
as
they
are
entered
into
the
TIA
Portal.
This
will
ensure
that
your
company
complies
with
prescribed
password
policies.
WARNING
If your machine or system does not require this protection based on the Siemens Industrial
Defense-in-Depth concept, you can dispense with password assignment, for example,
because another equivalent protection is present. It is possible to do without the password if
you
have
implemented
measures
to
prevent
unauthorized
access
to
the
TIA
Portal
project
and
the
configuration
of
the
CPU.
Without
password,
weak
protection
of
private
keys
Note
that
without
a
password
to
protect
trusted
configuration
data,
the
private
keys
for
certificates
required
for
secure
communication
are
only
weakly
protected.
Certificate-based
communication
between
PG/HMI
and
CPU
Because
PG/HMI
communication
is
certificate-based,
you
will
be
asked
to
accept
the
server
certificate
during
commissioning.
Additional
parameter
assignment
options
allow
you
to
determine
the
behavior
of
the
CPU
during operation: For example, you can specify that the CPU also allows connection to
devices
that
do
not
support
Secure
PG/HMI
communication.
Maintenance
/
replacement
parts
scenario
For
the
problem-free
exchange
of
the
CPU
in
replacement
parts
scenario,
you
must
observe
specific
rules
(see
Rules
for
the
replacement
parts
scenario
(Page
89)).
More
information
An
overview
of
how
to
protect
confidential
configuration
data
can
be
found
in
section
Protection
of
confidential
configuration
data
(Page
77).
108
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Additional
settings
for
the
secure
PG/HMI
communication
In
addition
to
the
assignment
of
a
password
to
protect
confidential
PLC
configuration
data,
you
have
further
setting
options
for
the
behavior
of
the
CPU
during
operation.
PG/PC
and
HMI
communication
mode
You
can
set
how
the
CPU
can
communicate
with
programming
devices
and
HMI
devices:
Only
via
secure
PG/HMI
communication
Both
via
Secure
PG/HMI
communication
and
via
the
previously
used
PG/HMI
communication,
&quot;Legacy
PG/HMI
communication&quot;
for
short.
Procedure
In
the
CPU
properties,
navigate
to
the
area
&quot;Protection
&
Security
>
Connection
mechanisms&quot;.
Select
the
option
you
want
to
use.
Select
certificate
or
generate
a
new
certificate
If you select the connection mechanism for PG/HMI communication, you can select a PLC
communication
certificate
for
the
protection
of
the
connection
in
the
same
context
or
have
it
generated by the TIA Portal. If you have assigned a password or if you have deactivated the
option to protect confidential PLC configuration data (i.e. no password has been set), then a
certificate with suitable settings and a valid default name is already preset in the &quot;Protection
&
Security
>
Connection
mechanisms&quot;
area.
Procedure
If
you
want
to
have
a
new
certificate
generated
by
the
TIA
Portal
or
if
you
want
to
select
another
existing
certificate:
In
the
&quot;PLC
communication
certificate&quot;
field,
click
the
three
points
to
expand
the
field.
Select
the
certificate
you
want
or
click
the
&quot;Add&quot;
button.
When
adding
a
certificate,
a
dialog
appears
with
setting
options
for
the
certificate.
The
purpose
is
set
to
&quot;TLS
server&quot;,
you
can
change
other
parameters
(such
as
name,
hash
algorithm).
The general rules for certificate management apply. For example, if you want to generate a
CA
certificate,
the
option
&quot;Global
settings
for
the
certificate
manager&quot;
must
be
selected.
You
also
have
the
option
of
generating
a
self-signed
PLC
certificate.
More
information
Basic
information
on
the
subject
of
certificate
management
can
be
found
in
section
Certificate
management
with
TIA
Portal
(Page
65).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
109
Communications
services
5.6
Secure
Communication
Tip
for
certificate-based
communication
between
PG
and
CPU
The certificate-based PG/PC communication
(Secure PG/PC communication) means that the
communication
partner
of
the
CPU
–
the
programming
device
with
installed
TIA
Portal
–
must
trust
the
device
certificate
of
the
CPU
so
that
a
connection
can
be
loaded.
To
put
it
simply,
from
the
TIA
Portal
perspective
you
have
the
following
options
to
trust
the
certificate
of
a
CPU:
The
PG
with
TIA
Portal
is
in
possession
of
the
device
certificate
of
the
CPU
because
it
was,
for example, created or imported in the project. In this case, the certificate check runs
automatically
and
without
prompting.
The
PG
with
TIA
Portal
is
not
in
possession
of
the
device
certificate
of
the
CPU,
because
the
CPU was determined via &quot;Accessible stations&quot;, for example, and is not available in the
project. In this case, the TIA Portal asks the TIA Portal user whether the certificate can be
trusted. This may be possible only with great effort because the CPU is not in sight, for
example,
and
the
authenticity
can
therefore
not
be
checked
immediately.
The
PG
with
TIA
Portal
is
in
possession
of
the
CA
certificate
(certification
authority)
and
all
CPUs that can be reached in the network from the TIA Portal have device certificates
issued
by
this
CA
certificate.
Advantage
of
this
solution:
TIA
Portal
can
check
device
certificates
automatically,
even
if
the
device
certificates
of
the
communication
partners
are
not
available
in
TIA
Portal.
The
solution
with
a
CA
certificate
(certification
authority)
is
explained
in
more
detail
below.
Requirement
You
can
use
the
certification
authority
of
the
TIA
Portal
to
create
device
certificates
for
a
CPU
and use the existing CA certificates to sign the device certificates. However, you can also
import
another
certification
authority
into
TIA
Portal
and
use
it.
Enabling
the
global
security
policies
for
the
certificate
manager
is
a
requirement.
Only
with
this
setting
you
can
generate
CA-signed
certificates.
(Page
65)
See
also
here:
Certificate
management
with
TIA
Portal
Exporting
CA
certificate
for
programming
devices
To
export
the
corresponding
CA
certificate
after
creating
and
assigning
a
certificate,
follow
these
steps:
Open
the
certificate
manager
in
the
global
security
settings
in
the
project
tree.
Select
the
table
&quot;CA
certificates&quot;
for
the
certificate
to
be
exported.
Right-click
to
open
the
shortcut
menu
of
the
selected
certificate.
Click
&quot;Export&quot;.
Select
the
export
format
of
the
certificate
and
the
storage
location.
110
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Store
CA
certificate
in
the
TIA
Portal
To
make
the
exported
certificate
known
to
a
PG
with
TIA
Portal
and
thus
enable
automatic
certificate
checking,
follow
these
steps:
Copy
the
CA
certificate
exported
in
the
previous
step
to
the
following
directory:
C:\ProgramData\Siemens\Automation\Certstore\Trusted
Start
TIA
Portal.
In
the
&quot;Info&quot;
tab
of
the
Inspector
window,
a
message
appears
for
each
CA
certificate
which
provides
information
on
whether
the
CA
certificate
could
be
successfully
transferred
to
the
CA
store
of
TIA
Portal.
However,
no
detailed
causes
are
output
in
case
of
failure.
Adding
device
certificates
to
the
TIA
Portal
certificate
revocation
list
(CRL)
You
have
the
option
to
add
individual
device
certificates
to
a
certificate
revocation
list
(CRL),
for
example,
because
the
associated
key
is
no
longer
considered
secure.
When the TIA Portal establishes a connection to a CPU whose device certificate is in the
certificate
revocation
list,
a
dialog
appears
in
the
TIA
Portal
asking
whether
you
still
want
to
trust
the
certificate.
If
you
decline,
the
connection
will
not
be
established.
To
add
a
device
certificate
to
the
certificate
revocation
list,
follow
these
steps:
Copy
the
device
certificate
to
the
following
directory:
C:\ProgramData\Siemens\Automation\Certstore\CRL
Start
TIA
Portal.
In the &quot;Info&quot; tab of the Inspector window, a message appears for each certificate which
provides
information
about
whether
the
certificate
could
be
successfully
transferred
to
the
CRL
store
of
TIA
Portal.
However,
no
detailed
causes
are
output
in
case
of
failure.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
111
Communications
services
5.6
Secure
Communication
CPU
behavior
from
loading
to
operational
readiness
To
ensure
that
communication
between
the
CPU
and
a
programming
device
or
HMI
device
is
secure, it must first have a certificate. However, the certificate for productive operation is
only
issued
when
the
project
is
loaded
into
the
CPU.
To
ensure
that
the
initial
loading
is
also
secured,
the
CPU
first
creates
a
self-signed
certificate.
The
following
description
explains
the
different
phases
of
establishing
a
connection.
Requirement
for
the
initial
establishment
of
connection
to
load
the
CPU
No
password
for
confidential
PLC
configuration
data
available
in
the
CPU.
If
the
CPU
has
already
been
loaded
and
therefore
already
has
a
password
for
confidential
PLC
configuration
data,
this
password
must
then
match
the
project
that
is
to
be
loaded.
Project
with
CPU
configuration
(including
password
for
confidential
PLC
configuration
data)
and
user
program
is
available.
The
CPU
is
in
STOP
mode.
Programming
device
and
CPU
are
directly
connected
to
each
other
and
are
located
in
a
protected environment; i.e. you can identify the CPU to be loaded and control the
connection
between
CPU
and
programming
device.
Initial
establishment
of
connection
to
the
CPU
-
provisioning
phase
The
first
connection
establishment
for
loading
the
CPU
is
secured
by
the
TLS
procedure
in
terms
of
Secure
PG/HMI
Communication.
However, the CPU uses its manufacturer device certificate (if available) or a self-signed
certificate to establish this connection. The CPU can only be used to a limited extent in this
phase.
In
this
phase,
the
CPU
waits
for
the
provision
of
the
password-based
key
information
-
or
more
simply
stated,
it
is
expecting
the
password
for
confidential
PLC
configuration
data.
This
phase
is
referred
to
below
as
the
provisioning
phase.
A
message
in
the
diagnostic
buffer
indicates
that
the
CPU
is
in
the
provisioning
phase.
When
a
project
is
loaded
into
the
CPU,
the
CPU
receives
the
project
data:
Hardware
configuration
including
configured
certificates
for
secure
communication
(OPC
UA,
HTTPS,
Secure
OUC,
Secure
PG/HMI
Communication)
User
program
112
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
1P
S
UBM
5*A
(FOFSBUFE
TFMG-TJHOFE
DFSUJ꫼DBUF
TFOU
JO
SFTQPOTF
UP
DPOOFDUJPO
FTUBCMJTINFOU
SFRVFTU
*
N
QMJDJU
M
Z
DPO꫼HV
S
FE
$16
DFSUJ꫼DBUF
GPS
1(I)M*
DPNNVOJDBUJPO
JT
MPBEFE
1.
$POOFDUJPO
FTUBCMJTINFOU
3FRVFTU
TJODF
OP
BVUPNBUJD
BVUIFOUJDJUZ
(USVTU
JO
TFMG-TJHOFE
DFSUJ꫼DBUF),
MBOVBM
DPO꫼SNBUJPO
DIFDL
JT
QPTTJCMF
1SPjFDU
EBUB
$16
JT
OPU
DPO꫼HVSFE
Figure
5-34
Connection
establishment,
provisioning
phase
Potential
security
risks
during
commissioning
During commissioning, the CPU provides a manufacturer device certificate (if available) or a
self-signed certificate that you must trust in order to establish a connection. Only trust this
certificate
if
the
programming
device
and
the
CPU
are
in
a
protected
network
and
are
directly
connected to each other. In an unprotected environment, these certificates can be
manipulated and allow attackers to access the communication between the programming
device/HMI
and
CPU
(e.g.
through
man-in-the-middle
attacks).
Ending
the
provisioning
phase
TIA
Portal
does
not
store
the
password
for
confidential
PLC
configuration
data
itself
or
the
key
information
generated
from
the
password
in
the
project.
Therefore,
the
password
is
requested
in
a
dialog
when
loading
the
project
for
the
first
time
or
when loading a new project and transferred to the CPU as key information. Only after this
step the CPU is able to use the protected PLC configuration data - this completes the
provisioning
phase
and
the
CPU
can
start
operating.
If you do not protect the confidential PLC configuration data with a password, there is no
need
to
enter
the
password
when
loading
the
CPU
for
the
first
time.
This
has
no
influence
on
the flow of the PG/HMI communication but you have to consider that the confidential PLC
configuration data (e.g. private keys) offer almost no protection against unauthorized access
in
this
case.
WARNING
Communication
Function
Manual,
11/2024,
A5E03735815-AM
113
Communications
services
5.6
Secure
Communication
Startup
of
PG/HMI
communication
When the CPU is loaded and has received the CPU certificate for Secure PG/HMI
Communication,
the
programming
device
connects
again
-
this
time
based
on
the
loaded
CA
certificate.
1P
S
UBM
5*A
LPBEFE
$16
DFSUJ꫼DBUF
GPS
1(I)M*
DPNNVOJDBUJPO
JT
TFOU
JO
SFTQPOTF
2.
$POOFDUJPO
FTUBCMJTINFOU
SFRVFTU
$FSUJ꫼DBUF
JT
BVUPNBUJDBMMZ
BDDF
Q
U
FE,
LO
P
XO
G
S
PN
DPO꫼HVS
BUJPO
%BUB
FYDIBOHF
(TFDVSF)
%BUB
FYDIBOHF
(TFDVSF)
$16 JT
DPO꫼HVSFE
Figure
5-35
Startup
of
PG/HMI
communication
Using
secure
HMI
communication
As
of
TIA
Portal
version
V17,
the
CPU
and
the
HMI
device
communicate
via
secure
HMI
communication
if
both
devices
meet
the
requirements
for
this
type
of
communication.
The
basis
of
secure
HMI
communication
is
that
the
HMI
device
can
verify
the
authenticity
of
the CPU, using the PLC communication certificate that the CPU sends when establishing
communication, and considers the CPU to be &quot;trustworthy&quot;. Secure HMI communication is
only
possible
when
this
turns
out
to
be
the
case.
This
section
describes
the
measures
you
must
take
for
the
various
HMI
devices
to
manually
label
the
PLC
communication
certificate
as
&quot;trustworthy&quot;.
Requirement
CPU
and
HMI
device
support
secure
HMI
communication.
A
current
project
is
available
on
the
CPU
(TIA
Portal
V17
and
higher).
114
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Configuring
secure
HMI
communication
Configure
the
HMI
device
with
an
alarm
view.
NOTE
Without
an
alarm
view
you
cannot
identify
the
errors
during
connection
establishment.
Configure
the
CPU
with
the
required
security
settings.
Select
a
PLC
communication
certificate to protect the HMI connection or have the TIA Portal generate a PLC
communication
certificate.
Configure
the
HMI
connection
between
the
CPU
and
the
HMI
device.
Download
the
project
to
the
CPU
and
the
HMI
device.
During
the
project
transfer,
the
PLC
communication certificate and, if necessary, a CA (Certificate Authority) certificate is
transferred
to
the
CPU
and
the
HMI
device.
NOTE
Updating
and
loading
the
CPU
configuration
requires
reloading
into
the
HMI
device
If you change the CPU configuration and this change causes a change to the PLC
communication
certificate
(e.g.
when
changing
the
IP
address
of
an
interface),
you
must
also
reload
the
PLC
communication
certificate
of
the
connected
HMI
device.
Otherwise,
communication
between
the
HMI
device
and
CPU
is
not
possible.
Trusting
the
PLC
communication
certificate
During
connection
setup,
the
CPU
transfers
the
PLC
communication
certificate
to
the
HMI
device.
When
the
PLC
communication
certificate
is
already
available
on
the
HMI
device
with
the
&quot;trustworthy&quot; status, a secure HMI communication is automatically set up between the
CPU
and
the
HMI
device.
When the PLC communication certificate is not available in the &quot;trustworthy&quot; status on the
HMI
device,
you
will
see
a
message
in
the
alarm
view
of
the
HMI
device
informing
you
that
the
CPU
is
not
trusted
along
with
an
error
code.
In
this
case,
you
must
label
the
PLC
communication
certificate
on
the
HMI
device
as
&quot;trustworthy&quot;.
Depending
on
the
type
of
your
HMI
device,
follow
these
steps.
Basic
Panels
2nd
Generation
In
the
Start
Center,
select
&quot;Settings
>
Internet
Settings
>
Certificate
store&quot;.
In
the
&quot;Available
certificates
in
Device&quot;
list,
select
the
PLC
communication
certificate
of
the
CPU.
Press
&quot;Trust&quot;.
Restart
the
HMI
runtime
software.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
115
Communications
services
Secure
Communication
Unified
Comfort
Panels
Open
the
Control
Panel.
Select
&quot;Security
>
Certificates&quot;.
In
the
&quot;Certificate
store&quot;
selection
list,
select
the
entry
&quot;Other
Certificates&quot;.
In
the
&quot;Other
certificates&quot;
list,
select
the
PLC
communication
certificate
of
the
CPU.
Press
&quot;Trust&quot;.
Restart
the
HMI
runtime
software.
Comfort
Panels,
Mobile
Panels
2nd
Generation
Open
the
file
manager
via
the
Windows
CE
desktop
icon
&quot;My
Device&quot;.
Navigate
to
the
directory
&quot;\flash\simatic\SystemRoot\OMS\Untrusted&quot;.
There
you
will
find
the
PLC
communication
certificate
of
the
CPU.
Copy
the
PLC
communication
certificate
of
the
CPU
to
the
directory
&quot;\flash\simatic\SystemRoot\OMS\Trusted&quot;.
Restart
the
HMI
runtime
software.
When
the
PLC
communication
certificate
is
already
available
on
the
HMI
device
with
the
&quot;trustworthy&quot; status, secure HMI communication can be set up. You can find more
information
in
the
operating
instructions
of
the
HMI
device.
Using
Legacy PG/PC
communication
for
TIA Portal
As of TIA Portal version V17, the TIA Portal and the S7‑1200/S7‑1500 CPU as of firmware
version
V4.5/V2.9
automatically
communicate
&quot;securely&quot;
-
the
connection
partners
set
their
connection
mechanisms
automatically
to
the
highest
possible
security
method.
Only
special
circumstances
(see
Information
about
compatibility
(Page
117))
cause
a
fallback
to
the
old
PG/PC
communication,
called
&quot;Legacy
PG/PC
communication&quot;.
There
may
be
some
cases
in
which
the
higher
security
is
not
desirable
because
it
can
impact
the
transmission
rate
of
CPUs
with
weak
communication
performance.
Requirement
There
may
be
no
online
connections
to
the
CPUs.
For
CPUs
that
are
to
be
reached
online,
the
option
&quot;Only
permit
secure
PG/PC
and
HMI
communication&quot; must be disabled (CPU parameters in the area &quot;Connection
mechanisms&quot;).
The
communication
partners
are
in
a
protected
environment,
for
example,
during
the
commissioning
phase.
116
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.6
Secure
Communication
Setting
the
Legacy
PG/PC
communication
In
the
&quot;Online&quot;
menu,
select
the
command
&quot;Use
only
Legacy
PG/PC
communication&quot;.
Select
the
check
box
in
front
of
the
menu
command.
Result
:
All
online
connections
are
set
up
as
for
TIA
Portal
versions
<
V17.
The
setting
remains
active
for
the
duration
of
the
session.
When
you
open
a
project,
the
option
&quot;Use
only
legacy
PG/PC
communication&quot;
is
not
set.
Behavior
with
enabled
option
&quot;Use
only
Legacy
PG/PC
communication&quot;
A
password
to
protect
confidential
PLC
configuration
data
cannot
be
specified,
modified
or
deleted online for CPUs. These functions require disabling the &quot;Use only Legacy PG/PC
communication&quot;
option.
A
CPU
that
is
set
to
only
permit
secure
PG/PC
and
HMI
communication
can
no
longer
be
reached
online.
Information
about
compatibility
The
following
description
provides
information
about
the
interaction
between
different
TIA
Portal versions with different CPU firmware versions and the effects on the type of PG/HMI
connection.
Projects
created
with
TIA
Portal
<
V17
For example, if you have created a project with TIA Portal version V16 for an S7-1500 CPU
(e.g. version V2.8), then the corresponding configuration with TIA Portal V17 can also be
loaded
into
an
S7-1500
CPU
V2.9,
e.g.
in
a
spare
part
scenario
-
with
the
same
behavior
as
a
configuration
on
an
S7-1500
CPU
V2.8.
Even
projects
created
with
TIA
Portal
<
V17
and
transferred
to
a
memory
card
work
without
problems
in
an
S7-1500
CPU
V2.9.
However, the concept of protecting confidential PLC configuration data applies as soon as
you open the project with TIA Portal ≥ V17, update the firmware version of the CPU via a
device replacement and thus save it as a CPU with a firmware version ≥ V2.9 (see Useful
information
for
the
protection
of
confidential
PLC
configuration
data
(Page
80)).
The
project
can
no
longer
be
edited
with
previous
versions
of
TIA
Portal
V17.
PG/HMI and
CPU
connected
differently
As
explained
in
the
previous
sections,
the
secure
PG/HMI
connection
as
of
V17
between
the
PG/HMI device and CPU (current version) is characterized by the employed standardized
communication
procedure,
TLS
(Transport
Layer
Security).
You have the option of connecting a V2.9 CPU to a current programming device with TIA
Portal V17 or higher and additionally, for example, to an HMI device with a runtime from the
previous version: The devices automatically adjust their connection mechanisms accordingly.
In order to be able to better differentiate between the two connection mechanisms, we call
the previous procedure, which is based on a variant of S7 communication, &quot;Legacy
procedure&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
117
Communications
services
Secure
Communication
In
summary
(&quot;PG&quot;
here
stands
for
a
programming
device
with
TIA
Portal):
PG/HMI
and
CPU
come
with
the
V17
(or
subsequent
version):
TLS
procedure
is
used.
PG/HMI
comes
from
a
predecessor
version
(<
V17):
Legacy
procedure
is
used
-
provided
that
you
have
deactivated
the
option
&quot;Only
allow
secure
PG/PC
and
HMI
communication&quot;
in
the
CPU
properties.
CPU comes with V17 (or higher), several PGs/HMIs are connected and come from both
V17 (or higher) and previous versions: TLS + legacy procedures are used - provided that
you
have
deactivated
the
option
&quot;Only
allow
secure
PG/PC
and
HMI
communication&quot;
in
the
CPU
properties.
When
the
CPU
state
changes
The
diagnostics
buffer
provides
you
with
information
if
its
status
changes
due
to
events
in
connection
with
the
Secure
PG/HMI
Communication.
Examples:
After successfully loading a configuration with a configured password, the diagnostics
buffer
reports
that
the
CPU
is
changing
from
the
provisioning
phase
to
Secure
Mode
(TLS
procedure).
You
have
connected
a
PG
with
TIA
Portal
V17
to
a
CPU
V2.9.
If
&quot;Use
only
Legacy
PG/PC
communication&quot;
is
deactivated
in
the
Online
menu,
the
Secure
PG/HMI
Communication
(TLS
procedure)
is
established
automatically.
More
information
Information
on
device
or
firmware-specific
features
such
as
the
TLS
version
used
can
be
found
in
section
Device-dependent
security
features
(Page
55).
118
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
SNMP
SNMP
Activating
and
deactivating
SNMP
The
network
management
protocol
SNMP
(Simple
Network
Management
Protocol)
is
used
for
performing monitoring and diagnostics of the network topology. SNMP uses the transport
protocol
UDP
and
knows
two
roles:
the
SNMP
manager
(client)
and
SNMP
agent
(server).
The
SNMP
manager
monitors
the
network
nodes:
The SNMP agents collect the various network-specific information in the individual
network nodes and store it in a structured form in the MIB (Management Information
Base).
Various
services
and
tools
(as
SNMP
manager)
can
run
detailed
network
diagnostics
with
the
help
of
these
data.
SNMP
is
also
used
in
a
PROFINET
IO
system
for
managing
the
network
infrastructure
and
the
IO
controller/IO
devices.
NOTE
If
SNMP
is
deactivated
for
a
device,
various
options
for
diagnostics
of
the
network
topology
(for
example,
using
the
PRONETAtool)
are
no
longer
available
to
you.
Example:
For
the
topology
comparison
Online-Offline,
the
TIA
Portal
determines
which
ports
are
actually
connected
and
uses
SNMP
for
this
function.
Default
settings
depending
on
the
firmware
version
S7-1500
CPUs
have
an
integrated
SNMP
agent.
Depending
on
the
firmware
version,
different
defaults
apply
to
SNMP
(SNMP
activated
or
deactivated).
With
S7-1500
CPUs
with
a
FW
version
<
V3.0,
the
SNMP
agent
is
activated
by
default
and
can
only
be
deactivated
via
a
data
record
in
the
user
program.
Under
certain
conditions,
it
may
be
useful
to
deactivate
SNMP.
Examples:
The
security
guidelines
in
your
network
do
not
allow
the
use
of
SNMP.
You
use
your
own
SNMP
solution,
e.g.
with
your
own
communications
instructions.
With S7-1500 CPUs as of FW version V3.0, the SNMP agent is
deactivated
by default. The
default
setting
&quot;disabled&quot;
is
also
in
effect
if
no
configuration
has
been
loaded
or
if
no
memory
card is plugged in. STEP 7 V18 offers the following options for changing the SNMP settings
for
S7‑1500
CPUs
as
of
FW
version
V3.0:
Configure
SNMP
in
the
CPU
properties
of
TIA
Portal.
Activate/deactivate
SNMP
in
the
use
program
by
transferring
a
data
record
to
a
PROFINET
interface.
NOTE
Replacement
part
scenario
For compatibility reasons, an S7-1500 CPU as of firmware version V3.0 with a loaded
predecessor
project
(CPU
firmware
<
V3.0)
behaves
like
the
CPU
in
the
predecessor
project:
SNMP
is
activated
and
&quot;public&quot;
and
&quot;private&quot;
community
strings
are
in
effect.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
119
Communications
services
SNMP
Configuring
SNMP
As
of
CPU
firmware
version
V3.0
and
TIA
Portal
version
V18,
you
can
change
the
following
settings
for
SNMP
in
the
CPU
properties:
Activate
SNMP
(default:
deactivated)
Read-only
community
string
(default:
&quot;public&quot;)
Read-write
community
string
(default:
&quot;private&quot;)
You
can
find
the
settings
in
the
&quot;Advanced
configuration
>
SNMP&quot;
area.
As
of
CPU
firmware
version
V3.1
and
TIA
Portal
version
V19,
you
can
additionally
enable
write-protected
access
for
SNMP
when
SNMP
is
activated.
Meaning
and
properties
of
community
strings
An
SNMP
community
string,
also
referred
to
as
a
&quot;community
name&quot;,
is
like
an
ID
or
a
password,
which
allows
access
to
information/statistics
of
a
device
such
as
a
router.
In
this
respect,
to
increase
the
security,
you
should
change
the
default
community
strings
in
the CPU properties. An SNMP manager authenticates itself with the SNMP agent by
transferring
the
community
strings
when
there
is
a
request.
The
community
strings
are
transferred
as
plain
text.
The
default
community
string
for
SNMP
read-only
operations
(GET)
is
&quot;public&quot;.
The
default
community
string
for
SNMP
read-write
operations
(SET)
is
&quot;private&quot;.
Number
of
characters
for
the
community
string:
1-240.
You
can
use
the
following
characters
for
the
community
string:
a-z
A-Z
0-9
-
.
120
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.7
SNMP
Activating/deactivating
SNMP
in
the
user
program
In addition to the configuration in the CPU properties, you can also activate or deactivate
SNMP
in
the
user
program.
To
do
this,
transfer
a
data
record
0xB071
to
a
PROFINET
interface
of the CPU. In this record it is encoded whether SNMP is to be activated/deactivated. No
matter to which PROFINET interface you transfer the data record, the data record applies to
all
interfaces
of
the
CPU.
One way to transfer the 0xB071 data record: Define the data set structure in a data block and
transfer
it
in
the
program
cycle
OB
(e.g.
OB1)
with
the
instruction
&quot;WRREC&quot;
(write
data
record)
to
a
PROFINET
interface
of
the
CPU.
To
do
this,
follow
these
steps:
In
STEP
7,
create
a
data
block
that
contains
the
structure
of
data
record
0xB071.
The
following
table
shows
the
structure
of
the
data
record
0xB071.
Byte
Element
Code
Explanation
0-1
BlockID
0xF003
Header
The
data
record
length
is
coun-
ted
starting
at
byte
4
&quot;Version&quot;.
2-3
BlockLength
8
4
Version
0x01
5
Subversion
0x00
6-7
Reserved
-
-
8-11
SNMP
controller
0.1
0:
Deactivate
SNMP.
1:
Activate
SNMP.
Transfer the data record 0xB071, for example, in the program cycle OB (OB1) to the CPU
with
the
&quot;WRREC&quot;
instruction
(write
data
record).
Use
an
integrated
PROFINET
interface
of
the
CPU
as
the
hardware
ID.
Interplay
of
SNMP
configuration
and
user
program
The
SNMP
setting
&quot;activated/deactivated&quot;
via
the
user
program
is
not
stored
permanently
in the CPU. The configured setting is effective again, for example, after each POWER
OFF/POWER ON transition, loading of a new hardware configuration, or resetting to
factory
settings.
When loading the configuration from the CPU (&quot;Upload device as new station&quot;), the
configured
SNMP
setting
(activated/deactivated)
is
taken
into
consideration.
An
SNMP
setting
previously
set
by
data
record
in
the
user
program
is
ignored.
The
community
strings
can
only
be
changed
in
the
configuration;
the
community
strings
cannot
be
set
through
a
data
record
in
the
user
program.
However,
you
can
activate
the
configured
community
strings
by
data
record.
Example
:
You have set SNMP to deactivated in the configuration of an S7-1500 CPU. You change
the
default
community
strings
in
the
CPU
properties
and
then
load
the
configuration
into
the
CPU.
Then, you activate SNMP via data record transfer.
Result:
The
changed
community
strings
take
effect.
For
S7-1500
CPUs
with
a
firmware
version
<
V3.0,
the
preset
community
strings
(&quot;public&quot;
and
&quot;private&quot;)
are
always
in
effect
when
SNMP
is
activated.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
121
Communications
services
5.7
SNMP
Activating/deactivating
SNMP
by
data
record
transfer:
Example
for
a
CPU
1516-3
PN/DP
Introduction
You need to activate the SNMP for a CPU 1516‑3 PN/DP to manage your network
infrastructure,
CPUs
and
IO
devices
with
SNMP.
The
example
below
shows
the
0xB071
data
record
being
transferred
to
a
PROFINET
interface
for
this
purpose.
Requirement
CPU
1516‑3
PN/DP
as
of
FW
version
V2.0
STEP
7
version
V14
or
higher
Solution
Transfer
the
data
record
0xB071
to
a
PROFINET
interface
of
the
CPU.
As
a
result,
SNMP
is
enabled
in
all
PROFINET
interfaces
of
the
CPU.
The
following
example
shows
how
you
can
create
the
data
record
in
a
global
data
block
and
transfer it in a program cycle OB (for example, OB1) to the PROFINET interface
(Local~PROFINET_interface_1).
To
activate
SNMP
for
the
addressed
PROFINET
interface
of
the
CPU
1516‑3
PN/DP,
follow
these
steps:
Create
a
global
data
block.
Assign
a
name,
for
example,
&quot;ActivateSnmp&quot;.
Under &quot;Static&quot;, create the structure of the 0xB071 data record (in the figure:
&quot;snmpRecord&quot;)
and
other
variables
for
transferring
the
data
record.
The
following
figure
shows
the
data
block
structure
&quot;ActivateSnmp&quot;.
1804416
128502
Figure
5-36
Structure
of
the
global
data
block
&quot;ActivateSnmp&quot;
Transfer the 0xB071 data record in an OB program cycle (for example, OB1), with the
&quot;WRREC&quot;
(write
data
record)
instruction
to
the
CPU
1516‑3
PN/DP.
You
can
find
an
example
program
in
the
next
section.
122
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.7
SNMP
Programming
example
for
the
data
record
transfer
in
the
OB1
The
data
record
0xB071
is
transferred
in
the
following
program
code:
//-----------------------------------------
//
Start
writing
SNMP
settings
//-----------------------------------------
IF
&quot;ActivateSnmp&quot;.snmpWrite
THEN
IF
(NOT
&quot;ActivateSnmp&quot;.snmpWriteDone)
AND (NOT &quot;ActivateSnmp&quot;.snmpWriteError) THEN
&quot;instWrrec_1&quot;(REQ := &quot;ActivateSnmp&quot;.snmpWrite,
ID
:=
&quot;Local~PROFINET-Schnittstelle_1&quot;,
INDEX
:=
16#B071,
DONE => &quot;ActivateSnmp&quot;.snmpWriteDone,
ERROR => &quot;ActivateSnmp&quot;.snmpWriteError,
STATUS => &quot;ActivateSnmp&quot;.snmpWriteStatus,
RECORD := &quot;ActivateSnmp&quot;.snmpRecord);
END_IF;
IF
&quot;ActivateSnmp&quot;.snmpWriteError
THEN
; // add error handling
END_IF;
IF &quot;ActivateSnmp&quot;.snmpWriteDone THEN
&quot;ActivateSnmp&quot;.snmpWrite := FALSE;
END_IF;
END_IF;
Deactivating
SNMP
again
You
can
use
the
program
code
used
above,
with
small
changes,
to
deactivate
SNMP.
Assign
the
value
&quot;0&quot;
to
the
tag
&quot;ActivateSnmp&quot;.snmpRecord.snmpControl
in
the
user
program:
&quot;ActivateSnmp&quot;.snmpRecord.snmpControl
:=
0;
The
next
time
the
&quot;WRREC&quot;
instruction
is
called,
SNMP
will
be
deactivated
again.
Activating/deactivating
SNMP
by
data
record
transfer
with
S7-1500R/H
CPUs
In
S7-1500R/H
systems,
activate/deactivate
SNMP
in
the
user
program
as
with
standard
CPUs.
However, the PROFINET interfaces (X1, X2,...) of both CPUs have different hardware IDs. The
PROFINET interface X1 of the left CPU, for example, has a different hardware ID as the
PROFINET interface X1 of the right CPU. The S7-1500R/H system does not automatically
synchronize the SNMP status (activated/deactivated) for both CPUs. An SNMP status
(activated/deactivated) set by the &quot;WRREC&quot; instruction
only affects the CPU whose PROFINET
interface
addresses
the
&quot;WRREC&quot;
instruction.
Example:
The
S7‑1500R/H
system
is
in
the
&quot;RUN
redundant&quot;
system
state.
If
a
PROFINET
interface
of
the
left CPU is addressed with the &quot;WRREC&quot; instruction, for example, the SNMP status of the left
CPU
is
changed.
The
SNMP
status
of
the
right
CPU
remains
unchanged.
If
the
left
CPU
fails
or
is
replaced,
the
unchanged
SNMP
status
is
in
place
after
the
SYNCUP.
Solution
:
Call
the
&quot;WRREC&quot;
instruction
2
times.
In
the
first
call
of
&quot;WRREC&quot;,
address
the
hardware
ID
of
a
PROFINET
interface
of
the
left
CPU.
Call
the
&quot;WRREC&quot;
instruction
again.
This
time,
address
the
hardware
ID
of
a
PROFINET
interface
of
the
right
CPU.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
123
Communications
services
SNMP
Hardware
IDs
for
PROFINET
interface
X1:
The
PROFINET
interface
X1
of
the
left
CPU
has
the
hardware
ID
65164
(default
name:
Local1~PROFINET-interface_1).
The
PROFINET
interface
X1
of
the
right
CPU
has
the
hardware
ID
65364
(default
name:
Local2~PROFINET-interface_1).
The
addressing
by
means
of
the
respective
hardware
IDs
of
the
PROFINET
interfaces
X1
is
also
used
in
the
following
example
for
calling
the
&quot;WRREC&quot;
instruction
for
both
R/H
CPUs.
NOTE
Transferring
the
data
record
to
the
backup
CPU
Transfer the data record to the addressed PROFINET interface of the backup CPU only after
the
S7‑1500R/H
system
has
reached
the
&quot;Run
REDUNDANT&quot;
system
state.
Otherwise,
the
data
record
cannot
be
transferred
to
the
addressed
PROFINET
interface
of
the
backup
CPU.
When the S7‑1500R/H system has reached the system state &quot;Run REDUNDANT&quot;, the CPU
redundancy
error
OB
(OB72)
is
started.
The
&quot;Fault_ID&quot;
tag
of
the
OB72
contains
the
error
code
&quot;B#16#03&quot;
or
&quot;B#16#06&quot;.
Example:
WRREC
calls
for
both
R/H
CPUs
To
activate/deactivate
SNMP
for
the
addressed
PROFINET
interface
of
both
the
CPUs
by
transferring
data
records,
proceed
as
follows:
Create
a
global
data
block.
Assign
a
name,
for
example,
&quot;ActivateSnmp&quot;.
Under &quot;Static&quot;, create the structure of the 0xB071 data record (in the figure:
&quot;snmpRecord&quot;)
and
other
tags
for
transferring
the
data
record.
The
following
figure
shows
the
structure
of
the
data
block
&quot;ActivateSnmp&quot;.
1799970
129304
Figure
5-37
Structure
of
the
global
data
block
&quot;ActivateSnmp&quot;
124
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communications
services
5.7
SNMP
Add
the
organization
block
&quot;CPU
redundancy
error&quot;
(OB72)
to
your
user
program.
You
can
find
an
example
program
for
the
OB72
in
the
next
section.
Open
the
program
cycle
OB
(OB1).
In
the
OB1,
carry
out
two
&quot;WRREC&quot;
instructions
for
transferring
the
data
record
to
the
respective
addressed
PROFINET
interface
of
both
the
CPUs.
You
can
find
an
example
program
for
the
OB1
in
the
next
section.
Result:
The
0xB071
data
record
was
transferred
to
the
PROFINET
interface
of
both
the
CPUs
addressed
in
each
case.
Programming
examples
for
the
OB72
and
OB1
organization
blocks
Open
the
OB72
that
has
been
added.
With
the
following
program
code,
determine
whether
the
R/H
system
has
assumed
the
&quot;Run
REDUNDANT&quot;
state
and
set
the
starting
command
for
the
&quot;WRREC&quot;
instructions:
//--------------------------------------------
//
Check
redundancy
state
and
set
&quot;snmpWrite&quot;
//--------------------------------------------
IF
#Fault_ID
=
B#16#03
OR
#Fault_ID
=
B#16#06
THEN
&quot;ActivateSnmp&quot;.snmpWrite := TRUE;
END_IF;
Open the program cycle OB (OB1). With the following program code, you can run 2 &quot;WRREC&quot;
instructions
for
transferring
the
data
record
to
the
respective
addressed
PROFINET
interface
of
both
the
CPUs:
//-----------------------------------------
//
Start
writing
SNMP
settings
//-----------------------------------------
IF
&quot;ActivateSnmp&quot;.snmpWrite
THEN
IF
(NOT
&quot;ActivateSnmp&quot;.plcLeft.snmpWrDone)
AND
(NOT
&quot;ActivateSnmp&quot;.plcLeft.snmpWrError)
THEN
// write SNMP settings for the left PLC
&quot;instWrrec_1&quot;(REQ := &quot;ActivateSnmp&quot;.snmpWrite,
ID
:=
&quot;Local1~PROFINET_interface_1&quot;,
INDEX
:=
16#B071,
DONE => &quot;ActivateSnmp&quot;.plcLeft.snmpWrDone,
ERROR => &quot;ActivateSnmp&quot;.plcLeft.snmpWrError,
STATUS => &quot;ActivateSnmp&quot;.plcLeft.snmpWrStatus,
RECORD
:=
&quot;ActivateSnmp&quot;.snmpRecord);
END_IF;
IF
&quot;ActivateSnmp&quot;.plcLeft.snmpWrError
THEN
; // add error handling for left plc
END_IF;
IF
(NOT
&quot;ActivateSnmp&quot;.plcRight.snmpWrDone)
AND
(NOT
&quot;ActivateSnmp&quot;.plcRight.snmpWrError)
THEN
// write SNMP settings for the right PLC
&quot;instWrrec_2&quot;(REQ := &quot;ActivateSnmp&quot;.snmpWrite,
ID
:=
&quot;Local2~PROFINET_interface_1&quot;,
INDEX
:=
16#B071,
DONE => &quot;ActivateSnmp&quot;.plcRight.snmpWrDone,
ERROR => &quot;ActivateSnmp&quot;.plcRight.snmpWrError,
STATUS
=>
&quot;ActivateSnmp&quot;.plcRight.snmpWrStatus,
RECORD := &quot;ActivateSnmp&quot;.snmpRecord);
END_IF;
Communication
Function
Manual,
11/2024,
A5E03735815-AM
125
Communications
services
SNMP
IF
&quot;ActivateSnmp&quot;.plcRight.snmpWrError
THEN
; // add error handling for right plc
END_IF;
IF
&quot;ActivateSnmp&quot;.plcLeft.snmpWrDone
AND &quot;ActivateSnmp&quot;.plcRight.snmpWrDone THEN
&quot;ActivateSnmp&quot;.snmpWrite
:=
FALSE;
END_IF;
END_IF;
Deactivating
SNMP
again
You
can
use
the
program
code
used
above,
with
small
changes,
to
deactivate
SNMP.
Assign
the
value
&quot;0&quot;
to
the
tag
&quot;ActivateSnmp&quot;.snmpRecord.snmpControl
in
the
user
program:
&quot;ActivateSnmp&quot;.snmpRecord.snmpControl
:=
0;
The
next
time
the
&quot;WRREC&quot;
instructions
are
called,
SNMP
will
be
deactivated
again.
126
Communication
Function
Manual,
11/2024,
A5E03735815-AM
PG
communication
6
Properties
Using
PG
communication,
the
CPU
or
another
module
capable
of
communication
exchanges
data with an engineering station (for example PG, PC). The data exchange is possible via
PROFIBUS
and
PROFINET
subnets.
The
gateway
between
S7
subnets
is
also
supported.
PG
communication
provides
functions
needed
to
load
programs
and
configuration
data,
run
tests, and evaluate diagnostic information. These functions are integrated in the operating
system
of
the
module
capable
of
communication.
NOTE
As
of
TIA
Portal
version
V17,
the
TLS
(Transport
Layer
Security)
protocol
is
supported
for
programming device/HMI communication to secure the data exchange between
programming
device/PC
and
CPU
using
standardized
security
mechanisms.
For
more
information,
refer
to
the
following
sections:
(Page
77)
Requirements
for
secure
communication
(Page
107)
Secure
PG/HMI
communication
Requirements
The
PG/PC
is
physically
connected
to
the
communication-capable
module.
If the communication-capable module is to be reached via S7 routing, the hardware
configuration
has
to
be
loaded
in
the
participating
stations
(S7
router
and
end
point).
Procedure
for
connecting
online
You
must
establish
an
online
connection
to
the
CPU
for
the
programming
device
communication:
Select
the
CPU
in
the
project
tree
in
STEP
7.
Select
the
&quot;Online
>
Go
online&quot;
menu
command.
In
the
&quot;Go
online&quot;
dialog,
make
the
following
settings
for
your
online
connection:
Select
interface
type
(e.g.
PN/IE)
in
the
&quot;Type
of
PG/PC
interface&quot;
drop-down
list.
In
the
&quot;PG/PC
interface&quot;
drop-down
list,
select
the
PG/PC
interface
(e.g.
Ind.
Ethernet
card)
you
want
to
use
to
establish
the
online
connection.
Select
the
interface
or
the
S7
subnet
with
which
the
programming
device/PC
is
physically
connected
from
the
&quot;Connection
to
interface/subnet&quot;
drop-down
list.
If the communication-capable module can be reached via an S7 router (gateway),
select
the
S7
router
that
connects
the
subnets
in
question
from
the
&quot;1st
gateway&quot;
drop-
down
list.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
127
PG
communication
727581
138141
Figure
6-1
Setting
up
PG
communication
Click
&quot;Start
search&quot;.
All
devices
that
you
can
address
with
PG
communication
appear
shortly
thereafter
in
the
table
&quot;Compatible
devices
in
target
subnet&quot;.
In
the
&quot;Compatible
devices
in
target
subnet&quot;
table,
select
the
relevant
CPU
and
confirm
with
&quot;Go
online&quot;.
More
information
You
can
find
more
information
on
&quot;Go
online&quot;
in
the
STEP
7
online
help.
128
Communication
Function
Manual,
11/2024,
A5E03735815-AM
HMI
communication
7
Properties
Using HMI communication, one or more HMI devices (for example HMI Basic/Comfort/Mobile
Panel)
exchanges
data
with
a
CPU
for
operator
control
and
monitoring
with
via
the
PROFINET
or
PROFIBUS
DP
interface.
The
data
exchange
is
via
HMI
connections.
If
you
want
to
set
up
several
HMI
connections
to
a
CPU,
use
for
example:
The
PROFINET
and
PROFIBUS
DP
interfaces
of
the
CPU
CPs
and
CMs
with
the
relevant
interfaces
NOTE
As
of
TIA
Portal
version
V17,
the
TLS
(Transport
Layer
Security)
protocol
is
supported
for
programming device/HMI communication to secure the data exchange between
programming
device/PC
and
CPU
using
standardized
security
mechanisms.
For
more
information,
refer
to
the
following
sections:
(Page
77)
Requirements
for
secure
communication
(Page
107)
Secure
PG/HMI
communication
Procedure
for
setting
up
HMI
communication
As
soon
as
you
drag-and-drop
a
tag,
for
example
a
tag
from
a
global
data
block
into
an
HMI
screen
or
into
the
HMI
tag
table,
STEP
7
automatically
sets
up
an
HMI
connection.
Alternatively,
you
can
also
set
up
the
HMI
connection
yourself.
To
set
up
an
HMI
connection,
follow
these
steps.
Configure
the
HMI
device
in
an
existing
configuration
with
a
CPU
in
the
network
view
of
the
Devices
&
networks
editor
of
STEP
7.
Select
the
&quot;Connections&quot;
button
and
then
&quot;HMI
connection&quot;
from
the
drop-down
list.
Drag-and-drop
a
line
between
the
end
points
of
the
connection
(HMI
device
and
CPU).
The
end points are highlighted in color. If the required S7 subnet does not yet exist, it is
created
automatically.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
129
HMI
communication
In
the
&quot;Connections&quot;
tab,
select
the
row
of
the
HMI
connection.
In
the
&quot;General&quot;
area
of
the
&quot;Properties&quot;
tab,
you
see
the
properties
of
the
HMI
connection,
some
of
which
you
can
change.
721359
154178
Figure
7-1
Setting
up
HMI
communication
Download
the
hardware
configuration
to
the
CPU.
Download
the
hardware
configuration
to
the
HMI
device.
More
information
401).
(Page
You
can
find
information
on
S7
routing
for
HMI
connections
in
the
section
S7
Routing
You
can
find
more
information
on
setting
up
HMI
connections
in
the
STEP
7
online
help.
130
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
8
Overview
of
Open
User
Communication
Features
of
Open
User
Communication
Through
Open
User
Communication,
also
called
&quot;open
communication&quot;,
the
CPU
exchanges
data with another device capable of communication. Open User Communication has the
following
features
and
characteristics:
Open
standard
(communication
partners
can
be
two
SIMATIC
CPUs
or
a
SIMATIC
CPU
and
a
suitable
third-party
device).
Communication
via
various
protocols
(in
STEP
7
known
as
&quot;Connection
types&quot;)
High degree of flexibility in terms of the data structures transferred; this allows open data
exchange
with
any
communications
devices
as
long
as
these
support
the
connection
types
available.
Secure Communication: To protect your automation system, you can exchange data
securely over Open User Communication. With Secure Open User Communication, the
data
is
sent
signed
and
encrypted,
see
also
Secure
Open
User
Communication
(Page
90).
Open
User
Communication
is
possible
in
various
automation
systems,
see
technical
specifications
of
the
respective
manuals.
Examples:
Integrated
PROFINET
/
Ind.
Ethernet
interfaces
of
CPUs
(S7-1500,
ET
200SP
CPU,
S7-1500
Software
Controller,
CPUs
1513/1516pro
2
PN)
PROFINET
/
Ind.
Ethernet
interfaces
of
communications
modules
(for
example
CP
1543‑1,
CM
1542-1,
CP
1543SP-1)
Information
on
Secure
Open
User
Communication
is
available
in
the
section
Secure
Communication
(Page
52).
Information
on
S7‑1500R/H
You
can
find
information
on
Open
User
Communication
with
the
S7‑1500R/H
redundant
system
in
section
Communication
with
the
redundant
system
S7-1500R/H
(Page
433).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
131
Open
User
Communication
Protocols
for
Open
User
Communication
8.2
Protocols
for
Open
User
Communication
Protocols
for
Open
User
Communication
The
following
protocols
are
available
for
open
communication:
Table
8-1
Transport
protocols
for
open
communication
Transport
protocol
Via
interface
TCP
according
to
RFC
793
PROFINET/Industrial
Ethernet
ISO-on-TCP
according to RFC 1006 (Class
4)
PROFINET/Industrial
Ethernet
ISO
according
to
ISO/IEC
8073
Industrial
Ethernet
(only
CP
1543‑1)
UDP
according
to
RFC
768
PROFINET/Industrial
Ethernet
FDL
PROFIBUS
Table
8-2
Application
protocols
for
open
communication
Application
protocol
Used
transport
protocol
Modbus
TCP
TCP
according
to
RFC
793
E-mail
TCP
according
to
RFC
793
FTP
TCP
according
to
RFC
793
TCP,
ISO‑on‑TCP,
ISO,
UDP
Prior to data transfer, these protocols (except UDP) establish a transport connection to the
communication
partner.
Connection-oriented
protocols
are
used
when
potential
loss
of
data
needs
to
be
avoided.
The
following
is
possible
with
UDP:
Unicast
to
one
device
or
broadcast
to
all
devices
on
PROFINET
via
the
PROFINET
interface
of
the
CPU
or
the
Industrial
Ethernet
interface
of
the
CP
1543‑1
Multicast
to
all
receivers
of
a
multicast
group
via
the
PROFINET
interface
of
the
CPU
or
the
PROFINET/Industrial
Ethernet
interface
of
the
CP
1543‑1
Maximum
number
of
supported
multicast
groups
and
maximum
user
data
lengths:
See
technical
specifications
of
the
respective
Equipment
Manuals.
132
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
Protocols
for
Open
User
Communication
Protocol
for
communication
via
PROFIBUS:
FDL
Data
transfer
via
an
FDL
connection
(Fieldbus
Data
Link)
is
suitable
for
the
transfer
of
related
blocks of data to a communication partner on PROFIBUS that supports the sending and
receiving
of
data
according
to
the
FDL
service
SDA
(Send
Data
with
Acknowledge)
according
to EN 50170, Vol 2. Both partners have the same rights; in other words, each partner can
initiate
sending
and
receiving
event-driven.
In
keeping
with
the
FDL
service
SDN
(Send
Data
with
No
Acknowledge)
according
to
EN
50170,
Vol
2,
the
following
is
possible
with
FDL:
Broadcast
to
all
devices
on
PROFIBUS
via
the
PROFIBUS
interface
of
the
CM
1542‑5
Multicast
to
all
recipients
of
a
multicast
group
via
the
PROFIBUS
interface
of
the
CM
1542‑5
Modbus
TCP
The Modbus protocol is a communication protocol with linear topology based on a
master/slave
architecture.
In
the
Modbus
TCP
(Transmission
Control
Protocol),
the
data
is
transmitted
as
TCP/IP
packets.
Communication
is
controlled
solely
by
suitable
instructions
in
the
user
program.
E-mail
and
FTP
You
can
use
email
to
send
for
example,
data
block
contents
(e.g.
process
data)
as
an
attachment.
You
can
use
the
FTP
connection
(FTP
=
File
Transfer
Protocol)
to
transmit
files
to
and
from
S7
devices.
The
communication
is
controlled
by
instructions
in
the
user
program
at
the
client
end.
Application
example:
MQTT
Publisher
for
the
SIMATIC
S7-1500
CPU
The
&quot;Message
Queue
Telemetry
Transport&quot;
(MQTT)
is
a
simple
protocol
on
the
TCP/IP
level.
It
is suitable for the exchange of messages between devices with lower functionality and for
the
transfer
via
unreliable
networks.
The
application
example
provides
a
function
block
with
which
you
can
implement
the
MQTT
protocol
into
the
SIMATIC
S7-1500.
You
can
find
the
application
example
on
the
Internet
(
https://support.industry.siemens.com/cs/ww/en/view/109772284
).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
133
Open
User
Communication
Instructions
for
Open
User
Communication
See
also
SYSLOG
(
https://support.industry.siemens.com/cs/ww/en/view/51929235
)
Instructions
for
Open
User
Communication
Introduction
You
set
up
Open
User
Communication
via
the
corresponding
connection
(for
example,
TCP
connection)
as
follows:
By
programming
in
the
user
programs
of
the
communications
partners
or
By configuring the connection in STEP 7 in the hardware and network editor
Regardless
of
whether
you
set
up
the
connection
by
programming
or
configuring,
instructions
are
always
required
in
the
user
programs
of
both
communications
partners
for
sending
and
receiving
the
data.
Setting
up
the
connection
via
the
user
program
If
the
connection
is
set
up
by
programming,
the
connection
establishment
and
termination
is
implemented
using
instructions
in
the
user
program.
In
certain
application
areas,
it
is
advantageous
not
to
set
up
the
communication
connections
statically via hardware configuration, but via the user program instead. You can set up the
connections
via
a
specific
application
program-controlled
and
therefore
when
necessary.
Programmed
connection
setup
also
allows
connection
resources
to
be
released
following
data
transfer.
A data structure is necessary for each communications connection that contains the
parameters
for
establishing
the
connection
(for
example
system
data
type
&quot;TCON_IP_v4&quot;
for
TCP).
The
system
data
types
(SDT)
are
provided
by
the
system
and
have
a
predefined
structure
that
cannot
be
changed.
The
various
protocols
have
their
own
data
structures
(see
table
below).
The
parameters
are
stored in a data block (&quot;connection description DB&quot;) for example of the system data type
TCON_IP_v4.
There
are
two
ways
in
which
you
can
specify
the
DB
with
the
data
structure:
Recommendation: Have the data block created automatically in the properties in the
program
editor
during
parameter
assignment
of
the
connection
for
the
TSEND_C,
TRCV_C
and
TCON
instructions.
Create
the
data
block
manually,
assign
parameters
to
it
and
write
it
directly
to
the
instruction
Necessary
for:
Secure
OUC
Connection
over
DNS
E-mail
FTP
134
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
8.3
Instructions
for
Open
User
Communication
You
can
modify
the
connection
parameters
in
the
&quot;connection
description
DB&quot;.
This FAQ (
https://support.industry.siemens.com/cs/ww/en/view/58875807
)
describes how to
program
the
TCON
instruction
to
set
up
a
connection
for
Open
User
Communication
between
two
S7-1500
CPUs.
Protocols,
system
data
types
and
employable
instructions
for
programmed
setup
The
following
table
shows
the
protocols
of
the
Open
User
Communication
and
the
matching
system
data
types
and
instructions.
Table
8-3
Instructions
for
programmed
setup
of
the
connection
Protocol
System
data
type
Instructions
TCP
TCON_QDN
TCON_IP_v4
Establish
connection
and
send/receive
data
via:
TSEND_C/TRCV_C
or
TCON,
TSEND/TRCV
or
TCON, TUSEND/TURCV
(connection
can
be
terminated
via
TDISCON)
ISO-on-TCP
TCON_IP_RFC
ISO
according
to
ISO/IEC
8073
(Class
4)
TCON_ISOnative
1
TCON_Configured
UDP
TCON_IP_v4
TADDR_Param
TADDR_SEND_QDN
TADDR_RCV_IP
Establish
connection
and
send/receive
data
via:
TSEND_C/TRCV_C
TUSEND/TURCV/TRCV
(connection
can
be
terminated
via
TDISCON)
FDL
1
TCON_FDL
Establish
connection
and
send/receive
data
via:
TSEND_C/TRCV_C
or
TCON,
TSEND/TRCV
or
TCON, TUSEND/TURCV
(connection
can
be
terminated
via
TDISCON)
Modbus
TCP
TCON_IP_v4
TCON_QDN
TCON_Configured
MB_CLIENT
MB_SERVER
Email
TMAIL_v4
TMAIL_v6
TMAIL_FQDN
TMAIL_C
FTP
2
FTP_CONNECT_IPV4
3
FTP_CONNECT_IPV6
3
FTP_CONNECT_NAME
3
FTP_CMD
1
This
protocol
can
only
be
used
with
the
CM
1542‑5
2
This
protocol
can
only
be
used
with
the
CP
1543-1
3
User-defined
data
type
Communication
Function
Manual,
11/2024,
A5E03735815-AM
135
Open
User
Communication
Instructions
for
Open
User
Communication
The
following
table
shows
you
the
different
connections
of
the
Secure
Open
User
Communication
and
the
matching
system
data
types
and
instructions.
Secure
OUC
connection
System
data
type
Instructions
Secure
TCP
connection
from
an
S7-1500 CPU as TLS client to a
third-party PLC (TLS server)
Secure
TCP
connection
from
an
S7-1500
CPU
as
TLS
server
to
a
third-party
PLC
(TLS
client)
TCON_QDN_SEC
TSEND_C/TRCV_C
TCON,
TSEND/TRCV
Secure
TCP
connection
between
two
S7-1500
stations
TCON_IP_V4_SEC
1
Secure
connection
to
a
mail
server
2
TMAIL_V4_SEC
TMAIL_QDN_SEC
TMAIL_C
(V5.0
or
higher)
Secure
Modbus
TCP
connection
TCON_IP_V4_SEC
1
MB_Client
MB_Server
TCON_QDN_SEC
1
Also
possible
for
CP
1543‑1
2
Secure
connection
to
a
mail
server
also
possible
with
CP1543‑1
und
TMAIL_C
(V4.0)
Setting
up
the
connection
with
connection
configuration
When
setting
up
through
the
configuration
of
the
connection,
the
address
parameters
of
the
connection
are
specified
in
the
hardware
and
network
editor
of
STEP
7.
To
send
and
receive
the
data,
use
the
same
instructions
as
when
the
connections
are
set
up
by
programming:
Table
8-4
Instructions
for
sending/receiving
with
configured
connections
Protocol
Send/receive
with
configured
connections
Supported
instructions:
TCP
Send/receive
data
via:
TSEND_C/TRCV_C
or
TSEND/TRCV
or
TUSEND/TURCV
ISO-on-TCP
ISO
according
to
ISO/IEC
8073
(Class
4)
UDP
Send/receive
data
via:
TSEND_C/TRCV_C
or
TUSEND/TURCV
FDL
Send/receive
data
via:
TSEND_C/TRCV_C
or
TSEND/TRCV
or
TUSEND/TURCV
Modbus TCP
Not
supported
Email
Not
supported
FTP
Not
supported
136
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
Instructions
for
Open
User
Communication
Additional
instructions
for
open
communication
You
can
use
the
following
instructions
for
connections
set
up
in
the
user
program
as
well
as
for
configured
connections:
T_RESET:
Terminating
and
establishing
a
connection
T_DIAG:
Check
the
connection
Basic
examples
for
Open
User
Communication
The
Siemens
Online
Support
offers
you
function
blocks
(FBs)
that
facilitate
the
handling
of
the instructions of the Open User Communication. You can find the function block with
corresponding
examples
on
the
Internet
(
https://support.industry.siemens.com/cs/ww/en/view/109747710
).
More
information
The
STEP
7
online
help
describes:
The
user
and
system
data
types
The
instructions
for
open
communication
The
connection
parameters
You
will
find
information
about
the
allocation
and
release
of
connection
resources
in
the
section
Allocation
of
connection
resources
(Page
421).
Information
about
the
Secure
Open
User
Communication
is
available
in
the
section
Secure
Open
User
Communication
(Page
90).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
137
Open
User
Communication
Open
User
Communication
with
addressing
via
domain
names
Open
User
Communication
with
addressing
via
domain
names
As
of
firmware
version
V2.0,
S7‑1500
CPUs,
ET
200SP
CPUs
and
the
CPUs
1513/1516pro‑2
PN
support Open User Communication with addressing via Domain Name System (DNS). A DNS
client
is
integrated
in
the
CPU.
In
the
case
of
communication
via
DNS,
you
use
domain
names
as an alias for IP addresses to address communication partners. Addressing of the
communication partners via domain names is possible for open communication via TCP and
UDP.
At
least
one
DNS
server
must
be
located
in
your
network
as
a
requirement
for
communication
via
DNS.
The
S7‑1500
software
controller
supports
communication
via
DNS
for
all
interfaces
that
are
assigned
to
the
software
controller.
Setting
up
communication
via
DNS
The
DNS
client
of
the
CPU
must
know
the
IPv4
address
of
at
least
one
DNS
server
so
that
a
CPU
can
establish
a
connection
to
a
communication
partner
via
its
domain
name.
The
CPU
supports
up
to
4
different
DNS
servers.
To
set
up
communication
via
domain
names
for
an
S7‑1500
CPU,
follow
these
steps:
Select
the
CPU
in
the
network
view
of
STEP
7.
In the Inspector window, navigate to &quot;Properties&quot; > &quot;General&quot; > &quot;Advanced configuration&quot; >
&quot;DNS
configuration&quot;.
Enter
the
IPv4
address
of
a
DNS
server
in
the
&quot;DNS
server
addresses&quot;
column
of
the
&quot;Server
list&quot;
table.
You
can
enter
up
to
4
IPv4
addresses
of
DNS
servers.
719962
151183
Figure
8-1
Entering
DNS
server
addresses
using
a
CPU
1516‑3
PN/DP
as
an
example
138
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
Open
User
Communication
with
addressing
via
domain
names
Setting
up
a
TCP
connection
via
the
domain
name
of
the
communication
partner
For TCP communication via the domain name you need to create a data block with the
TCON_QDN
system
data
type
yourself,
assign
parameters
and
call
it
directly
at
the
instruction.
The
TCON,
TSEND_C
and
TRCV_C
instructions
support
the
system
data
type
TCON_QDN:
To
set
up
a
TCP
connection
via
the
domain
name
of
the
communication
partner,
follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
Define
a
tag
of
the
data
type
TCON_QDN
in
the
global
data
block.
The
example
below
shows
the
global
data
block
&quot;Data_block_1&quot;
in
which
the
tag
&quot;DNS
Connection1&quot;
of
data
type
TCON_QDN
is
defined.
900049
156225
Figure
8-2
Data
type
TCON_QDN
Program
the
parameters
of
the
TCP
connection
(for
example
the
fully
qualified
domain
name
(FQDN))
in
the
tag
of
data
type
TCON_QDN.
Create
a
TCON
instruction
in
the
program
editor.
Interconnect
the
CONNECT
parameter
of
the
TCON
instruction
with
the
tag
of
the
data
type
TCON_QDN.
In
the
example
below,
the
CONNECT
parameter
of
the
TCON
instruction
is
interconnected
with
the
tag
&quot;DNS
connection1&quot;
(data
type
TCON_QDN).
Figure
8-3
TCON
instruction
Communication
Function
Manual,
11/2024,
A5E03735815-AM
139
Open
User
Communication
Setting
up
Open
User
Communication
via
TCP,
ISO-on-TCP,
UDP
and
ISO
Addressing
a
UDP
connection
via
the
domain
name
of
the
communication
partner
For S7-1500 CPUs as of firmware version V2.0, you can address the recipient with its fully
qualified
domain
name
(FQDN)
when
sending
data
via
UDP.
With
the
instruction
TUSEND
at
the
parameter
ADDR,
you
hereby
reference
a
structure
of
the
type
TADDR_SEND_QDN.
The receiver can return an IPv4 or an IPv6 address. With the TURCV instruction at the ADDR
parameter,
you
therefore
reference
a
structure
of
the
TADDR_RCV_IP
type.
Only
this
structure
can
include
both
IP
address
types.
NOTE
Network
load
In
contrast
to
the
TCP
the
UDP
protocol
does
not
work
connection-oriented.
For
every
edge
at
the block parameter REQ, the TUSEND or TURCV command performs queries of the DNS
server.
This
can
lead
to
high
network
load
or
load
on
the
DNS
server.
Additional
information
You
can
find
more
information
about
the
system
data
types
TCON_QDN,
TADDR_SEND_QDN
and
TADDR_RCV_IP
in
the
STEP
7
online
help.
How
to
set
up
a
secure
TCP
connection
via
the
domain
name
of
the
communication
partner
is
described
in
the
section
Secure
Open
User
Communication
(Page
90).
Setting
up
Open
User
Communication
via
TCP,
ISO-on-TCP,
UDP
and
ISO
Configuring
a
connection
for
the
TSEND_C,
TRCV_C
or
TCON
instructions
Requirement:
A
TSEND_C,
TRCV_C
or
TCON
instruction
is
created
in
the
programming
editor.
Select
a
TCON,
TSEND_C
or
TRCV_C
block
of
Open
User
Communication
in
the
program
editor.
Open
the
&quot;Properties
>
Configuration&quot;
tab
in
the
inspector
window.
Select
the
&quot;Connection
parameters&quot;
group.
Until
you
select
a
connection
partner,
only
the
empty drop-down list for the partner end point is enabled. All other input options are
disabled.
The
connection
parameters
already
known
are
displayed:
Name
of
the
local
end
point
Interface
of
the
local
end
point
140
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
8.5
Setting
up
Open
User
Communication
via
TCP,
ISO-on-TCP,
UDP
and
ISO
–
IPv4
address
of
the
local
end
point
1082421
150012
Figure
8-4
Connection
parameters
for
TSEND_C
In the drop-down list box of the partner end point, select a connection partner. You can
select
an
unspecified
device
or
a
CPU
in
the
project
as
the
communication
partner.
Certain
connection
parameters
are
then
entered
automatically.
The
following
parameters
are
set:
Name
of
the
partner
end
point
Interface
of
the
partner
end
point
IPv4
address
of
the
partner
end
point
If
the
connection
partners
are
networked,
the
name
of
the
subnet
is
displayed.
In
the
&quot;Configuration
type&quot;
drop-down
list,
select
between
using
program
blocks
or
configured
connections.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
141
Open
User
Communication
8.5
Setting
up
Open
User
Communication
via
TCP,
ISO-on-TCP,
UDP
and
ISO
Select
an
existing
connection
description
DB
in
the
&quot;Connection
data&quot;
drop-down
list
or
for
configured connections select an existing connection under &quot;Connection name&quot;. You can
also create a new connection description DB or a new configured connection. Later, you
can still select other connection description DBs or configured connections or change the
names
of
the
connection
description
DBs
in
order
to
create
new
data
blocks:
You
can
also
see
the
selected
data
block
at
the
interconnection
of
the
CONNECT
input
parameter
of
the
selected
TCON,
TSEND_C
or
TRCV_C
instruction.
If you have already specified a connection description DB for the connection partner
using
the
CONNECT
parameter
of
the
TCON,
TSEND_C
or
TRCV_C
instruction,
you
can
either
use
this
DB
or
create
a
new
DB.
If
you
edit
the
name
of
the
displayed
data
block
in
the
drop-down
list,
a
new
data
block
with
the changed
name
but
with
the same structure
and
content
is
generated and
used
for
the
connection.
Changed
names
of
a
data
block
must
be
unique
in
the
context
of
the
communication
partner.
A
connection
description
DB
must
have
the
structure
TCON_Param,
TCON_IP_v4
or
TCON_IP_RFC,
depending
on
CPU
type
and
connection.
A
data
block
cannot
be
selected
for
an
unspecified
partner.
Additional
values
are
determined
and
entered
after
the
selection
or
creation
of
the
connection
description
DB
or
configured
connection.
The
following
is
valid
for
specified
connection
partners:
ISO-on-TCP
connection
type
Connection
ID
with
default
of
1
Active
connection
establishment
by
local
partner
TSAP
ID
for
S7-1200/1500:
E0.01.49.53.4F.6F.6E.54.43.50.2D.31
The
following
is
valid
for
unspecified
connection
partners:
TCP
connection
type
Partner
port
2000
The
following
applies
for
a
configured
connection
with
a
specified
connection
partner:
TCP
connection
type
Connection
ID
with
default
of
257
Active
connection
establishment
by
local
partner
Partner
port
2000
The
following
applies
for
a
configured
connection
with
an
unspecified
connection
partner:
TCP
connection
type
Local
port
2000
142
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
8.5
Setting
up
Open
User
Communication
via
TCP,
ISO-on-TCP,
UDP
and
ISO
Enter
a
connection
ID
as
needed
for
the
connection
partner.
No
connection
ID
can
be
assigned
to
an
unspecified
partner.
NOTE
You must enter a unique value for the connection ID at a known connection partner. The
uniqueness
of
the
connection
ID
is
not
checked
by
the
connection
parameter
settings
and
there is no default value entered for the connection ID when you create a new
connection.
Select
the
desired
connection
type
in
the
relevant
drop-down
list.
Default
values
are
set
for
the
address
details
depending
on
the
connection
type.
You
can
choose
between
the
following:
TCP
ISO-on-TCP
UDP
ISO
(only
with
Configuration
mode
&quot;Use
configured
connection&quot;)
You
can
edit
the
input
boxes
in
the
address
details.
Depending
on
the
selected
protocol,
you
can
edit
the
ports
(for
TCP
and
UDP)
or
the
TSAPs
(for
ISO-on-TCP
and
ISO).
Use
the
&quot;Active
connection
establishment&quot;
check
box
to
set
the
connection
establishment
characteristics
for
TCP,
ISO
and
ISO-on-TCP.
You
can
decide
which
communication
partner
establishes
the
connection
actively.
Changed
values
are
checked
immediately
for
input
errors
by
the
connection
configuration
and
entered
in
the
data
block
for
the
connection
description.
NOTE
Open User Communication between two communication partners can only work when the
program
section
for
the
partner
end
point
has
been
downloaded
to
the
hardware.
To
achieve
fully
functional
communication,
make
sure
that
you
load
not
only
the
connection
description
of
the
local
CPU
on
the
device
but
also
that
of
the
partner
CPU
as
well.
Configuring
connections,
e.g.
for
TSEND/TRCV
If
you
want
to
use
the
instructions
for
TSEND/TRCV
for
open
communication,
for
example,
you
first
need
to
configure
a
connection
(e.g.
TCP
connection).
To
configure
a
TCP
connection,
follow
these
steps:
Configure
the
communications
partners
in
the
network
view
of
the
Devices
&
networks
editor
of
STEP
7.
Click
the
&quot;Connections&quot;
button
and
select
the
&quot;TCP
connection&quot;
connection
type
from
the
drop-down
list.
Using drag-and-drop, connect the communication partner with each other (via an
interface
or
local
end
point).
If
the
required
S7
subnet
does
not
yet
exist,
it
is
created
automatically.
You
can
also
set
up
a
connection
to
unspecified
partners.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
143
Open
User
Communication
Setting
up
Open
User
Communication
via
TCP,
ISO-on-TCP,
UDP
and
ISO
Select
the
created
connection
in
the
network
view.
Set the properties of the connection in the &quot;Properties&quot; tab in the &quot;General&quot; area, for
example
the
name
of
the
connection
and
the
interfaces
of
the
communications
partner
that
will
be
used.
For
connections
to
an
unspecified
partner,
set
the
address
of
the
partner.
You
can
find
the
local
ID
(reference
of
the
connection
in
the
user
program)
in
the
&quot;Local
ID&quot;
area.
In
the
Project
tree,
select
the
&quot;Program
blocks&quot;
folder
for
one
of
the
CPUs
and
open
OB1
in
the
folder
by
double-clicking
on
it.
The
program
editor
opens.
Select
the
required
instruction
from
the
&quot;Instructions&quot;
task
card,
&quot;Communication&quot;
area,
&quot;Open
user
communication&quot;,
for
example
TSEND
and
drag
it
to
a
network
of
OB1.
At
the
ID
parameter
of
the
instruction,
assign
the
local
ID
of
the
configured
connection
to
be
used
for
the
transmission
of
data.
Interconnect
the
&quot;DATA&quot;
parameter
of
the
TSEND
instruction
with
the
user
data,
for
example
in
a
data
block.
Download
the
hardware
configuration
and
user
program
to
the
CPU.
Based
on
the
procedure
described
above,
set
up
the
connection
on
the
partner
CPU
with
the
instruction
for
receiving,
TRCV,
and
download
it
to
the
CPU.
Point
to
note
with
ISO
connections
with
CP
1543‑1
If
you
use
the
&quot;ISO
connection&quot;
connection
type,
you
will
need
to
select
the
&quot;Use
ISO
protocol&quot;
check
box
in
the
properties
of
the
CP
so
that
addressing
using
MAC
addresses
will
work.
1625472
128384
Figure
8-5
Select
CP
1543‑1
ISO
protocol
144
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
Setting
up
communication
over
FDL
Additional
information
The
STEP
7
online
help
describes:
The
instructions
for
open
communication
The
connection
parameters
This FAQ (
https://support.industry.siemens.com/cs/ww/en/view/109479564
)
describes how
the
instructions
TSEND_C
and
TRCV_C
behave
in
the
S7-1500.
Setting
up
communication
over
FDL
Requirements
Configuration
software:
STEP
7
Professional
V14
End point of the connection: CPU S7-1500 firmware version V2.0 or higher with
communication
module
CM
1542‑5
with
firmware
version
V2.0
Setting
up
a
configured
FDL
connection
Proceed
as
follows
to
set
up
a
configured
FDL
connection
in
STEP
7:
Create
a
TSEND_C
instruction
in
the
program
editor.
Select
the
TSEND_C
instruction
and
go
to
&quot;Properties&quot;
>
&quot;General&quot;
>
&quot;Connection
parameters&quot;
in
the
Inspector
window.
Under
End
point,
select
the
partner
end
point.
Use
one
of
the
two
partner
end
points
below:
–
CPU
S7‑1500
with
CM
1542‑5
Unspecified
Under
Configuration
type,
select
&quot;Use
configured
connection&quot;.
Under
Connection
type,
select
&quot;FDL&quot;.
Under Interface, select the
following interfaces:
Local:
PROFIBUS
interface
of
CM
1542‑5
Specified
partner:
PROFIBUS
interface
of
CM
1542‑5
Under
Connection
data,
select
the
setting
<new>.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
145
Open
User
Communication
Setting
up
communication
over
FDL
The
figure
below
shows
a
fully
configured
FDL
connection
in
STEP
7.
542925
150012
Figure
8-6
Configuring
the
FDL
connection
Setting
up
an
FDL
connection
in
the
user
program
For
communication
via
FDL,
you
need
to
create
the
data
block
of
the
TCON_FDL
system
data
type yourself in each case, assign parameters and call it directly at the instruction. Follow
these
steps:
Create
a
global
data
block
in
the
project
tree.
In
the
global
data
block,
define
a
tag
of
the
data
type
TCON_FDL.
The
example
below
shows
the
global
data
block
&quot;FDL_connection&quot;
in
which
the
tag
&quot;FDL_connection&quot;
of
the
data
type
TCON_FDL
is
defined.
719962
155953
Figure
8-7
Programming
an
FDL
connection
Program
the
parameters
of
the
FDL
connection
(e.g.
the
PROFIBUS
addresses)
in
the
tag
of
the
data
type
TCON_FDL.
Create
a
TCON
instruction
in
the
program
editor.
146
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
Setting
up
communication
with
Modbus
TCP
5.
Interconnect
the
CONNECT
parameter
of
the
TCON
instruction
with
the
tag
of
the
data
type
TCON_FDL.
In
the
example
below,
the
CONNECT
parameter
of
the
TCON
instruction
is
interconnected
with
the
tag
&quot;FDL_Connection&quot;
(data
type
TCON_FDL).
Figure
8-8
Example:
TCON
Instruction
for
FDL
connection
Setting
up
communication
with
Modbus
TCP
Setting
up
a
connection
for
Modbus
TCP
via
the
user
program
The
parameter
assignment
takes
place
in
the
program
editor
at
the
instruction
MB_CLIENT
or
MB_SERVER.
Procedure
for
setting
up
communication
using
Modbus
TCP
The
MB_CLIENT
instruction
communicates
as
a
Modbus
TCP
client
via
the
TCP
connection.
You establish a connection between the client and the server with the instruction, send
Modbus
requests
to
the
server
and
receive
the
corresponding
Modbus
responses.
You
also
control
the
setup
of
the
TCP
connection
with
this
instruction.
The
MB_SERVER
instruction
communicates
as
a
Modbus
TCP
server
via
the
TCP
connection.
The instruction processes connection requests of a Modbus client, receives and processes
Modbus
requests
and
sends
responses.
You
also
control
the
setup
of
the
TCP
connection.
Requirement:
The
client
can
reach
the
server
via
IP
communication
in
the
network.
Configure
an
S7‑1500
automation
system
with
CPU
in
the
network
view
of
the
Devices
&
networks
editor
of
STEP
7.
In
the
Project
tree,
select
the
&quot;Program
blocks&quot;
folder
and
open
OB1
in
the
folder
by
double-clicking
on
it.
The
program
editor
opens.
Select
the
required
instruction,
for
example
MB_CLIENT,
from
the
&quot;Instructions&quot;
task
card,
&quot;Communication&quot;
area,
&quot;Other&quot;,
&quot;MODBUS
TCP&quot;
and
drag
it
to
a
network
of
OB1.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
147
Open
User
Communication
Setting
up
communication
with
Modbus
TCP
Assign
the
parameters
of
the
MB_CLIENT
or
MB_SERVER
instruction.
Observe
the
following
rules:
An
IPv4
server
address
must
be
specified
for
each
MB_CLIENT
connection.
Each
MB_CLIENT
or
MB_SERVER
connection
must
use
a
unique
instance
DB
with
one
of
the
data
structures
TCON_IP_v4,
TCON_QDN
or
TCON_Configured.
Each
connection
requires
a
unique
connection
ID.
The
connection
ID
and
instance
DB
belong
together
in
pairs
and
must
be
unique
for
each
connection.
719962
240002
Figure
8-9
MB_CLIENT
725551
198238
Figure
8-10
MB_SERVER
Download
the
hardware
configuration
and
user
program
to
the
CPU.
148
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
Setting
up
communication
with
Modbus
TCP
Redundant
communication
over
Modbus
TCP
Assign
parameters
for
redundant
communication
via
Modbus
TCP
using
the
MB_RED_CLIENT
or
MB_RED_SERVER
instructions:
Instruction MB_RED_CLIENT You use the instruction &quot;MB_RED_CLIENT&quot; to establish a
redundant
connection
between
the
client
and
the
server,
send
Modbus
requests,
receive
responses
and
control
connection
termination
of
the
Modbus
TCP
client.
Instruction
MB_RED_SERVER
The
&quot;MB_RED_SERVER&quot;
instruction
processes
connection
requests
of a Modbus TCP client, receives and processes Modbus requests and sends responses. The
CPUs
can:
processing
multiple
server
connections
and
accepting
multiple
connections
from
different
clients
simultaneously
at
one
server
port.
For
more
information
on
the
MB_RED_CLIENT
or
MB_RED_SERVER
instructions,
refer
to
the
STEP
7
online
help.
Modbus
TCP
server
as
gateway
to
Modbus
RTU
If
you
use
a
Modbus
TCP
server
as
a
gateway
to
a
Modbus
RTU
protocol,
address
the
slave
device in the serial network using the static parameter, MB_UNIT_ID. The MB_UNIT_ID
parameter
corresponds
to
the
field
of
the
slave
address
in
the
Modbus
RTU
protocol.
The
MB_UNIT_ID
parameter
in
this
case
would
forward
the
request
to
the
correct
Modbus
RTU
slave
address.
You
do
not
have
to
program
the
gateway
function
yourself.
You
can
find
the
MB_UNIT_ID
parameter
in
the
instance
data
block
associated
with
MB_CLIENT
instruction.
You
can
find
more
information
on
the
MB_UNIT_ID
parameter
in
the
STEP
7
online
help.
Reference
This FAQ (
https://support.industry.siemens.com/cs/ww/en/view/94766380
)
describes how
to
program
and
configure
the
Modbus
TCP
communication
between
two
S7-1500
CPUs.
This FAQ (
https://support.industry.siemens.com/cs/ww/en/view/102020340
) describes
how
to
program
and
configure
Modbus
TCP
communication
between
an
S7-1500
CPU
and
an
S7-1200
CPU.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
149
Open
User
Communication
Setting
up
communication
via
e-mail
Setting
up
communication
via
e-mail
Setting
up
a
connection
for
e-mail
via
the
user
program
For
communication
using
e-mail,
you
need
to
create
the
data
block
of
the
relevant
system
data type yourself, assign parameters and call the instruction directly. This procedure is
introduced
below.
Procedure
for
setting
up
communication
using
e-mail
A
CPU
can
send
e-mails.
To
send
e-mails
from
the
user
program
of
the
CPU,
use
the
TMAIL_C
instruction.
Requirement:
The
SMTP
server
can
be
reached
via
the
IPv4
network.
Configure
an
S7‑1500
automation
system
with
CPU
in
the
network
view
of
the
Devices
&
networks
editor
of
STEP
7.
Assign
parameters
to
the
instruction
TMAIL_C,
for
example
enter
the
subject
of
the
e-mail
in
Subject.
In
a
global
data
block
create
a
variable
of
the
type
TMAIL_v4,
TMAIL_v6
(only
CP
1543‑1)
or
TMAIL_FQDN
(only
CP
1543‑1).
Set
the
connecting
parameters
of
the
TCP
connection
in
the
variable
in
the
&quot;Start
value&quot;
column. Enter the IPv4 address of the mail server, for example, for the
&quot;MailServerAddress&quot;
(for
TMAIL_v4)
NOTE
Connection
parameter
Interface
ID
Note
that
you
can
enter
the
value
&quot;
0
&quot;
for
the
interface
ID
with
instruction
version
V5.0
or
higher of the instruction TMAIL_C in the data type TMAIL_V4_SEC. In this case, the CPU
itself
searches
for
a
suitable
local
CPU
interface.
Interconnect
the
variable
to
the
MAIL_ADDR_PARAM
parameter
of
the
TMAIL_C
instruction.
Download
the
hardware
configuration
and
user
program
to
the
CPU.
Additional
information
The
STEP
7
online
help
describes:
The
system
data
types
The
instructions
for
open
communication
The
connection
parameters
150
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
Setting
up
communication
via
FTP
8.9
Setting
up
communication
via
FTP
Setting
up
a
connection
for
FTP
via
the
user
program
For communication via FTP, you need to create the data block of the relevant system data
type
yourself,
assign
parameters
and
call
the
instruction
directly.
This
procedure
is
introduced
below.
FTP
client
and
server
functionality
Files can be sent by a CPU to an FTP server and can be received from the FTP server.
Communication
with
FTP
is
only
possible
for
the
S7‑1500
using
the
CP
1543‑1.
The
CP
can
be
an
FTP
server,
FTP
client
or
both.
FTP
clients
can
also
be
third-party
systems/PCs.
For
the
FTP
server
functionality,
configure
the
CP
accordingly
in
STEP
7.
You can use the FTP client functionality to implement, for example, the establishment and
termination
of
an
FTP
connection,
the
transfer
and
deletion
of
files
on
the
server.
For
the
FTP
client
functionality,
use
the
FTP_CMD
instruction.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
151
Open
User
Communication
8.9
Setting
up
communication
via
FTP
Procedure
for
setting
up
FTP
server
functionality
Requirement:
The
FTP
server
can
be
reached
via
the
IPv4
network
.
Configure
an
S7‑1500
automation
system
with
CPU
and
CP
1543‑1
in
the
device
view
of
the
Devices
&
networks
editor
of
STEP
7.
At the same time, you need to select the option &quot;Permit access with PUT/GET
communication
from
remote
partner
(PLC,
HMI,
OPC,
...)&quot;
in
the
HW
configuration
of
the
S7-1500 CPU under the &quot;Protection&quot; area navigation in the section &quot;Connection
mechanisms&quot;.
Make
the
following
settings
in
the
properties
of
the
CP
under
&quot;FTP
configuration&quot;:
Select
the
&quot;Use
FTP
server
for
S7
CPU
data&quot;
check
box.
Assign
the
CPU,
a
data
block
and
a
file
name
under
which
the
DB
for
FTP
will
be
stored.
905763
150118
Figure
8-11
Setting
up
the
FTP
configuration
Download
the
hardware
configuration
to
the
CPU.
152
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Open
User
Communication
Setting
up
communication
via
FTP
Procedure
for
setting
up
FTP
client
functionality
Requirement:
The
FTP
server
can
be
reached
via
the
IPv4
network
.
Configure
an
S7‑1500
automation
system
with
CPU
and
CP
1543‑1
in
the
device
view
of
the
Devices
&
networks
editor
of
STEP
7.
At the same time, you need to select the check box &quot;Permit access with PUT/GET
communication
from
remote
partner
(PLC,
HMI,
OPC,
...)&quot;
in
the
HW
configuration
of
the
S7-1500 CPU under the &quot;Protection&quot; area navigation in the section &quot;Connection
mechanisms&quot;.
Call
the
FTP_CMD
instruction
in
the
user
program
of
the
CPU.
Set
the
connection
parameters
for
the
FTP
server
in
the
FTP_CMD
instruction.
Create
a
global
DB
and
within
this
DB
a
tag
of
the
type
FTP_CONNECT_IPV4,
FTP_CONNECT_IPV6
or
FTP_CONNECT_NAME.
Interconnect
the
tag
within
the
data
block
with
the
FTP_CMD
instruction.
For
the
connection
to
the
FTP
server,
specify
the
following
in
the
DB:
–
The
user
name,
the
password
and
the
IP
address
for
the
FTP
access
in
the
relevant
data
type
(FTP_CONNECT_IPV4,
FTP_CONNECT_IPV6
or
FTP_CONNECT_NAME)
Download
the
hardware
configuration
and
user
program
to
the
CPU.
Application
examples
Application example: FTP communication with S7-1500 and CP 1543-1
You
can
find
the
application
example
on
the
Internet
(
https://support.industry.siemens.com/cs/ww/en/view/103550797
).
Application example: FTP client communication with S7-1200/1500
You
can
find
the
application
example
on
the
Internet
(
https://support.industry.siemens.com/cs/ww/en/view/81367009
).
Additional
information
The
STEP
7
online
help
describes:
The
system
data
types
The
instructions
for
open
communication
The
connection
parameters
Communication
Function
Manual,
11/2024,
A5E03735815-AM
153
Open
User
Communication
Establishment
and
termination
of
communications
relations
8.10
Establishment
and
termination
of
communications
relations
Establishment
and
termination
of
communications
The
table
below
shows
the
establishment
and
termination
of
communications
as
part
of
open
communication.
Table
8-5
Establishment
and
termination
of
communications
Setting
up
the
connection
Establishing
communication
Terminating
communication
With
the
user
program
After
downloading
the
user
program
to
the
CPUs:
The passive communications partner sets up
the local connection access by calling
TSEND_C/TRCV_C or TCON. Calling
TSEND_C/TRCV_C
or
TCON
on
the
active
part-
ner starts connection establishment. If the
connection
could
be
established,
there
is
pos-
itive feedback to the instructions in the user
program.
After
you
have
terminated
a
connection
using
the instruction T_RESET, the connection is
reestablished.
If the connection aborts, the active partner
attempts to re-establish the connection. This
applies
only
if
the
connection
was
successfully
established
beforehand
with
TCON.
Using
the
TSEND_C/TRCV_C,
TDISCON
and
T_RESET
instructions
When
the
CPU
changes
from
RUN
to
STOP
mode
With
POWER
OFF/POWER
ON
on
a
CPU
By
configuring
a
connection
After
downloading
the
connection
configura-
tion
and
the
user
program
to
the
CPUs.
By deleting the connection configuration in
STEP
7
and
downloading
the
changed
config-
uration
to
the
CPU.
154
Communication
Function
Manual,
11/2024,
A5E03735815-AM
S7
communication
9
Characteristics
of
S7
communication
S7 communication as homogeneous SIMATIC communication is characterized by vendor-
specific
communication
between
SIMATIC
CPUs
(not
an
open
standard).
S7
communication
is
used
for
migration
and
for
connecting
to
existing
systems
(S7‑300,
S7‑400).
For data transfer between two S7‑1500 automation systems, we recommend that you use
open
communication
(see
section
Open
User
Communication
(Page
131)).
Properties
of
S7
communication
Using S7 communication, the CPU exchanges data with another CPU. Once the user has
received
the
data
at
the
receiver
end,
the
reception
data
is
automatically
acknowledged
to
the
sending
CPU.
The
data
is
exchanged
via
configured
S7
connections.
S7
connections
can
be
configured
at
one
end
or
at
both
ends.
S7
communication
is
possible
via:
Integrated
PROFINET
or
PROFIBUS
DP
interface
of
a
CPU
Interface
of
a
CP/CM
S7
connections
configured
at
one
end
For
an
S7
connection
configured
at
one
end,
the
configuration
for
this
connection
takes
place
in
only
one
communication
partner
and
is
only
downloaded
to
it.
A one-sided S7 connection can be configured to a CPU that is only a server of an S7
connection
(e.g.
CPU
315-2
DP).
The
CPU
is
configured
and
the
address
parameters
and
interfaces
are
thus
known.
In addition, a one-sided S7 connection can be configured to a partner who is not in the
project
and
whose
address
parameters
and
interface
and
therefore
are
not
known.
You
need
to enter the address; it is not checked by STEP 7. The partner is initially unspecified (no
partner address is registered when you create the S7 connection). Once you enter the
address,
it
is
&quot;unknown&quot;
(i.e.
it
is
named,
but
the
project
is
unknown).
This makes it possible to use S7 connections beyond the boundaries of a project. The
communication
partner
is
unknown
to
the
local
project
(unspecified)
and
is
configured
in
another
STEP
7
or
third-party
project.
S7
connections
configured
at
both
ends
When
an
S7
connection
is
configured
at
both
ends,
the
configuration
and
download
of
the
configured
S7
connection
parameters
takes
place
in
both
communication
partners.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
155
S7
communication
Instructions
for
S7
communication
For S7
communication
with
S7‑1500, the following
instructions can be used:
PUT/GET
You write data to a remote CPU with the PUT instruction. You can use the GET instruction
to read data from a remote CPU. The PUT and GET instructions and are one-sided
instructions, i.e. you need only an instruction in one communication partner. You can can
easily
set
up
the
PUT
and
GET
instructions
via
the
connection
configuration.
NOTE
Data
blocks
for
PUT/GET
instructions
When
using
the
PUT/GET
instructions,
you
can
only
use
data
blocks
with
absolute
addressing.
Symbolic
addressing
of
data
blocks
is
not
possible.
You
must
also
enable
this
service
for
protection
in
the
CPU
configuration
in
the
&quot;Protection&quot;
area.
This FAQ (
https://support.industry.siemens.com/cs/ww/en/view/82212115
) provides
information
about
how
to
configure
and
program
an
S7
instruction
and
the
GET
and
PUT
communication
instructions
for
data
exchange
between
two
S7-1500
CPUs.
BSEND/BRCV
The BSEND instruction sends data to a remote partner instruction of the type BRCV. The
BRCV instruction receives data from a remote partner instruction of the type BSEND. You
use
the
S7
communication
via
the
BSEND/BRCV
instruction
pair
for
secure
transmission
of
data.
USEND/URCV
The USEND instruction sends data to a remote partner instruction of the type URCV. The
URCV
instruction
receives
data
from
a
remote
partner
instruction
of
the
type
USEND.
You
use the S7 communication via the USEND/URCV instruction pair for fast, non-secure
transmission of data regardless of the timing of the processing by the communications
partner;
for
example
for
operating
and
maintenance
messages.
156
Communication
Function
Manual,
11/2024,
A5E03735815-AM
S7
communication
S7
communication
via
PROFIBUS
DP
interface
in
slave
mode
You
can
find
the
&quot;Test,
commissioning,
routing&quot;
check
box
in
STEP
7
in
the
properties
of
the
PROFIBUS
DP
interface
of
communications
modules
(e.g.
CM
1542‑5).
Using
this
check
box,
you
decide
whether
the
PROFIBUS
DP
interface
of
the
DP
slave
is
an
active
or
passive
device
on
PROFIBUS.
Check
box
selected:
The
slave
is
an
active
device
on
PROFIBUS.
Check
box
cleared:
The
DP
slave
is
a
passive
device
on
PROFIBUS.
You
can
only
set
up
S7
connections
configured
at
one
end
for
this
DP
slave.
900049
154713
Figure
9-1
&quot;Test,
commissioning,
routing&quot;
check
box
Configuring
S7
connections
for
PUT/GET
instructions
You can create S7 connections and assign the parameters for these in the connection
parameter
assignment
of
the
PUT/GET
instructions.
Changed
values
are
checked
immediately
by
the
connection
parameter
assignment
for
input
errors.
Requirement: A PUT or GET instruction is created in the programming editor.
To
configure
an
S7
connection
using
PUT/GET
instructions,
follow
these
steps:
In
the
program
editor,
select
the
call
of
the
PUT
or
GET
instruction.
Open
the
&quot;Properties
>
Configuration&quot;
tab
in
the
inspector
window.
Select
the
&quot;Connection
parameters&quot;
group.
Until
you
select
a
connection
partner,
only
the
empty drop-down list for the partner end point is enabled. All other input options are
disabled.
The
connection
parameters
already
known
are
displayed:
Name
of
the
local
end
point
Interface
of
the
local
end
point
Communication
Function
Manual,
11/2024,
A5E03735815-AM
157
S7
communication
IPv4
address
of
the
local
end
point
900049
150386
Figure
9-2
Connection
configuration
for
PUT
instruction
In
the
drop-down
list
box
of
the
partner
end
point,
select
a
connection
partner.
You
can
select
an
unspecified
device
or
a
CPU
in
the
project
as
the
communication
partner.
The
following
parameters
are
automatically
entered
as
soon
as
you
have
selected
the
connection
partner:
Name
of
the
partner
end
point
Interface of the partner end point. If several interfaces are available, you can change
the
interface
as
required.
Interface
type
of
the
partner
end
point
Subnet
name
of
both
end
points
IPv4
address
of
the
partner
end
point
Name
of
the
connection
which
is
used
for
the
communication.
158
Communication
Function
Manual,
11/2024,
A5E03735815-AM
S7
communication
If
required,
change
the
connection
name
in
the
&quot;Connection
name&quot;
input
box.
If
you
want
to
create
a
new
connection
or
edit
an
existing
connection,
click
on
the
&quot;Select
connection&quot;
button
on
the
right
side
next
to
the
input
box
for
the
connection
name.
NOTE
The PUT and GET instructions between two communication partners can only run if both
the hardware configuration and the program part for the partner end point have been
loaded into the hardware. To achieve fully functional communication, make sure that you
load not only the connection description of the local CPU on the device but also that of
the
partner
CPU
as
well.
Configuring
S7
connections
for
e.g.
BSEND/BRCV
If
you
want
to
use
the
instructions
for
BSEND/BRCV
for
S7
communication,
for
example,
you
first
need
to
configure
an
S7
connection.
To
configure
a
S7
connection,
follow
these
steps:
Configure
the
communications
partners
in
the
network
view
of
the
Devices
&
networks
editor
of
STEP
7.
Select
the
&quot;Connections&quot;
button
and
the
&quot;S7
connection&quot;
entry
from
the
drop-down
list.
Using drag-and-drop, connect the communication partner with each other (via an
interface
or
local
end
point).
If
the
required
S7
subnet
does
not
yet
exist,
it
is
created
automatically.
You
can
also
set
up
a
connection
to
unspecified
partners.
In
the
&quot;Connections&quot;
tab,
select
the
row
of
the
S7
connection.
Set
the
properties
of
the
S7
connection
in
the
&quot;Properties&quot;
tab
in
the
&quot;General&quot;
area,
for
example
the
name
of
the
connection
and
the
interfaces
of
the
communications
partner
that
will
be
used.
For
S7
connections
to
an
unspecified
partner,
set
the
address
of
the
partner.
You
can
find
the
local
ID
(reference
of
the
S7
connection
in
the
user
program)
in
the
&quot;Local
ID&quot;
area.
In
the
Project
tree,
select
the
&quot;Program
blocks&quot;
folder
for
one
of
the
CPUs
and
open
OB1
in
the
folder
by
double-clicking
on
it.
The
program
editor
opens.
In the program editor, call the relevant instructions for S7 communication in the user
program
of
the
communication
partner
(configured
at
one
end)
or
in
the
user
programs
of
the communication partners (configured at both ends). Select the BSEND and BRCV
instructions from the &quot;Communication&quot; area of the &quot;Instructions&quot; task card, for example,
and
drag
them
to
a
network
of
OB1.
At
the
ID
parameter
of
the
instruction,
assign
the
local
ID
of
the
configured
connection
to
be
used
for
the
transmission
of
data.
Assign the parameters for the instructions indicating which data will be written to where
and
which
data
will
be
read
from
where.
Download
the
hardware
configuration
and
user
program
to
the
CPU(s).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
159
S7
communication
S7
communication
via
CP
1543‑1
If
you
set
up
S7
communication
via
the
Industrial
Ethernet
interface
of
the
CP
1543‑1,
you
can select the transport protocol for data transfer in the properties of the S7 connection
under
&quot;General&quot;:
&quot;TCP/IP&quot;
check
box
selected
(default):
ISO‑on‑TCP
(RFC
1006):
for
S7
communication
between
S7‑1500
CPUs
&quot;TCP/IP&quot;
check
box
cleared:
ISO
protocol
(ISO/IEC
8073):
Addressing
using
MAC
addresses
720851
150404
Figure
9-3
Selecting
the
CP
1543‑1
transport
protocol
Procedure
for
setting
up
an
S7
connection
via
different
S7
subnets
You
have
the
option
of
using
an
S7
connection
over
multiple
S7
subnets
(PROFIBUS,
PROFINET/Industrial
Ethernet)
(S7
routing
(Page
401)).
Configure
the
communications
partners
in
the
network
view
of
the
Devices
&
networks
editor
of
STEP
7.
Select
the
&quot;Network&quot;
button.
Connect
the
relevant
interfaces
with
the
S7
subnets
(PROFIBUS,
PROFINET/Industrial
Ethernet)
using
drag-and-drop.
Select
the
&quot;Connections&quot;
button
and
the
&quot;S7
connection&quot;
entry
from
the
drop-down
list.
160
Communication
Function
Manual,
11/2024,
A5E03735815-AM
S7
communication
Using
drag-and-drop
in
our
example,
connect
PLC_1
in
the
left
S7
subnet
(PROFIBUS)
to
PLC_3
in
the
right
S7
subnet
(PROFINET).
The
S7
connection
between
CPU
1
and
CPU
3
is
configured.
900049
151638
Figure
9-4
S7
connections
via
different
subnets
Communication
Function
Manual,
11/2024,
A5E03735815-AM
161
S7
communication
ET
200SP
Open
Controller
as
router
for
S7
connections
If
you
assign
the
&quot;PROFINET
onboard
[X2]&quot;
interface
to
the
CPU
1515SP
PC
(F)
of
the
SIMATIC
PC station, the CPU 1515SP PC (F) can be used as a router for S7 connections. If you use the
CP interface for &quot;None, or a different Windows setting&quot;, you cannot use the Open Controller
as
a
router
for
routed
S7
connections.
An existing S7 connection routed by the CPU 1515SP PC (F) becomes invalid if the
assignment
of
the
interface
of
the
CPU
1515SP
PC
(F)
is
changed
from
&quot;SIMATIC
PC
station&quot;
to
&quot;None, or a different Windows setting&quot;. Since the PLC now no longer handles routing
functions for this connection, when the CPU 1515SP PC (F) is compiled, no message relating
to the invalid connection is displayed. The invalid routed S7 connection is displayed only
when
the
end
points
of
the
connection
are
compiled.
The
interfaces
required
for
routed
S7
connections
must
remain
explicitly
assigned
on
the
CPU
1515SP PC (F) . You can edit the assignment of the interface of the CPU 1515SP PC (F) in the
properties
under
&quot;PROFINET
onboard
[X2]
>
Interface
assignment&quot;.
540004
156184
Figure
9-5
S7
routing
PC
station
Additional
information
You
can
find
detailed
information
on
configuring
S7
connections
and
how
to
use
the
instructions
for
S7
communication
in
the
user
program
in
the
STEP
7
online
help.
162
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Point-to-point
link
10
Functionality
A
point-to-point
connection
for
S7‑1500,
ET
200MP
and
ET
200SP
is
established
via
communications
modules
(CMs)
with
serial
interfaces (RS232,
RS422 or
RS485):
S7‑1500/ET
200MP:
CM
PtP
RS232
BA
CM
PtP
RS422/485
BA
CM
PtP
RS232
HF
CM
PtP
RS422/485
HF
ET
200SP:
CM
PtP
The bidirectional data exchange via a point-to-point connection works between
communications
modules
or
third-party
systems
or
devices
capable
of
communication.
At
least 2 communication partners are required for communication (&quot;point-to-point&quot;). With
RS422
and
RS485,
more
than
two
communications
partners
are
possible.
Protocols
for
communication
via
a
point-to-point
connection
Freeport
protocol
(also
called
ASCII
protocol)
Procedure
3964(R)
Modbus
protocol
in
RTU
format
(RTU:
Remote
Terminal
Unit)
USS
protocol
(universal
serial
interface
protocol)
The
protocols
use
different
layers
according
to
the
ISO/OSI
reference
model:
Freeport:
Uses layer 1 (physical
layer)
3964 (R), USS and Modbus: Use layer 1 and 2 (physical layer and data link layer; therefore
greater
transmission
reliability
than
with
Freeport).
USS
and
Modbus
use
additionally
layer
4.
Properties
of
the
Freeport
protocol
The recipient recognizes the end of the data transfer by means of a selectable end
criterion (e.g. character delay time elapsed, receipt of end character, receipt of a fixed
amount
of
data).
The
sender
cannot
recognize
whether
the
sent
data
arrived
free
of
errors
at
the
recipient.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
163
Point-to-point
link
Properties
of
procedure 3964
(R)
When the data is sent, control characters are added (start, end and block check
characters).
Make
sure
that
these
control
characters
are
not
included
as
data
in
the
frame.
Connection
establishment
and
termination
makes
use
of
control
characters.
If
transfer
errors
occur,
data
transfer
is
automatically
repeated.
Data
exchange
using
Freeport
or
3964
(R)
communication
The data to be sent is stored in the user program of the corresponding CPU in data blocks
(send buffer). A receive buffer is available on the communications module for the received
data.
Check
the
properties
of
the
receive
buffer
and
adapt
them
if
necessary.
You
must
create
a
data
block
for
receiving
in
the
CPU.
In
the
user
program
of
the
CPU,
the
&quot;Send_P2P&quot;
and
&quot;Receive_P2P&quot;
instructions
handle
the
data
transfer
between
the
CPU
and
CM.
Procedure
for
setting
up
Freeport
or
3964
(R)
communication
Configure
an
S7‑1500
configuration
with
CPU
and
CM
in
the
device
view
of
the
hardware
and
network
editor
of
STEP
7.
Select
the
interface
of
the
CM
in
the
device
view
of
STEP
7.
Assign the parameters of the interface (for example connection communication,
configuration
of
message
sending)
in
the
Inspector
window
of
STEP
7
under
&quot;Properties&quot;
>
&quot;General&quot;.
Select the &quot;Send_P2P&quot; or &quot;Receive_P2P&quot; instruction in the &quot;Instructions&quot; task card under
&quot;Communication&quot;
>
&quot;Communications
processor&quot;
and
drag-and-drop
the
instruction
into
the
user
program
(for
example
into
a
FB).
Assign
the
parameters
for
the
instructions
according
to
your
configuration.
Download
the
hardware
configuration
and
user
program
to
the
CPU.
Otherwise:
Dynamic
parameter
assignment
of
the
communications
module
In
certain
types
of
application
it
is
an
advantage
to
set
up
communication
dynamically;
in
other
words,
program-controlled
by
a
specific
application.
Typical
applications
for
this,
could
be,
for
example
manufacturers
of
serial
machines.
To
make
the user interfaces as convenient as possible for their customers, these manufacturers adapt
the
communications
services
to
the
particular
operator
entries.
164
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Point-to-point
link
Instructions
for
Freeport
communication
There are 3 instructions available for the dynamic configuration in the user program for
Freeport communication. The following applies to all 3 instructions: the previously valid
configuration
data
is
overwritten
but
not
stored
permanently
in
the
target
system.
The
&quot;Port_Config&quot;
instruction
is
used
for
the
program-controlled
configuration
of
the
relevant
port
of
the
communications
module.
The &quot;Send_Config&quot; instruction is used for the dynamic configuration, for example of time
intervals
and
breaks
in
transmission
(serial
transmission
parameters)
for
the
relevant
port.
The &quot;Receive_Config&quot; instruction is used for dynamic configuration, for example of
conditions
for
the
start
and
end
of
a
message
to
be
transferred
(serial
receive
parameters)
for
the
relevant
port.
Instructions
for
3964 (R)
communication
There are 2 instructions available for dynamic configuration in the user program for 3964 (R)
communication. The following applies to the instructions: the previously valid configuration
data
is
overwritten
but
not
stored
permanently
in
the
target
system.
The
&quot;Port_Config&quot;
instruction
is
used
for
the
program-controlled
configuration
of
the
relevant
port
of
the
communications
module.
The
&quot;P3964_Config&quot;
instruction
is
used
for
the
dynamic
configuration
of
protocol
parameters.
Properties
of
the
USS
protocol
Simple,
serial
data
transfer
protocol
with
cyclic
message
frame
traffic
in
half
duplex
mode
that
is
tailored
to
the
requirements
of
drive
technology.
Data
transfer
works
according
to
the
master-slave
principle.
–
The master has access to the functions of the drive and can, among other things,
control
the
drive,
read
status
values
and
read
and
write
the
drive
parameters.
Data
exchange
using
USS
communication
The communications module is the master. The master continuously sends frames (job
frames)
to
the
up
to
16
drives
and
expects
a
response
frame
from
each
addressed
drive.
A
drive
sends
a
response
frame
under
the
following
conditions:
When
a
frame
is
received
without
errors
When
the
drive
is
addressed
in
this
frame
A
drive
must
not
send
if
these
conditions
are
not
met
or
the
drive
was
addressed
in
the
broadcast.
The
connection
to
the
relevant
drives
exists
for
the
master
once
it
receives
a
response
frame
from
the
drive
after
a
specified
processing
time
(response
delay
time).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
165
Point-to-point
link
Procedure
for
setting
up
USS
communication
Configure
an
S7‑1500
configuration
with
CPU
and
CM
in
the
device
view
of
the
hardware
and
network
editor
of
STEP
7.
In
the
Project
tree,
select
the
&quot;Program
blocks&quot;
folder
and
open
OB1
in
the
folder
by
double-clicking
on
it.
The
program
editor
opens.
Select the instructions for USS communication according to your task in the
&quot;Communication&quot;
area,
&quot;Communications
processor&quot;
folder
of
the
&quot;Instructions&quot;
task
card
and
drag
them
to
a
network
of
OB1:
The
&quot;USS_Port_Scan&quot;
instruction
allows
you
to
communicate
via
the
USS
network.
The
&quot;USS_Drive_Control&quot;
instruction
prepares
send
data
for
the
drive
and
evaluates
the
response
data
of
the
drive.
The
&quot;USS_Read_Param&quot;
instruction
is
used
to
read
out
parameters
from
the
drive.
The
&quot;USS_Write_Param&quot;
instruction
is
used
to
change
parameters
on
the
drive.
Assign
the
parameters
for
the
instructions
according
to
your
configuration.
Download
the
hardware
configuration
and
user
program
to
the
CPU.
Properties
of
the
Modbus
protocol
(RTU)
Communication
takes
the
form
of
serial,
asynchronous
transfer
with
a
transmission
speed
of
up
to
115.2
kbps,
half
duplex.
Data
transfer
works
according
to
the
master-slave
principle.
The
Modbus
master
can
send
jobs
for
reading
and
writing
operands
to
the
Modbus
slave:
Reading
inputs,
timers,
counters,
outputs,
memory
bits,
data
blocks
Writing
outputs,
memory
bits,
data
blocks
Broadcast
to
all
slaves
is
possible.
Data
exchange
using
Modbus
communication
(RTU)
The communications module can be a Modbus master or Modbus slave. A Modbus master
can communicate with one or more Modbus slaves (the number depends on the physical
interface).
Only
the
Modbus
slave
explicitly
addressed
by
the
Modbus
master
is
permitted
to
return data to the Modbus master. The slave detects the end of the data transfer and
acknowledges
it.
If
an
error
occurs,
it
provides
an
error
code
to
the
master.
166
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Point-to-point
link
Procedure
for
setting
up
Modbus
communication
(RTU)
Configure
an
S7‑1500
configuration
with
CPU
and
CM
in
the
device
view
of
the
hardware
and
network
editor
of
STEP
7.
In
the
Project
tree,
select
the
&quot;Program
blocks&quot;
folder
and
open
OB1
in
the
folder
by
double-clicking
on
it.
The
program
editor
opens.
Select the instructions for Modbus communication according to your task in the
&quot;Communication&quot;
area,
&quot;Communications
processor&quot;
folder
of
the
&quot;Instructions&quot;
task
card
and
drag
them
to
a
network
of
OB1:
The
&quot;Modbus_Comm_Load&quot;
instruction
configures
the
port
of
the
CM
for
Modbus
communication.
The
&quot;Modbus_Master&quot;
instruction
is
used
for
Modbus
master
functionality.
The
&quot;Modbus_Slave&quot;
instruction
is
used
for
Modbus
slave
functionality.
Assign
the
parameters
for
the
instructions
according
to
your
configuration.
Download
the
hardware
configuration
and
user
program
to
the
CPU.
Additional
information
You
can
find
more
detailed
information
on
communication
via
point-to-point
connections
and
basics
of
serial
data
transmission
in
the
function
manual
CM
PtP
communication
mod-
ule
-
Configurations
for
point-to-point
connections
(
https://support.industry.siemens.com/cs/us/en/view/59057093
).
You
can
find
a
description
of
how
to
use
the
instructions
for
point-to-point
connections
in
the
user
program
in
the
STEP
7
online
help.
You
can
find
information
about
the
communications
modules
with
a
serial
interface
in
the
manual
of
the
particular
communications
module.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
167
OPC
UA
communication
11
What
you
need
to
know
about
OPC
UA
OPC UA
and
Industrie
4.0
Uniform
standard
for
information
and
data
exchange
Industry 4.0 stands for the intensive utilization, evaluation and analysis of the large volumes
of data from production in IT systems at the enterprise level. With Industry 4.0, data
exchange between the production and enterprise levels is rapidly increasing. However, a
prerequisite
for
success
is
a
uniform
standard
for
the
information
and
data
exchange.
Classic
OPC
only
runs
on
Windows
operating
systems.
To
get
around
this
restriction,
the
OPC
Foundation
developed
the
OPC
UA
(OPC
Unified
Architecture)
standard.
The
OPC
UA
standard
is
particularly
suitable
for
data
exchange
across
different
levels
thanks
to its independence from specific operating systems, its secure transfer procedures and the
semantic description of data. Machine data (controlled variables, measured values or
parameters)
can
also
be
transferred
in
this
way.
An
important
component
of
this
concept
is
that
OPC
UA
communication
can
take
place
in
parallel
with
real-time
communication
for
time-critical,
machine-level
data
transfer.
OPC
UA
is
highly
scalable
so
that
a
consistent
information
exchange
between
sensors,
controllers
and
MES
or
ERP
systems
is
possible.
OPC
UA
makes
available
not
only
data
but
also
information
about
the
data
(data
types),
at
the
same
time
making
possible
machine-interpretable
access
to
the
data.
OPC
UA
topic
page
For
an
overview
of
the
most
important
articles
and
links
on
the
subject
of
OPC
UA,
refer
to
the
SIEMENS
Industry
Online
Support.
OPC
UA
topic
page
(
https://support.industry.siemens.com/cs/ww/en/view/109770435
)
168
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
General
features
of
OPC
UA
OPC
UA
and
PROFINET
OPC
UA
and
PROFINET
can
be
used
together.
The
two
protocols
use
the
same
network
infrastructure.
Independence
from
the
operating
system
The
OPC
UA
standard
is
platform-independent
and
uses
an
optimized
TCP-based
binary
protocol
for
high-performance
applications.
OPC
UA
can
be
used,
for
example,
under
Windows,
Linux,
Mac
OS
X,
a
realtime
operating
system
or
a
mobile
operating
system
(Android
or
iOS).
Independence
of
a
specific
transport
layer
OPC
UA
currently
supports
the
following
transport
mechanisms
and
protocols:
The
transfer
of
messages
as
a
binary
stream
directly
via
TCP/IP
The
transfer
of
messages
with
XML
via
TCP/IP
and
HTTP.
This
transport
mechanism
allows
only
a
slow
transfer
and
is
therefore
almost
never
used.
S7-1500
CPUs
do
not
support
this
transport
mechanism.
Binary
data
exchange
is
supported
by
all
OPC
UA
applications
(required
in
OPC
UA
specification).
Simple
client-server
principle
An
OPC
UA
server
provides
a
great
deal
of
information
within
a
network,
e.g.
relating
to
the
CPU, the OPC UA server itself, the data and the data types. An OPC UA client accesses this
information.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
169
OPC
UA
communication
What
you
need
to
know
about
OPC
UA
Implementation
in
different
programming
languages
The OPC Foundation has implemented the OPC UA standard in several programming
languages:
Stacks
for
.NET,
ANSI
C
and
Java
are
available,
although
maintenance
has
been
discontinued
for
the
stacks
for
ANSI
C
and
Java.
The
OPC
Foundation
offers
the
.NET
stack
as
well
as
example
programs
as
open
source
software.
See
Github
(
https://github.com/opcfoundation
).
A number of companies offer Software Development Kits (SDK). These development
packages
contain
the
stacks
of
the
OPC
Foundation
and
other
functionalities
that
facilitate
the
development
of
solutions.
Advantages
of
using
SDKs:
Support
from
the
supplier
Tested
software
Detailed
documentation
Clear
license
conditions
(important
for
selling
of
solutions)
Scalability
OPC
UA
can
be
used
for
devices
of
different
performance
classes:
Sensors
Embedded
systems
Controllers
PC
systems
Smartphones
Servers
running
MES
or
ERP
applications.
The performance class of the devices is differentiated by profiles. Different OPC UA profiles
offer
the
possibility
to
scale
OPC
UA
for
very
small
and
simple
devices
as
well
as
for
very
high-
performance
devices.
An
OPC
UA
profile
describes
functions
and
services
that
must
be
supported
by
the
server
and
client. In addition, other functionalities/services that are not required by the profile can be
optionally
provided.
OPC
UA
profiles
differ
from
PROFINET
profiles;
the
latter
define
additional
cross-vendor
properties and behavior for installations and systems in the sense of a vendor-neutral
software
interface.
Nano
Embedded
Device
2017
Server
Profile
For the smallest devices with severely limited functionality, there is the &quot;Nano Embedded
Device 2017 Server Profile&quot; of the OPC Foundation. This profile is functionally equivalent to
the core server facet and defines the OPC UA TCP binary protocol as the required transport
profile. The profile allows for connections without UA Security and does not allow
subscriptions
or
method
calls.
Support
for
diagnostic
objects
and
variables
is
optional
for
this
profile.
Additional
profiles
build
on
the
&quot;Nano
Embedded
Device
2017
Server
Profile&quot;,
requiring
more
resources
and
offering
more
functionality.
170
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Micro
Embedded
Device
2017
Server
Profile
This profile provides limited functionality; it requires at least two parallel connections.
Additionally,
it
allows
subscriptions/data
monitoring,
but
no
UA
Security
and
no
method
calls.
S7-1200
Basic
Controllers
support
the
&quot;Micro
Embedded
Device
2017
Server
Profile&quot;.
The
S7-1200
additionally
supports
UA
Security.
Embedded
2017
UA
Server
Profile
This profile has been developed for devices with more than 50 MB RAM and a more high-
performance
processor.
It
is
based
on
the
Micro
Embedded
Device
Server
profile.
In
addition,
it
requires
UA
security
and
method
calls.
In
addition,
the
servers
must
make
their
used
type
model
(data
types,
reference
types,
variable
types,
etc.)
available.
S7-1500
Advanced
Controllers
support
the
&quot;Embedded
2017
UA
Server
Profile&quot;.
Standard
and
global
discovery
profiles
The
&quot;OPC
UA
Specification
Part
7&quot;
defines
additional
profiles:
The
&quot;Standard
2017
UA
Server
Profile&quot;,
which
is
suitable
for
PC-based
OPC
UA
servers
2
global
profiles,
&quot;Global
Discovery
Server
2017
Profile&quot;
and
&quot;Global
Discovery
and
Certificate Management 2017 Server Profile&quot;, that cover the required service and
information
models
of
a
Global
Discovery
Server
Type-instance
concept
OPC UA offers a fully networked (full-meshed network), object-oriented information model
for namespaces, including metadata for the object description. Any object structures can be
generated
via
referencing
of
the
instances
among
each
other
and
their
types.
Because
servers
disclose their instance and type systems, clients can navigate through this network and
obtain all the information they need. Both instances and their type definitions are available in
runtime.
Procedures
or
concepts
on
how
to
handle
references
to
types
are
optimized
over
time.
These
optimizations
lead
to
new
versions
of
the
OPC
UA
Specification
(e.g.
V1.03
=>
V1.04).
PLC
tag
mapping
The information of the OPC UA server (for example the PLC tags) is modeled as nodes
connected
to
one
another
via
references.
The
semantics
are
displayed
by
the
server
in
the
address space and can be acquired by clients (while navigating). This makes it possible to
browse from node to node with an OPC UA client and find out what content can be read,
monitored
or
written.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
171
OPC
UA
communication
What
you
need
to
know
about
OPC
UA
Integrated
security
mechanisms
OPC
UA
uses
security
mechanisms
at
various
levels:
A secure connection can only be established between an OPC UA server and an OPC UA
client if the client and server can register with X.509-v3 certificates and accept each
other&apos;s
certificates
(security
at
the
application
level).
Various
security
policies
are
possible,
including an unsecured connection between server and client (Security Policy: &quot;No
security&quot;).
A
server
can
always
request
the
following
information
from
the
user
for
authorized
access
(authentication):
A
user
certificate
(not
configurable
in
STEP
7)
User
name
and
password
No
user
authorization
The
security
mechanisms
are
optional
and
configurable.
More
information
You
can
find
more
information
on
the
website
of
the
OPC
Foundation
(
https://opcfoundation.org
).
OPC
UA
for
S7-1200/S7-1500
CPUs
In
OPC
UA,
one
system
operates
as
a
server
and
provides
data
the
existing
information
to
other
systems
(clients).
OPC
UA
clients,
for
example,
have
read
and
write
access
to
data
on
an
OPC
UA
server.
OPC
UA
clients
call
methods
on
the
OPC
UA
server.
You can access this data online with a client, including e.g. information on performance and
diagnostics. In OPC UA terminology, this function is called &quot;Browsen&quot;. The &quot;Subscription&quot;
function eliminates regular reading of a tag; with this function, the server informs a client
about
value
changes.
A
system
can
be
both
a
client
and
a
server
at
the
same
time.
OPC UA
server
of the
S7-1500 CPU
As
of
firmware
version
2.0,
an
S7-1500
CPU
is
equipped
with
an
OPC
UA
server.
The
following
sections
describe
how
you
configure
the
OPC
UA
server
of
the
S7-1500
CPU
to
make
data
and
methods
available
for
OPC
UA
clients
so
that
clients
have
read
or
write
access
to
PLC
tags
on
the
CPU
and
can
call
server
methods.
The
following
sections
also
set
out
how
to
integrate
companion
specifications
into
the
address
space
of
the
OPC
UA
server.
172
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
OPC UA server
of the
S7-1200 CPU
As
of
firmware
V4.4,
an
S7-1200
CPU
is
equipped
with
an
OPC
UA
server.
The
OPC
UA
server
is
generally
configured
as
it
is
for
an
S7-1500
CPU;
the
scope
of
functions
and
the
quantity
limits
are
limited
according
to
the
supported
&quot;Micro
Embedded
Device
2017
Server Profile&quot;. Unlike for an S7-1500 CPU, the functions &quot;Registered Read&quot; and &quot;Registered
Write&quot;
are
not
available.
As
of
firmware
V4.5,
S7-1200
CPUs
support
server
methods
as
well
as
structured
data
types
(structures
and
arrays).
You
can
find
additional
information
in
the
STEP
7
online
help.
OPC
UA
client
of
the
S7-1500
CPU
As
of
firmware
version
V2.6,
an
S7-1500
CPU
is
additionally
equipped
with
an
OPC
UA
client.
The
following
sections
show
how
to
use
standardized
instructions
(PLCopen
function
blocks)
to
create
a
user
program
that,
as
an
OPC
UA
client,
provides
the
following
functions:
Reading
data
from
an
OPC
UA
server
Writing
data
to
an
OPC
UA
server
Calling
methods
of
an
OPC
UA
server
STEP
7
(TIA
Portal)
assists
you
in
creating
user
programs
by
providing
an
editor
for
client
interfaces
and
a
parameter
assignment
for
OPC
UA
connections.
The
OPC
UA
instructions
for
an
S7-1500
CPU
as
client
are
described
in
detail
in
the
help
to
the
instructions
(Instructions
>
Communication
>
OPC
UA).
OPC
UA
client
for
test
purposes
The
following
description
uses
various
different
OPC
UA
clients
to
illustrate
the
use
of
OPC
UA
clients:
clients.html
)
&quot;UaExpert&quot; of Unified Automation. An extensive client that can be used free of charge:
Link
for
downloading
UaExpert
(
https://www.unified-automation.com/downloads/opc-ua-
&quot;UA
Sample
Client&quot;
of
the
OPC
Foundation.
This
client
is
available
free
of
charge
for
users
who
are
registered
with
the
OPC
Foundation
:
(
https://opcfoundation.org
)
Link
for
downloading
the
example
client
of
the
OPC
Foundation
Communication
Function
Manual,
11/2024,
A5E03735815-AM
173
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Application
example
in
Industry
online
support
Siemens Industry Online Support provides a free application example with a client API for
various
applications.
You
use
the
functions
of
this
interface
to
create
your
own
OPC
UA
clients
that match your application. To simplify handling the API, we offer a higher-level .NET helper
class.
The
client
API
is
based
on
the
.NET
OPC
UA
stack
of
the
OPC
Foundation.
The
application
example
shows
how
to
establish
connections
between
servers
and
clients,
for
example.
It
also
demonstrates
the
reading
and
writing
of
PLC
tags.
(
https://support.industry.siemens.com/cs/us/en/view/109737901
)
Link
to
download:
OPC
UA
.NET
client
for
the
SIMATIC
S7-1500
OPC
UA
Server
Access
to
OPC
UA
applications
The
access
possibilities
that
an
S7-1500
CPU
with
an
OPC
UA
application
(client
or
server)
has
via a CP in the same station are described below. In addition, an approach for combining
these access possibilities with the &quot;IP Forwarding&quot; function to allow access to devices of
another
IP
subnet
via
an
S7-1500
station
is
presented.
All
the
settings
for
this
can
be
found
in
the
CPU
properties,
&quot;Advanced
configuration&quot;
area
in
the
Inspector
window.
The
possibility
of
accessing
the
OPC
UA
application
in
the
CPU
via
CP
interface
is
subject
to
the
following
requirements:
S7-1500
CPU
(Advanced
Controller)
firmware
version
V2.8
or
higher,
S7-1500R/H
CPUs
firmware
version
V3.1
or
higher
CP
1543-1
firmware
version
V2.2
or
higher
Recommendation: Use a CP 1543-1 with firmware V3.0 or higher. As of this version, the
security functions (firewall) are also available for the virtual interface (W1) and no additional
firewall
needs
to
be
installed
between
the
station
and
an
insecure
network.
174
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Principle:
Interface
for
access
via
communications
module
For
a
CPU
application,
such
as
OPC
UA,
to
be
accessed
via
CP
interface,
you
must
configure
a
virtual interface (W1). IP-based applications can then be accessed via the IP address
parameters
of
this
virtual
interface.
The
schematic
is
shown
in
the
following
figure.
2513583
60277
3781577
60277
1
2
S7-1500
CP
1543-1
4
5
4
3
PROFINET
/
Industrial
Ethernet
IP
subnet
PROFINET
/
Industrial
Ethernet
IP
subnet
Drives
ET 200SP
Drives
S7-1500
PG/PC
①
CPU
S7-1500
FW
V2.8
or
higher
(e.g.
CPU
1515-2
PN)
②
CP
1543-1
(FW
V2.2
or
higher)
③
Virtual interface (W1)
④
Protocol
conversion
PROFINET
/
Industrial
Ethernet
on
backplane
bus
or
backplane
bus
on
PROFINET
/
Industrial
Ether-
net
⑤
Backplane
bus
Figure
11-1
Principle:
Interface
for
access
via
communications
module
Communication
Function
Manual,
11/2024,
A5E03735815-AM
175
OPC
UA
communication
What
you
need
to
know
about
OPC
UA
Example:
Access
of
OPC
UA
clients
to
the
OPC
UA
server
of
the
CPU
For
access
of
an
OPC
UA
client
to
the
OPC
UA
server
of
the
CPU,
the
following
interfaces
of
the
S7-1500
station
are
available:
The
local
PROFINET
interfaces
of
the
S7-1500
CPU
The Ethernet
interface
of
a
CP
1543-1
(firmware
version
V2.2 and
higher)
The
following
figure
shows
an
example
of
a
possible
configuration:
The
CPU
could
also
have
the role OPC UA client and the device on the subnet of the CP could have the role OPC UA
server.
PROFINET
/ Industrial Ethernet
IP
subnet
PROFINET
/ Industrial Ethernet
IP
subnet
OPC
UA
Server
OPC
UA
Client
Figure
11-2
Example:
Access
of
OPC
UA
clients
to
the
OPC
UA
server
of
the
CPU
176
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Example:
Access
of
OPC
UA
clients
to
OPC
UA
servers
via
S7-1500
CPU
with
activated
IP
Forwarding
OPC
UA
client
and
OPC
UA
server
can
also
be
connected
to
one
another
via
an
S7-1500
CPU,
in
which
case
the
S7-1500
CPU
operates
as
an
IP
Forwarder.
This
configuration
option
allows
for
flexible
expansion
of
existing
systems.
PROFINET
/ Industrial Ethernet
IP
subnet
PROFINET
/ Industrial Ethernet
IP
subnet
S7-1500
CP
1543-1
OPC
UA
Server
OPC UA
Client
Figure
11-3
Example:
Access
of
OPC
UA
clients
to
OPC
UA
servers
via
S7-1500
CPU
with
activated
IP
Forwarding
More
information
More
information
on
access
options
via
the
virtual
interface
and
via
IP
forwarding
can
be
found
in
the
following
sections:
(Page
405)
IP
forwarding
(Page
414)
Virtual
interface
for
IP-based
applications
Communication
Function
Manual,
11/2024,
A5E03735815-AM
177
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Addressing
nodes
Nodes are the basic elements of OPC UA, they are comparable with objects from object-
oriented
programming.
Nodes
are
used,
for
example,
for
user
data
(tags)
or
other
metadata.
Nodes
are
used
to
model
an
OPC
UA
address
space
that
also
contains
a
type
model
with
type
definitions.
Node
ID
(NodeId)
Nodes
in
the
OPC
UA
address
space
are
uniquely
identified
by
a
NodeId
(Node
Identifier).
The
NodeId
consists
of
an
identifier,
identifier
type
and
a
namespace
index.
Namespaces
are
used
to
avoid
naming
conflicts.
The OPC Foundation has defined a wide range of nodes that provide information about the
given
OPC
UA
server.
These
nodes
can
be
found
in
the
namespace
of
the
OPC
Foundation
and
have
the
index
0.
The
OPC
Foundation
also
defines
data
types
and
tag
types.
Namespace
(Namespace)
In
addition
to
the
above-described
namespace
of
the
OPC
Foundation,
the
namespace
for
accessing
CPU
data
is
of
interest:
All
the
tags
or
methods
of
an
S7‑1500
OPC
UA
server
are
contained in the namespace (Namespace) of the standard server interface
&quot;http://www.siemens.com/simatic-s7-opcua&quot;.
By default this namespace has the Index 3. The index may change later if additional
namespaces are inserted into the server or if existing ones are deleted. It is therefore
necessary for an OPC UA client to request the current index of the namespace (e.g.
&quot;http://www.siemens.com/simatic-s7-opcua&quot;)
from
the
server
before
reading
or
writing
its
values.
The
following
figure
shows
an
example
of
the
result
of
such
a
request.
1661762
192907
178
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Identifier
The
Identifier
corresponds
to
the
name
of
the
PLC
tag
in
quotation
marks.
The
quotation
mark
is the only sign that is not permitted as part of a name in STEP 7. Quotation marks avoid
naming
conflicts.
The
following
example
reads
the
value
of
the
&quot;StartTimer&quot;
tag:
1837881
202035
The
Identifier
can
consist
of
several
components.
The
individual
components
are
then
separated
by
a
dot.
The
following
example
reads
the
&quot;MyDB&quot;
array
data
block
completely.
This
data
block
contains
an array with ten integer values. All ten values should be read in one pass. Therefore, &quot;0:9&quot; is
entered
at
the
array
range.
Example
of
NodeIds,
identifiers
and
namespaces
The following figure illustrates the relation between NodeIds, identifiers and namespaces: It
is
no
problem
if
two
nodes
have
the
same
identifiers
but
belong
to
different
namespaces.
STEP
7
(TIA
Portal)
allows
you
to
easily
import
namespaces
via
a
server
interface.
1
R
G
H
l
G
V
X
V
H
G
i
Q
&quot;
&
R
P
S
D
Q
i
R
Q
1DPHVSDFHV
(
1
D
P
H
V
S
D
F
H
l
Q
G
H
[
D
Q
G
1
D
P
H
V
S
D
F
H
)
1RGHlG
1
D
P
H
V
S
D
F
H
l
Q
G
H
[
2
l
G
H
Q
W
i
I
i
H
U
7
\
S
H
V
W
U
i
Q
J
l
G
H
Q
W
i
I
i
H
U
0
\
7
H
P
S
H
U
D
W
X
U
H
0
K
W
W
S
:
/
/
R
S
F
I
R
X
Q
G
D
W
i
R
Q
.
R
U
J
/
8
$
/
1
X
U
Q
:
0
\
&
R
P
S
X
W
H
U
:
0
\
&
R
P
S
D
Q
\
:
0
\
6
H
U
Y
H
U
2
X
U
Q
:
0
\
&
R
P
S
D
Q
\
:
8
D
6
H
U
Y
H
U
:
0
R
G
H
O
1
3
X
U
Q
:
0
\
&
R
P
S
D
Q
\
:
8
D
6
H
U
Y
H
U
:
0
R
G
H
O
2
6
S
H
F
i
I
i
F
D
W
i
R
Q
&quot;
W
\
S
H
i
Q
W
H
U
I
D
F
H
1RGHlG
1
D
P
H
V
S
D
F
H
l
Q
G
H
[
3
l
G
H
Q
W
i
I
i
H
U
7
\
S
H
V
W
U
i
Q
J
l
G
H
Q
W
i
I
i
H
U
0
\
7
H
P
S
H
U
D
W
X
U
H
Communication
Function
Manual,
11/2024,
A5E03735815-AM
179
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
PLC
tags
in
the
address
space
of
the
OPC
UA
server
The
figure
below
shows
where
the
PLC
tags
in
the
example
are
located
in
the
address
space
of
the
OPC
UA
server
(excerpt
from
UA
client):
The
&quot;MyDB&quot;
data
block
is
a
global
data
block.
The
data
block
is
therefore
located
below
the
node &quot;DataBlocksGlobal&quot;. &quot;StartTimer&quot; is a memory tag and is therefore stored below the
&quot;Memory&quot;
node.
1627620
139741
Figure
11-4
PLC
tags
in
the
address
space
of
the
OPC
UA
server
180
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Methods
in
the
address
space
of
the
OPC
UA
server
If
you
implement
a
method
via
your
user
program,
it
takes
the
following
form
in
the
address
space
of
the
OPC
UA
Server
(see
Providing
methods
on
the
OPC
UA
server
(Page
307)):
1799970
125800
Figure
11-5
Methods
in
the
address
space
of
the
OPC
UA
server
Communication
Function
Manual,
11/2024,
A5E03735815-AM
181
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Namespace
overview
for
the
OPC
UA
server
of
the
S7-1200/1500
CPUs
As already written for the topic &quot;Addressing of nodes&quot;, the namespace index is part of the
node ID. To ensure that a node ID is always unique in the address space, namespaces are
used
in
OPC
UA;
the
BrowseName
as
the
sole
means
of
identifying
a
node
can
be
ambiguous.
Namespaces
are
specified
at
OPC
UA
through
different
&quot;Naming
Authorities&quot;
which
develop
the OPC UA information models, for example by a working group, the OPC Foundation or
organizations
that
develop
standard
information
models.
Namespaces
are
identified
through
a
namespace
URI;
the
namespace
URI
identifies
the
Naming
Authority.
A namespace index is used to optimize accesses to the nodes of the server instead of the
namespace URI. The namespace index is a pointer to a namespace array that the server
manages.
A
client
reads
the
namespace
index
once
from
the
server
to
be
able
to
access
the
nodes
of
the
server
afterwards
with
a
simple
integer
instead
of
a
URI
string.
The
following
table
contains
the
assignment
between
namespace
URIs
and
namespace
indexes
of
S7-1500
and
S7-1200
CPUs.
Assignment
between
namespace
URI
and
namespace
index
The
namespace
indexes
are
fixed
at
S7-1200
and
S7-1500
CPUs
for
the
namespace
indexes
0
to
3.
Further
namespace
indexes
are
currently
not
specified.
Namespace
URI
Namespace
index
Description
http://opcfoundation.org/UA/
0
Namespace for the node IDs and
BrowseNames
of
the
OPC
UA
spe-
cification
(OPC
10000-3).
Example
0:EngineeringUnits
Local
Server
URI
(&quot;urn:&quot;
+
application
name
as
con-
figured in TIA Portal (area &quot;OPC
UA
>
General&quot;
in
the
CPU
proper-
ties))
1
Namespace for nodes that are
defined
in
the
local
server
(OPC
10000-5).
Example
urn:SIMATIC.S7-1500.OPC-UA.Ap-
plication:PLC_1
http://opcfoundation.org/UA/DI/
2
Namespace for node IDs and
BrowseNames
of
the
OPC
UA
spe-
cification
for
devices
(OPC
10000-100).
Example
2:DeviceRevision
http://www.siemens.com/simatic-
s7-opcua
3
Namespace for node IDs and
BrowseNames
that
are
defined
product-specifically
for
an
S7-1200/S7-1500
CPU.
In
this
namespace instances (CPU, tags,
DBs, etc.) as well as their types
(UDTs, LDTs, FBs, etc.) are
defined.
Example
3:DataBlocksGlobal
182
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Namespace
URI
Namespace
index
Description
URIs
of
additional
namespaces
for
further instances and types
Examples
http://machinesupplier.org/imple-
mentedPackML
http://opcfoundation.org/UA/Pack
ML
>
3
Not specified. Can, for example,
be defined with SiOME.
Examples
4:MyPackMLMachineInstance
5:PackMLBaseObjectType
What
you
need
to
know
about
OPC
UA
clients
Basics
of
OPC
UA
clients
OPC
UA
clients
are
programs
that
do
the
following:
Access
the
information
from
an
OPC
UA
server
(for
example
an
S7-1500
CPU):
read/browse
access,
write
access,
subscriptions
Execute
methods
through
the
OPC
UA
server
However,
OPC
US
clients
can
only
access
data
that
is
enabled
for
this
purpose
(see
&quot;Managing
write
and
read
rights
(Page
235)&quot;).
You
need
the
endpoint
of
the
server
to
establish
a
connection
to
an
OPC
UA
server
(see
&quot;Endpoints
of
the
OPC
UA
servers
(Page
223)&quot;).
Reading
out
information
from
the
OPC
UA
server
When
a
connection
to
an
end
point
of
the
server
exists,
you
can
use
the
navigation
function
of the client: You navigate starting from a defined starting point (from the &quot;root&quot; node)
through
the
address
space
of
the
server.
The
following
information
is
provided
in
the
process:
Enabled
PLC
tags,
data
blocks
and
data
block
components
Namespace
index
and
identifiers
of
these
PLC
tags,
data
blocks
and
DB
components
Data
types
of
the
PLC
tags
and
DB
components
Number
of
components
in
arrays
(required
for
reading
and
writing
arrays)
In addition, you receive information about the OPC UA server itself as well as information
about
the
S7-1500
based
on
the
&quot;OPC
UA
for
Devices&quot;
standard
of
the
OPC
Foundation
(for
example,
serial
number,
firmware
version).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
183
OPC
UA
communication
11.1
What
you
need
to
know
about
OPC
UA
Reading
data
from
the
server
and
writing
to
the
server
You
now
know
the
namespace,
identifier
and
data
type
of
PLC
tags.
This
means
that
you
can
now
specifically
read
individual
PLC
tags
and
DB
components
as
well
as
complete
arrays
and
structures.
You
can
find
examples
of
the
reading
of
Boolean
tags
and
array
data
blocks
in
Addressing
nodes
(Page
178).
Rules
for
access
to
structures
are
available
here
(Page
368).
With the information that you obtain while navigating through the address space of the
server (index, identifier and data type), you can also transfer values to the S7-1500 with the
OPC
UA
client.
The
following
example
overwrites
the
first
three
values
in
the
array
data
block
&quot;MyDB&quot;.
1665356
112038
For &quot;Array Range&quot; you specify which components of the array you want to overwrite. The
&quot;Good&quot;
status
code
indicates
that
the
values
were
transferred
successfully.
However,
you
can
only write the values to the S7-1500 but not the time stamps of these values. The time
stamps
can
only
be
read.
Faster
access
through
registration
Registered Read/Write lends itself to repeated, optimized access to data – with maximum
performance.
When
tag
nodes
are
registered,
the
OPC
UA
server
creates
a
numerical
Identifier
(numerical NodeId) that directly references the registered node. For read or write jobs of the
client to this numerical Identifier, the server does not have to resolve any strings as Identifier
and
can
access
the
requested
tag
in
an
optimized
manner.
This
Identifier
applies
solely
to
the
current
session
and
has
to
be
queried
again
when
the
session
connection
is
terminated/lost.
In
the
following
example,
the
&quot;StartTimer&quot;
tag
is
first
registered
on
the
server.
Afterwards,
the
rapid
function
&quot;RegisteredWrite&quot;
is
used
for
setting
the
value.
1674586
195467
In accordance with the same scheme, the &quot;RegisteredRead&quot; function can also be used, which
is particularly useful for recurring data readouts. Take into account, however, that depending
on
the
application
it
may
be
advisable
to
use
a
Subscription
instead.
Recommendation:
It
is
best
to
place
registrations
in
the
startup
program
of
the
OPC
UA
client,
since
the
registration
takes
up
time.
184
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
What
you
need
to
know
about
OPC
UA
Please note that you can set the maximum number of registered nodes in the properties of
the
S7-1500
CPU
and
that
the
Clients
have
to
respect
this
number,
see
General
settings
of
the
OPC
UA
server
(Page
250).
Subscription
The
term
&quot;Subscription&quot;
is
used
for
a
function
in
which
only
those
tags
for
which
an
OPC
UA
client has registered at the OPC UA server are transferred. The OPC UA server only sends a
message
to
the
OPC
UA
client
for
these
registered
tags
(monitored
Items)
when
a
value
has
changed. The monitoring of these tags makes constant sampling by the OPC UA client
(Polling)superfluous,
which
reduces
the
network
load.
You have to create a Subscription to use this function. For this purpose, you specify the
&quot;Publishing
Interval&quot;
at
the
UA
client
and
click
the
&quot;Create&quot;
button.
The
publishing
interval
is
the time interval in which the server sends new values to the client in a notification (data
change
notification).
In
the
following
example
a
subscription
has
been
created:
The
client
receives
a
message
with
the
new
values
(publishing
interval
50
ms)
every
50
milliseconds
here.
1831697
197201
Preventing
server
overload
You can set the OPC UA server of the S7-1500 CPU by means of the &quot;Minimum publishing
interval&quot;
so
that
it
does
not
serve
extremely
short
send
intervals
requested
by
the
client,
see
Settings
of
the
server
for
subscriptions
(Page
252).
Example
: A client wants to be operated at a publishing interval of 50 ms as detailed above.
Such a short publishing interval would, however, result in a high network and server load.
You
should
therefore
set
1000
ms
as
the
&quot;Minimum
publishing
interval&quot;
for
the
server.
Clients
whose subscription requires shorter publishing intervals are &quot;slowed&quot; to 1000 ms and the
server
is
protected
from
overload.
Sampling and transmission (Sampling & Publishing) within the scope of a subscription are
communication processes which, like other communication
processes (TCP/UDP/Web server
communication...), are processed by the CPU with priority 15. OBs with higher priority
interrupt
the communication. If you set the sampling
and
transmission intervals
too short,
this
setting
causes
a
high
communication
load.
Therefore,
select
intervals
as
large
as
possible,
which
are
still
sufficient
for
the
application.
For
information
about
the
consistency
of
tags,
refer
to
Consistency
of
CPU
tags
(Page
240).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
185
OPC
UA
communication
Security
at
OPC UA
Monitoring
of
PLC
tags
When the Subscription has been created, you inform the server which tags are to be
monitored
with
it.
In
the
following
example,
the
&quot;Voltage&quot;
tag
was
added
to
the
subscription.
1711126
128382
The
&quot;Voltage&quot;
tag
contains
the
value
of
a
voltage
that
is
detected
by
an
S7-1500
CPU.
The sampling interval (&quot;Sampling Interval&quot;) contains a negative value (-1). This determines
that the default setting of the OPC UA server is used for the sampling interval. The default
setting
is
defined
by
the
transmission
interval
(&quot;Publishing
Interval&quot;)
of
the
subscription.
If
you
want
to
set
the
smallest
possible
sampling
interval,
select
the
value
&quot;0&quot;.
In this example, the length of the queue is set to &quot;1&quot;: Only one value is read from the CPU at
an
interval
of
50
milliseconds
and
subsequently
sent
to
the
OPC
UA
client
when
the
value
has
changed.
The
&quot;Deadband&quot;
parameter
in
this
example
is
&quot;0.1&quot;:
Changes
in
value
have
to
amount
to
0.1
Volt; only then does the sender send the new value to the client. The server does not send
smaller changes in value. You can use this parameter, for example, to disable signal noise:
Slight
changes
in
a
process
variable
which
do
not
have
a
real
meaning.
Security
at
OPC
UA
Security
settings
Addressing
risks
186
OPC
UA
allows
the
exchange
of
data
between
different
systems,
both
within
the
process
and
production
levels
and
to
systems
at
the
control
and
enterprise
level.
This
possibility
also
entails
security
risks.
That
is
why
OPC
UA
provides
a
range
of
security
mechanisms:
Verification
of
the
identity
of
OPC
UA
server
and
clients.
Checking
of
the
identity
of
the
users.
Signed/encrypted
data
exchange
between
OPC
UA
server
and
clients.
These
security
policies
should
only
be
bypassed
in
cases
where
it
is
absolutely
necessary:
During
commissioning
In
stand-alone
projects
without
external
Ethernet
connection
If
you
have
selected
the
endpoint
&quot;None&quot;
for
&quot;UA
Sample
Client&quot;
of
the
OPC
Foundation,
for
example,
the
program
issues
a
clear
warning:
1650110
128513
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
When
STEP
7
compiles
your
project
it
also
checks
whether
you
have
considered
the
setting
options for the protection and warns you of possible risks. This also includes an OPC UA
security
policy
with
the
setting
&quot;no
security&quot;,
which
corresponds
to
the
end
point
&quot;None&quot;.
NOTE
Disabling
security
policies
you
do
not
want
If
you
have
enabled
all
security
policies
in
the
secure
channel
settings
of
the
S7-1500
OPC
UA
server
–
thus,
also
the
end
point
&quot;None&quot;
(no
security)
–
unsecured
data
traffic
(neither
signed
nor
encrypted)
between
the
server
and
client
is
also
possible.
The
OPC
UA
server
of
the
S7-1500 CPU also sends its public certificate to the client at &quot;None&quot; (No security). And some
clients check this certificate. However, the client is not forced to send a certificate to the
server.
The
identity
of
the
client
may
possibly
remain
unknown.
Each
OPC
UA
client
can
then
connect
to
the
server
irrespective
of
any
subsequent
security
settings.
When configuring the OPC UA server, make sure that only security policies that are
compatible
with
the
security
concept
of
your
machine
or
plant
are
selected.
All
other
security
policies
should
be
disabled.
Recommendation:
Use
the
setting
&quot;Basic256Sha256
-
Sign
and
Encrypt&quot;,
which
means
that
the server only accepts Sha256 certificates. The security policies &quot;Basic128Rsa15&quot; and
&quot;Basic256&quot; are deactivated by default and should not be used as an end point. Select end
points
with
a
higher
security
policy.
Additional
security
rules
Only
use
the
end
point
&quot;None&quot;
in
exceptional
cases.
Only
use
the
&quot;guest
authentication&quot;
of
the
user
in
exceptional
cases.
Only
allow
access
to
PLC
tags
and
DB
components
via
OPC
UA
if
it
is
genuinely
necessary.
Use
the
list
of
trusted
clients
in
the
settings
of
the
S7-1500
OPC
UA
client
to
allow
access
to
certain
clients
only.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
187
OPC
UA
communication
11.2
Security
at
OPC
UA
Certificates
pursuant
to
ITU
X.509
Security mechanisms are integrated in several layers in OPC UA. Digital certificates have an
important
role
here.
An
OPC
UA
client
can
only
establish
a
secure
connection
to
an
OPC
UA
server
when
the
server
accepts
the
digital
certificate
of
the
client
and
classifies
it
as
trusted.
See
section
Handling
client
and
server
certificates
(Page
255).
The client must also check and trust the certificate of the server. The server and client must
show their identities and prove that they are what they claim to be: They must prove their
identity.
Mutual
authentication
of
client
and
server,
for
example,
prevents
man-in-the-middle
attacks.
Man-in-the-middle
attacks
A
&quot;man-in-the-middle&quot;
could
have
positioned
itself
between
server
and
client.
A
man-in-the-
middle
is
a
program
that
intercepts
communication
between
server
and
client
and
claims
to
be a client or server, and is thus able to obtain information about the S7 program or to set
values
in
the
CPU
and
attack
a
machine
or
plant.
OPC
UA
uses
digital
certificates
that
meet
standard
X.509
of
the
International
Telecommunication
Union
(ITU).
This
allows
the
identity
of
a
program,
a
computer
or
an
organization
to
be
proven
(authenticated).
X.509
certificates
An
X.509
certificate
includes
the
following
information:
Version
number
of
the
certificate
Serial
number
of
the
certificate
Information
on
the
algorithm
used
by
the
certificate
authority
to
sign
the
certificate.
Name
of
the
certificate
authority
Start
and
end
of
the
validity
period
of
the
certificate
Name
of
the
program,
person
or
organization
for
which/whom
the
certificate
has
been
signed
by
the
certificate
authority.
The
public
key
of
the
program,
person
or
organization.
An
X509
certificate
thus
links
an
identity
(name
of
a
program,
person
or
an
organization)
to
the
public
key
of
the
program,
person
or
organization.
188
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Check
during
connection
establishment
When a connection is being established between the client and server, the devices check all
information from the certificate that is required to determine its integrity, such as signature,
period of validity, application name (URN) and, in case of firmware version V2.5 only, also the
IP
address
of
the
client
in
the
client
certificate.
NOTE
The
validity
period
stored
in
the
certificate
is
also
checked.
The
CPU
clock
must
therefore
be
set and date/time must be within the validity period, otherwise no communication takes
place.
Signing
and
encryption
To allow you to check whether a certificate has been manipulated, certificates are signed.
There
are
various
possible
procedures
here
:
Within
the
TIA
Portal
you
have
the
possibility
to
generate
and
sign
certificates.
If
you
have
protected
your
project
and
are
logged
in
as
a
user
with
the
function
right
to
make
security
settings,
you
can
use
the
global
security
settings.
The
global
security
settings
allow
access
to
the
certificate
manager
and
therefore
to
the
certificate
authority
(CA)
of
the
TIA
Portal.
Additional
options
are
available
for
creating
and
signing
certificates.
In
the
TIA
Portal,
you
can
import
certificates
into
the
global
certificate
manager.
You
contact
a
certificate
authority
(CA)
and
have
your
certificate
signed.
In
this
case,
the
certificate
authority
checks
your
identity
and
signs
your
certificate
with
the private key of the certificate authority. For this purpose you send a CSR (Certificate
Signing
Request)
to
the
certificate
authority.
You
yourself
create
a
certificate
and
sign
it.
To
this
purpose
you
use,
for
example,
the
&quot;Opc.Ua.CertificateGenerator&quot;
program
of
the
OPC
Foundation.
Alternatively,
you
use
OpenSSL.
(Page
193).
You
can
find
more
information
in
Generating
PKI
key
pairs
and
certificates
yourself
Communication
Function
Manual,
11/2024,
A5E03735815-AM
189
OPC
UA
communication
Security
at
OPC UA
Useful
information:
Certificate
types
Self-signed
certificate:
Each
device
generates
and
signs
its
own
certificate.
Application
examples:
Static
configuration
with
limited
number
of
communication
nodes.
No
new
certificates
can
be
derived
from
a
self-signed
certificate.
However,
you
need
to
load
all
self-signed
certificates
from
partner
devices
to
the
CPU
(STOP
required).
CA
certificate:
All
certificates
are
generated
and
signed
by
a
certificate
authority.
Application
examples:
Dynamically
growing
plants.
You only need to download the certificate from the certificate authority to the CPU. The
certificate authority can generate new certificates (partner devices can be added without
CPU
STOP).
Signing
The
signature
makes
it
possible
to
prove
the
integrity
and
source
of
a
message
as
detailed
below.
Signing starts with the sender creating a hash value from the plain text (plain text message).
The sender then encrypts the hash value with its private key and subsequently transfers the
plain text together with the encrypted hash value to the recipient. To verify the signature, the
recipient needs the public key of the sender (this is contained in the X509 certificate of the
sender). The recipient uses the sender&apos;s public key to decrypt the hash value received. The
recipient
then
forms
the
hash
value
themselves
from
the
plain
text
received
(the
hash
process
is
contained
in
the
sender&apos;s
certificate).
The
recipient
compares
the
two
hash
values:
If the two hash values are identical, the plain text message has reached the receiver
unchanged
and
has
not
been
manipulated.
If
the
two
hash
values
do
not
match,
the
plain
text
message
has
not
reached
the
receiver
unchanged. The plain text message has been manipulated or has been distorted during
transfer.
Encryption
Encrypting data prevents unauthorized parties from reading the content. X509 certificates
are
not
encrypted;
they
are
public
and
can
be
viewed
by
anyone.
Encryption involves the sender encrypting the plain text message with the public key of the
recipient. To do so, the sender requires the recipient&apos;s X509 certificate, as it contains the
public key of the recipient. The recipient decrypts the message with their private key. Only
the
recipient
can
decrypt
the
message:
They
alone
hold
the
private
key.
The
private
key
must
therefore
never
be
disclosed.
190
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Secure
channel
OPC UA uses the private and public key of client and server to establish a secure connection,
the secure channel. Once the secure connection has been established, the client and server
generate
an
internal
key
only
known
to
them
which
they
both
use
for
signing
and
encrypting
messages. This symmetric process (a shared key) is much faster than asymmetric processes
(private
and
public
key).
More
information
An
application
example
for
the
use
of
certificates
with
the
TIA
Portal
can
be
found
here:
Using
certificates
with
TIA
Portal
(
https://support.industry.siemens.com/cs/ww/en/view/109769068
).
Certificates
with
OPC
UA
Usage
of
X509
certificates
with
OPC
UA
OPC
UA
uses
various
types
of
X.509
certificates
for
establishing
a
connection
from
client
to
server:
OPC
UA
application
certificates
Such X.509
certificates identify the software instance, the installation
of
client or server
software.
For
the
&quot;Organization
name&quot;
attribute,
you
enter
the
name
of
the
company
that
uses
the
software.
NOTE
The
OPC
UA
server
of
the
S7-1500
uses
application
certificates
even
for
the
security
setting &quot;None&quot; (no security). This ensures compatibility to OPC UA V1.1 and earlier
versions.
OPC
UA
software
certificates
This X-509 certificate identifies a specific version of the client or server software. These
certificates contain attributes that describe which tests this version of the software has
passed
during
certification
by
the
OPC
Foundation
(or
recognized
test
laboratories).
For
the &quot;Organization name&quot; attribute, you enter the name of the company that has
developed
or
markets
the
software.
NOTE
Software
certificates
are
not
supported
in
STEP
7.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
191
OPC
UA
communication
Security
at
OPC UA
OPC
UA
user
certificates
This X.509 certificate identifies the specific user who, for example, retrieves process data
from the OPC UA server. This certificate is not required if the user can authenticate itself
with
a
password,
or
if
anonymous
access
is
configured.
NOTE
User
certificates
are
not
supported
in
STEP
7.
The described certificates are end-entity certificates: They identify, for example, a person, an
organization,
a
company
or
an
instance
(installation)
of
a
software.
Creating
self-signed
certificates
Using
the
client&apos;s
certificate
generator
Many
OPC
UA
client
applications
or
SDKs
are
integrated
in
a
sample
application
that
allows
you
to
generate
certificates
for
the
client
from
this
application.
The
description
for
certificate
generation
can
generally
be
found
in
the
context
for
describing
the
OPC
UA
client
application.
Example
client
from
the
online
support
The OPC UA .NET client for the SIMATIC S7-1500 OPC UA server
(
https://support.industry.siemens.com/cs/ww/en/view/109737901
) creates a self-signed
software
certificate
of
the
client
application
in
the
Windows
Certificate
Store
during
the
first
program start. The documentation for this example describes the procedure for handling
these
certificates.
Using
the
certificate
generator
of
the
TIA
Portal
If
you
use
an
OPC
UA
client
that
does
not
generate
a
client
certificate,
you
can
create
self-
signed
certificates
with
STEP
7.
To
do
this,
follow
these
steps:
In
the
properties
of
the
CPU,
double-click
&quot;<Add
new>&quot;
under
&quot;Protection
&
Security
>
Certificate
manager
>
Device
certificates&quot;.
Click
&quot;Add&quot;.
In
the
&quot;Create
a
new
certificate&quot;
dialog,
select
the
&quot;OPC
UA
client&quot;
option
for
&quot;Usage&quot;.
Click &quot;OK&quot;.
In
the
field
&quot;Subject
Alternative
Name&quot;
STEP
7
automatically
enters
the
URI
for
the
generated
certificate. In the program-specific certificate generation by means of the .NET stack of the
OPC Foundation, the field is called, for example, &quot;ApplicationUri&quot; - it can have a different
name
in
other
tools
for
certificate
generation.
192
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
More
information
For
more
information
on
handling
client
certificates,
refer
to
the
section
Handling
of
the
client
certificates
of
the
S7-1500
CPU
(Page
373).
Generating
PKI
key
pairs
and
certificates
yourself
This
section
is
only
relevant
if
you
want
to
use
an
OPC
UA
client
that
cannot
itself
create
a
PKI
key pair and a client certificate. In this case, you generate a private and a public key using
OpenSSL,
generate
an
X.509
certificate,
and
sign
the
certificate
yourself.
Using
OpenSSL
OpenSSL
is
a
tool
for
Transport
Layer
Security
that
you
can
use
to
create
certificates.
You
can
also use other tools, for example XCA, a type of key management software with a graphical
user
interface
for
an
improved
overview
of
certificates
issued.
To
work
with
OpenSSL
under
Windows,
follow
these
steps:
Install
OpenSSL
under
Windows.
If
you
are
using
a
64-bit
version
of
the
operating
system,
install OpenSSL in the &quot;C:\OpenSSL-Win64&quot; directory, for example. You can obtain
OpenSSL-Win64
as
a
download
from
various
providers
for
open
source
software.
Create
a
directory,
for
example
&quot;C:\demo&quot;.
Open
the
command
prompt.
To
do
so,
click
&quot;Start&quot;
and
enter
&quot;cmd&quot;
or
&quot;command
prompt&quot;
in the search field. Right-click &quot;cmd.exe&quot; in the results list and run the program as an
administrator.
Windows
opens
the
command
prompt.
Change
to
the
&quot;C:\demo&quot;
directory.
To
do
this,
enter
the
following
command:
&quot;cd
C:\demo&quot;.
Set
the
following
network
variables:
set
RANDFILE=c:\demo\.rnd
set
OPENSSL_CONF=C:\OpenSSL-Win64\bin\openssl.cfg
The
figure
below
shows
the
command
line
with
the
following
commands:
1985391
124469
Now
start
OpenSSL.
If
OpenSSL
has
been
installed
in
the
C:\OpenSSL-Win64
directory,
enter the following: C:\OpenSSL-Win64\bin\openssl.exe The figure below shows the
command
line
with
the
following
command:
Communication
Function
Manual,
11/2024,
A5E03735815-AM
193
OPC
UA
communication
11.2
Security
at
OPC
UA
Generate a private key. Save the key to the &quot;myKey.key&quot; file. The key in this example is
1024 bits long; for greater RSA security, use 2048 bits in practice. Enter the following
command: &quot;genrsa -out myKey.key 2048&quot; (&quot;genrsa -out myKey.key 1024&quot; in the example).
The
figure
below
shows
the
command
line
with
the
command
and
the
output
of
OpenSSL:
1810639
129159
Generate
a
CSR
(Certificate
Signing
Request).
To
do
this,
enter
the
following
command:
&quot;req -new -key myKey.key -out myRequest.csr&quot;. During execution of this command,
OpenSSL
queries
information
about
your
certificate:
Country
name:
for
example
&quot;DE&quot;
for
Germany,
&quot;FR&quot;
for
France
State
or
province
name:
for
example
&quot;Bavaria&quot;.
Location
Name:
for
example
&quot;Augsburg&quot;.
Organization
Name:
Enter
the
name
of
your
company.
Organizational
Unit
Name:
for
example
&quot;IT&quot;
Common
Name:
for
example
&quot;OPC
UA
client
of
machine
A&quot;
Email
Address:
NOTE
Note
for
S7-1500
CPU
as
server
with
firmware
version
V2.5
The IP address of the client program has to be stored in the &quot;Subject Alternative Name&quot; field
of the created certificate for S7-1500 CPUs version V2.5 (only for this version); otherwise, the
CPU
will
not
accept
the
certificate.
The
information
you
enter
is
added
to
the
certificate.
The
figure
below
shows
the
command
line
with
the
command
and
the
output
of
OpenSSL:
1620011
130472
The
command
creates
a
file
in
the
C:\demo
directory
containing
the
Certificate
Signing
Request
(CSR);
in
the
example,
this
is
&quot;myRequest.csr&quot;.
194
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Using
the
CSR
There
are
two
ways
to
use
a
CSR:
You send the CSR to a certificate authority (CA): Read the information of the respective
certification authority. The certificate authority (CA) checks your information and identity
(authentication) and signs the certificate with the private key of the certificate authority.
You receive the signed X.509 certificate and use this certificate for OPC UA, HTTPS or
Secure OUC (secure open user communication), for example. Your communication
partners use the public key of the certificate authority to check whether your certificate
was really issued and signed by that CA (i.e. that the certificate authority has confirmed
your
information).
You
sign
the
CSR
yourself:
Using
your
private
key.
This
option
is
shown
in
the
next
step.
Signing
the
certificate
yourself
Enter
the
following
command
so
that
you
can
generate
and
sign
your
certificate
(self-signed
certificate) yourself: &quot;x509 -req -days 365 -in myRequest.csr -signkey myKey.key -out
myCertificate.crt&quot;.
The
figure
below
shows
the
command
line
with
the
command
and
OpenSSL:
1799970
127109
The command generates an X.509 certificate with the attributes that you transfer with the
CSR
(in
the
example
&quot;myRequest.csr&quot;),
for
example
with
a
validity
of
one
year
(-days
365).
The command also signs the certificate with your private key (&quot;myKey.key&quot; in the example).
Your communication partners can use your public key (contained in your certificate) to check
that
you
are
in
possession
of
the
private
key
that
belongs
to
this
public
key.
This
also
prevents
your
public
key
from
being
misused
by
an
attacker.
With
self-signed
certificates,
you
yourself
confirm
that
the
information
in
your
certificate
is
correct.
There
is
no
independent
body
that
checks
your
information.
More
information
You
will
find
information
about
the
handling
of
client
certificates
of
the
S7‑1500
CPU
in
the
section
Handling
of
the
client
certificates
of
the
S7-1500
CPU
(Page
373).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
195
OPC
UA
communication
11.2
Security
at
OPC
UA
Secure
transfer
of
messages
Establishing
secure
connections
with
OPC
UA
OPC
UA
uses
secure
connections
between
client
and
server.
OPC
UA
checks
the
identity
of
the
communication partners. OPC UA uses certificates in accordance with X.509-V3 from the ITU
(International Telecommunication Union) for client and server authentication. Exception: A
secure
connection
is
not
established
with
the
&quot;No
security&quot;
security
policy.
Message
security
mode
OPC
UA
uses
the
following
security
policies
to
protect
messages:
No
security
All
messages
are
unsecured.
In
order
to
use
this
security
policy,
establish
a
connection
to
a
None
end
point
of
a
server.
Signing
All message are signed. This allows the integrity of the messages received to be checked.
Manipulations
are
detected.
In
order
to
use
this
security
policy,
establish
a
connection
to
a
Sign
end
point
of
a
server.
Sign
&
Encrypt
All
messages
are
signed
and
encrypted.
This
allows
the
integrity
of
the
messages
received
to be checked. Manipulations are detected. What is more, no attacker can read the
content of the message (protection of confidentiality). In order to use this security policy,
establish
a
connection
to
a
&quot;SignAndEncrypt&quot;
end
point
of
a
server.
The security policies are also named according to the algorithms used. Example:
&quot;Basic256Sha256
-
Sign
&
Encrypt&quot;
means:
Secure
endpoint,
supports
a
series
of
algorithms
for
256-bit
hashing
and
256-bit
encryption.
196
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Layers
required
The
figure
below
shows
the
three
layers
that
are
always
required
for
establishing
a
connection:
the
transport
layer,
the
secure
channel
and
the
session.
2
3
&
8
$
F
O
i
H
Q
W
23&
8$
VHUYHU
6HVViRQ
6
H
F
X
U
H
F
K
D
QQ
H
O
&
R
P
P
X
Q
i
F
D
W
i
R
Q
O
D
\
H
U
-
&
R
Q
I
i
G
H
Q
W
i
D
O
i
W
\
ದ
I
Q
W
H
J
U
i
W
\
–
$
S
S
D
X
W
K
H
Q
W
i
F
D
W
i
R
Q
7
U
D
Q
V
S
R
U
W
O
D
\
H
U
&
R
P
P
X
Q
i
F
D
W
i
R
Q
O
D
\
H
U
&
R
Q
I
i
G
H
Q
W
i
D
O
i
W
\
ದ
I
Q
W
H
J
U
i
W
\
$
S
S
D
X
W
K
H
Q
W
i
F
D
W
i
R
Q
$
SS
O
i
F
D
W
i
R
Q
O
D
\
H
U
–
8
V
H
U
D
X
W
K
R
U
i
]
D
W
i
R
Q
ದ
8
V
H
U
D
X
W
K
H
Q
W
i
F
D
W
i
R
Q
$
SS
O
i
F
D
W
i
R
Q
O
D
\
H
U
–
8
V
H
U
D
X
W
K
R
U
i
]
D
W
i
R
Q
ದ
8
V
H
U
D
X
W
K
H
Q
W
i
F
D
W
i
R
Q
Figure
11-6
Necessary
layers:
transport
layer,
secure
channel
and
session
Transport
layer:
This
layer
sends
and
receives
messages.
OPC
UA
uses
an
optimized
TCP-based
binary
protocol
here.
The
transport
layer
is
the
basis
for
the
subsequent
secure
channel.
Secure
channel
The
secure
channel
receives
the
data
received
from
the
transport
layer,
and
forwards
that
data to the session. The secure channel forwards data of the session that is to be sent to
the
transport
layer.
In
&quot;Sign&quot;
security
mode,
the
secure
channel
signs
the
data
(messages)
that
is
sent.
When
a
message
is
received,
the
secure
channel
checks
the
signature
to
detect
any
manipulations.
With
a
&quot;SignAndEncrypt&quot;
security
policy,
the
secure
channel
signs
and
encrypts
the
send
data. Data received is decrypted by the secure channel, and the secure channel then
checks
the
signature.
With
the
&quot;No
security&quot;
security
policy,
the
message
packages
pass
the
secure
channel
unchanged
(the
messages
are
received
and
sent
in
plain
text).
Session
The
session
forwards
the
messages
from
the
secure
channel
to
the
application,
or
receives
from the application the messages that are to be sent. The application uses the process
values
or
provides
the
values.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
197
OPC
UA
communication
Security
at
OPC UA
Establishing
the
secure
channel
The
secure
channel
is
established
as
follows:
The
server
starts
establishing
the
secure
channel
when
it
receives
a
request
to
this
effect
from
the
client.
This
request
is
signed
or
signed
and
encrypted,
or
the
message
is
sent
in
plain text (security mode of the selected server end point). With &quot;Sign&quot; and &quot;Sign &
Encrypt&quot;,
the
client
sends
a
&quot;secret&quot;
(random
number)
with
the
request.
The server validates the client certificate (contained in the request, unencrypted) and
checks
the
identity
of
the
client.
If
the
server
trusts
the
client
certificate,
it
decrypts
the
message
and
checks
the
signature
(&quot;Sign
&
Encrypt&quot;),
checks
the
signature
only
(&quot;Sign&quot;),
or
leaves
the
message
unchanged
(&quot;No
security&quot;)
The server then sends a response to the client (same level of security as the request). The
server
secret
is
contained
in
the
response.
The
client
and
server
calculate
a
symmetric
key
from
the
client
and
server
secret.
The
secure
channel
is
now
established.
The
symmetric
key
(instead
of
the
private
and
public
key
of
client
and
server)
is
now
used
for
signing
and
encrypting
messages.
Establishment
of
the
session
The
session
is
executed
as
follows:
The
client
starts
establishing
the
session
by
sending
a
CreateSessionRequest
to
the
server.
This
message
contains
a
Nonce,
a
random
number
that
is
only
used
once.
The
server
must
sign this random number (Nonce) to prove that it is the owner of the private key. The
private key belongs to the certificate that the server uses to establish the secure channel.
This
message
(and
all
subsequent
messages)
is
secured
in
line
with
the
security
policies
of
the
selected
server
endpoint
(selected
security
policies).
The
server
responds
with
the
CreateSession
Response.
This
message
contains
the
public
key
of
the
server
and
the
signed
Nonce.
The
client
checks
the
signed
Nonce.
If
the
server
passes
the
test,
the
client
sends
a
SessionActivateRequest
to
the
server.
This
message
contains
the
information
that
is
required
for
user
authentication:
User
name
and
password,
or
X.509
certificate
of
the
user
(not
supported
in
STEP 7),
or
No
data
(if
anonymous
access
is
configured).
If
the
user
has
the
necessary
rights,
the
server
returns
a
message
to
the
client
(ActivateSessionResponse).
This
activates
the
session.
The
secure
connection
between
the
OPC
UA
client
and
server
has
been
established.
Establishing
a
connection
to
PLCopen
function
block
The
PLCopen
specification
defines
a
range
of
IEC
61131
function
blocks
for
OPC
UA
clients.
The instruction UA_Connect initiates both a secure channel and a session following the
pattern
described
above.
198
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Certificate
management
via
Global
Discovery
Server
(GDS)
Automated
certificate
management
with
GDS
As
of
TIA
Portal
V17
and
S7-1500
CPU
firmware
version
V2.9
,
you
can
use
the
certificate
management services of the OPC UA server to transfer OPC UA server certificates during
runtime.
OPC
UA
certificates,
trust
lists
and
certificate
revocation
lists
(CRLs)
for
the
OPC
UA
server
of
the
S7-1500
CPU
can
be
updated
automatically
using
GDS
push
management
functions.
The
automation of the certificate management eliminates any manual work required for
reconfiguring the CPU, for example, after the period of validity of a certificate has expired,
and a fresh download of the CPU. You can also use the GDS push management functions to
transfer
updated
certificates
and
lists
in
the
STOP
and
RUN
operating
states
of
the
CPU.
The
certificate
management
information
model
is
specified
in
OPC
UA
Part
12
(OPC
10000-12:
OPC
Unified
Architecture,
Part
12:
Discovery
and
Global
Services).
As
of
TIA
Portal
version
V18
and
S7-1500
CPU
firmware
version
V3.0
,
you
can
also
use
the
GDS push management function for web server certificates. The sequence of, for example,
certificate updates via GDS push-management functions is identical here in principle to the
certificate update of OPC UA server certificates. Instead of OPC UA server certificates, you
transfer web server certificates to the CPU at runtime or during operation. The differences or
restrictions
are
explained
in
the
following
description
at
the
corresponding
places.
The following sections provide a general overview of Global Discovery Services and the
function
of
an
automated
certificate
update
supported
as
of
TIA
Portal
V17
/
CPU
firmware
version
V2.9.
Discovery
server
To connect to an OPC UA server, an OPC UA client requires information about its endpoint
such
as
the
endpoint
URL
and
the
security
policy.
When
a
large
number
of
possible
servers
are
available in the network, a discovery server can take over the search and management of this
server
information.
OPC
UA
servers
register
with
the
discovery
server.
OPC
UA
clients
request
a
list
of
accessible
servers
from
the
discovery
server
and
then
connect
to
the
desired
OPC
UA
server.
Global
Discovery
Server
(GDS)
The
OPC
UA
GDS
concept
allows
the
configuration
of
cross-subnet
discovery
services
on
the
one
hand
and
provides
interfaces
for
central
certificate
management
on
the
other
hand.
A
Global
Discovery
Server
(GDS)
makes
mechanisms
available
for
the
central
management
of
the
following
components:
CA-signed
certificates
and
self-signed
certificates
Trusted
Lists
and
Certificate
Revocation
Lists
(CRL)
A
GDS
thus
provides
an
access
point
to
central
certificate
management
and
takes
over
the
task
of
a
security
server
within
an
OPC
UA
network.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
199
OPC
UA
communication
Security
at
OPC UA
The
main
application
of
GDS
is
the
management
of
CA-signed
certificates
with
the
corresponding
CRLs:
Initial
creation
of
an
OPC
UA
application
certificate,
for
example,
for
the
OPC
UA
server
or
for
the
web
server
Regular
update
of
the
trust
list
and
the
CRLs
Renovation
of
an
application
certificate
Certificate
management
Certificate
management
has
the
task
of
automating
the
administration
and
distribution
of
certificates
and
trust
lists
for
different
services
or
UA
applications.
In
this
context,
a
distinction
is
made
between
the
following
roles:
Certificate
manager
-
an
OPC
UA
application
that
provides
certificate
management
functions
Certificate
recipient
–
an
OPC
UA
application
that
receives
certificates,
trust
lists
and
CRLs
from
the
certificate
manager.
There
are
two
models
for
certificate
management:
Pull
and
push
management.
With
pull
management,
the
OPC
UA
application
acts
as
a
client
of
the
GDS
server
and
uses
certificate
management
methods
to
request
certificate
updates
and
trust
list
updates.
With
push
management,
the
OPC
UA
application
acts
as
a
server
and
provides
methods
for
an OPC UA GDS as OPC UA client. The GDS in the role of certificate manager uses these
methods to transfer (&quot;push&quot;) certificates and trusted list updates, see explanation of the
concept
for
automated
certificate
update
below.
As
of
firmware
version
V2.9,
the
S7-1500
CPU
currently
only
supports
push
management
for
the
OPC
UA
server
of
the
CPU.
200
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
System
configuration
with
GDS
The
figure
below
shows
an
example
of
the
tasks
of
the
devices
involved
in
combination
with
a
GDS
that
provides
certificate
management
functions.
1
3
2
①
Root
CA
-
device
that
issues
certificates
for
the
system
(these
certificates
can
also
be
transmit-
ted
in
other
ways,
for
example,
by
email)
②
OPC UA GDS with certificate manager creates or signs device certificates, manages trust lists
and
certificate
revocation
lists
(CRLs),
and
writes
certificates
and
lists
to
the
devices
(push
func-
tion).
This
device
requires
OPC
UA
client
functionality
for
the
push
function.
③
Device
with
OPC
UA
application
receives
&quot;pushed&quot;
certificates
and
lists
Concept
for
automated
certificate
update
for
STEP
7
version
V17
and
higher
GDS
and
certificate
manager
are
usually
combined
into
one
application;
however,
in
the
figure
below,
they
are
two
separate
components.
Devices such as &quot;normal&quot; OPC UA clients are also suitable as certificate managers, but they
need
to
support
the
Bytestring
data
type
that
is
required
to
transfer
certificates,
for
example,
an S7-1500 CPU firmware V2.9 and higher as OPC UA client or the UA Expert tool (Unified
Automation)
with
GDS
plugin.
The OPC UA server of the S7-1500 CPU as certificate receiver provides the standardized
methods
and
attributes
that
the
OPC
UA
client
certificates
need
to
read
and
write
trust
lists
and
CRLs.
The focus in the context of the OPC UA server of the S7-1500 CPU is the description of the
push
function
in
contrast
to
the
usual
manner
in
which
certificates
are
provided
to
the
CPU:
By
loading
the
hardware
configuration.
The
figure
below
shows
how
to
transfer
certificates
and
lists
for
OPC
UA
in
an
S7-1500
CPU
FW
V2.9
or
higher:
Either
by
loading
the
hardware
configuration
(if
appropriate,
in
STOP
mode
of
the
CPU;
the certificates are part of the hardware configuration and can only be loaded in RUN
mode
under
specific
conditions;
see
Tip:
Updating
loaded
certificates
in
RUN
(Page
76))
Or
via
GDS
push
methods
in
RUN
or
in
STOP
mode
of
the
CPU.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
201
OPC
UA
communication
Security
at
OPC UA
It
is
not
possible
to
use
both
transmission
paths
in
parallel.
If,
for
example,
you
have
opted
for
transfer of OPC UA server certificates with GDS push functions at runtime, you must also
transmit
all
the
other
certificate
types
to
the
CPU
via
this
route.
(%4
$AI
$
F
S
U
J
꫼
D
B
U
F
%
B
U
B
C
B
T
F
(
F
U
L
J
T
U
5
S
V
T
U
01$
6
A
-
$
M
J
F
O
U
1
V
T
I
(
6
Q
E
B
U
F
$
F
S
U
J
꫼
D
B
U
F
T
01$
6A
4FSWFS
1
P
S
U
B
M
5*A
47-1500
$16
$
F
S
U
J
꫼
D
B
U
F
T
(
%
P
X
O
M
P
B
E
)
B
S
E
X
B
S
F
D
P
O
꫼
H
V
S
B
U
J
P
O
)
4*MA5*$
MFNPSZ
$BSE
BOE
5SVTU
LJTU)
$F
S
U
J
꫼
D
B
U
F
M
B
OB
H
F
S
$F
S
U
J
꫼
D
B
U
F
3
F
D
F
J
W
F
S
More
information
You
can
find
more
information
on
the
certificates
for
OPC
UA
in
the
section
Certificates
with
OPC
UA
(Page
191).
Configuration
limits
for
Push
function
Number
of
certificates
for
Push
function
For
the
OPC
UA
Push
function,
an
S7-1500
CPU,
regardless
of
the
type,
has
a
configuration
limit
of
62
trust
list
entries
as
of
firmware
version
V2.9.
Each
activated
certificate-based
service
(CPU
application)
&quot;consumes&quot;
one
entry
each
for
a
certificate
and
an
entry
for
the
private
key.
A
Certificate
Revocation
List
entry
(CRL)
counts
just
as
an
entry
in
the
list
of
trusted
certificates.
A
certificate
that
is
used
by
different
services
(CPU
applications)
counts
as
a
single
trust
list
entry.
Size
of
elements
for
Push
function
(e.g.
certificates)
Max.
4096
bytes
202
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Example
You
want
to
grant
access
to
the
OPC
UA
server
for
up
to
62
OPC
UA
clients
and
fill
the
trusted
list
accordingly.
When
you
add
a
Certificate
Revocation
List
entry
in
the
trusted
list,
you
can
only
trust
up
to
61
client
certificates.
Additional
OPC
UA
certificates
can
not
be
transferred
by
loading
the
hardware
configuration
to
the
CPU.
Tip
To
keep
the
number
of
required
certificates
low,
we
recommend
having
the
OPC
UA
client
certificates
signed
by
the
same
CA.
In this case, the CPU as OPC UA server only needs the corresponding CA certificate and CRLs.
With
these
elements,
the
OPC
UA
server
can
then
verify
all
client
certificates
signed
by
the
CA.
This
means
you
do
not
have
to
add
the
individual
client
certificates
to
the
trusted
list.
Setting
and
loading
GDS
parameters
The
following
describes
the
settings
required
for
the
certificate
update.
Requirement
Depending
on
the
application
certificate,
the
corresponding
STEP
7/TIA
Portal
version
and
S7-1500
CPU
firmware
version
is
required.
(Page
64)
See
also
here:
What
you
should
know
about
the
certificate
management
For
OPC
UA
server
certificates,
for
example,
TIA
Portal
from
V17
onwards,
CPU
firmware
version
V2.9
For web server certificates, for example, from TIA Portal V18, CPU firmware version
V3.0
Timet/date
of
the
CPU
is
set
(generally
applies
to
certificate-based
communication)
The
OPC
UA
server
is
enabled.
The
service
that
the
GDS
push
management
uses
must
be
enabled.
For
example,
the
web
server
must
be
enabled
for
the
transfer
of
web
server
certificates.
At
least
one
endpoint
with
the
&quot;Sign
&
Encrypt&quot;
security
policy
must
be
configured
for
the
OPC
UA
server.
The
partner
must
use
this
endpoint
Communication
Function
Manual,
11/2024,
A5E03735815-AM
203
OPC
UA
communication
Security
at
OPC UA
An
authenticated
user
with
sufficient
function
rights
is
configured
The
user
must
have
a
role
that has
the
&quot;Manage
certificates&quot;
function
right
.
This function
right, in
turn,
has the following
requirements:
Project
protection
must
be
enabled
in
the
project
tree:
Project
tree:
&quot;Security
settings
>
Settings
>
Project
protection&quot;.
The
user
with
a
role
that
has
the
&quot;Manage
certificates&quot;
function
right
is
configured
in
the
project
navigation
&quot;Security
Settings
>
Users
and
Roles&quot;.
(Page
265)
TIA
Portal
<
V19:
In
the
&quot;OPC
UA
>
General&quot;
area
of
the
CPU
settings,
the
following
general user management setting must be enabled: &quot;Enable additional user
management
via
project
security
settings&quot;
The
Users
and
roles
with
OPC
UA
function
rights
function
rights.
section
describes
how
to
set
the
Activating
GDS
When
the
requirements
listed
above
are
met,
you
must
still
enable
the
GDS:
In
the
Inspector
window
(CPU
parameters),
go
to
the
&quot;OPC
UA
>
Server
>
General&quot;
area.
Enable
the
&quot;Enable
Global
Discovery
Services
(Push)&quot;
option.
Determining
the
certificate
store
used
Certificates
that
are
managed
using
GDS,
are
in
a
different
memory
area
than
the
certificates
that
are
downloaded
via
the
TIA
Portal
(STEP
7).
When
GDS
push
certificate
management
is
enabled,
the
services
(applications)
of
the
CPU
also
use
certificates
from
the
certificate
store
whose
certificates
are
managed
at
runtime.
In
the
CPU
settings,
navigate
to
the
area
&quot;Protection
&
Security
>
Certificate
management&quot;.
Select
the
&quot;Use
certificates
provided
by
the
certificate
management
at
runtime&quot;
option.
The other option (use certificates configured and downloaded using TIA Portal) uses the
certificates that are downloaded from the TIA Portal to the CPU with the configuration or
configuration
changes.
In
this
certificate
store,
no
certificates
or
trust
lists
can
be
updated
at runtime and certificates can only be updated within specific constraints (see Tip:
Updating
loaded
certificates
in
RUN
(Page
76)).
204
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Enabling
the
diagnostics
for
the
lapsing
of
certificates
If you wish to be informed in advance about the lapsing of a certificate, select the &quot;Enable
system
diagnostics
event
for
the
certificate
lapsing&quot;
option
in
the
area
&quot;Protection
&
Security
>
Certificate
management&quot;.
In
the
input
field
&quot;Show
event
at
remaining
certificate
validity
period
of:&quot;
enter
a
percent
value.
Effect
of
these
settings:
At
the
instant
when
this
value
is
reached
by
a
certificate,
a
corresponding
system
diagnostics
message
appears
till
the
certificate
lapses
or
is
refreshed.
If the end of the validity period of a certificate has been reached, the CPU generates a
corresponding
system
diagnostics
message
as
well
as
an
entry
in
the
diagnostics
buffer
and
the
maintenance
LED
lights
up.
Example
:
The certificate transferred via GDS on June 01, 2022 has a validity from June 01, 2022 to
June
30,
2022
(30 days).
You
have
input
a
percent
value
of 10
for the diagnostics
event.
On
June 27, 2022, when 90% of the period of validity lapses, a corresponding message will
appear
stating
that
the
certificate
that
had
been
transferred
will
lapse
on
June
30,
2022.
Regardless
of
the
configured
percentage
value,
upon
lapsing
of
the
period
of
validity
of
a
certificate, a corresponding message is displayed in any case, an entry is made in the
diagnostics
buffer,
and
the
maintenance
LED
lights
up.
Download
to
CPU
When
downloading
the
configuration
to
the
CPU,
you
can
delete
the
certificates
that
are
managed
via
GDS
before
the
download.
When
you
confirm
the
deletion,
the
download
is
followed
by
a
provisioning
phase
(see
section
on
commissioning).
When
you
download
the
memory
card
outside
of
the
CPU
(card
reader),
this
certificate
store
is
always
deleted.
When
Global
Discovery
Services
(Push)
is
activated
and
no
pushed
certificates
are
available,
then
no
separate
certificate,
trust
list
or
CRL
is
available
for
the
OPC
UA
server.
GDS
commissioning
Part
12
of
the
OPC
UA
specification
distinguishes
between
a
provisioning
phase
and
a
run
time
phase
during
certificate
management.
In the provisioning phase, a GDS or OPC UA client provides initial trust lists and CRLs for
clients of the OPC UA server. In this phase, the OPC UA server of the CPU accepts all client
certificates
and
lists
it
is
offered
–
similar
to
the
&quot;Trusted
clients&quot;
setting
for
the
OPC
UA
server
that all client certificates are accepted during runtime. This is the only way in which a
connection to clients not known to the server is possible. For example, clients that the server
cannot authenticate using existing certificates or trust lists until it has received the
corresponding
client
certificate
or
the
corresponding
trust
list.
The
provisioning
phase
is
characterized
by
lower
security;
therefore,
the
provisioning
phase
is
indicated by a lit Maintenance LED and a corresponding diagnostics buffer entry
(Maintenance
demanded).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
205
OPC
UA
communication
11.2
Security
at
OPC
UA
During
the
runtime
phase,
the
existing
CRLs
are
updated,
for
example,
and
the
certificates
and
trust
lists
are
renewed.
Communication
is
secure
in
this
phase.
Requirement
Only authorized users with sufficient function rights can set up a connection in the
provisioning
phase.
The
users
must
have
a
role
with
the
function
right
&quot;Manage
certificates&quot;.
See
also
Setting
and
loading
GDS
parameters
(Page
203).
Rules
for
the
provisioning
phase
In
the
provisioning
phase,
the
OPC
UA
server
of
the
CPU
cannot
authenticate
the
OPC
UA
clients that initiate connection establishment. Therefore, the following rules must be
observed:
Provide
a
secure
environment,
for
example,
access
to
the
CPU
is
limited
to
commissioning
personnel.
Check
that
the
right
devices
are
communicating
with
one
another.
Limit
the
time
for
this
phase.
The
CPU
signals
that
it
is
in
the
provisioning
phase
by
the
lit
Maintenance
LED
as
well
as
a
corresponding
diagnostics
buffer
entry
(Maintenance
demanded).
206
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Sequence
of
the
provisioning
phase
The
following
provides
an
outline
of
the
process
of
the
provisioning
phase
for
OPC
UA
server
certificates
and
trust
lists.
The
process
of
the
provisioning
phase
for
web
server
certificates
is
comparable.
In
contrast
to OPC UA, the GDS client only pushes web server certificates but not trust lists into the
corresponding
certificate
store.
1SPWJTJPOJOH
QIBTF
/P
USVTU
MJTUT
(MJTU
PG
USVTUFE
DMJFOUT)
BWBJMBCMF
JO
$16
/P
TFSWFS
DFSUJ꫼DBUF
BWBJMBCMF
JO
$16
01$
6
A
TF
S
W
FS
PG
U
IF
$16
H
FOFS
B
U
FT
TFMG-TJHOFE
DF
S
UJ
꫼
DB
U
F
BOE
Q
S
J
W
B
U
F
LFZ
(UFNQPSBSZ)
((%4)
$MJFOU
DPOOFDUT
UP
$16
(TFDVSF)
$MJFOU
NVTU
BDDFQU
TFMG-TJHOFE
DF
S
UJ꫼DB
U
F
((%4)
$MJFOU
X
S
J
U
FT
DF
S
UJ꫼DB
U
FT
BOE
USVT
U
MJT
UT
JO
U
IF
EFTJHOB
U
FE
DF
S
UJ꫼DB
U
F
T
U
P
S
F
PG
U
IF
$16
(&quot;QVTI&quot;
GVODUJPO)
AMM
FYJTUJOH
DPOOFDUJPOT
CFUXFFO
DMJFOU
BOE
$16
BSF
UFSNJOBUFE.
$MJFOU
S
FDPOOFDUT
U
P
U
IF
$16
CBTFE
PO
U
IF
O
F
X
DF
S
UJ꫼DB
U
FTlUSVT
U
MJT
UT
Communication
Function
Manual,
11/2024,
A5E03735815-AM
207
OPC
UA
communication
Security
at
OPC UA
Entering
the
provisioning
phase
After
startup
of
the
OPC
UA
server,
the
CPU
automatically
enters
the
provisioning
phase
when
one
of
the
following
conditions
is
met:
The
OPC
UA
server
certificate
is
the
initial
self-signed
certificate
generated
by
the
CPU
and
has
not
yet
been
replaced
by
a
valid
server
certificate.
The
trust
list (list
of
trustworthy
clients)
is empty.
The
OPC
UA
server
certificate
generated
by
the
CPU
contains
the
most
important
parameters
of
the
OPC
UA
server
and
is
re-generated,
including
the
private
key,
after
each
startup
of
the
OPC UA server following POWER ON - until the valid server certificate is present. For this
reason,
the
OPC
UA
server
may
take
longer
to
start
up
after
a
POWER
ON.
After the hardware configuration is downloaded, the certificate store for certificates that can
be
updated
during
runtime
is
deleted
on
download
or
the
certificates
are
retained,
depending
on the setting. This means that if GDS is activated and the certificate store has been deleted,
the
CPU
is
in
the
provisioning
stage
after
the
hardware
configuration
has
be
loaded.
Provisioning
phase
diagnostics
In
addition
to
the
lit
Maintenance
LED,
the
GDS
address
model
has
two
nodes
that
provide
information
on
whether
the
OPC
UA
server
of
the
CPU
is
in
the
provisioning
phase:
1665304
158419
You
can
only
use
the
two
nodes
as
marked
in
the
figure
for
diagnostics
if
the
requirements
for GDS are met (endpoint security signed & encrypted plus administrator function rights
available).
ProvisioningModeEnabled:
Indicates
that
a
provisioning
phase
is
supported
ProvisioningModeActive:
Indicates
that
the
OPC
UA
server
of
the
CPU
is
in
the
provisioning
phase.
End
of
the
provisioning
phase
The
CPU
ends
the
provisioning
phase
automatically
when
the
following
conditions
are
met:
The
certificate
generated
and
self-signed
by
the
CPU
for
the
provisioning
phase
has
been
overwritten by a valid server certificate. This valid server certificate can be a self-signed
certificate
or
a
CA-signed
certificate.
The
trust
list
in
the
CPU
is
not
empty,
i.e.
client
certificates
of
the
OPC
UA
clients
to
be
trusted
or
CA
certificates
for
checking
the
client
certificates
are
available.
If
the
OPC
UA
client
transfers
a
CA-signed
certificate
and
also
adds
the
CA
certificate
to
the
trust
list,
the
OPC
UA
server
of
the
CPU
can
automatically
accept
all
other
certificates
from
OPC
UA
clients
that
were
signed
by
the
same
CA.
208
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Request
of
a
valid
server
certificate
As of TIA Portal version V18 / S7-1500 CPU version V3.0, in addition to OPC UA server
certificates,
certificates
for
other
services
can
also
be
transferred
to
the
CPU,
for
example,
for
the
web
server.
The
corresponding
service,
for
example,
the
OPC
UA
server
of
the
CPU,
receives
a
valid
certificate
in
the
following
steps:
A
GDS
client
(OPC
UA
client)
calls
the
method
&quot;CreateSigningRequest&quot;
to
request
a
server
certificate:
with
a
Certificate
Signing
Request
(CSR).
This
CSR
must
be
signed
by
a
Certificate
Authority
(CA).
The
signed
CSR
must
then
be
transferred
back
to
the
OPC
UA
server
of
the
CPU
as
a
certificate.
The
OPC
UA
server
of
the
CPU
makes
this
method
available
if
the
client
has
the
required
function
right
&quot;Manage
certificates&quot;.
The
&quot;CreateSigningRequest&quot;
method
allows
for
the
following
variants:
Certificate
update
without
creating
a
new
key
pair
(internal
CPU
keys
that
are
already
available
are
used)
Certificate
update
with
creation
of
a
new
key
pair
(CPU-internal)
There
is
also
the
possibility
to
generate
certificates
with
externally
created
key
pairs.
Recommended
procedure
to
generate
certificates
Transport
of
private
keys
should
be
avoided;
a
private
key
should
not
leave
a
device.
We,
therefore,
recommend
the
generation
of
a
certificate
without
creating
a
new
key
pair
or
with
the
creation
of
a
key
pair
inside
the
CPU.
NOTICE
Create
certificate
without
key
pair
The
&quot;CreateSigningRequest&quot;
method
returns
a
Certificate
Signing
Request
(CSR),
that
is,
a
file (*.csr) with specific information on the server or on the service, for example,
application
name
and
URL.
Outside
of
the
CPU,
this
CSR
must
be
validated
and
signed
by
a
Certificate
Authority
(CA)
and
the
certificate
must
be
returned.
The
certificate
must
then
be
transferred
to
the
CPU
(&quot;pushed&quot;)
using
the
&quot;UpdateCertificate&quot;
method.
The
key
does
not
leave
the
CPU
in
this
scenario.
Create
certificate
with
internally
created
key
pair
The
procedure
is
similar
to
the
method
explained
in
the
previous
section;
the
only
difference
is that a key pair is generated in addition to the CSR. You specify in the parameter of the
&quot;CreateSigningRequest&quot;
method
that
it
is
to
generate
a
key
pair.
The
private
key
does
not
leave
the
CPU
in
this
procedure
either.
The
generation
of
a
new
key
pair
creates
a
very
heavy
load
on
the
CPU.
The
CPU
processes
this request over a longer period of time with lower priority in the reserved area for the
communication
load.
The
duration
of
this
time
period
depends
on
the
performance
of
the
CPU.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
209
OPC
UA
communication
11.2
Security
at
OPC
UA
Because
the
share
of
the
set
communication
load
is
fully
utilized
during
key
generation
over
a
longer
period
of
time,
set
the
&quot;Cycle
load
due
to
communication&quot;
share
so
that
the
maximum
cycle time is not exceeded and sufficient reserves are available. For this, use the web server
page
&quot;Diagnostics
>
Runtime
information&quot;
of
the
CPU.
This
page
shows
information
about
the
current program/communication load and cycle time of your user program. Via a controller,
you
can
get
help
on
the
effects
of
a
changed
communication
load
on
the
cycle
time.
Create
certificate
with
externally
created
key
pair
The
certificate
is
generated
with
the
help
of
tools,
for
example,
that
can
generate
additional
keys.
Certificate
and
keys
are
transferred
to
the
CPU
using
the
&quot;UpdateCertificate&quot;
method.
Due
to
low
security,
this
procedure
is
not
recommended.
Different
keys
for
different
target
systems
Always use newly generated keys for a production system. If you simulate and test your
project,
e.g.
with
PLCSIM
Advanced
on
your
PC,
do
not
under
any
circumstances
use
the
keys
used
for
the
simulation
also
for
a
productive
system.
Restrict
the
access
to
PC-based
controllers
by
setting
up
appropriate
permissions.
NOTICE
Address
model
for
the
push
certificate
management
The OPC UA specification Part 12 (OPC 10000-12: Discovery, Global Services) defines
methods
and
attributes
for
OPC
UA
servers,
for
example,
that
enable
GDS
or
OPC
UA
clients
to
update certificates and trust lists on the server (&quot;Push certificate management&quot;). These
methods
and
attributes
are
also
included
in
the
address
model
of
the
OPC
UA
server.
The
relevant
section
in
the
address
model
of
the
OPC
UA
server
of
the
S7-1500
CPU
is
explained
below.
Requirement
The
following
requirements
must
be
met
for
the
relevant
methods
and
attributes
to
become
visible
for
the
GDS
push
functionality:
GDS
is
activated.
The
set
security
policy
supports
the
integrity
and
confidentiality
of
the
data
through
signature
and
encryption
(Sign
&
Encrypt).
Access
with
runtime
function
right
&quot;Manage
certificates&quot;
210
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Address
model
for
the
GDS
push
functionality
The
address
model
for
the
GDS
push
functionality
corresponds
to
the
&quot;Information
Model
for
Push
Certificate
Management&quot;
of
the
OPC
UA
specification
OPC
10000-12:
Discovery,
Global
Services.
You
will
find
the
following
structure
below
the
&quot;ServerConfiguration&quot;
node:
1837984
126299
Methods
and
attributes
for
access
to
the
address
model
The
methods
and
attributes
are
briefly
described
below
with
special
features
and
restrictions
of the specific address model of the S7-1500 CPU. The OPC UA specification listed above
contains
the
general
description.
You
can
find
a
detailed
description
of
the
individual
methods
below
this
overview
table.
Method
/
Attribute (Variable)
Description
CreateSigningRequest
Method
for
generating
a
PKCS#10-encoded
certificate
request
signed with the private key of the service (for example, OPC
UA
server).
UpdateCertificate
Method
for
updating
the
server
certificate,
for
example,
for
the
OPC
UA
server.
ApplyChanges
Method for applying a security-relevant change if the
&quot;ApplyChangesRequired&quot;
attribute
was
set
when
executing
a
previously
executed
method.
Note
If,
as
a
result
of
&quot;ApplyChanges&quot;,
a
certificate
is
changed,
the
CPU
interrupts
the
connections/sessions
that
are
secured
via
this
certificate.
Background:
The
basis
for
the
secured
connections
-
the
certi-
ficate
-
is
no
longer
valid.
GetRejectedList
Method
that
returns
a
list
of
certificates
that
were
rejected
by
the
OPC
UA
server.
Rejected
certificates
are
currently
not
stored
by
the
OPC
UA
server of the S7-1500 CPUs. The method returns an empty
array
(RejectedList).
ServerCapabilities
Variable
is
not
supported
by
the
OPC
UA
server
of
the
S7-1500
CPU.
SupportedPrivateKeyFormats
Variable
that
specifies
permitted
formats
of
the
private
key.
For
S7-1500
CPUs
only
&quot;PEM&quot;
(String
Array)
Communication
Function
Manual,
11/2024,
A5E03735815-AM
211
OPC
UA
communication
Security
at
OPC UA
Method
/
Attribute
(Variable)
Description
MaxTrustListSize
Variable
that
specifies
the
maximum
size
of
the
trust
list.
MulticastDnsEnabled
Variable
that
specifies
whether
multicast
DNS
is
supported.
For
S7-1500
CPUs,
the
value
is
&quot;False&quot;.
CertificateGroups
Object
(folder)
that
organizes
all
certificate
groups
supported
by the OPC UA server. The certificate groups contain the
objects that can be updated dynamically during runtime: For
example, one trust list each and one or multiple certificates
that are assigned to a service (for example, OPC UA applica-
tion).
Details on the structure of the CertificateGroups object and
the
methods
and
attributes
that
are
available
in
the
object
are
described
in
the
next
section.
CreateSigningRequest
The
method
has
the
following
parameters:
Parameter
Data
type
Description
[in]
certificateGroupId
NodeId
NodeId
of
the
CertificateGroup
object.
[in]
certificateTypeId
NodeId
Requested
certificate
type.
List
of
permitted
certificate
types
is
specified
by
the &quot;CertificateTypes&quot; variable of the certificate
group.
For the OPC UA server for example, certificate
type &quot;RsaSha256ApplicationCertificateType&quot;,
for
the web server the certificate type
&quot;HttpsCertificateType&quot;
[in]
subjectName
String
Subject
Name
that
is
requested
in
the
Certificate
Request. If not specified, the current Subject
Name
of
the
certificate
is
used.
[in]
regeneratePrivateKey
Boolean
True: Server generates a new private key. This
key
is
saves
until
the
UpdateCertificate
methods
with
the
matching
signed
certificate
is
called.
False:
Server
uses
the
available
private
key.
[in]
nonce
ByteString
Additional
nonce
for
generating
the
new
private
key (see regeneratePrivateKey). Must be at least
32
bytes
long.
[out]
certificateRequest
ByteString
PKCS
#10
-
DER
coded
Certificate
Request.
Method
Result
Codes
Result
Code
Description
Bad_InvalidArgument
certificateTypeId,
certificateGroupId or
subjectName
is
invalid.
Bad_UserAccessDenied
The
current
user
does
not
have
the
required
func-
tion
rights.
212
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
UpdateCertificate
Applications:
Generation
of
certificate
with
CreateSigningRequest.
No
private
key
is
available.
New
private
key
and
new
certificate
were
generated
outside
of
the
server.
Both
are
updated
with
UpdateCertificate.
Certificate
generated
and
signed
with
the
private
key
of
the
existing
certificate.
No
private
key
is
available.
Parameter
Data
type
Description
[in]
certificateGroupId
NodeId
NodeId
of
the
CertificateGroup
object.
[in]
certificateTypeId
NodeId
Requested
certificate
type.
List
of
permitted
certificate
types
is
specified
by
the &quot;CertificateTypes&quot; variable of the certificate
group.
[in]
certificate
ByteString
DER-coded
certificate
that
replaces
the
existing
certificate.
[in]
issuerCertificates
ByteString
Issuer
certificates
[in]
privateKeyFormat
String
Format of the private key. Currently only PEM is
supported.
If
the
privateKey
is
not
specified:
zero
or
empty
string.
[in]
privateKey
ByteString
Privater
key
coded
as
specified
in
privateKeyFormat.
[out]
applyChangesRequired
Boolean
Indicates
that
the
&quot;ApplyChanges&quot;
method
must
be
called
before
you
use
the
new
certificate.
Method
Result
Codes
Result
Code
Description
Bad_InvalidArgument
certificateTypeId
or
certificateGroupId
is
invalid.
Bad_CertificateInvalid
The
certificate
is
invalid
or
the
format
is
not
sup-
ported.
Bad_NotSupported
The
private
key
is
invalid
or
the
format
is
not
sup-
ported.
Bad_UserAccessDenied
The
current
user
does
not
have
the
required
func-
tion
rights.
Bad_SecurityChecksFailed
Error occurred when verifying the integrity of the
certificate.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
213
OPC
UA
communication
11.2
Security
at
OPC
UA
Apply
Changes
GetRejectedList
The
method
has
no
parameters.
Method
Result
Codes
Result
Code
Description
Bad_UserAccessDenied
The
current
user
does
not
have
the
required
func-
tion
rights.
The
method
has
the
following
parameters:
Parameter
Data
type
Description
[out] certificates
ByteStrings
DER-coded
list
of
rejected
certificates.
The method currently returns an empty list
(empty array), because rejected certificates are
not
stored.
Method
Result
Codes
Result
Code
Description
Bad_UserAccessDenied
The
current
user
does
not
have
the
required
func-
tion
rights.
CertificateGroups
in
the
address
model
Certificates and trust lists for services or applications of the CPU (for example, OPC UA
servers) that can be updated during runtime are located in the address model in the
&quot;CertificateGroups&quot;
object
-
there
is
one
certificate
group
each
for
the
various
services
of
the
S7‑1500
CPU.
For
the
OPC
UA
server
certificate,
the
certificate
group
has
the
name
&quot;OPC
UA
server&quot;.
CertificateGroup
in
the
address
model
The
following
figure
shows
the
structure
of
the
&quot;CertificateGroups&quot;
object
below
the
&quot;ServerConfiguration&quot;
node.
1677091
129334
214
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
You
can
change
the
Display
Name
of
the
CertificateGroups
(e.g.
of
the
&quot;OPC
UA
server&quot;)
in
STEP
7
(TIA
Portal):
In
the
Inspector
window
(CPU
properties),
navigate
to
the
area
&quot;Protection
&
Security
>
Certificate
management&quot;.
Enable
the
option
&quot;Use
certificates
provided
by
certificate
management
during
runtime&quot;
option.
Change
the
group
name
(DisplayName)
of
the
certificate
group
in
the
table
below.
1-64
characters
in
7-bit
ASCII
format
are
permitted.
The first column contains the activated service for which certificates can be transferred at
runtime
and
the
&quot;ID&quot;
column
contains
a
fixed
numeric
identifier
that
is
used
CPU-internally
for
referencing
the
certificate.
Here
is
an
example
for
the
display
in
the
area
&quot;Certificate
management&quot;:
1799970
125149
Figure
11-7
Certificate
management
settings
&quot;CertificateTypes&quot;
node
The
&quot;CertificateTypes&quot;
variable
specifies
the
NodeIds
of
the
certificate
types
that
are
assigned
to
the
server
application.
For
the
OPC
UA
server
service,
for
example,
the
&quot;RsaSha256ApplicationCertificateType&quot;
CertificateType is supported, for the web server, it is the &quot;HttpsCertificateType
CertificateType&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
215
OPC
UA
communication
11.2
Security
at
OPC
UA
&quot;TrustList&quot;
node
The node for the trust list object (TrustList file) defines an OPC UA file type (Binary encoded
stream)
that
contains
information
on
the
certificates
and
CRLs
that
can
be
read
and
updated
in the &quot;pki store\trusted\issuer&quot; directory of the
Memory Card. This node provides methods
and
attributes
that
make
reading
and
updating
possible.
The
node
is
an
instance
of
the
OPC
UA
data
type
&quot;TrustListDataType&quot;
with
the
following
structure:
Parameter
Data
type
Description
specifiedLists
TrustListsMasks
Bit
mask
that
shows
which
lists
contain
informa-
tion.
trustedCertificates
ByteStrings
List
of
the
application
certificates
and
CA
certific-
ates
that
can
be
trusted.
trustedCrls
ByteStrings
CRLs
for
the
certificates
in
the
&quot;trustedCertificates&quot;
list.
issuerCertificates
ByteStrings
List
of
the
CA
certificates
that
are
required
for
validating
the
CA
signed
certificates.
issuerCrls
ByteStrings
CRLs
of
the
CA
certificates
in
the
&quot;issuerCertificates&quot;
list.
Structure
of
the
&quot;TrustList&quot;
node
The
&quot;TrustList&quot;
node
has
the
following
structure:
1657957
149423
216
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Methods
and
attributes
for
the
&quot;TrustList&quot;
node
Below is a description of the nodes under &quot;TrustList&quot; that supplement the methods of the
Object
Type
&quot;FileType&quot;.
The
TrustList
Type
is
derived
from
FileType
(see
OPC
10000‑5:
OPC
Unified
Architecture,
Part
5:
Information
Model).
Method
/
Attribute (Variable)
Description
LastUpdateTime
Variable
that
shows
the
time
of
the
last
update.
OpenWithMasks
Method
that
permits
a
client
to
only
read
a
part
of
the
TrustList.
CloseAndUpdate
Method
for
closing
the
TrustList
file
and
applying
the
changes.
AddCertificate
Method
for
adding
a
single
certificate
to
the
TrustList.
RemoveCertificate
Method
for
removing
a
single
certificate
from
the
TrustList.
Description
of
the
methods
The
description
of
the
methods
with
their
result
codes,
attributes
and
types
of
the
TrustList
object
is
available
in
the
OPC
UA
specification
Part
12,
Discovery
and
Global
Services.
Role-based
security
in
OPC
UA
11.2.8.1
Interesting
facts
about
role-based
security
In OPC UA, the concept for role-based security is defined in Part 18 of the OPC UA
specification
(OPC
10000-18:
UA
Part
18:
Role-Based
Security).
Parts
3
and
5
of
the
OPC
UA
specification, which contain individual aspects of the role definition, are also relevant, e.g.
which roles a server should support with which permissions and which objects are defined
with
which
attributes
or
properties
in
the
address
space.
With the implementation of the role-based concept for the S7-1500 CPUs as of firmware
version
V4.0,
the
OPC
UA
server
can
manage
the
access
of
clients
to
the
address
space
on
a
fine-grained
basis.
Individual
OPC
UA
access
rights
to
nodes
in
the
address
space
With
the
help
of
role-based
security
for
OPC
UA,
you
can
configure
the
roles
and
associated
permissions
that
determine
the
possibilities
for
accessing
nodes
in
the
existing
namespaces
using
the
OPC
UA
server
interfaces
/
companion
specifications.
The
configuration
options
for
roles
and
permissions
in
the
server
interface
together
with
the
user
management
in
the
TIA
Portal
(users
and
roles)
enable
effective
access
management.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
217
OPC
UA
communication
Security
at
OPC UA
Relationship
between
roles/permissions
for
OPC
UA
and
roles/function
rights
for
users
and
roles
The users that you define as part of the local or central user management in the security
settings
of
the
project
(users
and
roles)
are
taken
into
account
for
the
access
control
of
the
OPC UA server as follows: only users with the &quot;OPC UA server access&quot; function right are
allowed
to
access
the
OPC
UA
server.
Local
or
central
user
management
of
the
CPU
is
responsible
for
authenticating
the
users
(OPC
UA
clients)
who
access
the
OPC
UA
server.
The OPC UA server of the CPU is responsible for authorizing users (OPC UA clients), i.e. for
checking
whether
a
user
is
allowed
to
perform
the
requested
action
(e.g.
read
or
write
to
a
node).
You configure the access control for the OPC UA server in the corresponding OPC UA
server
interface.
The
&quot;Access
control&quot;
area
has
been
added
to
the
editor
for
OPC
UA
server
interfaces.
The
following
settings
are
possible
in
this
area:
Mapping
of
existing
roles
(from
the
Security
settings
of
the
project
>
Users
and
roles)
to
the
OPC
UA
roles.
Assignment
of
default
permissions
for
the
namespace
of
the
server
interface.
Additionally, you can define access restrictions for the namespaces. For example, you
can specify that permission for an action is granted to the role only within certain
constraints,
e.g.
that
messages
are
signed
and
encrypted.
Customization of the default permissions for individual nodes of the server
interface/companion specification: In a separate &quot;Access management&quot; tab of the
server
interface
editor,
you
can
customize
the
permissions
for
each
role
on
node
level
(from
CPU
view:
variables)
to
adapt
the
permissions.
During
operation,
this
has
the
effect
that
one
or
more
roles
are
assigned
to
the
session
of
a
logged-on
user.
The
assigned
roles
ensure
that
accesses
to
a
node
in
the
address
space
are
only possible when the OPC UA permissions of the roles for this node and the configured
access
restrictions
permit
this
(e.g.
read
or
write).
User
roles
on
the
OPC
UA
server
A view of the server interface is available for imported companion specifications with user
management data, which also displays the imported OPC UA roles in addition to the roles
from
the
user
management
(users
and
roles).
A
mapping
between
OPC
UA
roles
and
roles
in
the project is possible in this view. The namespace in which the role is defined is also
displayed
for
each
role.
For
some
pre-defined
OPC
UA
roles
in
namespace
0,
there
are
no
direct
equivalents
in
&quot;Users
and roles&quot;, e.g. the &quot;AuthenticatedUser&quot; role. Users who successfully authenticate themselves
with username/password receive the access rights that were assigned to the
&quot;AuthenticatedUser&quot;
role.
218
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.2
Security
at
OPC
UA
Roles
and
permissions
for
OPC
UA
In
the
editor
for
users
and
roles,
you
can
create
a
role
that
is
then
available
for
the
further
configuration
of
server
interfaces.
Assigning roles and OPC UA permissions is possible for elements of server interfaces
(variables,
methods)
and
for
complete
namespaces
(i.e.
for
all
nodes
in
the
namespace).
You
can
assign
the
following
OPC
UA
permissions
to
a
role:
Browse
-
A
client
with
this
permission
can
see
references
to/from
this
node,
i.e.
also
for
all
attributes
with
the
exception
of
the
Value
and
RolePermissions
attributes.
Read
-
A
client
with
this
permission
can
read
the
Value
attribute.
Write
-
A
client
with
this
permission
can
write
to
the
Value
attribute.
Call
-
A
client
with
this
permission
can
call
the
corresponding
method;
valid
for
objects,
object
types
or
methods.
Receive
events
-
A
client
with
this
permission
can
receive
events
(alarms
and
conditions).
Read
Role
Permissions
-
A
client
with
this
permission
may
read
the
RolePermissions
attribute.
You
can
also
activate
additional
access
restrictions
for
namespaces
and
individual
nodes:
Signing Required - A client only has access to the nodes if a SecureChannel is used that
digitally
signs
the
messages.
See
also
the
explanation
of
the
&quot;Apply
Restrictions
to
Browse&quot;
restriction.
Encryption
Required
-
A
client
only
has
access
to
the
nodes
if
a
SecureChannel
is
used
that
encrypts the messages. See also the explanation of the &quot;Apply Restrictions to Browse&quot;
restriction.
Apply
Restrictions
to
Browse
-
If
this
access
restriction
is
activated,
the
requirements
described for &quot;Signing Required&quot; and &quot;Encryption
Required&quot; also apply to browse
permission.
Requirements
S7-1500 CPU
with
firmware
V4.0
or
higher
TIA
Portal
as
of
V20
Communication
Function
Manual,
11/2024,
A5E03735815-AM
219
OPC
UA
communication
Security
at
OPC UA
Rules
To
assign
roles
to
users
or
user
groups,
use
the
editor
for
users
and
roles
(Security
settings
>
Users
and
roles
in
the
project
tree).
These
users
and
user
groups
are
also
used
by
the
OPC
UA
server.
The
CPU
or
a
connected
UMC
server
carries
out
the
authentication
service
when
logging
on.
The
logged
in
user
must
have
the
function
right
&quot;OPC
UA
server
access&quot;.
Adding
additional
roles
during
runtime
is
not
possible.
All
roles
and
associated
OPC
UA
permissions for the address space have to be configured before commissioning and
loaded
in
the
CPU.
You
can
achieve
greater
flexibility
with
regard
to
users
if
you
use
a
UMC
server
for
central
user
management
and
combine
users
into
groups.
OPC
UA
offers
various
criteria
for
authorizing
server
access;
in
OPC
UA
jargon
these
are
&quot;mapping
rules&quot;,
for
example:
User
identity:
Access
depends
on
the
identity
of
the
user
Application
identity:
Access
depends
on
the
ApplicationUri
specified
in
the
client
certificate
Endpoint:
Access
depends
on
the
URL
used
to
access
the
server.
The
OPC
UA
server
of
the
S7-1500
CPU
only
validates
the
permission
via
the
user
identity.
The
OPC
UA
server
of
the
S7-1500
CPU
supports
&quot;Well-Known
Roles&quot;,
which
are
defined
in
OPC
10000-3:
UA
Part
3:
Address
Space
Model.
The
&quot;SecurityKeyServer...&quot;
roles
are
defined
in
OPC
10000-14:
UA
Part
14
PubSub,
section
8.8.
Well-Known
Roles
The
OPC
Foundation
has
pre-defined
roles
in
namespace
0
(http://opcfoundation.org/UA/);
these roles are available without a separate role definition for every OPC UA server that
supports
role-based
security.
Examples
of
&quot;Well-Known
Roles&quot;:
Anonymous, AuthenticatedUser, Observer, Operator, Engineer, Supervisor, ConfigureAdmin,
SecurityAdmin
and
Security
Key
Service
roles.
You
can
easily
add
these
roles
as
standard
OPC
UA
roles
in
the
TIA
Portal.
More
information
You can find the latest information on configuring the role-based security for S7-1500 CPUs
in
the
product
information
(
https://support.industry.siemens.com/cs/ww/en/view/68052815
).
220
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Using
the
S7-1500
as
an
OPC
UA
server
Interesting
information
about
the
OPC
UA
server
of
the
S7-1500
CPUs
The
OPC
UA
server
of
the
S7-1500
CPUs
The
S7‑1500
CPUs
as
of
firmware
V2.0
are
equipped
with
an
OPC
UA
server.
Apart
from
the
Standard-S7-1500
CPUs
this
applies
to
the
variants
S7-1500F,
S7-1500T,
S7-1500C,
S7-1500pro
CPUs,
ET
200SP
CPUs,
SIMATIC
S7-1500
SW
controllers
and
PLCSIM
Advanced.
Convention:
&quot;S7‑1500
CPUs&quot;
also
includes
the
above-mentioned
CPU
variants.
S7-1500
CPU
OPC
UA
server
basics
Access
to
the
OPC
UA
server
of
the
CPU
is
possible
via
all
integrated
Ethernet
interfaces
of
the
S7-1500
CPU.
Direct
access
to
the
OPC
UA
server
of
the
CPU
over
the
backplane
bus
of
the
automation
system
is
not
possible
via
CPs
under
the
following
conditions:
Configuration
with
TIA
Portal
Version
V16
or
higher
S7-1500 CPU firmware version 2.8 or higher and CP 1543-1 firmware version V2.2 or
higher
For
configuration,
see
Access
to
OPC
UA
applications
(Page
174)
.
Direct
access
to
the
OPC
UA
server
of
the
CPU
over
the
backplane
bus
of
the
automation
system
is
not
possible
via
CMs.
For
access
by
clients,
the
server
saves
the
enabled
PLC
tags
and
other
information
in
the
form
of
nodes
(see
Accessing
OPC
UA
server
data
(Page
230)).
These
nodes
are
interconnected
and
form a network. OPC UA defines access points to this network (well-known nodes) that
enable
navigation
to
subordinate
nodes.
With
an
OPC
UA
client
you
can
read,
observe
or
write
values
of
tags
of
the
PLC
program
as
well as call methods that are available to the server. As of firmware version 2.5 you can
implement
methods,
see
Useful
information
about
server
methods
(Page
307).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
221
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Node
classes
OPC
UA
servers
provide
information
in
the
form
of
nodes.
A
node
can
be,
for
example,
an
object,
a
tag,
a
method
or
a
property.
The
example
below
shows
the
address
space
of
the
OPC
UA
server
of
an
S7-1500
CPU
(extract
from
the
OPC
UA
client
&quot;UaExpert&quot;
from
Unified
Automation).
1620011
132561
Figure
11-8
Example
of
the
address
space
of
the
OPC
UA
server
of
an
S7-1500
CPU
In
the
figure
above,
the
&quot;MyValue&quot;
tag
is
selected
(highlighted
in
gray).
This
tag
is
located
below
the
&quot;Memory&quot;
node,
which
has
the
node
class
&quot;Object&quot;.
&quot;Memory&quot;
is
below
the
&quot;PLC_1&quot;
node
(also
an
Object).
Address
space
The nodes are linked over references, for example, the reference &quot;HasComponent, which
represents
a
hierarchical
relationship
between
a
node
and
its
subordinate
nodes.
With
their
references,
the
nodes
form
a
network
that
can,
for
example,
take
the
form
of
a
tree.
A
network
of
nodes
is
also
called
an
address
space.
Starting
from
the
root,
all
nodes
can
be
reached
in
the
address
space.
222
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
End
points
of
the
OPC
UA
server
The
end
points
of
the
OPC
UA
server
define
the
security
level
for
a
connection.
Depending
on
the
purpose
of
use
or
desired
security
level,
you
have
to
carry
out
the
corresponding
settings
for
the
connection
at
the
end
point.
Different
security
settings
Before
establishing
a
secure
connection,
OPC
UA
clients
ask
the
server
with
which
security
settings connections are possible. The server returns a list with all the security settings
(endpoints)
that
the
server
offers.
Structure
of
end
points
End
points
consist
of
the
following
components:
Identifier
for
OPC:
&quot;opc.tcp&quot;
IP
address:
192.168.178.151
(in
the
example)
Port
number
for
OPC
UA:
4840
(standard
port)
The
port
number
can
be
configured.
Security
setting
for
messages
(Message
Security
Mode):
None,
Sign,
SignAndEncrypt.
Encryption and hash procedures (Security Policy): None, Basic128Rsa15, Basic256,
Basic256Sha256
(in
the
example).
The
following
figure
shows
the
&quot;UA
Sample
Client&quot;
of
the
OPC
Foundation.
The
client
has
established
a
secure
connection
to
the
OPC
UA
server
of
an
S7-1500
CPU
to
the
end point &quot;opc.tcp://192.168.178.151:4840 - [SignAndEncrypt: Basic256Sha256:Binary]&quot;. The
security
settings
&quot;SignAndEncrypt:Basic256Sha256&quot;
are
contained
in
the
end
point.
NOTE
Select
an
endpoint
with
a
security
policy
that
is
as
strict
as
possible
for
the
server
Only
activate
the
most
secure
endpoints
on
the
OPC
UA
server
that
a
client
still
supports.
Deactivate
the
security
policy
with
a
lower
security
policy
on
the
OPC
UA
server.
Establishing
a
connection
to
the
server
(client-side)
To
establish
a
connection
to
the
server,
select
the
appropriate
security
policy
for
the
application.
Corresponding
certificates
are
required
for
the
activated
endpoints
of
the
OPC
UA
server
of
the
CPU
(e.g.
a
Sha256
certificate
for
Basic256Sha256).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
223
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
1620011
113343
Figure
11-9
&quot;UA
Sample
Client&quot;
program
of
the
OPC
Foundation
A
connection
to
a
server
end
point
is
only
established
if
the
OPC
UA
client
complies
with
the
security
policies
of
that
end
point.
Through
the
information
provided
by
the
OPC
UA
server
OPC
UA
servers
provide
a
wide
range
of
information:
The
values
of
PLC
tabs
and
DB
components
which
clients
may
access.
The
data
types
of
these
PLC
tags
and
DB
components.
Information
on
the
OPC
UA
server
itself
and
on
the
CPU.
This gives clients an overview and allows them to read out specific information. Previous
knowledge
of
the
PLC
program
and
the
CPU
data
is
not
required.
You
do
not
need
to
ask
the
developer of the PLC program when PLC tags are to be read. All necessary information is
stored
on
the
server
itself
(for
example,
the
data
types
of
the
PLC
tags).
224
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Display
of
the
information
of
the
OPC
UA
server
You
have
the
following
options:
Online:
You
have
all
the
available
information
displayed
during
the
runtime
of
the
OPC
UA
server.
To
do
so,
navigate
(browse)
the
address
space
of
the
server.
Offline:
You
export
an
XML
file
that
is
based
on
the
XML
schemes
of
the
OPC
Foundation.
307).
(Page
Server
methods
created
by
the
user
(FB
instance
that
can
be
called
by
an
OPC
UA
client)
are
not
exported
as
of
STEP
7
V15.1,
see
Providing
methods
on
the
OPC
UA
server
Offline with the Openness API: In your program, you use the API (Application
Programming
Interface)
of
the
TIA
Portal
to
access
the
function
for
exporting
all
PLC
tags
that
can
be
read
by
OPC
UA.
This
requires
.NET
Framework
4.0;
see
TIA
Portal
Openness,
Automating
SIMATIC
projects
with
scripts
(
https://support.industry.siemens.com/cs/ww/en/view/109477163
).
If
you
already
know
the
syntax
and
the
PLC
program,
you
can
access
the
OPC
UA
server
without
first
researching
the
information.
Mapping
of
data
types
SIMATIC
and
OPC
UA
data
types
SIMATIC
data
types
do
not
always
correspond
with
OPC
UA
data
types.
S7-1500
CPUs
provide
SIMATIC
tags
(with
SIMATIC
data
types)
to
their
own
OPC
UA
server
as
OPC
UA
data
types.
OPC
UA
clients
can
then
access
these
tags
with
OPC
UA
data
types
via
the
server
interface.
A
client
can
read
the
attribute
&quot;DataType&quot;
from
such
a
tag
and
reconstruct
the
original
data
type
in
SIMATIC.
Example
A
tag
has
the
SIMATIC
data
type
&quot;COUNTER&quot;.
You
read
COUNTER
→
UInt16
in
the
table.
You
now know that you do not need to convert; the COUNTER value is sent over the line as a
UInt16
data
type.
The
client
detects
from
the
attribute
&quot;DataType&quot;
that
the
tag
is
actually
the
SIMATIC
data
type
&quot;COUNTER&quot;.
With
this
knowledge,
the
client
reconstructs
the
data
type.
Table
11-1
SIMATIC
and
OPC
UA
data
types
SIMATIC
data
type
OPC
UA
data
type
BOOL
Boolean
BYTE
BYTE
→
Byte
WORD
WORD
→
UInt16
DWORD
DWORD
→
UInt32
LWORD
LWORD
→
UInt64
SINT
SByte
Communication
Function
Manual,
11/2024,
A5E03735815-AM
225
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
SIMATIC
data
type
OPC
UA
data
type
INT
Int16
DINT
Int32
LINT
Int64
USINT
Byte
UINT
UInt16
UDINT
UInt32
ULINT
UInt64
REAL
Float
LREAL
Double
S5TIME
S5TIME
→
UInt16
TIME
TIME
→
Int32
LTIME
LTIME
→
Int64
DATE
DATE
→
UInt16
TIME_OF_DAY
(TOD)
TOD
→
UInt32
LTIME_OF_DAY
(LTOD)
LTOD
→
UInt64
DATE_AND_TIME
(DT)
DT
→
Byte[8]
LDT
DateTime
DTL
Special note: You can only describe the structure
completely
with
an
OPC
UA
client.
You
have
read-
only access individual elements of this structure
(e.g.
&quot;YEAR&quot;)
mapped
as
structure
CHAR
CHAR
→
Byte
WCHAR
WCHAR
→
UInt16
STRING
(Code
page
1252
or
Windows-1252)
STRING
→ String
WSTRING
(UCS-2;
Universal
Coded
Character
Set)
String
TIMER
TIMER
→
UInt16
COUNTER
COUNTER
→
UInt16
226
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Arrays
A
read
or
write
job
with
OPC
UA
is
always
an
array
access,
which
means
that
it
always
has
an
index and length. A single tag is a special case of an array (index 0 and length 1). The data
type
is
simply
sent
repeatedly
on
the
line.
For
the
tags,
the
&quot;DataType&quot;
attribute
indicates
the
basic
data
type.
The
attributes
&quot;ValueRank&quot;
and
&quot;ArrayDimensions&quot;
show
whether
or
not
you
are
dealing
with
an
array
and
how
large
the
array
is.
Data
types
based
on
arrays
There
are
SIMATIC
data
types
for
which
an
OPC
UA
value
is
mapped
to
an
array
of
bytes.
An
array
of
these
data
types
is
then
mapped
to
a
two-dimensional
array.
Example:
The
SIMATIC
data
type
DATE_AND_TIME
(DT)
is
mapped
on
the
OPC
UA
side
to
an
8-byte array (Byte[8]), see table above. When you define an array of the SIMATIC data type
DATE_AND_TIME
(DT),
then
it
is
considered
as
two-dimensional
array.
This
fact
affects
the
use
of
system
data
types
such
as
OPC_UA_NodeAdditionalInfo
and
OPC_UA_NodeAdditionalInfoExt,
for
example:
For
the
data
types
described
above,
you
must
use
the
system
data
type
OPC_UA_NodeAdditionalInfoExt
for
multidimensional
arrays
instead
of
OPC_UA_NodeAdditionalInfo.
Structures
Structures are transferred as ExtensionObject. The S7-1500 server uses binary representation
for transmission of the ExtensionObjects over the line; the individual structure elements
come
one
after
the
other.
At
the
front
is
the
NodeId
of
the
data
type;
this
is
used
by
the
client
to
establish
the
structure.
For
OPC
UA
Specification
<=
V1.03,
a
client
has
to
read,
decode
and
interpret
the
complete
DataTypeDictionary
for
this
(unless
it
has
already
learned
this
library
offline
through
an
XML
import).
AS of OPC UA V1.04, the DataTypeDefinition attribute is available, which can be read and
interpreted
more
quickly
and
easily.
A
client
only
determines
the
setup
of
the
structure
once,
before or during the first access, and then uses this information for the duration of the
session.
Special
SIMATIC
data
types
SIMATIC
data
types
that
are
not
in
the
table
above
and
cannot
be
defined
as
elements
of
a
structure
or
PLC
data
type
are
not
supported
by
the
OPC
UA
client.
These
are,
for
example,
&quot;ANY&quot;
or
&quot;POINTER&quot;
pointers,
function
block
&quot;Block_FB&quot;,
function
&quot;Block_FC&quot;
or
hardware
data
type
&quot;REMOTE&quot;.
The
selection
of
an
unsupported
data
type
leads
to
an
error
message.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
227
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Additional
information
More
details
on
mapping
of
basic
data
types,
arrays
and
structures
can
be
found
in
the
OPC
UA
Specification
Part
6,
&quot;Mappings&quot;
(see
OPC
UA
BINARY
there).
What
must
be
considered
with
arrays
and
data
types
DTL
and
LDT
in
the
OPC
UA
server
of
a
SIMATIC
S7-1500?
FAQ
(
https://support.industry.siemens.com/cs/ww/en/view/109766726
)
Runtime
behavior
of
the
OPC
UA
server
OPC
UA
server
in
operation
The
OPC
UA
server
of
the
S7-1500
CPU
starts
when
you
activate
the
server
and
download
the
project
to
the
CPU.
How
to
activate
the
OPC
UA
server
is
described
here.
Behavior
in
the
operating
state
STOP
of
the
CPU
An
activated
OPC
UA
server
remains
in
operation
even
if
the
CPU
switches
to
&quot;STOP&quot;.
The
OPC
UA
server
continues
to
respond
to
requests
from
OPC
UA
clients.
Server
response
in
detail:
If
you
request
the
values
of
PLC
tags,
you
will
get
what
were
the
latest
values
before
the
CPU
switched
to
or
was
set
to
&quot;STOP&quot;.
If
you
write
values
to
the
OPC
UA
server,
the
OPC
UA
server
will
accept
those
values.
However,
the
CPU
will
not
process
the
values
because
the
user
program
is
not
executed
in
&quot;STOP&quot;
mode.
An
OPC
UA
client
can
nonetheless
read
the
values
written
at
STOP
from
the
OPC
UA
server
of
the
CPU.
During
restart,
the
CPU
overwrites
the
values
written
at
STOP
with
the
start
of
the
PLC
tags.
If you call a server method, the error message 16#00AF_0000 (BadInvalidState) is output
because
the
server
method
(user
program)
is
not
running.
Connections to the OPC UA server remain active during an operating mode transition
(STOP
>
RUN
or
RUN
>
STOP).
Exception:
OPC
UA-relevant
data
is
loaded,
see
next
section.
228
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Download
to
the
CPU
may
affect
OPC
UA
server
If you load a CPU with running OPC UA server, you may need to stop and restart the server
depending
on
the
loaded
objects.
In
this
case,
active
connections
are
interrupted
and
must
be
re-established
once
the
server
restarts.
The
duration
of
the
restart
depends
mainly
on
the
following
parameters:
The
scope
of
the
data
structure
The
number
of
variables
visible
in
the
OPC
UA
address
space
The
setting
for
downward
compatible
data
type
definition
according
to
OPC
UA
specification
to
V1.03
(TypeDictionary
enabled)
(Page
383)
Settings
for
the
communication
load
and
minimum
cycle
time,
you
can
find
additional
information
here
With
CPU
FW
versions
older
than
V2.8,
the
OPC
UA
server
was
stopped
at
each
download
to
the
CPU
and
then
restarted.
As
of
FW
version
V2.8,
the
behavior
of
the
OPC
UA
server
has
been
optimized
as
follows:
When
objects
are
downloaded
in
STOP
operating
state
of
the
CPU,
the
OPC
UA
server
still
always
stops
and
then
restarts.
STEP
7
does
not
show
a
warning
in
this
case.
When
objects
are
downloaded
in
RUN
operating
state
of
the
CPU,
the
OPC
UA
server
only
stops if the downloaded objects are, or could be, OPC UA-relevant. The OPC UA server
restarts
after
re-initialization
due
to
the
modified
OPC
UA
data.
Before
OPC-UA-relevant
objects
are
loaded
into
the
CPU
and
stop
the
OPC
UA
server,
STEP
7 displays a warning in the preview dialog for loading. You can then decide whether a
server restart is compatible for the running process or whether you want to cancel the
download. These warnings are only displayed when the OPC UA server is running. If the
OPC
UA
server
is
not
enabled,
modified
OPC
UA
data
have
no
influence
on
the
download
process.
Examples
You
only
want
to
add
another
code
module
to
the
program.
Neither
data
blocks
nor
inputs,
outputs,
flags,
times
or
counters
are
affected.
Reaction
during
loading:
A
running
OPC
UA
server
is
not
interrupted.
You
want
to
load
a
new
data
module
and
you
have
flagged
the
data
module
as
non-OPC-UA-relevant:
Reaction
during
loading:
A
running
OPC
UA
server
is
not
interrupted.
You
want
to
overwrite
a
data
module.
Reaction
during
loading:
A
warning
appears
that
the
server
will
be
restarted.
Background:
STEP
7
cannot
determine
whether
the
changes
refer
to
OPC-UA-relevant
data
or
not.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
229
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Reading
CPU
operating
mode
over
OPC
UA
server
The
OPC
UA
server
allows
you
to
read
out
the
CPU
mode,
see
figure
below:
1696075
142173
Figure
11-10
Reading
CPU
operating
mode
over
OPC
UA
server
In
addition
to
the
operating
mode
of
the
CPU
you
can,
for
example,
read
out
information
in
the
manual
(DeviceManual)
or
firmware
version
(HardwareRevision).
Accessing
OPC
UA
server
data
Client
accesses
and
local
accesses
to
the
OPC
UA
server
An OPC UA server provides a lot of information for OPC UA clients within a network. The
following
section
describes
options
for
making
CPU
tags
(PLC
tags
and
DB
elements)
available
in
the
address
space
of
your
own
OPC
UA
server.
Provide
CPU
tags
via
server
interfaces
in
the
OPC
UA
address
space
The
easiest
way
to
transfer
CPU
tags
automatically
into
the
address
space
of
the
OPC
UA
server:
Activate
the
standard
SIMATIC
server
interface
in
the
OPC
UA
properties
of
the
CPU.
All
CPU
tags
released
for
OPC
UA
are
then
automatically
also
available
in
the
OPC
UA
address
space
under
the
name
of
the
CPU.
1625346
149768
Figure
11-11
Standard
SIMATIC
server
interface
of
the
OPC
UA
server
230
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
The use of OPC UA server interfaces is more flexible and clearer because you configure the
server
interfaces
in
the
project
tree
(below
the
CPU,
&quot;OPC
UA
Communication&quot;
folder).
User-
defined OPC UA server interfaces allow you to easily map OPC UA tags and CPU tags (local
data).
1799970
130175
Figure
11-12
Creating
a
user-defined
server
interface
with
mapped
CPU
tags
The
data
exchange
between
OPC
UA
client
and
OPC
UA
server
is
clearly
illustrated
in
the
following
example
of
two
S7-1500
CPUs.
Here, an S7‑1500 CPU as client writes values to an OPC UA tag of the OPC UA server. The
mapping
between
CPU
variable
and
OPC
UA
tag
makes
it
look
as
though
the
OPC
UA
client
writes a value directly into the CPU variable. For an S7‑1500 client CPU, use the
&quot;OPC_UA_WriteList&quot;
instruction
in
conjunction
with
additionally
required
instructions
for
the
data
exchange.
$
P
O
꫼
H
V
S
B
U
J
P
O
I
4
F
S
W
F
S
J
O
U
F
S
G
B
D
F
M
B
QQ
J
O
H
$
1
6
W
B
S
J
B
C
M
F
<
>
0
1
$
6
A
U
B
H
$
P
O
O
F
D
U
J
P
O
)
E
M
=
)
B
O
E
M
F
G
S
P
N
0
1
$
@
6
A
@
$
P
O
O
F
D
U
47-1500
$16
BT
01$
6A
TFSWFS
47-1500
$16
B
T
0
1
$
6
A
D
M
J
F
O
U
$
M
J
F
O
U
Q
S
P
H
S
B
N
0
1
$
@
6
A
@
$
P
O
O
F
D
U
...
0
1
$
@
6
A
@
%
J
T
D
P
O
O
F
D
U
0
1
$
@
6
A
@
8
S
J
U
F
L
J
T
U
...
01$
6A
UBH
(OPEFT)
Figure
11-13
Client
access
to
the
server&apos;s
OPC
UA
tag
Communication
Function
Manual,
11/2024,
A5E03735815-AM
231
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Writing
CPU
tag
values
directly
to
OPC
UA
tags
(set
OPC
UA
DataValue)
As
of
firmware
version
V3.0,
S7‑1500
CPUs
offer,
it
is
possible
to
not
only
map
tags,
but
also
write values directly to local OPC UA tag nodes of the server via the &quot;OPC_UA_WriteList&quot;
instruction.
Normally,
the
&quot;OPC_UA_WriteList&quot;
instruction
in
the
client
program
of
the
CPU
is
used
to
write
values
to
OPC
UA
tags
of
a
remote
OPC
UA
server.
Advantage
of
using
&quot;OPC_UA_WriteList&quot;
in
the
server:
In
addition
to
the
value,
you
can
provide
the
OPC
UA
tag
node
with
the
following
additional
information:
SourceTimestamp
StatusCode
OPC UA provides a built-in &quot;DataValue&quot; data type. DataValue is a structure that records both
the Value as well as the SourceTimestamp and StatusCode as additional information for the
value.
The
DataValue
structure
is
only
used
by
OPC
UA
services
and
you
cannot
write
directly
in
the
program
of
the
CPU
to
the
elements
of
this
structure.
Write
access
is
only
possible
via
a
special
use
of
the
&quot;OPC_UA_WriteList&quot;
instruction.
Application
options
CPU
variables
cannot
record
a
time
stamp
indicating
when
a
value
was
last
written
to
the
CPU
variable. If you map CPU tags and OPC UA tags via server interfaces, the OPC UA server does
not therefore set the SourceTimestamp to the time when the CPU tag changed, but to the
time when the value was &quot;collected&quot; in the server, such as by a read service or by sampling in
the
context
of
a
subscription.
If
you
write
DataValue
directly
with
&quot;OPC_UA_WriteList&quot;
to
an
OPC
UA
tag
node,
for
example,
you can provide a time stamp determined in the program as the SourceTimestamp for the
value.
Principle
functionality
of
the
&quot;OPC_UA_WriteList&quot;
instruction
for
setting
DataValues
The DataValue structure is, for example, modeled as a UDT and a tag of this data type is
transferred
to
the
&quot;OPC_UA_WriteList&quot;
instruction.
The
instruction
then
consistently
transfers
the
elements
of
the
tag
to
the
OPC
UA
tag
node.
The value of the &quot;ConnectionHdl&quot; instruction parameter determines the function of the
&quot;OPC_UA_WriteList&quot; instruction: Either &quot;Normal&quot; client instruction or instruction to write to
local
OPC
UA
tag
nodes.
OPC
UA
clients
can
read
the
value
with
additional
information
in
the
latter
case
and
evaluate
it
accordingly.
This principle is illustrated in the following figures, once with any client and once with an
S7‑1500
CPU
as
OPC
UA
client.
In
the
case
of
the
S7‑1500
CPU
client,
the
assignment
of
the
DataValue
elements
to
the
corresponding
instruction
parameters
of
the
&quot;OPC_UA_ReadList&quot;
instruction
is
shown.
You
have
full
access
to
all
elements
of
the
DataValue
structure.
232
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
The
value
of
&quot;Read&quot;
(-42)
of
the
&quot;OPC_UA_WriteList&quot;
instruction
causes
the
server
to
write
to
local
OPC
UA
tag
nodes.
1SPHSBN
...
0
1
$
@
6
A
@
8
S
J
U
F
L
J
T
U
...
4
F
U
%
B
U
B
7
B
M
V
F
(01$
6A
4FSWJDF)
$
P
O
O
F
D
U
J
P
O
)
E
M
=
-
4
2
47-1500
$16
BT
01$
6A
TFSWFS
$
M
J
F
O
U
B
QQ
M
J
D
B
U
J
P
O
01$
6A
3FBEl
4VCTDSJQUJPO
01$
6A
UBH
(OPEFT)
(OPU
47-1500
$16)
0
1
$
6
A
D
M
J
F
O
U
Figure
11-14
Set
data
value
on
local
OPC
UA
tag
of
the
server
1SPHSBNN
...
0
1
$
@
6
A
@
8
S
J
U
F
L
J
T
U
...
4
F
U
%
B
U
B
7
B
M
V
F
(01$
6A
4FSWJDF)
47-1500
$16
BT
01$
6A
TFSWFS
47-1500
$16
B
T
0
1
$
6
A
D
M
J
F
O
U
01$
6A
UBH
(OPEFT)
w
4UBUVTDPEF
w
4
P
V
S
D
F
5
J
N
T
U
B
N
Q
w
7
B
M
V
F
Figure
11-15
Client
reads
data
value
(OPC
UA
tag
of
the
server
of
the
S7-1500
CPU)
Other
application
options
If OPC UA clients log on with an S7-1500 CPU for value changes (monitored items) in the
context of a subscription and you supply the corresponding DataValue with both the value
and
the
additional
information
mentioned
above,
then
changes
to
the
additional
information
can
also
trigger
a
notification.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
233
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Example
:
A
binary
value
changes
so
fast
that
it
falls
back
to
its
original
value
in
the
sampling
interval (fast change TRUE > FALSE > TRUE). A change of the value is not detected. But the
change of the time stamp is detected. Similarly, a notification can be triggered when the
StatusCode
changes
-
even
without
the
value
changing.
Constraints
OPC
UA
clients
are
only
allowed
to
read
the
OPC
UA
tag;
the
&quot;AccessLevel&quot;
attribute
for
read/write
permissions
must
be
set
accordingly
for
the
OPC
UA
tag.
Only
OPC
UA
tags
of
the
user-defined
server
interfaces
can
be
set
locally.
In
the
user-defined
server
interface,
there
must
be
no
mapping
to
CPU
tags
for
the
directly
written
OPC
UA
tags.
1799970
129744
Figure
11-16
User-defined
server
interface
Details on how to use the &quot;OPC_UA_WriteList&quot; instruction in the &quot;Set OPC UA DataValue&quot;
context
can
be
found
in
the
corresponding
section
of
the
communication
instruction
help.
Setting
OPC
UA
DataValue
attributes
for
arrays
and
structures
When
OPC
UA
tags
of
type
structure
or
array
are
set
using
&quot;OPC_UA_WriteList&quot;
for
setting
OPC
UA
DataValue
attributes,
all
elements
of
this
structure
or
array
are
filled.
You
should
not
model
individual
elements
of
structures
or
arrays
additionally
as
lower-level
OPC
UA
tags.
Reason: If you model individual elements of arrays or structures additionally as separate
lower-level
nodes
in
the
address
space
of
the
server,
then
these
nodes
are
not
automatically
filled.
For
the
OPC
UA
server,
these
separate
nodes
are
independent
of
the
higher-level
OPC
UA
tags
of
the
structure
or
array
type,
because
they
are
not
mapped
to
CPU
tags.
To
fill
these
separately
modeled
nodes,
you
must
create
each
individual
element
as
its
own
DataValue
structure
in
the
program.
Tip
:
In
order
for
OPC
UA
clients
to
be
able
to
simultaneously
learn
about
changes
to
relevant
nodes
in
this
case,
set
the
values
of
all
OPC
UA
tags
involved
in
the
same
&quot;OPC_UA_WriteList&quot;
call.
More
information
An application example (
https://support.industry.siemens.com/cs/us/en/view/109820694
)
is
provided
to
assist
you
on
the
topic
of
&quot;Setting
OPC
UA
DataValue
attributes&quot;.
You
can
find
information
on
how
to
coordinate
read
and
write
permissions
for
CPU‑tags
in
(Page
238)
the
Coordinating
read
and
write
permissions
for
CPU
tags
section.
You
can
find
information
how
to
create
user-defined
server
interfaces
in
the
Creating
a
user-
(Page
283)
defined
server
interface
section.
234
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Managing
write
and
read
rights
Enabling
PLC
tags
and
DB
tags
for
OPC
UA
OPC
UA
clients
can
have
read
and
write
access
to
PLC
tags
and
DB
tags
if
the
tags
are
enabled
for
OPC
UA
(default
setting).
For
an
enabled
tag
the
check
box
&quot;Accessible
from
HMI/OPC
UA&quot;
is
activated.
You
can
change
the
default
setting
in
the
settings
of
the
TIA
Portal:
Command
&quot;Settings
>
PLC
programming > General&quot; in &quot;Options&quot; menu. You will find the corresponding options in the
&quot;Block
interface/data
block
elements&quot;
area.
The
following
example
shows
an
array
data
block:
719962
150816
Figure
11-17
Enabling
PLC
tags
and
DB
tags
for
OPC
UA
tags
(Page
This array can be read
completely
in
one
pass
by OPC
UA clients (see Addressing nodes
178)).
The
check
boxes
at
&quot;Accessible
from
HMI/OPC
UA&quot;
and
&quot;Writable
from
HMI/OPC
UA&quot;
are
activated
for
all
the
components
of
the
array.
Result:
OPC
UA
clients
can
both
read
and
write
these
components.
Removing
write
rights
If
you
want
to
write-protect
a
tag,
deselect
the
&quot;Writable
from
HMI/OPC
UA&quot;
option
for
that
tag.
This
removes
the
write
right
for
the
OPC
UA
clients
and
HMI
devices.
Result:
Only
read
access
by
OPC
UA
clients
and
HMI
devices
is
possible.
OPC
UA
clients
cannot
assign
values
to
this
tag
and
therefore
cannot
influence
execution
of
the
S7
program.
Removing
write
and
read
rights
To
write-protect
and
read-protect
a
tag,
disable
the
&quot;Accessible
from
HMI/OPC
UA&quot;
option
for
that tag (checkbox not selected). This makes the OPC UA server remove the tag from its
address
space.
OPC
UA
clients
can
no
longer
see
that
CPU
tag.
Result:
OPC
UA
clients
and
HMI
devices
can
neither
read
nor
write
the
tag.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
235
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Write
and
read
rights
of
structures
If
you
remove
the
read
or
write
right
for
the
component
of
a
structure,
the
structure
or
the
data
block
cannot
be
written
or
read
as
a
whole.
If
you
remove
read
and
write
rights
for
individual
components
of
a
PLC
data
type
(UDT),
the
rights
will
also
be
removed
from
any
data
block
based
on
that
data
type!
Visible
in
HMI
engineering
The option &quot;Visible in HMI Engineering&quot; applies to Siemens engineering tools. If you disable
the
option
&quot;Visible
in
HMI
Engineering&quot;
(check
mark
not
set),
you
can
no
longer
configure
the
tag
in
WinCC
(TIA
Portal).
The
option
does
not
have
any
effect
on
OPC
UA.
Rules
Only
allow
read
access
to
PLC
tags
and
tags
of
data
blocks
in
STEP
7
if
this
is
necessary
for
communication
with
other
systems
(controllers,
embedded
systems
or
MES).
You
should
not
enable
other
PLC
tags.
Only
allow
write
access
over
OPC
UA
if
write
rights
are
genuinely
necessary
for
specific
PLC
tags
and
tags
of
data
blocks.
If
you
have
reset
the
&quot;Accessible
from
HMI/OPC
UA&quot;
option
for
all
elements
of
a
data
block,
the
data
block
for
an
OPC
UA
client
is
no
longer
visible
in
the
address
space
of
the
OPC
UA
server
of
the
S7-1500
CPU.
You
can
also
prevent
access
to
an
entire
data
block
centrally
(see
Managing
write
and
read
rights for a complete DB
(Page 237)).
This setting &quot;overrules&quot; the settings for the
components
in
the
DB
editor.
More
information
For
information
on
how
to
coordinate
write
and
read
rights
for
CPU
tags,
refer
to
the
section
Coordinating
write
and
read
rights
for
CPU
tags
(Page
238).
236
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Managing
write
and
read
rights
for
a
complete
DB
Hiding
DBs
or
DB
contents
for
OPC
UA
clients
You
can
easily
prevent
access
to
a
complete
data
block
by
an
OPC
UA
client.
With
this
option,
the
data
of
the
corresponding
DB,
including
instance
DBs
of
function
blocks,
remains
hidden
for
OPC
UA
clients.
In the default setting, data blocks can be read and written from OPC UA clients. You can
change this default setting in the settings of the TIA Portal: Command &quot;Settings > PLC
programming
>
General&quot;
in
&quot;Options&quot;
menu.
You
will
find
the
corresponding
option
in
the
&quot;Default
settings
for
new
blocks&quot;
area.
Procedure
Proceed
as
follows
to
completely
hide
a
data
block
for
OPC
UA
clients
or
to
protect
a
data
block
from
write
access
from
OPC
UA
clients:
Select
the
data
block
to
be
protected
in
the
project
tree.
Select
the
&quot;Properties&quot;
shortcut
menu.
Select
the
&quot;Attributes&quot;
area.
Select/clear
the
&quot;DB
accessible
from
OPC
UA&quot;
checkbox
as
required.
1984248
124673
Figure
11-18
Hiding
DBs
or
DB
contents
for
OPC
UA
clients
NOTE
Effect
on
settings
in
the
DB
editor
If
you
hide
a
DB
using
the
DB
attribute
described
here,
the
settings
for
the
components
in
the
DB editor are no longer relevant; individual components can no longer be accessed or
written.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
237
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Tip:
Using
the
overview
of
all
program
blocks
If you are using multiple data blocks, it is appropriate to use the detailed overview of the
&quot;Program
blocks&quot;
folder
for
selective
activation
or
deactivation
of
the
OPC
UA
accessibility.
Follow
these
steps:
Select
the
&quot;Program
blocks&quot;
folder
in
the
project
tree.
Select
the
&quot;Overview&quot;
command
in
the
&quot;View&quot;
menu.
Select
the
&quot;Details&quot;
tab.
An
overview
of
the
blocks
with
their
attributes
is
displayed.
Ensure
that
the
&quot;Data
block
accessible
via
OPC
UA&quot;
column
is
selected.
Select
only
the
data
blocks
that
are
to
be
accessible
via
OPC
UA.
719962
152029
Figure
11-19
Overview
of
the
program
blocks
Coordinating
write
and
read
rights
for
CPU
tags
Definition
of
write
and
read
rights
in
the
information
model
(OPC
UA
XML)
In
the
OPC
UA
information
model,
the
attribute
&quot;AccessLevel&quot;
regulates
access
to
tags.
AccessLevel
is
defined
bit
by
bit:
Bit
0
=
CurrentRead
and
Bit
1
=
CurrentWrite.
The
meaning
of
the
bit
combinations
is
as
follows:
AccessLevel
=
0:
no
access
AccessLevel
=
1:
read
only
AccessLevel
=
2:
write
only
AccessLevel
=
3:
read+write
Example
of
the
assignment
of
write
and
read
rights
(read+write)
1627610
117993
238
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Definition
of
write
and
read
rights
in
STEP
7
When
you
define
tags,
you
specify
the
access
rights
using
the
properties
&quot;Accessible
from
HMI/OPC
UA&quot;
and
&quot;Writable
from
HMI/OPC
UA&quot;.
Example
of
the
assignment
of
write
and
read
rights
1802510
101676
Figure
11-20
Example
of
the
assignment
of
write
and
read
rights
Interaction
between
write
and
read
rights
If
you
have
imported
an
OPC
UA
server
interface
and
AccessLevel
attributes
are
set
in
this
OPC
UA XML file, the write and read rights are defined by the following rule: The least extensive
access
rights
for
each
setting
apply.
Example
AccessLevel
=
1
(read
only)
in
the
OPC
UA
server
interface
Both
&quot;Accessible
from
HMI/OPC
UA&quot;
and
&quot;Writable
from
HMI/OPC
UA&quot;
are
selected
in
the
PLC
tag
table
Result:
This
tag
can
only
be
read.
Rules
If
write
rights
are
required:
AccessLevel
=
2
oder
3
&quot;Writable from HMI/OPC
UA&quot;
enabled
If
read
rights
are
required:
AccessLevel
=
1
(AccessLevel
3
is
also
possible,
but
misleading.
The
settings
suggests
that
an
OPC
UA
client
has
write
and
read
rights)
&quot;Accessible
from
HMI/OPC
UA&quot;
enabled,
&quot;Writable
from
HMI/OPC
UA&quot;
disabled
If
neither
read
nor
write
rights
are
to
be
granted
(no
access):
AccessLevel
=
0
&quot;Accessible
from
HMI/OPC
UA&quot;
disabled
Only
one
of
the
two
conditions
needs
to
be
met
to
block
all
access.
In
this
case,
review
whether
the
tag
in
the
OPC
UA
server
interface
is
actually
necessary
at
all.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
239
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Access
table
&quot;Accessible
from
HMI/OPC
UA&quot;
must
be
set
if
access
over
OPC
UA
is
to
be
possible
at
all.
&quot;Writable from HMI/OPC UA&quot; must be set to allow an OPC
UA client to write a tag / DB
element.
Please
see
the
table
for
the
resulting
access
right.
Table
11-2
Access
table
OPC
UA
XML
STEP
7
(TIA
Portal),
for
example
tag
table
AccessLevel
Accessible
from
HMI/OPC
UA
Writable
from
HMI/OPC
UA
Resulting
access
right
0
x
x
No
access
x
0
x
No
access
1
Enabled
x
Read
only
2
Enabled
Disabled
No
access
3
Enabled
Disabled
Read
only
2
Enabled
Enabled
Write
only
3
Enabled
Enabled
Read+write
(x
=
don&apos;t
care)
Consistency
of
CPU
tags
&quot;AccessLevelEx&quot;
attribute
extends
access
properties
As of firmware version V2.6, the OPC UA server of the S7-1500 CPU supports not only the
attribute
&quot;AccessLevel&quot;
(see
Coordinating
write
and
read
rights
for
CPU
tags
(Page
238))
but
also the attribute &quot;AccessLevelEx&quot; which, in addition to the already explained bits for read
access
and
write
access,
provides
information
on
the
consistency
of
a
OPC
UA
tag.
The
new
attribute was introduced with version V1.04 of the OPC UA specification (Part 3, Address
Space
Model).
Reading
consistency
properties
In
the
OPC
UA
information
model
of
the
OPC
UA
server,
the
attribute
&quot;AccessLevel&quot;
defines
the
access.
AccessLevelEx
is
defined
bit
by
bit;
in
this
case
the
relevant
bits
are:
Bit
0
=
CurrentRead
Bit
1
=
CurrentWrite
Bits
2
to
7
are
not
relevant
for
the
OPC
UA
server
of
an
S7-1500
CPU
The
meaning
of
the
bit
combinations
is
explained
in
the
section
on
read
and
write
rights.
240
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
The
following
bits
for
consistency
are
also
added:
Bit
8
=
NonatomicRead;
the
bit
is
set
if
the
tag
cannot
be
read
consistently.
For
read
consistency
of
tags,
bit
8=0.
Bit
9
=
NonatomicWrite;
is
set
if
the
tag
cannot
be
written
consistently.
For
write
consistency
of
tags,
or
if
no
write
access
is
granted,
bit
9=0.
Examples
An
OPC
UA
tag
(structure)
is
readable
and
writable;
but
inconsistent
for
reading
and
writing
access.
Consequently: Bits 0, 1, 8 and 9 are set: AccessLevelEx = &quot;771&quot; (1+2+256+512).
Another
structure
is
read-only.
Consequently:
Bits
0
and
8
are
set,
bit
1
and
bit
9
are
not
set:
AccessLevelEx
=
&quot;257&quot;
(1+0+256+0).
Handling
of
the
attribute
in
the
server
The
&quot;AccessLevelEx&quot;
attribute
is
only
available
in
the
OPC
UA
server.
The
attribute
is
not
present
in
a
node
set
file
(XML
export
file).
However, the attribute &quot;AccessLevel&quot;, which is exported, includes the information from
&quot;AccessLevelEx&quot;,
see
next
section.
Export
During
XML
export
of
the
standard
SIMATIC
server
interface,
the
server
sets
the
&quot;AccessLevel&quot;
attribute, which was expanded to 32 bits in V1.04 compared to V1.03, to the value of the
&quot;AccessLevelEx&quot;
attribute.
Import
When
importing
a
node
set
file
(e.g.
from
an
export
of
a
server
interface),
the
S7-1500
CPU
sets the attribute &quot;AccessLevelEx&quot; according to its own estimate of the consistency of the
imported
data
type,
see
next
section.
The
imported
value
is
ignored.
Consistency
of
data
types
at
the
server
interface
The
consistency
of
tags
(&quot;atomicity&quot;
in
the
language
usage
of
OPC
UA)
within
a
program
cycle
of an S7-1500 CPU is ensured at the nodes of the server interface for the following data
types:
BOOL,
BYTE,
WORD,
DWORD,
LWORD
SINT,
INT,
LINT,
DINT,
USINT,
UINT,
ULINT,
UDINT
REAL,
LREAL
DATE,
LDT, TIME,
LTIME, TIME_OF_DAY, LTIME_OF_DAY,
S5TIME
CHAR,
WCHAR
System
data
types
and
hardware
data
types
that
are
based
on
the
above-mentioned
data
types
are
also
consistent.
Example:
HW_ANY,
derived
from
UINT
(UInt16).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
241
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Tip
:
If
you
browse
in
the
address
space
of
the
S7-1500
CPU
(e.g.
with
the
OPC
UA
Client
UaExpert), you can find the consistent data types under Types > BaseDataType >
Enumeration/Number/String.
Tags
of
the
following
data
types
are
not
consistent
(in
the
language
usage
of
OPC
UA:
&quot;nonatomic&quot;):
SIMATIC
structures
are
generally
not
consistent.
This
means
that
all
tags
which,
for
example,
have
unknown
structures
or
a
UDT
data
type
are
not
consistent.
System
data
types
such
as
DTL,
IEC_Counter,
IEC_TIMER,
etc.
are
data
types
that
are
derived
from
structures.
Strings
(Array
of
Char)
are
not
consistent.
Tip
:
If
you
browse
in
the
address
space
of
the
S7-1500
CPU
(e.g.
with
the
OPC
UA
Client
UaExpert), you can find data types based on structures under Types > BaseDataType >
Structure.
Write
accesses
to
OPC
UA
variables
from
S7-1500
Motion
Control.
In
addition
to
the
consistency
of
the
data
types,
the
CPU
examines
the
variables
of
the
technology
objects
for
plausibility
and
validity.
If
an
OPC
UA
client
writes
an
invalid
or
implausible
value
to
a
variable,
the
original
value
is
retained
in
the
variable
of
the
technology
object.
Despite
an
unsuccessful
write
access,
the
status
&quot;Good&quot;
is
output.
Example
1
Interpolation
type
of
the
cyclic
cam
The
variable
&quot;Cam_1&quot;.InterpolationSettings.InterpolationMode
is
of
type
INT,
but
may
only
assume
the
values
1...2.
If
you
want
to
change
the
variable
using
OPC
UA
to
an
invalid
value,
for
example,
3,
then
the
status
code
&quot;Good&quot;
is
output,
but
the
variable
is
not
changed.
Example
2
Position
the
software
limit
switch
at
a
positioning
axis
The
position
of
the
positive
HW
limit
switch
must
be
more
positive
than
the
position
of
the
negative
SW
limit
switch.
&quot;PosAxis_1&quot;.PositionLimits_SW.MaxPosition
>
&quot;PosAxis_1&quot;.PositionLimits_SW.MinPosition
If
you
want
to
change
the
variable
using
OPC
UA
to
a
value
that
does
not
meet
this
condition,
then
the
status
code
&quot;Good&quot;
is
output,
but
the
variable
is
not
changed.
Which
values
are
valid
for
variables
of
the
technology
objects
can
be
looked
up
in
the
docu-
mentation
of
the
technology
objects
(
https://support.industry.siemens.com/cs/ww/en/view/109751049
).
242
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Accessing
OPC
UA
server
data
High
performance
in
line
with
application
OPC UA is designed for the transfer of a high volume of data within a short period of time.
You
can
increase
the
performance
significantly
if
you
do
not
access
individual
PLC
tags,
but
rather
read
and
write
arrays
and
structures
as
a
whole.
It
is
fastest
to
access
arrays.
Therefore,
you
should
combine
the
data
for
OPC
UA
clients
into
arrays.
Recommendations
for
access
to
the
OPC
UA
server
by
the
OPC
UA
client
For
one-off
or
infrequent
data
access,
use
standard
read/write
access.
For
cyclic
access
to
small
amounts
of
data
(up
to
ca.
every
5
seconds),
use
subscriptions.
Optimize
the
settings
for
the
smallest
publishing
interval
and
the
smallest
sampling
interval
at
the
OPC
UA
server.
If
you
access
specific
tags
regularly
(recurring
access),
you
should
use
the
functions
&quot;RegisteredRead&quot;
and
&quot;RegisteredWrite&quot;.
Allow
a
greater
communication
load
for
the
PLC
by
increasing
the
value
for
&quot;Cycle
load
due
to
communication&quot;. Make sure that your application still works properly with the changed
settings.
Procedure
for
creating
an
array
DB
You can create arrays for example in global data blocks, in the instance data block of a
function
block
or
as
an
array
DB
.
The
following
sections
describe
how
to
create
an
Array-DB.
To
create
a
data
block
with
an
array
(array
data
block),
follow
these
steps:
Select
the
CPU
with
the
OPC
UA
server
in
the
project
tree.
Double-click
&quot;Program
blocks&quot;.
Double-click
&quot;Add
new
block&quot;.
Click
&quot;Data
block&quot;.
Select
a
unique
name
for
the
data
block
and
accept
the
name
that
is
already
entered.
Select
the
&quot;Array
DB&quot;
entry
from
the
drop-down
list
for
&quot;Type&quot;.
Select
the
data
type
for
the
individual
components
of
the
array
from
the
drop-down
list
for
&quot;Array
data
type&quot;.
Enter
the
high
limit
of
the
array
for
&quot;Array
limit&quot;.
Click &quot;OK&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
243
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
MinimumSamplingInterval
attribute
MinimumSamplingInterval
attribute
of
tags
In addition to &quot;Value&quot;, &quot;DataType&quot; and &quot;AccessLevel&quot;, you can also set the
&quot;MinimumSamplingInterval&quot;
attribute
for
a
tag
in
the
XML
file
that
represents
the
server
address
space.
The
attribute
specifies
how
fast
the
server
can
sample
the
tag
value.
The
OPC
UA
server
of
the
S7-1500
CPU
handles
the
values
for
MinimumSamplingInterval
as
follows:
Negative values and values greater than 4294967 are set to -1; this means: The minimum
sampling rate is indeterminate. The server does not specify how fast the tag value can be
sampled.
Decimal
numbers
are
rounded
to
three
decimal
places.
Export
OPC
UA
XML
file
Generating
an
OPC
UA
export
file
The OPC Foundation has specified a standard XML-based format for describing information
models. It allows the information model of an OPC UA server to be provided to a client in
advance,
or
information
models
can
be
downloaded
to
an
OPC
UA
server.
A
file
in
this
format
is
called
a
node
set
file
because
it
describes
an
information
model
as
a
set
of
nodes.
With
STEP
7
(TIA
Portal),
you
can
easily
export
the
standard
SIMATIC
information
model
of
the
S7-1500 CPU as a server to an OPC UA XML file (node set file); including the following
elements
that
you
have
enabled
for
OPC
UA:
CPU
variables
(PLC
tags
and
DB
elements)
Function
blocks
with
their
inputs/outputs
Elements
that
exist
in
the
CPU
but
are
not
used
in
the
program
do
not
appear
in
the
OPC
UA
XML
file
after
the
export.
Examples
of
such
unused
elements
are:
UDTs
that
are
not
mapped
to
a
data
block
Function
blocks
with
inputs/outputs
without
assigning
inputs/outputs
to
CPU
tags
You
use
the
OPC
UA
XML
file
for
the
offline
configuration
of
an
OPC
UA
client;
it
is
structured
according
to
the
OPC
UA
specification
and
acts
as
a
standard
SIMATIC
server
interface.
244
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
To
create
and
export
the
OPC
UA
XML
file,
follow
these
steps:
Select
the
CPU.
Click
on
the
CPU
symbol
(for
example
in
the
network
view).
Click
&quot;General
>
OPC
UA
>
Server
>
Export&quot;
in
the
properties
of
the
CPU.
Click
&quot;Export
OPC
UA
XML
file&quot;.
Select
the
directory
in
which
you
want
to
save
the
export
file.
Select
a
new
name
for
the
file
or
keep
the
name
that
is
already
entered.
Click
&quot;Save&quot;.
NOTE
As
of
STEP
7
(TIA
Portal)
V15.1,
server
methods
are
contained
in
the
OPC
UA
export
file
(node
set)
together
with
their
input
and
output
parameters.
Exporting
all
array
elements
separately
If
the
&quot;Export
all
array
elements
as
separate
nodes&quot;
option
is
selected
in
the
CPU
properties
under
&quot;OPC
UA
>
Server
>
Export&quot;,
the
OPC
UA
XML
file
contains
all
elements
of
arrays
as
individual XML elements. In addition, the arrays themselves are each described in an XML
element
in
the
XML
file.
If
an
array
contains
many
array
elements,
the
XML
file
can
be
very
large.
Tip
The
following
FAQ
contains
a
converter
with
which
you
can
convert
the
export
file
into
CSV
format.
You
then
obtain
a
list
of
the
tags
of
the
CPU
that
can
be
accessed
by
OPC
UA.
You
can
find
the
FAQ
on
the
Internet
(
https://support.industry.siemens.com/cs/ww/en/view/109742903
).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
245
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Configuring
the
OPC
UA
server
Enabling
the
OPC
UA
server
Requirement
If
you
use
certificates
for
secured
communication,
e.g.
HTTPS,
Secure
OUC,
OPC
UA,
make
sure that the modules involved have the
current time of day and the current date
.
Otherwise, the modules evaluate the used certificates as invalid and secure
communication
does
not
work.
You
have
acquired
a
runtime
license
for
the
operation
of
the
OPC
UA
functions,
see
License
for
OPC
UA
(Page
269).
If
access
control
is
enabled
and
you
are
using
user
management
(local
or
central):
The
users
must
have
the
&quot;OPC
UA
server
access&quot;
function
right.
Information
on
the
assignment
of
the
&quot;OPC
UA
server
access&quot;
function
right
can
be
found
in the Siemens Industry Online Support under the following entry ID: SIOS Entry ID
109954947
(
https://support.industry.siemens.com/cs/us/en/view/109954947
)
Commissioning
an
OPC
UA
server
By
default,
the
OPC
UA
server
of
the
CPU
is
not
enabled
for
reasons
of
security:
OPC
UA
clients
have
neither
write
nor
read
access
to
the
S7-1500
CPU.
Follow
these
steps
to
activate
the
OPC
UA
server
of
the
CPU:
Select
the
CPU.
Click
on
the
CPU
symbol
(for
example
in
the
network
view).
Click
&quot;OPC
UA
>
Server&quot;
in
the
properties
of
the
CPU.
Activate
the
OPC
UA
server
of
the
CPU.
Confirm
the
security
notes.
Go
to
the
CPU
properties,
select
&quot;Runtime
licenses&quot;
and
set
the
runtime
license
acquired
for
the
OPC
UA
server.
Compile
the
project.
Download the project to the CPU.
The
OPC
UA
server
of
CPU
now
starts.
Settings
remain
stored
If
you
have
already
enabled
the
server
and
made
settings,
those
settings
are
not
lost
if
the
server
is
disabled.
The
settings
are
saved
as
before
and
are
available
when
you
enable
the
server
again.
246
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Application
name
The
application
name
is
the
name
of
the
OPC
UA
application
and
applies
to
the
server
and
the
client.
The
name
is
displayed
under
&quot;OPC
UA
>
General&quot;:
The
default
for
the
application
name
is:
&quot;SIMATIC.S7-1500.OPC-UA.Application:PLC_1&quot;.
The
default
consists
of
&quot;SIMATIC.S7-1500.OPC-UA.Application:&quot;
and
the
name
of
the
CPU
selected
under
&quot;General
>
Product
information
>
Name&quot;,
in
this
case
&quot;PLC_1&quot;.
The
OPC
UA
server
uses
this
application
name
to
identify
itself
to
a
communication
partner
(OPC UA client), for example, when an OPC UA client uses the discovery service to detect
accessible
servers.
The
displayed
application
name
uses
the
OPC
UA
client
of
the
CPU
when
connecting
to
an
OPC UA Server. This means that the CPU enters this application name automatically as
&quot;ApplicationName&quot; for the instruction &quot;OPC_UA_Connect&quot; (tag of type
&quot;OPC_UA_SessionConnectInfo&quot; at the parameter &quot;SessionConnectInfo&quot; of the instruction
&quot;OPC_UA_Connect&quot;).
When you program the instruction &quot;OPC_UA_Connect&quot; you must therefore assign an
empty
string
to
the
&quot;ApplicationName&quot;.
You
can
use
the
application
name,
for
example,
to
identify
the
client
and
its
sessions
(SessionNames)
for
diagnostic
purposes.
If
you
have
activated
the
server,
you
can
also
use
a
different
name
that
is
meaningful
in
your
project
and
that
fulfills
the
requirements
of
your
project,
e.g.
for
worldwide
uniqueness.
The
example
below
originates
from
UaExpert:
1799970
125783
Changing
the
application
name
To
change
the
application
name,
follow
these
steps:
Select
the
CPU.
Click
on
the
CPU
symbol
(for
example
in
the
network
view).
Click
&quot;OPC
UA
>
General&quot;
in
the
properties
of
the
CPU.
Enter a
meaningful
name.
Please
note
that
the
application
name
is
also
entered
on
the
certificate
(Subject
Alternative
Name) and you may have to generate an existing certificate again after changing the
application
name.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
247
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Access
to
the
OPC
UA
server
Server
addresses
The
OPC
UA
server
of
the
S7-1500
CPU
can
be
reached
over
all
integrated
PROFINET
interfaces
of
the
CPU
(firmware
V2.0
and
higher).
Direct
access
to
the
OPC
UA
server
of
the
CPU
over
the
backplane
bus
of
the
automation
system
is
not
possible
via
CPs
under
the
following
conditions:
Configuration
with
TIA
Portal
Version
V16
or
higher,
S7-1500
CPU
firmware
version
2.8
or
higher
and
CP
1543-1
firmware
version
V2.2
or
higher.
For
configuration,
see
Access
to
OPC
UA
applications
(Page
174)
.
Direct
access
to
the
OPC
UA
server
of
the
CPU
over
the
backplane
bus
of
the
automation
system
is
not
possible
via
CMs.
With
SIMATIC
S7
1500
SW
controllers,
access
to
the
OPC
UA
server
is
possible
via
PROFINET
interfaces
that
are
assigned
to
the
software
PLC.
Additional access options of SW controllers are described in the following application
example:
Internal
and
external
OPC
UA
connection
via
the
virtual
Ethernet
interface
of
the
software
controller
V2.5
or
higher
(
https://support.industry.siemens.com/cs/ww/en/view/109760541
).
Example
for
URLs
(Uniform
Resource
Locator)
that
can
be
used
to
set
up
connections
to
the
OPC
UA
server
of
the
CPU:
1620011
130660
Figure
11-21
Display
of
the
server
addresses
The
URLs
are
structured
as
follows:
Protocol
identifier
&quot;
opc.tcp://&quot;
IP
address
–
192.168.178.151
The
IP
address
at
which
the
OPC
UA
server
can
be
accessed
from
the
Ethernet
subnet
192.168.178.
–
192.168.1.1
The
IP
address
at
which
the
OPC
UA
server
can
be
accessed
from
the
Ethernet
subnet
192.168.1.
TCP
Port
number
–
Default: 4840
(standard
port)
The
port
number
can
be
changed
under
&quot;OPC
>
UA
>
Server
>
Port&quot;.
248
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Dynamic
IP
addresses
In
the
example
below,
the
IP
address
for
the
PROFINET
interface
[X2]
has
not
yet
been
specified.
1799970
130255
Figure
11-22
Display
of
the
server
addresses
with
dynamic
IP
address
The
placeholder
&quot;<dynamically>&quot;
appears
in
the
table.
The
IP
address
of
this
PROFINET
interface
is
set
later
on
the
device,
e.g.
via
the
display
of
the
CPU.
Activating
the
standard
SIMATIC
Server
interface
If
the
&quot;Enable
standard
SIMATIC
server
interface&quot;
option
is
selected,
the
OPC
UA
server
of
the
CPU provides the enabled PLC tags and server methods to the clients, as was specified by
SIEMENS
in
the
self-defined
namespace.
This
option
is
selected
in
the
default
setting.
Leave
the
option
selected
so
that
OPC
UA
clients
can
automatically
connect
to
the
OPC
UA
server
of
the
CPU
and
exchange
data.
If
you
do
not
select
this
option,
you
must
add
the
server
interface
by
entering
the
&quot;OPC
UA
communication&quot; entry in the project tree. This interface is then used as OPC UA server
interface,
see
OPC
UA
server
interface
configuration
(Page
269)
.
NOTE
General
device
information
is
readable
even
with
deactivated
standard
SIMATIC
server
interface
Even
if
you
disable
the
standard
SIMATIC
server
interface,
OPC
UA
clients
can
read
general
device
information
about
the
OPC
UA
server
of
the
CPU.
Examples
of
such
device
information:
DeviceManual,
DeviceRevision,
OrderNumber.
In
this
case,
however,
all
objects
of
the
application
program
remain
invisible
to
clients.
If
you
want
to
prevent
that
this
device
information
is
not
visible,
you
have
to
disable
the
OPC
UA
server
of
the
CPU.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
249
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
General
settings
of
the
OPC
UA
server
TCP port
for
OPC
UA
By default, OPC UA uses TCP port 4840. You can, however, select a different port. Entries
from 1024 to 49151 are possible. You must, however, make sure that there are no conflicts
with other applications. OPC UA clients must use the selected port when establishing a
connection.
In
the
example
below,
port 48400
is selected:
1625346
124672
Figure
11-23
TCP
port
for
OPC
UA
An
overview
of
the
supported
protocols
and
the
port
numbers
used
by
the
S7-1500
CPUs
can
be found in section Communications protocols and port numbers used for Ethernet
communication
(Page
36).
Settings
for
sessions
Maximum
timeout
for
sessions
In
this
field,
you
specify
the
maximum
time
period
before
the
OPC
UA
server
closes
a
session
without
data
exchange.
Possible
values
between
1
and
600000
seconds.
Maximum
number
of
OPC
UA
sessions
In
this
field,
you
specify
the
maximum
number
of
sessions
the
OPC
UA
server
starts
and
simultaneously
operates.
The
maximum
number
of
sessions
is
dependent
on
the
performance
capability
of
the
CPU.
Each
session
ties
up
resources.
250
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Maximum
number
of
registered
nodes
In
this
field,
you
specify
the
maximum
number
of
nodes
the
OPC
UA
server
registers.
The maximum number of registered nodes depends on the capacity of the CPU and is
displayed
when
you
configure
the
field
content
(place
cursor
in
field).
Each
registration
ties
up
resources.
NOTE
No
error
message
following
attempt
to
register
more
than
the
configured
maximum
number
of
registrable
nodes
If
a
client
tries
to
register
more
nodes
during
runtime
than
the
configured
maximum
number,
the
server
of
the
S7-1500
CPU
only
registers
the
configured
maximum
number.
Starting
from
the configured maximum number of registrable nodes, the server returns the regular string
node IDs unchanged to the client so that the speed advantage gained by registration for
these
nodes
is
lost.
The
client
does
not
receive
an
error
message.
When configuring, make sure you have a sufficient reserve by taking into account the
maximum
number
of
nodes
that
can
be
registered
(for
example,
using
the
technical
data
of
the
CPU).
Additional
information
Details
on
which
ports
are
used
by
the
various
services
for
data
transfer
via
TCP
and
UDP,
and
what
are
the
points
to
note
when
using
routers
and
firewalls
can
be
found
in
the
FAQ
(
https://support.industry.siemens.com/cs/ww/en/view/8970169
).
Backward
compatible
data
type
definitions
according
to
OPC
UA
specification
≤
V1.03
The OPC UA specification (<= V1.03) defines mechanisms in order to read out data type
definitions,
for
example
for
user-defined
structures
(UDTs),
from
a
server
by
means
of
the
TypeDictionaries.
In the OPC UA server properties of the CPU, you can set whether the CPU generates these
backward
compatible
data
type
definitions
according
to
the
OPC
UA
specification
≤
V1.03
for
the
standard
SIMATIC
server
interface
or
not.
Because
TypeDictionaries
are
complex
and
result
in
large
OPC
UA
XML
files
(server
interfaces)
which
the
client
has
to
interpret,
a
simpler
solution
was
introduced
with
OPC
UA
Specification
V1.04 (attribute &quot;DataTypeDefinition&quot; at the data type node). If your client supports the OPC
UA
specification
V1.04
or
higher,
then
disable
the
option.
Advantages
of
the
data
type
definitions
according
to
OPC
UA
specification
as
of
V1.04:
The
server
starts
faster
The
memory
is
used
more
efficiently
The
&quot;Browse&quot;
function
is
faster
Communication
Function
Manual,
11/2024,
A5E03735815-AM
251
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Settings
of
the
server
for
subscriptions
Subscription
instead
of
cyclic
queries
An
alternative
to
cyclic
queries
for
a
PLC
tag
(polling)
is
to
monitor
this
value.
Use
a
Subscription:
The
server
informs
the
client
if
the
value
of
PLC
tags
changes.
One
server
usually
monitors
a
large
number
of
PLC
values.
For
this
reason,
the
server
sends
notifications
to
the
client
at
regular
intervals
containing
the
new
values
of
the
PLC
tags.
Advantages
of
subscriptions:
The
server
starts
faster
The
memory
is
used
efficiently
How
frequently
does
the
server
send
notifications?
When
a
Subscription
is
set
up,
the
OPC
UA
client
specifies
the
intervals
at
which
it
wants
to
be
sent the new values in the event of changes. To limit the communication load through OPC
UA, set a minimum interval for the messages. For this purpose, use the parameters for the
minimum
publishing
interval
and
the
minimum
sampling
interval.
23&
8$
VHUYHU
%B1.NZASSBZ
111100001111
4VCTDSJCF
NZ%B.NZASSBZ
0000
NZASSBZ
1111
1111
%B1.
6
D
P
S
O
i
Q
J
i
Q
W
H
U
Y
D
O
=
;
P
V
7
U
D
Q
V
P
i
V
V
i
R
Q
i
Q
W
H
U
Y
D
O
=
<
P
V
NZ%B.NZASSBZ=
111100001111
3
X
E
O
i
V
K
i
Q
J
i
Q
W
H
U
Y
D
O
6
D
P
S
O
i
Q
J
i
Q
W
H
U
Y
D
O
Figure
11-24
Principle
of
a
subscription
252
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Minimum
publishing
interval
With
&quot;Minimum
publishing
interval&quot;,
you
set
the
time
intervals
at
which
the
server
sends
a
message
to
the
client
with
the
new
values
in
the
event
of
changes.
250
ms
is
used
as
the
&quot;Minimum
sampling
interval&quot;
in
the
figure
below.
The
value
200
ms
is
entered
as
the
&quot;Minimum
publishing
interval&quot;.
1799970
130999
Figure
11-25
Subscription
settings
In
the
example,
following
a
value
change
the
OPC
UA
server
will
send
a
new
message
every
200
ms
if
the
OPC
UA
client
requests
an
update.
If
the
OPC
UA
client
requests
an
update
every
1000
ms,
the
OPC
UA
server
will
only
send
a
message
with
the
new
values
once
every
1000
ms
(one
second).
If
the
OPC
UA
client
requests
an
update
every
100
ms,
the
server
will
still
only
send
a
message
every
200
ms
(minimum
publishing
interval).
Minimum
sampling
interval
With &quot;Minimum sampling interval&quot;, you set the time intervals at which the OPC UA server
records
the
value
of
a
CPU
tag
and
compares
it
with
the
previous
value
to
detect
any
changes.
If
the
sampling
interval
is
selected
smaller
than
the
publishing
interval
and
an
OPC
UA
client
requests a high sampling rate for certain PLC tags, two or more values may be measured
during
each
publishing
interval.
In this case, the OPC UA server writes the value changes into the queue and sends all value
changes to the client after the completion of the publishing interval. If more value changes
occur
in
the
publishing
interval
than
fit
in
the
queue,
the
OPC
UA
server
overwrites
the
oldest
values
(depending
on
the
set
&quot;Discard
Policy&quot;
of
the
client
subscribing
to
the
data,
the
option
&quot;Discard Oldest&quot; has to be activated in this case). The most recent values are sent to the
client.
Maximum
number
of
monitored
elements
(monitored
items)
In
this
field,
you
specify
the
maximum
number
of
elements
that
the
OPC
UA
server
of
the
CPU
simultaneously
monitors
for
a
value
change.
The
monitoring
ties
up
resources.
The
maximum
number
of
monitored
elements
is
dependent
on
the
utilized
CPU.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
253
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
More
information
Information about the system limits of the OPC UA server of the S7-1500 CPUs (firmware
V2.0 and V2.1) regarding subscriptions, sampling intervals and publishing intervals can be
found
in
the
following
FAQ
(
https://support.industry.siemens.com/cs/ww/en/view/109755846
).
When
using
subscriptions,
certain
status
codes
of
errors
provide
information
on
the
error
that
occurred. For information on causes and remedies for status codes of OPC UA client that
appear, see the list of error codes in the online help of STEP 7 (TIA Portal) or in the following
FAQ
(
https://support.industry.siemens.com/cs/ww/en/view/109755860
).
The
rules
for
subscriptions
are
available
in
section
Rules
for
subscriptions
(Page
383).
You
will
find
information
about
the
diagnostics
of
subscriptions
in
the
section
Subscription
diagnostics
(Page
343).
Using
the
TransferSubscription
service
Useful
information
on
transferring
subscriptions
The OPC UA specification provides that OPC UA clients may transfer a subscription with its
monitored
items
from
one
session
to
another
session
(see
OPC
10000-4:
UA
Part
4:
Services
–
in
particular,
&quot;TransferSubscriptions&apos;&apos;
section).
The
OPC
UA
server
of
an
S7-1500
CPU
supports
the
transfer
of
subscriptions
as
of
firmware
version
V3.1.4.
Application
examples:
Interruption/timeout of an active session: e.g. due to a communication disruption:
subscription
transfer
from
an
interrupted
session
to
an
active
session
to
avoid
data
loss.
A
client
is
to
be
shut
down;
another
client
takes
over
the
subscription.
Load
distribution:
subscription
transfer
from
one
active
session
to
another
active
session
or
to
a
new
session.
Benefits
of
a
subscription
transfer:
The
transfer
of
a
subscription
prevents
data
loss
(in
the
event
of
client
failure,
disconnection
or
overload).
The
TransferSubscription
service
enables
the
transfer
of
subscribed
data.
With
this
service,
you
solve
the
encountered
connection
termination
problem
in
the
following
way:
If the connection of the client taking over the subscription to the server has been
established,
it
is
not
necessary
to
re-create
the
subscription
with
all
monitored
items.
The
accumulated, i.e. unsent, notification messages can be republished after the successful
subscription transfer. See also OPC 10000-4: UA Part 4: Services, section &quot;Re-establishing
connections&quot;.
The
transfer
of
a
subscription
spares
the
OPC
UA
client
the
time-
and
resource-intensive
process
of
creating
a
subscription.
When
a
subscription
with
a
large
number
of
monitored
items
is
created,
a
high
CPU
load
is
generated.
254
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Requirement
A
configuration
for
the
S7-1500
OPC
UA
server
is
not
required;
the
&quot;TransferSubscription&quot;
service
is
provided
on
request
of
an
OPC
UA
client.
All S7-1500 CPUs as of firmware V3.1.4 support the transfer of subscriptions.
Additional
requirements:
Users
(clients)
must
have
a
role
that
grants
them
Read
permission.
If
a
subscription
of
an
already
closed
session
is
to
be
transferred,
the
process
must
be
completed
within
the
subscription
timeout.
Subscriptions
can
be
transferred
both
between
sessions
of
an
authenticated
user
and
between
sessions
of
anonymous
users.
For
authenticated
users,
both
sessions
must
be
assigned
to
the
same
user.
For
anonymous
users,
the
connection
must
also
be
encrypted
and
the
sessions
must
have
been
created
by
clients
with
identical
application
URIs.
Handling
client
and
server
certificates
A
secure
connection
between
the
OPC
UA
server
and
an
OPC
UA
client
is
only
established
when
the
server
can
prove
its
identity
to
the
client.
This
is
done
with
the
server
certificate.
Certificate
of
the
OPC
UA
server
When
you
have
activated
the
OPC
UA
server
and
have
confirmed
the
security
prompts,
STEP
7
automatically generates the certificate for the server and saves it in the local certificate
directory of the CPU. You can view and manage this directory with the local certificate
manager
of
the
CPU
(exporting
or
deleting
certificates).
The
figure
below
shows
the
local
certificate
manager
of
the
CPU
with
the
automatically
generated
certificate
for
the
OPC
UA
server:
1799970
130323
Figure
11-26
Local
certificate
manager
of
the
CPU
Alternatively,
you
can
also
generate
a
server
certificate
yourself.
The
certificate
of
the
server
is
transferred
from
the
server
to
the
client
during
establishment
of
a
connection.
The
client
checks
the
certificate.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
255
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
The
client
user
decides
whether
the
server
certificate
is
to
be
trusted.
The
user
at
the
client
side
now
has
to
decide
whether
the
server
certificate
is
to
be
trusted.
If
the user trusts the server certificate, the client stores the server certificate in its directory
containing
the
trusted
server
certificates.
The
following
example
shows
a
dialog
of
the
client
&quot;UA
Sample
Client&quot;.
When
the
user
clicks
the
&quot;Yes&quot;
button,
the
client
trusts
the
server
certificate:
1622044
128196
Figure
11-27
Dialog
of
the
client
&quot;UA
Sample
Client&quot;
Where
does
a
client
certificate
come
from?
Client
of
the
S7-1500
If
you
are
using
the
OPC
UA
client
of
an
S7-1500
CPU
(OPC
UA
client
enabled),
you
can
create
certificates
for
these
clients
with
STEP
7
V15
and
higher.
In
the
project
tree,
select
the
CPU
you
want
to
use
as
a
client.
Double-click
&quot;Device
configuration&quot;.
In
the
properties
of
the
CPU,
click
&quot;Protection
&
Security
>
Certificate
manager&quot;.
Double-click
&quot;<Add
new>&quot;
in
the
&quot;Device
certificates&quot;
table.
STEP
7
opens
a
dialog.
Click
the
&quot;Add&quot;
button.
Select
the
&quot;OPC
UA
client&quot;
entry
from
the
&quot;Usage&quot;
list.
Note:
The
IP
addresses
under
which
the
CPU
can
be
accessed
in
your
system
must
be
entered
under
&quot;Subject
Alternative
Name
(SAN)&quot;.
You
must
therefore
configure
the
IP
interfaces
of
the
CPU
before
you
generate
a
client
certificate.
Click &quot;OK&quot;.
STEP
7
now
shows
the
client
certificate
in
the
&quot;Device
certificates&quot;
table.
Right-click
this
line
and
select
the
&quot;Export
certificate&quot;
entry
from
the
shortcut
menu.
Select
a
directory
where
you
will
store
the
client
certificate.
256
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Clients
of
other
manufacturers
When you use UA clients from manufacturers or the OPC Foundation, a client certificate is
generated
automatically
during
installation
or
upon
the
first
program
call.
You
have
to
import
these certificates via the global certificate manager in STEP 7 and use them for the
corresponding
CPU
(as
shown
above).
When
you
program
an
OPC
UA
client
yourself,
you
can
have
the
certificates
generated
by
the
program; see the section &quot;Instance certificate for the client&quot;. Alternatively, you can generate
certificates with tools, for example with OpenSSL or the certificate generator of the OPC
Foundation:
The
procedure
for
OpenSSL
is
described
here:
&quot;Generating
PKI
key
pairs
and
certificates
yourself&quot;.
Working
with
the
certificate
generator
of
the
OPC
Foundation
is
described
here:
&quot;Creating
self-signed
certificates&quot;.
Announcing
client
certificates
to
the
server
You
need
to
send
client
certificates
to
the
server
to
allow
a
secure
connection
to
be
established.
To
do
this,
follow
these
steps:
Select the &quot;Use global security settings for certificate manager&quot; option in the local
certificate
manager
of
the
server.
This
makes
the
global
certificate
manager
available.
You
will
find
this
option
under
&quot;Protection
&
Security
>
Certificate
manager&quot;
in
the
properties
of
the
CPU
that
is
acting
as
server.
If
the
project
is
not
yet
protected,
select
&quot;Security
settings
>
Settings&quot;
in
the
STEP
7
project
tree,
click
the
&quot;Protect
this
project&quot;
button
and
log
on.
The
&quot;Global
security
settings&quot;
item
is
now
displayed
under
&quot;Security
settings&quot;
in
the
STEP
7
project
tree.
Double
click
&quot;Global
security
settings&quot;.
Double
click
&quot;Certificate
manager&quot;.
STEP
7
opens
the
global
certificate
manager.
Click
on
the
&quot;Trusted
certificates&quot;
tab.
Right-click
in
the
tab
on
a
free
area
(not
on
a
certificate).
Select
the
&quot;Import&quot;
command
from
the
shortcut
menu.
The
dialog
for
importing
certificates
is
displayed.
Select
the
client
certificate
that
the
server
is
to
trust.
Click
&quot;Open&quot;
to
import
the
certificate.
The
certificate
of
the
client
is
now
contained
in
the
global
certificate
manager.
Note
the
ID
of
the
client
certificate
just
imported.
Click
the
&quot;General&quot;
tab
in
the
properties
of
the
CPU
that
is
acting
as
server.
Click
&quot;OPC
UA
>
Server
>
Security
>
Secure
Channel&quot;.
Scroll
down
in
the
&quot;Secure
Channel&quot;
dialog
to
the
section
&quot;Trusted
clients&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
257
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Double-click
in
the
table
on
the
empty
row
with
&quot;<add
new>&quot;.
A
browse
button
is
displayed
in
the
row.
Click
this
button.
Select
the
client
certificate
that
you
have
imported.
Click
the
button
with
the
green
check
mark.
Compile
the
project.
Load
the
configuration
onto
the
S7-1500
CPU.
Result
:
The
server
now
trusts
the
client.
If
the
server
certificate
is
also
considered
trusted,
the
server
and
client
can
establish
a
secure
connection.
Accepting
client
certificates
automatically
When
you
select
the
option
&quot;Automatically
accept
all
client
certificates
during
runtime&quot;
(below
the
&quot;Trusted
clients&quot;
list),
the
server
automatically
accepts
all
client
certificates.
Setting
after
commissioning
In
order
to
avoid
security
risks,
deactivate
the
&quot;Automatically
accept
client
certificates
during
runtime&quot;
option
again
after
commissioning.
NOTICE
Configuring
security
settings
of
the
server
The
figure
below
shows
the
available
server
security
settings
for
signing
and
encrypting
messages.
540004
155249
Figure
11-28
Configuring
security
settings
of
the
server
258
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
By default, a server certificate is created that uses SHA256 signing. The following security
policies
are
enabled:
None
Unsecured
end
point
NOTE
Disabling
security
policies
you
do
not
want
If
you
have
enabled
all
security
policies
in
the
secure
channel
settings
of
the
S7-1500
OPC
UA server (default setting) – thus, also the end point &quot;None&quot; (no security) – unsecured
data traffic (neither signed nor encrypted) between the server and client is also possible.
The identity of the client remains unknown with &quot;No security&quot;. Each OPC UA client can
then
connect
to
the
server
irrespective
of
any
subsequent
security
settings.
When configuring the OPC UA server, make sure that only security policies that are
compatible
with
the
security
concept
of
your
machine
or
plant
are
selected.
All
other
security
policies
should
be
disabled.
Recommendation:
If
possible,
use
the
setting
&quot;Basic256Sha256&quot;.
Basic128Rsa15
-Sign
Insecure
end
point,
supports
a
series
of
algorithms
that
use
the
hash
algorithm
RSA15
and
128-bit
encryption.
This
endpoint
protects
the
integrity
of
the
data
through
signing.
Basic128Rsa15
-Sign
&
Encrypt
Secure
endpoint,
supports
a
series
of
algorithms
that
use
the
hash
algorithm
RSA15
and
128-bit
encryption.
This
endpoint
protects
the
integrity
and
confidentiality
of
the
data
through
signing
and
encrypting.
Basic256Rsa15
-Sign
Secure
endpoint,
supports
a
series
of
algorithms
that
use
the
hash
algorithm
RSA15
and
256-bit
encryption.
This
endpoint
protects
the
integrity
of
the
data
through
signing.
Basic256Rsa15
-Sign
&
Encrypt
Secure
endpoint,
supports
a
series
of
algorithms
that
use
the
hash
algorithm
RSA15
and
256-bit
encryption.
This
end
point
protects
the
integrity
and
confidentiality
of
the
data
through
signing
and
encrypting.
Basic256Sha256
-
Sign
Secure
endpoint,
supports
a
series
of
algorithms
for
256-bit
hashing
and
256-bit
encryption.
This
endpoint
protects
the
integrity
of
the
data
through
signing.
Basic256Sha256
-
Sign
&
Encrypt
Secure
endpoint,
supports
a
series
of
algorithms
for
256-bit
hashing
and
256-bit
encryption.
This
endpoint
protects
the
integrity
and
confidentiality
of
the
data
through
signing
and
encryption.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
259
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Aes256_Sha256_RsaPss
-
Sign
Secure endpoint, supports a range of algorithms for 256-bit encryption and 256-bit
hashing. All certificates must use at least Sha256 signatures. This endpoint protects the
integrity
of
the
data
by
signing
it.
For
high
security
requirements.
PKI
infrastructure
required.
Aes256_Sha256_RsaPss
-
Sign
&
Encrypt
Secure endpoint, supports a range of algorithms for 256-bit encryption and 256-bit
hashing. All certificates must use at least Sha256 signatures. This endpoint protects the
integrity
and
confidentiality
of
data
by
signing
and
encrypting
it.
For
high
security
requirements.
PKI
infrastructure
required.
To
enable
the
security
setting,
click
the
check
box
in
the
relevant
line.
NOTE
If
you
use
the
settings
&quot;Basic256Sha256
-Sign&quot;
and
&quot;Basic256Sha256
-Sign
&
Encrypt&quot;,
the
OPC
UA
server
and
OPC
UA
clients
must
use
&quot;SHA256&quot;-signed
certificates.
For
the
settings
&quot;Basic256Sha256
-Sign&quot;
and
&quot;Basic256Sha256
-Sign
&
Encrypt&quot;,
the
certificate
authority
of
STEP
7
automatically
signs
the
certificates
with
&quot;SHA256&quot;.
&quot;No
Security&quot;
security
policy
and
authentication
via
user
name
and
password
You
can
set
the
following
combination:
Security
policy
=
&quot;No
Security&quot;
and
authentication
via
user
name
and
password.
The
OPC
UA
server
of
the
S7-1500
supports
this
combination.
OPC
UA
clients
can
connect
and
encrypt
the
authentication
data
or
not.
OPC
UA
client
of
the
S7-1500
CPU
also
supports
this
combination:
However,
in
runtime
it
only
connects
if
it
can
send
the
authentication
data
encrypted
via
cable!
260
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Generating
server
certificates
with
STEP
7
The description below shows the procedure for generating new certificates with STEP 7 and
applies
in
principle
to
various
uses
of
the
certificates.
STEP
7
sets
the
appropriate
purpose
-
in
this
case
&quot;OPC
UA
Client
&
Server&quot;
-
depending
on
which
area
of
the
CPU
properties
is
used
to
start
the
following
dialog.
Recommendation:
To
use
the
full
functionality
for
the
security
of
the
OPC
UA
server,
use
the
global
security
settings.
The
global
security
settings
are
enabled
in
the
CPU
properties
under
&quot;Protection
&
Security
>
Certificate
manager&quot;.
Customizing
server
certificates
STEP 7 automatically generates a certificate for the OPC UA server of the S7-1500 when you
activate
the
server
(see
&quot;Activating
the
OPC
UA
server
(Page
246)&quot;).
In
the
process
STEP
7
uses
the default values for the parameters of the certificate. If you want to change the parameters,
follow
these
steps:
Click
the
Browse
button
under
&quot;General
>
OPC
UA
>
Server
>
Security
>
Secure
channel
>
Server certificate&quot; in the properties of the CPU. A dialog is displayed that shows the
certificates
available
locally.
Click
the
&quot;Add&quot;
button.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
261
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
The dialog for generating new certificates is displayed (figure below). The values for an
example
are
already
entered:
1807577
140211
Figure
11-29
Customizing
server
certificates
Use
other
parameters
if
this
is
necessary
in
accordance
with
the
security
specifications
in
your
company
or
your
customer.
262
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Explanation
of
fields
for
certificate
generation
CA
Select
whether
the
certificate
is
to
be
self-signed
or
signed
by
one
of
the
CA
certificates
of
the
TIA
Portal.
The
certificates
are
described
under
&quot;Certificates
with
OPC
UA&quot;.
If
you
want
to
generate
a
certificate
that
is
to
be
signed
by
one
of
the
CA
certificates
of
the
TIA-Portal,
the project must be protected and you must be logged in as a user with all the required
function rights. Further information can be found under &quot;Basics of user administration in
the
TIA
Portal&quot;.
Certificate
holder
The default setting always consists of the name of the project and &quot;\OPCUA-1&quot;. In the
example, the project name is &quot;PLC1&quot;. In the properties of the CPU set the project name
under
&quot;General
>
Project
information&quot;
>
Name&quot;.
Keep
the
default
or
enter
a
different
name
that
is
more
meaningful
for
the
OPC-UA
server
under
&quot;Certificate
holder&quot;.
Signature
Here
you
select
the
hash
and
encryption
process
that
is
to
be
used
when
signing
the
server
certificate.
The
following
entries
are
available:
&quot;sha1RSA&quot;,
&quot;sha256RSA&quot;.
Valid
from
Here
you
enter
the
date
and
time
for
the
beginning
of
the
validity
of
the
server
certificate.
Valid
until
Here you enter the date and time for the end of the validity of the server certificate.
Ensure
that
the
certificate
is
valid
not
only
for
one
year
or
a
few
years.
In
the
example
the
certificate is valid for 30 years. However, for reasons of security you should renew the
certificate
at
much
shorter
intervals.
The
long
period
of
validity
gives
you
the
opportunity
to decide when a suitable moment would be, for example, when the system is being
serviced.
Usage
The default is &quot;OPC UA client & server&quot;. Keep this default for the OPC UA server. The
&quot;Create a new certificate&quot; dialog can be called from several points in STEP 7. If, for
example,
you
call
this
dialog
for
the
Web
server
of
the
CPU,
&quot;Web
server&quot;
is
entered
under
&quot;Usage&quot;.
The
following
entries
are
available
in
the
Usage
drop-down
list:
&quot;OPC
UA
client&quot;
&quot;OPC
UA client
&
server&quot;
&quot;OPC
UA
server&quot;
&quot;TLS&quot;
&quot;Web
server&quot;
Subject
Alternative
Name
(SAN)
The
following
is
entered
in
the
example
above:
&quot;URI:urn:SIMATIC.S7-1500.OPC-UAServer:PLC1,IP:192.168.178.151,IP:192.168.1.1&quot;.
This
URI
must
be
correctly
entered
because
it
is
checked
against
the
communicated
application
description.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
263
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
The
following
entry
would
also
be
valid:
&quot;IP:
192.168.178.151,
IP:
192.168.1.1&quot;.
The
important
thing
here
is
that
the
IP
addresses
via
which
the
OPC
UA
server
of
the
CPU
can
be
accessed
are
entered
here.
See
&quot;Access
to
the
OPC
UA
server
(Page
248)&quot;.
This
allows
OPC
UA
clients
to
verify
whether
a
connection
to
the
OPC
UA
server
of
the
S7-1500 is really to be established or whether in fact an attacker is trying to send
manipulated
values
from
another
PC
to
the
OPC
UA
client.
User
authentication
Types
of
user
authentication
For
the
OPC
UA
server
of
the
S7-1500,
you
can
set
what
authentication
is
required
for
a
user
of
the
OPC
UA
client
wishing
to
access
the
server.
You
have
the
following
options:
Guest
authentication
The
user
does
not
have
to
prove
their
authorization
(anonymous
access).
The
OPC
UA
server
does
not
check
the
authorization
of
the
client
user
For CPUs up to firmware version V3.0: If you want to use this type of user authentication,
select the &quot;Enable guest authentication&quot; option under &quot;OPC UA > Server > Security > User
authentication&quot;.
For
CPUs
as
of
firmware
version
V3.1:
Use
the
local
user
management
to
implement
the
guest
authentication
via
the
&quot;Anonymous&quot;
user.
NOTE
To
increase
security,
you
should
only
allow
access
to
the
OPC
UA
server
with
user
authentication.
User
name
and
password
authentication
The user has to prove their authorization (no anonymous access). The OPC UA server
checks
whether
the
client
user
is
authorized
to
access
the
server.
Authorization
is
given
by
the
user
name
and
the
correct
password.
For CPUs up to firmware version V3.0: If you want to use this type of user authentication,
proceed
as
follows:
Select
the
&quot;Enable
user
name
and
password
authentication&quot;
option
under
&quot;OPC
UA
>
Server
>
Security
>
User
authentication&quot;.
Deactivate
the
guest
authentication.
Enter
the
user
in
the
&quot;User
management&quot;
table.
To
do
so,
click
the
&quot;<Add
new
user>&quot;
entry.
A
new
user
is
created
with
an
automatically
assigned
name.
You
can
edit
the
user
name
and
enter
the
password
for
the
user
name.
You
can
add
a
maximum
of
21
users.
264
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Additional
user
administration
via
the
security
settings
of
the
project
For
CPUs
up
to
firmware
version
V3.0,
the
&quot;Enable
additional
user
management
via
project
security settings&quot; option is available. You can find this setting under the general OPC UA
settings (CPU properties: OPC UA > General). If you select this option, the user
management
for
the
open
project
will
also
be
used
for
user
authentication
for
the
OPC
UA
server: The same user names and passwords are then valid in OPC UA as in the current
project.
Proceed
as
follows
to
activate
user
management
for
the
project:
Click
&quot;Security
settings
>
Settings&quot;
in
the
project
tree.
Click
the
&quot;Protect
this
project&quot;
button.
Enter
your
user
name
and
your
password.
Enter
additional
users
under
&quot;Security
settings
>
Users
and
roles&quot;.
If
you
configure
an
additional
OPC
UA
server
in
your
project,
also
select
the
option
&quot;Enable
additional user administration via the security settings of the project&quot;. Repeated input of
user
names
and
passwords
is
then
unnecessary.
Transfer
of
user
authentication
via
the
secure
channel
In
OPC
UA,
identification
data
for
user
authentication,
such
as
user
name
and
password,
is
transferred with a separate security policy. This security policy is referred to as the
&quot;UserTokenPolicy&quot;.
Regardless
of
the
configured
security
policies
for
the
secure
channel,
an
OPC
UA
client
selects
an
appropriate
&quot;UserTokenPolicy&quot;
during
connection
establishment
when
user
authentication
is required. This UserTokenPolicy ensures that a UserIdentityToken (e.g. user name and
password)
is
always
transferred
with
adequate
security
settings.
The
OPC
UA
client
is
then
able
to
transfer
the
user
name
and
password
with
encryption
if
&quot;No
security&quot; applies for the secure channel based on the configured security policy. For
information
on
the
process
of
establishing
a
secure
connection
in
OPC
UA,
see
Secure
transfer
of
messages
(Page
196).
Users
and
roles
with
OPC
UA
function
rights
The
following
options
for
user
authentication
use
central
project
settings
for
project
users:
For
the
server:
For
configuration
of
CPU
properties
(OPC
UA
>
Server
>
Security
>
User
authentication).
Option:
&quot;Enable
additional
user
administration
via
the
security
settings
of
the
project&quot;
For
the
client:
For
configuration
of
client
interface
(&quot;Configuration&quot;
tab,
&quot;Security&quot;).
Option:
&quot;User
(TIA
Portal
-
security
settings)&quot;
Requirement
Before
you
can
edit
the
security
settings,
the
project
must
be
protected
and
you
must
be
logged
on
with
sufficient
rights,
for
example
as
administrator.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
265
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Settings
in
the
project
tree
>
&quot;Security
settings&quot;
You access the central user settings and roles in the protected project in the project tree
under &quot;Security settings&quot;. This is where you centrally define users with user name, password
and
function
rights.
You
can
simply
use
these
settings
elsewhere.
1625346
136278
Figure
11-30
Setting
user
and
roles
Reusing
central
security
settings
Examples
for
reusing elsewhere:
User
selection
for
user
authentication
for
OPC
UA
server
With this setting, you tell the server which client (user) with which user name and which
password
is
allowed
to
access
the
server.
User
selection
for
OPC
UA
client
authentication
With
this
setting,
you
tell
the
client
the
user
name
and
password
that
it
is
to
use
for
client
authentication
for
the
server.
The
settings
for
the
client
and
server
must
correspond:
The
user
name
and
password
used
by
the client to log on must have been set up on the server and assigned the required
authorizations.
Function
rights
for
server
and
client
The
corresponding
function
rights
for
the
client
or
the
server
must
also
be
enabled
for
users
of the client function and users of the server function on an S7-1500 CPU. It is not enough
simply
to
save
the
user
name
and
password
centrally.
Here
is
an
example
to
illustrate
this
type
of
rights
use.
Under
&quot;Security
settings
>
Users
and
roles&quot;,
you
define
a
new
role
in
the
&quot;Roles&quot;
tab
with
the
name
&quot;PLC-opcua-role-all-inclusive&quot;,
for
example.
Tip
:
The
tab
may
be
covered
by
an
information
window
(&quot;The
current
status
has
not
yet
been
checked...&quot;).
In
this
case,
first
close
the
information
window.
In
the
&quot;Function
rights
categories&quot;
section,
you
navigate
to
the
runtime
rights
and
then
to
the
CPU
function
rights,
and
select
the
CPU
whose
function
rights
you
want
to
set.
266
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
You
will
find
the
following
function
rights
in
the
&quot;Function
rights&quot;
section:
OPC
UA
server
access
This function right applies on the OPC UA server of the S7-1500 CPU. Only when this
option is selected, can the user with the role &quot;PLC-opcua-role-all-inclusive&quot; transfer
certificates, CRLs or trusted lists to the CPU at runtime (push function). This function
right
is
required
for
automated
certificate
handling,
for
example,
in
the
context
of
GDS
(Global
Discovery
Service).
Managing
certificates
This function right applies on the OPC UA server of the S7-1500 CPU. Only when this
option is enabled, can the user with the role &quot;PLC-opcua-role-all-inclusive&quot; transfer
certificates, CRLs or trusted lists to the CPU at runtime (push function). This function
right
is
required
for
automated
certificate
handling,
for
example,
in
the
context
of
GDS
(Global
Discovery
Service).
User
authentication
of
the
OPC
UA
client
This function right applies on the OPC UA client of the S7-1500 CPU (with client
instructions).
Only
when
this
option
is
selected,
can
the
user
with
the
role
&quot;PLC-opcua-
role-all-inclusive&quot; use the user name and password for authentication to establish a
session
with
a
server.
2160016
131443
Figure
11-31
Setting
function
rights
The
role
&quot;PLC-opcua-role-all-inclusive&quot;
still
needs
to
be
assigned
to
the
relevant
users
(&quot;Users&quot;
tab
under
&quot;Security
settings&quot;
in
the
project
tree).
NOTE
&quot;Runtime
timeout&quot;
for
users
with
OPC
UA
function
rights
The
value
in
the
column
&quot;Runtime
timeout&quot;
(max.
session
duration)
in
the
table
for
user
configuration
does
not
evaluate
the
CPU
for
OPC
UA
runtime
rights.
Therefore, a user is not automatically logged out after a certain period of time. For this
purpose
use
OPC
UA
specific
mechanisms
such
as
the
parameter
&quot;Max.
session
timeout&quot;
(area
OPC
UA
>
Server
>
Settings).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
267
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Diagnostic
settings
of
the
server
Diagnostics
You can specify the scope of the diagnostics of the OPC UA server in the CPU settings.
To
change
the
diagnostics
scope,
navigate
to
the
&quot;OPC
UA
>
Server
>
Diagnostics&quot;
area.
Figure
11-32
Diagnostic
settings
of
OPC
UA
server
Default
setting
The
default
setting
is
a
diagnostics
behavior
that
supports
the
most
important
diagnostics
without
appreciably
increasing
the
communication
load.
You
enable
diagnostics
for
subscriptions
when
the
OPC
UA
server
also
uses
subscriptions,
i.e.
if
necessary
during
the
commissioning
phase
only.
Reason:
A
large
volume
of
diagnostic
activity
generates
a
high
communication
load
in
the
CPU
and
may
suppress
other
important
messages.
Or,
the
high
volume
of
diagnostics
may
result
in
important
messages
disappearing
in
the
mass
of
messages
and
being
ignored.
Additional
information
You
will
find
additional
information
on
the
meaning
and
effect
of
the
settings
shown
above
here
(Page
336).
268
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
License
for
OPC
UA
Runtime
licenses
A license is required to run the OPC UA server of the S7-1500 CPU. The type of license
required
depends
on
the
performance
of
the
respective
CPU.
The
following
license
types
are
differentiated:
SIMATIC
OPC
UA
S7-1500
small
(required
for
CPU
1511,
CPU
1512,
CPU
1513,
ET
200SP
CPUs,
CPU
1515SP
PC)
SIMATIC
OPC
UA
S7-1500
medium
(required
for
CPU
1515,
CPU
1516,
Software
Controller
CPU
1507,
CPU
1516pro-2PN)
SIMATIC
OPC
UA
S7-1500
large
(required
for
CPU
1517,
CPU
1518)
The
required
license
type
is
displayed
under
&quot;Properties
>
General
>
Runtime
licenses
>
OPC-UA
>
Type
of
required
license&quot;:
1799970
128437
Figure
11-33
OPC
UA
server
Runtime
licenses
To
confirm
purchase
of
the
required
license,
follow
these
steps:
Click
&quot;Runtime
licenses
>
OPC
UA&quot;
in
the
properties
of
the
CPU.
Select
the
required
license
from
the
&quot;Type
of
purchased
license&quot;
drop-down
list.
OPC
UA
server
interface
configuration
What
is
a
server
interface?
Definition
A
server
interface
combines
nodes
of
an
OPC
UA
address
space
of
a
CPU
into
a
unit,
so
that
a
specific
view
on
this
CPU
is
provided
for
OPC
UA
clients.
Each
server
interface
defines
one
or
more
namespaces
in
the
OPC
UA
server
of
the
CPU.
STEP
7
(TIA
Portal)
differentiates
between
the
following
types
of
server
interfaces:
Companion
specification
For
this
type
of
server
interface,
you
use
a
Companion
Specification
created
by
a
workgroup,
for
example.
The
workgroup
is
typically
composed
of
members
of
the
OPC
Foundation
and
another
industry organization who have jointly specified an OPC UA information model for a
specific purpose (for example, for data exchange with RFID devices or with injection
molding
machines).
This
information
model
is
realized
in
the
form
of
OPC
UA
nodes
in
the
address
space
of
an
OPC
UA
server.
OPC
UA
clients
can
access
these
OPC
UA
nodes.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
269
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
You
can
also
use
the
server
interface
type
&quot;Companion
specification&quot;,
for
example,
to
download
company-internal
information
models,
e.g.
in
SiOME.
If you implement a certain companion specification in your project, you apply the
specifications
of
this
companion
specification
into
your
project
as
server
interface.
For
&quot;Companion
specification&quot;-type
server
interfaces,
you
can
import
multiple
namespaces
which
the
Companion
specification
uses.
(
https://support.industry.siemens.com/cs/ww/en/view/109755133
).
Additional information on companion specifications is available here
(Page 271).
Additional
information
on
SiOME
is
available
here
When companion specifications refer to type definitions in dependent specifications,
use
the
reference
namespaces
for
this.
You
import
reference
namespaces
as
you
would
the
actual
companion
specifications.
See
Creating
a
server
interface
for
companion
specification
(Page
278).
If
you
want
to
make
instance
data
from
FBs
or
UDTs
of
the
CPU
accessible
to
OPC
UA
clients, you can have these instance data assignments automatically made as of TIA
Portal
version
V17.
You
only
need
to
map
the
FB
types
or
the
UDTs
to
suitable
OPC
UA
data types of an imported reference namespace. For this mapping to be possible,
enable the option &quot;Generate OPC UA nodes based on the local data mapping&quot; in the
dialog for creating an OPC UA server interface of the type companion
specification/reference
namespace.
(Page
303)
See
Generating
OPC
UA
nodes
based
on
local
data
mappings
of
FB
types
and
UDTs
User-defined
server
interface:
For
this
type
of
server
interface
you
combine
OPC
UA
nodes
of
an
OPC
UA
server
into
a
unit.
To
do
this,
use
the
specifications
for
your
project
or
the
requirements
for
your
machine
or
your
plant
as
a
basis.
Additional
information
on
the
user-defined
server
interface
is
available
here
(Page
283).
Injection
molding
machine
as
an
example
for
companion
specification
In
this
example,
a server
interface contains
the
following
elements:
OPC
UA
nodes
which
you
can
write
with
an
OPC
UA
client
to
receive
information
about
this
injection
molding
machine
(in
readable
PLC
tags)
OPC
UA
nodes
which
you
can
write
with
an
OPC
UA
client
to
transfer
values
to
the
injection
molding
machine
(in
writable
PLC
tags)
OPC
UA
nodes
which
you
can
call
with
an
OPC
UA
client
to
start
functions
of
the
injection
molding
machine
(via
server
methods)
This
server
interface
enables
a
default
view
of
a
CPU,
which
can
be
used
to
control
an
injection
molding
machine.
For injection molding machines, the companion specifications &quot;OPC UA specifications for
plastics
and
rubber
machines&quot;
(previously
&quot;Euromap&quot;)
define
a
whole
series
of
OPC
UA
nodes
which
you
can
apply
as
a
server
interface.
270
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Other
OPC
UA
nodes
of
the
CPU
are
not
included
in
this
server
interface.
This
provides
a
better
overview.
Example
of
user-defined
server
interface
A
CPU
should
control
the
production
of
workpieces.
Production
begins
when
a
production
job
arrives
from
the
higher-level
control
system.
The production jobs are transferred via a server method: A control system transmits
information
on
a
workpiece
by
calling
the
server
method
in
the
CPU.
This
server
method
also
starts
production.
The
control
system,
i.e.
the
connected
OPC
UA
client,
should
only
see
this
one
server
method.
Therefore,
you
create
a
user-defined
server
interface
in
the
CPU
and
assign
the
server
method
to this server interface. You enable only this server interface for OPC UA clients and thus limit
the
view
of
the
CPU
to
this
one
function.
Using
OPC
UA
companion
specifications
Introduction
OPC
UA
is
universally
applicable:
The
standard
itself
does
not,
for
example,
specify
how
PLC
tags
are
to
be
named.
It
is
also
up
to
the
individual
user
(application
developer)
to
program
and
name
server
methods
that
can
be
called
over
OPC
UA.
Information
modeling
and
standardization
for
devices
and
sectors
For
applications
of
the
same
kind,
it
is
worth
standardizing
your
device
or
machine
interface
with
the
&quot;OPC
UA
toolkit&quot;.
Many
different
bodies
and
working
groups
have
driven
forward
standardization
and
developed
a
range
of
companion
specifications.
These
specifications
define:
The
objects,
methods
and
tags
with
which
a
typical
device
or
machine
is
to
be
described.
The
namespace
intended
for
the
specified
objects.
Machines
are
typically
structured
in
functional
or
technological
units,
and
these
units
are
then
standardized.
Companion
specifications
offer
machine
and
plant
operators
the
benefits
of
a
standardized
interface. For example, all RFID readers that comply with the AutoID specifications can be
integrated in the same way. This means that all RFID readers that comply with the AutoID
specifications can be addressed by OPC UA clients in the same way irrespective of
manufacturer.
Another
example
of
companion
specifications
is
the
Euromap
77
Companion
Specifications
from
the
injection
molding
machinery
sector.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
271
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
The
following
section
uses
the
example
of
Euromap
77
to
detail
how
to
apply
companion
specifications
in
STEP
7
(TIA
Portal)
and
create
the
necessary
PLC
tags.
NOTE
EUROMAP
and
the
OPC
Foundation
have
established
the
Joint
Working
Group
&quot;OPC
UA
Plastics
and
Rubber
Machinery&quot;.
The existing EUROMAP recommendations EUROMAP 77 (data exchange between injection
moulding
machines
and
MES),
82.1
(temperature
control
devices)
and
83
(general
definitions)
were
published
under
the
neutral
umbrella
of
the
OPC
Foundation
as
OPC
40077,
40082-1
and
40083.
A
major
change
it
the
change
of
the
namespace,
for
example,
for
EUROMAP
77:
Currently
&quot;http://opcfoundation.org/UA/PlasticsRubber/IMM2MES/&quot;.
The
examples
listed
below
use
the
previously
valid
designations
and
references.
Example
Euromap
77
(currently:
OPC
40077)
Euromap 77 or the successor standard OPC 40077 standardizes the exchange of data
between injection molding machines and the higher-level MES (Manufacturing Execution
System). This allows the MES to connect all lower-level injection molding machines in the
same
way.
The
standardized
data
interface
facilitates
the
integration
of
injection
molding
machines
into
a
plant.
Using
companion
specifications:
Overview
Euromap
77
is
described
in
the
OPC
UA
XML
file
&quot;Opc_Ua.EUROMAP77.NodeSet2.xml&quot;.
NOTE
Euromap
77,
Euromap
83
and
OPC
UA
for
Devices
(DI)
With Release Candidate 2, some of the Euromap definitions have been transferred from
Euromap 77 to Euromap 83 (currently OPC 40083). You will therefore also need to import
the
OPC
UA
server
interface
of
Euromap
83.
&quot;OPC UA for Devices&quot; is a generally applicable information model for the configuration of
hardware
and
software
components.
The
information
model
also
serves
as
the
basis
for
other
companion
standards
and
is
therefore
also
imported.
The
OPC
UA
XML
files
are
available
here:
Euromap77 (
https://www.euromap.org/euromap77
)
Euromap83
(
https://www.euromap.org/euromap83
)
OPC
UA
for
Devices
(
https://opcfoundation.org/UA/schemas/DI/
)
These
XML
files
define
an
OPC
UA
interface
of
an
injection
molding
machine
that
complies
with
Euromap
77.
272
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Using
Euromap
77:
Overview
To
use
Euromap
77,
proceed
as
follows:
Generate
an
XML
file
by
creating
an
instance
of
the
type
&quot;IMM_MES_InterfaceType&quot;
using
the
SiOME
program.
How
to
proceed
is
described
below
in
&quot;Step
1:
Create
instances
in
SiOME&quot;.
In
STEP
7
(TIA
Portal),
create
PLC
tags
and
server
methods
that
correspond
to
the
instance
of
the
type
&quot;IMM_MES_InterfaceType&quot;
(created
in
Step
1).
See
below
for
information
on
how
to
proceed
in
&quot;Step
2:
Create
PLC
tags
in
STEP
7&quot;.
An
example
of
OPC
UA
nodes
and
the
corresponding
PLC
tags
can
be
found
in
section
&quot;Creating
a
server
interface
for
companion
specification
(Page
278)&quot;.
In
STEP
7
(TIA
Portal),
add
a
new
server
interface
of
companion
specification
type
and
import
the
XML
file
you
created
in
step
1.
The
&quot;Creating
a
server
interface
for
companion
specification
(Page
278)&quot;
section
describes
how
to
proceed.
Assign
the
OPC
UA
nodes
of
the
new
server
interface
to
the
corresponding
PLC
tags,
which
you
created
in
step
2.
The
&quot;Creating
a
server
interface
for
companion
specification
(Page
278)&quot;
section
describes
how
to
proceed.
Step
1:
Create
instances
in
SiOME
The
following
section
describes
how
to
use
the
free
program
&quot;SiOME&quot;,
the
&quot;Siemens
OPC
UA
Modeling
Editor&quot;.
With
SiOME,
you
can
create
an
OPC
UA
XML
file,
which
describes
the
server
interface
(an
information
model).
Download
link
and
explanations
about
SiOME
are
available
here
(
https://support.industry.siemens.com/cs/ww/en/view/109755133
).
Procedure
in
STEP 7
To use the new server interface, import the server interface into the STEP 7 project, see
section
&quot;Creating
a
server
interface
for
companion
specification
(Page
278)&quot;.
When
the
project
is
loaded
into
the
CPU,
the
new
server
interface
is
available
for
OPC
UA
clients.
Procedure
in
SiOME
1.7.3
NOTE
The
following
description
shows
the
work
steps
in
SiOME
1.7.3.
Follow-up versions of SiOME make it easier for you, for example, to create corresponding
DBs,
structures,
variables
or
methods
in
the
user
program.
Using
a
drag-and-drop
operation,
you
can
transfer
data,
for
example,
from
SiOME
to
the
TIA
Portal
(user
program).
In
this
case,
the variables, etc. are already mapped correctly or, for methods, the corresponding FB
elements
are
also
generated
correctly
in
the
user
program.
Download
the
current
SiOME
version
using
the
download
link
listed
above,
and
follow
the
instructions
in
the
documentation
included
in
the
download.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
273
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
The
following
description
shows
the
work
steps
in
SiOME
1.7.3.
To
use
Euromap
77,
create
an
XML
file
with
an
instance
of
&quot;IMM_MES_InterfaceType&quot;.
The
object
type
must
be
instantiated
in
order
for
the
information
model
of
the
specific
machine
to
appear
in
the
address
space
of
the
OPC
UA
server.
The
object
type
&quot;IMM_MES_InterfaceType&quot;
is
the
root
object
type
of
Euromap
77.
&quot;IMM&quot;
stands
for
&quot;Injection
Moulding
Machine&quot;.
Follow
these
steps:
Download the files &quot;Opc_Ua.EUROMAP77.NodeSet2.xml&quot; and
&quot;Opc_Ua_EUROMAP83_NodeSet2.xml&quot;
from
the
Euromap
website
(see
above).
Download
the
file
&quot;Opc.Ua.Di.NodeSet2
.
xml&quot;
from
the
OPC
Foundation
website.
The
&quot;Opc.Ua.Di.NodeSet2
.
xml&quot;
file
contains
type
definitions
which
Euromap
77
uses.
Start
SiOME.
First,
import
the
namespace
&quot;http://opcfoundation.org/UA/DI/&quot;.
To
do
so,
click
the
&quot;Import
XML&quot;
button
in
the
&quot;Information
model&quot;
area.
1803526
124616
Figure
11-34
&quot;Import
XML&quot;
button
in
SiOME
SiOME
displays
the
dialog
for
the
opening
files.
To
import
the
file,
select
the
&quot;Opc.Ua.Di.NodeSet2.xml&quot;
file
and
click
&quot;Open&quot;.
Result: SiOME imports the XML file and shows the namespace
&quot;http://opcfoundation.org/UA/DI/&quot;
in
the
&quot;Namespaces&quot;
area.
The
standard
namespace
&quot;http://opfoundation.org/UA/&quot;
is
always
available
in
SiOME
and
does
not
have
to
be
imported.
Now
import
the
namespace
&quot;http://www.euromap.org/euromap83/&quot;
To
do
so,
click
the
&quot;Import
XML&quot;
button
again
in
the
&quot;Information
model&quot;
area.
Select
the
file
&quot;Opc_Ua.EUROMAP83.NodeSet2.xml&quot;.
Result: SiOME imports the XML file and shows the namespace
&quot;http://www.euromap.org/euromap83/&quot;
in
the
&quot;Namespaces&quot;
area.
Now
import
the
namespace
&quot;http://www.euromap.org/euromap77/&quot;
To
do
so,
click
the
&quot;Import
XML&quot;
button
again
in
the
&quot;Information
model&quot;
area.
Select
the
file
&quot;Opc_Ua.EUROMAP77.NodeSet2.xml&quot;.
Create
your
own
namespace
for
your
project.
To
do
this,
right-click
in
the
&quot;Namespaces&quot;
area
on
&quot;OPC
UA
Modelling
Editor
Project&quot;
or
on
&quot;Namespaces&quot;
and
select
&quot;Add
Namespace&quot;.
SiOME
opens
the
&quot;Add
Namespace&quot;
dialog.
274
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Enter
the
name of
a
new namespace.
1980057
537476
The
&quot;YourCompany.org&quot;
namespace
is
used
in
the
example.
SiOME
now
also
displays
the
new
namespace:
Figure
11-35
Display
of
the
namespace
in
SiOME
Create
an
instance
from
the
root
object
type
IMM_MES_InterfaceType
of
the
Companion
specification
Euromap
77.
To
do
so,
in
the
&quot;Information
model&quot;
area,
right-click
the
&quot;DeviceSet&quot;
directory
and
select
&quot;Add
Instance&quot;.
SiOME
displays
the
&quot;Add
Instance&quot;
dialog.
For
&quot;Name&quot;,
enter
a
meaningful
name
for
your
instance.
In
the
example,
enter
&quot;IMM_Manufacturer_01234&quot;.
For
&quot;TypeDefinition&quot;,
select
&quot;IMM_MES_InterfaceType&quot;.
This
object
type
is
the
root
object
type
of
Euromap
77:
If
you
generate
an
instance
of
this
object
type,
then
use
the
Euromap
77
once
in
the
address
space
of
your
OPC
UA
server.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
275
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Click &quot;OK&quot;.
SiOME
shows
the
new
instance
&quot;IMM_Manufacturer_01234&quot;
in
the
&quot;Information
model&quot;
area
under
&quot;DeviceSet&quot;:
1803145
137910
Figure
11-36
Display
information
model
Create
an
instance
of
the
data
type
&quot;InjectionUnitType&quot;.
To
do
this,
right-click
on
the
&quot;InjectionUnits&quot;
directory
in
the
&quot;Information
model&quot;
area
and
select
&quot;Add
Instance&quot;.
SiOME
displays
the
&quot;Add
Instance&quot;
dialog.
For
&quot;Name&quot;,
enter
a
meaningful
name
for
the
instance.
In
the
example,
enter
&quot;InjectionUnit_1&quot;.
For &quot;TypeDefinition&quot;, select &quot;InjectionUnitType&quot;.
Click
&quot;OK&quot;.
Create
a
new
&quot;Mould_1&quot;
instance
of
the
&quot;MouldType&quot;
object
type
in
the
&quot;Moulds&quot;
directory.
Create
a
new
instance
&quot;PowerUnit_1&quot;
of
the
&quot;PowerUnitType&quot;
object
type
in
the
&quot;PowerUnits&quot;
directory.
Save
the
XML
file.
To
do
so,
click
the
&quot;Quick
save&quot;
button
in
the
&quot;Information
model&quot;
area:
1799970
128096
Figure
11-37
&quot;Quick
save&quot;
button
in
SiOME
276
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Export
the
XML
file.
To
do
so,
click
the
&quot;Export
XML&quot;
button
in
the
&quot;Information
model&quot;
area.
1983739
124475
Figure
11-38
&quot;Export
XML&quot;
button
in
SiOME
SiOME
shows
the
&quot;Export
XML&quot;
dialog.
Leave
all
namespaces
activated
and
click
&quot;OK&quot;.
SiOME
displays
the
&quot;Save
as&quot;
dialog.
Select
a
meaningful
name
and
save
the
exported
file.
In
the
example,
name the
XML
file
&quot;IMM_Manufacturer_01234&quot;.
Result
:
You
have
now
created
an
XML
file
which
uses
the
companion
specification
&quot;Euromap
77&quot;
once
(with
one
instance).
Step
2:
Creating
PLC
tags
for
the
Euromap
77
instance
in
STEP
7.
For
Euromap
77,
you
must
provide
PLC
tags
and
server
methods
in
your
user
program
and
assign
the
instance
of
the
&quot;IMM_MES_InterfaceType&quot;
type.
To
create
PLC
tags
for
the
instance
of
the
&quot;IMM_MES_InterfaceType&quot;
type,
proceed
as
follows.
Create
a
user-defined
data
type
(UDT).
The
figure
below
shows
the
beginning
of
the
user-defined
data
type
&quot;InjectionUnit&quot;
as
example.
This
data
type
has
the
same
structure
as
&quot;InjectionUnit&quot;
in
the
type
&quot;IMM_MES_InterfaceType&quot;.
Make
sure
that
you
use
SIMATIC
data
types
that
are
compatible
with
the
OPC
UA
data
types
(see
&quot;Mapping
of
data
types&quot;
below).
1980057
129596
Figure
11-39
Creating
a
UDT
in
STEP
7
Add
a
new
global
data
block
to
your
STEP
7
project.
In the example, name the data block &quot;IMM_Manufacturer_01234&quot;, so that there is a
reference
to
the
injection
molding
machine
of
the
respective
manufacturer
and
the
serial
number.
Create
a
new
element
in
this
data
block.
In
the
example,
name
this
element
&quot;InjectionUnit_1&quot;
Assign
the
new
user-defined
data
type
&quot;InjectionUnit&quot;
to
this
element.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
277
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Result
In
your
STEP
7
project,
you
have
created
a
tag
for
the
Euromap
77
in
the
&quot;IMM_Manufacturer_01234&quot;
data
block.
Creating
a
server
interface
for
companion
specification
For basic information on companion specifications, refer to the section &quot;Using OPC UA
companion specifications
(Page 271)&quot;.
The benefits of the Euromap 77 companion
scpecification,
which
provides
a
model
for
injection
molding
machines,
is
also
discussed
in
detail
there.
Using
this
companion
standard,
the
S7-1500
CPU
can
control
an
injection
molding
machine,
for example, and provide an OPC UA client, such as a higher-level MES system, with an
interface
for
accessing
the
functions
and
tags
of
injection
molding
machine.
An OPC UA server interface of the type &quot;Companion Standard&quot; limits the access of clients to
exactly
those
functions
and
tags
that
are
required,
for
example,
for
higher-level
systems
(MES
systems).
The
following
description
shows
how
to
create
a
server
interface
in
STEP
7
(TIA
Portal)
which
contains
only
the
Euromap
77
companion
specification.
If
you
want
to
make
OPC
UA
clients
accessible
to
other
tags
or
methods
than
those
required
for
the
management
of
an
injection
molding
machine,
simply
create
another
OPC
UA
server
interface.
In
this
way,
you
can
clearly
arrange
the
functionality
of
the
CPU
as
OPC
UA
server.
Creating
a
server
interface
for
a
companion
specification
To
create
a
server
interface
for
a
companion
specification
with
STEP
7
(TIA
Portal),
proceed
as
follows:
Select
the
CPU
that
you
want
to
use
as
an
OPC
UA
server.
In
the
project
tree,
click
&quot;OPC
UA
communication
>
Server
interfaces&quot;.
Double-click
&quot;Add
new
server
interface&quot;.
To
select
this
type
of
server
interface,
click
&quot;Companion
specification&quot;.
A
general
name
for
the
new
server
interface
is
entered
in
the
dialog,
for
example
&quot;Server_Interface_1&quot;.
278
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Change
the
name
of
the
new
server
interface
so
that
it
is
descriptive
in
your
project.
The
name
should
have
the
following
structure
according
to
Euromap
77:
&quot;IMM_<Manufacturer>_<Serial
number>&quot;.
The
example
uses
the
name
&quot;IMM_Manufacturer_01234&quot;.
1980057
125728
In
the
&quot;Import
XML
file&quot;
field,
select
an
XML
file
that
describes
an
information
model.
The
&quot;Using
OPC
UA
companion
specifications
(Page
271)&quot;
section
describes
how
to
create
such
an
XML
file
with
the
SiOME
tool.
The figure below shows a section from the information model:
&quot;IMM_MANUFACTURER_0123456&quot;
an
instance
(use)
of
the
type
&quot;IMM_MES_InterfaceType&quot;
which was defined by Euromap 77 . &quot;InjectionUnit_1&quot; is an instance of the
&quot;InjectionUnitType&quot;
type
of
Euromap
77.
1983232
129031
Click &quot;OK&quot;.
STEP
7
(TIA
Portal)
imports
the
information
model
described
in
the
selected
XML
file.
An
error
occurs
when
type
definitions
are
used
in
the
imported
XML
file
that
are
not
yet
present
in
STEP
7
(TIA
Portal)
and
that
are
also
not
contained
in
the
imported
XML
file.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
279
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
In
the
example,
an
XML
file
is
imported
that
uses
type
definitions
defined
in
the
following
namespaces
(Namespaces):
http://opcfoundation.org/UA/DI/
http://www.euromap.org/euromap83/
http://www.euromap.org/euromap77/
Tip
:
STEP
7
displays
missing
namespaces
in
the
lower
area
of
the
OPC
UA
interface
editor
(&quot;Properties&quot;
tab).
To do
this, select the server interface
in
the project
tree
(here: IMM_Manufacturer_01234)
and select the &quot;Namespaces&quot; area in the inspector window. Missing namespaces are
selected.
If
one
or
more
namespaces
are
missing
in
your
STEP
7
project,
create
a
new
server
interface
of
the
&quot;Reference
namespace&quot;
type
for
each
namespace.
The
&quot;Creating
a
server
interface
for
reference
namespace
(Page
300)&quot;
section
describes
the
procedure.
If
all
reference
namespaces
are
available,
STEP
7
displays
the
table
without
errors:
1799970
127024
Drag
the
OPC
UA
elements
from
the
right
area
of
the
table
(OPC
UA
elements)
to
the
left
part of the table (OPC UA server interface) so that the respective OPC UA elements (the
local
PLC
tags)
are
assigned
to
the
respective
OPC
UA
nodes
of
Euromap
77.
The
figure
below
shows
a
section
from
the
assignment
of
the
local
data
(PLC
tags)
to
the
OPC
UA
nodes
of
the
Euromap
77:
719962
157308
280
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Checking
the
mapping
of
CPU
local
data
on
nodes
of
the
OPC
UA
server
interface
When invalid assignments (mappings) exist in the server interface, they can result in
incorrect
read
and
write
operations.
Check
the
assignments
and
run
a
consistency
check.
NOTICE
Information
on
the
server
interface
The
editor
for
configuring
the
OPC
UA
server
interface
is
structured
as
a
table
and
provides
the
following
information:
Name
The top node (root node) is named &quot;IMM_Manufacturer_01234&quot; in the example. If a client
browses in the address space of the server, this node is the container for all lower-level
nodes. BrowseName and the DisplayName of this node depend on the name you have
assigned
for
the
server
interface.
In this case, for example, this name stands for the injection molding machine as a whole.
It is the name of the instance of the Euromap 77 companion specification that is used
here. According to the companion specification, the instance name should begin with
&quot;IMM&quot;, followed by the name of the manufacturer of the injection molding machine; the
serial number of the machine is added to the end. This allows a unique identification of
the
machine.
The
names
of
all
other
(lower-level)
nodes
are
defined
by
the
specification
(in
the
example
above by Euromap 77). These node names must not be changed. This ensures a uniform
view
of
all
injection
molding
machines,
which
complies
with
the
specification.
Node
type
Type
of
the
OPC
UA
node.
The
type
is
specified
by
the
companion
specification
that
is
used.
In
the
following
cases,
STEP
7
marks
a
node
type
in
the
table
in
color:
No
definition
is
included
for
this
in
the
imported
XML
file
or
The
namespace
in
which
the
type
was
defined
is
not
available
in
STEP
7.
In
this
case,
create
a
server
interface
of
the
&quot;Reference
namespace&quot;
type
for
the
missing
namespace
or
for
each
of
the
missing
namespaces.
The
missing
namespaces
can
be
found
under
&quot;Namespaces&quot;
in
the
properties
of
the
server
interface.
Local
data
STEP
7
displays
the
data
block
which
is
assigned
to
the
OPC
UA
node:
The
CPU
reads
the
value
of
the
OPC
UA
node
from
this
data
block.
If
a
data
block
is
highlighted
in
color
(e.g.
after
a
consistency
check),
the
specified
data
block
is
not
available
in
the
CPU.
In
this
case,
you
have
to
create
the
missing
data
block
in
the
CPU
(of
user
program)
and
supply
it
with
values.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
281
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Data
type
The
SIMATIC
data
type
of
the
PLC
tag
(e.g.
element
of
a
data
block)
in
the
CPU,
from
which the value of an OPC UA node (UAVariable type) is read, or to which a value is
assigned.
Updating
the
interface
You
can
update
the
server
interface
for
companion
specifications.
Example: After importing companion specifications and then importing reference
namespaces
on
which
the
companion
specifications
depend,
the
type
definitions
of
the
reference
namespaces
do
not
take
effect
immediately.
When
you
click
the
&quot;Update
interface&quot;
button,
the
missing
type
definitions
of
the
companion
specifications
are
resolved.
&quot;Update
interface&quot;
button:
1620011
125545
Generate
local
data
You have the option of generating local data for all or for selected nodes of the server
interface
that
are
not
already
assigned
(&quot;mapped&quot;)
to
local
data
of
the
CPU.
The
newly
created
local
data
are
mapped
automatically.
You
trigger
the
automatic
generation
of
local
data
by
clicking
the
&quot;Generate
local
data&quot;
button
(all
nodes
that
are
not
already
mapped)
or
by
selecting
individual
nodes
and
then
clicking
the
&quot;Generate
local
data&quot;
shortcut
menu.
&quot;Generate
local
data&quot;
button:
1620011
124661
Figure
11-40
&quot;Generate
local
data&quot;
button:
You
can
only
generate
nodes
that
can
be
mapped
to
local
data,
which
means
no
objects,
no
folders,
no
methods
or
input/output
arguments
of
methods.
After you have clicked the button or selected the shortcut menu, you must select in the
follow-up
dialog
box
whether
the
local
data
should
be
created
in
a
new
DB
or
in
an
existing
DB.
Consistency
check
You
have
the
option
to
check
the
server
interface.
STEP
7
(TIA
Portal)
checks
whether
the
OPC
UA
node
of
the
server
interface
PLC
tags
(data
blocks)
has
been
assigned
compatible
SIMATIC
data
types.
To
check
the
consistency
of
the
server
interface,
click
on
the
following
icon
in
the
toolbar
of
the
OPC
UA
server
interface
editor:
1620011
128878
Figure
11-41
&quot;Consistency
check&quot;
button
282
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Export
interface
You
have
the
option
of
exporting
the
OPC
UA
server
interface
as
an
XML
file.
This
XML
file
contains
all
data
type
definitions
referenced
by
the
server
interface.
To
export
the
OPC
UA
server
interface,
click
on
the
following
icon
in
the
toolbar
of
the
OPC
UA
server
interface
editor:
1805177
128370
Figure
11-42
&quot;Export
interface&quot;
button
Creating
a
user-defined
server
interface
Introduction
The
description
is
based
on
the
following
example:
A
protective
fence
surrounds
the
production
cell
&quot;Cell_1&quot;.
The
fence
is
equipped
with
the
gate
&quot;Gate_1&quot;.
An
S7-1500
CPU
controls
the
entire
production
cell
and
also
controls
access
through
Gate_1.
A
robot
packs
drugs
into
boxes
in
the
production
cell
and
then
stacks
the
boxes
on
pallets.
Self-driving
vehicles
for
automated
material
transport
move
the
pallets
to
the
central
warehouse,
thereby
passing
through
Gate_1.
The
CPU
publishes
a
server
interface
via
which
the
driverless
transport
systems
arrange
for
Gate_1
to
open.
The
server
interface
contains
the
server
method
&quot;smOpenGate&quot;
for
opening
the
gate
and
the
tag
&quot;Gate_1_State&quot;
which
indicates
the
status
of
the
gate
(open
or
closed).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
283
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Creating
a
user-defined
server
interface
To
create
a
server
interface,
follow
these
steps:
Select
the
CPU
that
you
have
used
and
configured
as
OPC
UA
server.
Click
&quot;OPC
UA
communication
>
Server
interfaces&quot;.
Double-click
&quot;Add
new
server
interface&quot;.
STEP
7
displays
the
following
dialog.
1799970
89807
Figure
11-43
Adding
the
server
interface
Change
the
name
of
the
new
server
interface
so
that
it
is
descriptive
in
your
project.
In
the
example,
change
the
name
&quot;Server-interface_1&quot;
suggested
by
STEP
7
to
&quot;Cell_1&quot;.
Click
&quot;Server
interface&quot;
and
then
&quot;OK&quot;.
Click
on
the
triangle
in
front
of
&quot;Program
blocks&quot;
in
the
area
&quot;OPC
UA
elements&quot;
to
open
the
&quot;Program
blocks&quot;
folder.
STEP
7
displays
the
following
table
for
editing:
719962
151190
Figure
11-44
Editing
the
server
interface
284
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
The
editor
is
divided
into
two
areas.
OPC
UA
server
interface
On
the
left
is
the
root
node
of
the
server
interface
&quot;Cell_1&quot;.
This
interface
is
currently
still
empty:
No
OPC
UA
elements
have
been
added
to
the
server
interface
yet.
OPC
UA
elements
On
the
right
are
the
OPC
UA
elements.
OPC
UA
elements
are
objects
that
have
been
created
so
far
in
the
STEP
7
project
and
have
the
property
&quot;Accessible
from
HMI/OPC
UA&quot;.
You
can
add
the
OPC
UA
elements
to
the
new
server
interface
&quot;Cell_1&quot;.
Drag
the
OPC
UA
elements
into
the
&quot;<Add
new>&quot;
line
of
the
new
server
interface.
NOTE
The
following
applies
in
general:
If
you
store
data
blocks
or
technology
objects
in
the
left
area of the table, STEP 7 (TIA Portal) creates an object in the server interface. The
elements
of
the
data
blocks
are
arranged
as
separate
nodes
below
this.
If
you
store
structures
in
the
left
area
of
the
table,
STEP
7
creates
a
node
for
the
structure
as
a
whole
and
nodes
for
each
element
of
the
structure.
The
same
applies
to
arrays:
Again,
STEP
7
creates
a
node
for
the
array
as
a
whole
and
nodes
for
each
element
of
the
array.
When
you
place
a
method
in
the
left
area
of
the
table,
STEP
7
creates
a
single
node;
the
arguments
of
the
inserted
method
are
displayed
for
information
purposes.
In
the
example,
you
drag
the
&quot;Gate_1_State&quot;
tag
from
the
right
area
to
the
left
area
to
&quot;<Add
new>&quot;.
Then,
drag
the
server
method
into
the
left
area.
This
server
method
is
located
within
the
&quot;smOpenGate_DB
[DB3]&quot;
data
block
in
the
right
area.
STEP
7
(TIA
Portal)
displays
the
dialog
as
follows:
900049
152405
Figure
11-45
Adding
OPC
UA
elements
to
the
server
interface
Communication
Function
Manual,
11/2024,
A5E03735815-AM
285
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Checking
the
mapping
of
CPU
local
data
on
nodes
of
the
OPC
UA
server
interface
When invalid assignments (mappings) exist in the server interface, they can result in
incorrect
read
and
write
operations.
Check
the
assignments
and
run
a
consistency
check.
Since
the
TIA
Portal
only
generates
warnings
and
not
errors
for
invalid
assignments,
you
can
proceed
step-by-step
as
follows:
For example, in the first step, you can modify the program/local data so that the program
runs
without
errors.
The
next
step
is
to
modify
the
OPC
UA
server
interface
and
eliminate
the
inconsistencies.
At
the
points
at
which
the
TIA
Portal
generates
warnings,
the
OPC
UA
server
interface
does
not
function
during
runtime.
The
OPC
UA
server
generates
runtime
errors.
NOTICE
Limiting
the
view
to
OPC
UA
servers
By
selecting
the
OPC
UA
elements,
you
limit
the
view
to
the
OPC
UA
server
and
the
options
of
the
OPC
UA
clients.
In
the
server
interface
of
the
example,
the
&quot;Robot_1&quot;
data
block
is
missing
because
industrial
trucks
do
not
need
access
to
the
server
methods
and
tags
of
the
robot.
In
this
case,
it
is
best
to
disable
the
standard
server
interface
(SIMATIC
namespace)
in
the
OPC
UA properties of the S7-1500 CPU so that the filtered nodes cannot be accessed any other
way.
1625346
128857
Figure
11-46
Disabling
the
standard
server
interface
You
can
also
disable
the
visibility
of
each
configured
OPC
UA
server
interface
in
the
properties
of the server interface and thus prevent that this server interface can be used by clients
during
operation.
To
do
this,
select
the
server
interface
and
right-click
on
the
&quot;Properties&quot;
command.
This
option
lets
you
define
multiple
server
interfaces
centrally,
for
example,
and
enable
and
download
only
the
required
server
interface.
286
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Once
a
server
interface
has
been
defined,
you
can
drag
it
to
another
CPU
in
the
project
tree.
Figure
11-47
Disabling
the
visibility
of
the
server
interface
Information
on
the
server
interface
The
&quot;OPC
UA
Server
Interface&quot;
editor
is
structured
as
a
table
and
provides
the
following
information:
Note
that
not
all
columns
are
displayed
initially.
You
determine
what
is
displayed
by
right-
clicking
on
the
header
line
of
the
table.
When a row is selected, you can display the OPC UA attributes of the node in the Inspector
window
(&quot;OPC
UA
attributes&quot;
area),
such
as
node
ID,
node
class,
node
type,
and
description.
BrowseName
The
language
neutral
name
of
the
user-defined
server
interface
is
at
the
top
(BrowseName).
This
name
can
be
freely
selected.
The
names
(BrowseNames)
of
the
individual
OPC
UA
nodes
that
have
been
added
to
the
server
interface
are
under
the
name
of
the
interface.
You
cannot
change
the
name
of
an
OPC
UA
node
in
this
dialog.
The
names
come
from
the
STEP
7
project.
You
can
delete
an
OPC
UA
node
from
the
table.
This
means
that
it
no
longer
belongs
to
the
server
interface
and
is
no
longer
visible
to
OPC
UA
clients.
DisplayName
Similar
to
BrowseName.
However,
the
name
can
be
translated
and
is
displayed,
if
available,
in
the
corresponding
language.
Node
ID
NodeId
of
the
OPC
UA
node,
e.g.
http://Server-Node_1;
i=1
Communication
Function
Manual,
11/2024,
A5E03735815-AM
287
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Node
type
Type
of
the
OPC
UA
node,
for
example
BOOL,
BYTE,
INT.
These
node
types
were
defined
by
Siemens,
not
by
the
OPC
Foundation.
For
example,
the
OPC Foundation uses the Boolean node type for BOOL. BOOL is directly derived from
Boolean.
The
specified
node
type
cannot
be
changed
in
this
dialog:
If
you
want
to
use
a
different
node
type,
you
must
change
the
type
of
the
respective
PLC
tags
in
the
STEP
7
project.
Data
type
The
SIMATIC
data
type
used
in
the
STEP
7
project
is
specified,
for
example,
Bool,
Byte,
Int.
etc.
Access
level
If
an
OPC
UA
node
is
a
tag
(UAVariable
type),
the
node
can
only
be
readable
(RD)
or
readable
and
writable
(RD/WR).
If
an
OPC
UA
node
is
a
method
(UAMethod
type),
this
node
can
always
be
called.
Local
data
The
SIMATIC
data
type
of
the
data
block
in
the
CPU,
from
which
the
value
of
an
OPC
UA
node
(UAVariable
type)
is
read,
or
to
which
a
value
is
written.
Generate
local
data
You have the option of generating local data for all or for selected nodes of the server
interface
that
are
not
already
assigned
(&quot;mapped&quot;)
to
local
data
of
the
CPU.
The
newly
created
local
data
are
mapped
automatically.
You
trigger
the
automatic
generation
of
local
data
by
clicking
the
&quot;Generate
local
data&quot;
button
(all
nodes
that
are
not
already
mapped)
or
by
selecting
individual
nodes
and
then
clicking
the
&quot;Generate
local
data&quot;
shortcut
menu.
&quot;Generate
local
data&quot;
button:
1620011
124790
Figure
11-48
&quot;Generate
local
data&quot;
button:
You
can
only
generate
nodes
that
can
be
mapped
to
local
data,
which
means
no
objects,
no
folders,
no
methods
or
input/output
arguments
of
methods.
After you have clicked the button or selected the shortcut menu, you must select in the
follow-up
dialog
box
whether
the
local
data
should
be
created
in
a
new
DB
or
in
an
existing
DB.
288
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Consistency
check
You
have
the
option
to
check
the
consistency
of
the
server
interface.
During the consistency check, STEP 7 checks whether the OPC UA nodes of the server
interface
are
each
assigned
to
a
suitable
OPC
UA
element
(identical
data
type)
or
whether
the
used
element
still
exists
in
the
CPU.
To
check
the
consistency
of
the
server
interface,
click
on
the
following
icon
in
the
toolbar
of
the
OPC
UA
server
interface
editor:
1799970
128567
Figure
11-49
&quot;Consistency
check&quot;
button
Export
interface
You
have
the
option
of
exporting
the
OPC
UA
server
interface
as
an
XML
file.
This
XML
file
contains
all
data
type
definitions
referenced
by
the
server
interface.
To
export
the
OPC
UA
server
interface,
click
on
the
following
icon
in
the
toolbar
of
the
OPC
UA
server
interface
editor:
1805177
128401
Figure
11-50
&quot;Export
interface&quot;
button
More
information
You
can
find
information
on
master
copies
for
the
OPC
UA
communication
in
the
section
Master
copies
for
OPC
UA
communication
(Page
385).
See
also
Client
accesses
and
local
accesses
to
the
OPC
UA
server
(Page
230)
Communication
Function
Manual,
11/2024,
A5E03735815-AM
289
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Data
types
for
companion
specifications
Mapping
of
data
types
The
table
below
shows
the
compatible
SIMATIC
data
type
for
each
OPC
UA
data
type.
Assign the data types as shown below (SIMATIC data type - OPC UA data type). Other
assignments are not permitted. STEP 7 does not check the observance of this rule and does
not
prevent
an
incorrect
assignment.
You
are
responsible
for
the
rule-compliant
selection
and
assignment
of
the
data
types.
You
can
also
use
the
listed
data
types,
for
example,
as
elements
of
structures/UDTs
for
input
and output parameters of self-created server methods (UAMethod_InParameters and
UAMethod_OutParameters).
Table
11-3
Mapping
of
data
types
SIMATIC
data
type
OPC
UA
data
type
BOOL
Boolean
SINT
SByte
INT
Int16
DINT
Int32
LINT
Int64
USINT
Byte
UINT
UInt16
UDINT
UInt32
ULINT
UInt64
REAL
Float
LREAL
Double
LDT
DateTime
WSTRING
String
DINT
Enumeration
(Encoding
Int32)
and
all
derived
data
types
User-defined
data
type
required
(UDT,
user-defined
data
type)
The user-defined data type must be cre-
ated with the prefix &quot;Union_&quot;, for example
&quot;Union_MyDatatype&quot;. See example below
the
table.
The
first
element
(Selector)
in
this
UDT
must
have
the
data
type
&quot;UDINT&quot;.
UNION
and
all
derived
data
types
See
LocalizedText
and
ByteString
data
types
(Page
291)
LocalizedText
ByteString
User-defined
data
type
for
UNION
required
The
figure
below
shows
the
tag
&quot;MyVariable&quot;,
which
has
the
&quot;Union_MyDatatype&quot;
data
type.
This
SIMATIC
data
type
corresponds
to
an
OPC
UA
tag
with
the
data
type
UNION.
290
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
The
figure
shows
an
example
of
the
declaration:
When
Selector
=
1,
Union
takes
a
ByteArray;
when
Selector
=
2,
Union
takes
a
WString.
1799970
131843
LocalizedText
and
ByteString
data
types
As
of
TIA
Portal
version
V17
and
S7-1500
CPU
firmware
version
V2.9,
the
two
OPC
UA
Built-in
data types &quot;LocalizedText&quot; and &quot;ByteString&quot; are available for mapping to corresponding
SIMATIC
data
structures.
For
the
definition
of
these
OPC
UA
data
types,
see
also
OPC
10000-3
DataType
definitions.
These
data
types
are
used
in
companion
specifications,
for
example,
and
can
be
easily
handled
by
the
user
program
with
the
OPC
UA
interface
editor.
LocalizedText
A
structure
containing
a
string
with
locale
identifier
(e.g.
&apos;en-US&apos;).
The
structure
has
three
elements
with
a
defined
order
and
the
following
structure
in
SIMATIC:
Encoding
(data type OPC_UA_LocalizedTextEncodingMask):
Indicates in bit 0 whether the
&quot;Locale&quot; field has a content and in bit 1 whether the &quot;Text&quot; field has a content. Both fields
should
have
a
content.
We
therefore
recommend
setting
the
&quot;Encoding&quot;
value
for
SIMATIC
to
2#00000011.
Local
(WString
data
type):
Locale,
for
example,
&apos;en-US&apos;.
Text
(WString
data
type):
Text
box,
for
example,
&apos;Text&apos;.
ByteString
A
sequence
of
octets.
The
structure
is
built
up
as
follows:
ActualLength
(data
type
&quot;OPC_UA_ByteStringActualLength&quot;):
Length
of
the
ByteString
array
that
is
filled
ByteString
(&quot;Array
of
Byte&quot;
data
type):
Byte
array
Requirement
An
OPC
UA
server
interface
has
been
created.
Application
You
can
import
a
companion
specification
or
a
reference
namespace
that
contains
definitions
of
the
&quot;LocalizedText&quot;
or
&quot;ByteString&quot;
type.
Likewise, you can create a server interface and define an address model yourself with the
data
types
&quot;LocalizedText&quot;
or
&quot;ByteString&quot;.
The
procedure
is
described
in
the
next
section.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
291
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Procedure
292
You will learn how to create a node of the type &quot;LocalizedText&quot; or &quot;ByteString&quot; with the
interface
editor
and
then
have
a
SIMATIC
data
structure
created
automatically
for
this
node
in
the
paragraphs
below.
To
define
OPC
UA
nodes
of
the
type
&quot;Localized
Text&quot;/&quot;ByteString&quot;
in
a
server
interface,
follow
these
steps:
Create
nodes
of
the
type
&quot;LocalizedText&quot;
or
&quot;ByteString&quot;
in
the
&quot;OPC
UA
server
interface&quot;
area.
These
node
types
are
included
in
the
list
of
selectable
node
types.
1799970
130033
Select the &quot;Generate local data&quot; command from the shortcut menu. To generate the local
data,
select
a
data
block,
for
example,
a
new
DB
with
the
name
&quot;MyServerInterface_Data&quot;.
1799970
129014
Result
:
STEP
7
generates
the
corresponding
structure
for
the
mapping
in
which
you
still
need to adjust the required text length (Text) and the required locale (Locale) for
&quot;LocalizedText&quot;.
The
same
is
true
for
&quot;ByteString&quot;;
in
this
case,
you
must
adjust
the
length
and
the
array.
The
consistency
check
generates
a
warning
to
indicate
the
required
adjustments.
1799970
91617
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Rules
You
can
also
create
UDTs
with
the
structure
as
shown
above
for
the
node
types
&quot;LocalizedText&quot;
or
&quot;ByteString&quot;
and
use
them
for
DB
elements.
You
can
use
the
node
types
&quot;LocalizedText&quot;
or
&quot;ByteString&quot;
in
other
structures
(nests).
The
SIMATIC
structures
for
&quot;LocalizedText&quot;
or
&quot;ByteString&quot;
may
only
be
used
completely;
an
isolated data type, such as &quot;OPC_UA_LocalizedTextEncodingMask&quot; for other purposes, is
not
provided.
Input
and
output
parameters
of
methods
can
also
be
of
the
data
type/node
type
&quot;LocalizedText&quot;
or
&quot;ByteString&quot;.
Using
additional
OPC
UA
data
types
for
companion
specifications
Apart from the OPC UA data types listed in the section &quot;Mapping of data types&quot; and their
correspondences
on
the
SIMATIC
side,
there
are
the
following
OPC
UA
basic
data
types
which
you
can
also
use:
OpcUa_NodeId
OpcUa_QualifiedName
OpcUa_Guid
OpcUa_XmlElement
(Page
291)
OpcUa_ByteString
(Page
291)
OpcUa_LocalizedText
Requirement for the use of the basic data types listed above as variables in the application
program:
The
basic
data
types
have
to
exist
as
complex
data
types
that
are
structured
exactly
like
the
corresponding
OPC
UA
basic
data
types.
OpcUa_NodeId
and
OpcUa_QualifiedName
exist
as
system
data
types;
that&apos;s
why
you
can
use
these
data
types
not
only
for
single
variables
but
also
as
elements
of
a
structure.
For
the
basic
data
types
or
built-in
data
types
GUID
and
XmlElement
you
have
to
create
a
PLC
data
type
in
accordance
with
the
OPC
UA
specification
and
subsequently
use
it
as
an
element
in
a
structure
so
that
the
data
types
of
the
elements
can
be
resolved.
What
each
PLC
data
type
must
look
like
is
described
below
for
every
single
basic
data
type.
For
OpcUa_ByteString
and
OpcUa_LocalizedText,
the
requirements
have
been
created
in
TIA Portal V17 to simply use these data types in the server interface of the &quot;Companion
Specification&quot;
type:
You
create
the
corresponding
node
type
in
the
server
interface
(for
example,
OpcUa_LocalizedText)
You
click
on
&quot;Generate
local
data&quot;
STEP
7
then
automatically
generates
the
appropriate
data
structures
in
a
DB.
For
OpcUa_Guid,
these
requirements
have
been
met
in
TIA
Portal
V19.
Proceed
as
described
in
the
previous
section.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
293
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
System
data
type
&quot;OPC_UA_NodeId&quot;
For
the
OPC
UA
basic
data
type
&quot;OpcUa_NodeId&quot;,
please
refer
to
the
following
table
for
the
meaning
of
the
parameters.
Use
OPC_UA_NodeId
for
the
identification
of
a
node
in
the
OPC
UA
server.
Parameter
S7
data
type
Meaning
NamespaceIndex
UINT
Namespace
index
of
the
node
in
the
OPC
UA
server.
A
node
can,
for
example,
be
a
tag.
Identifier
WSTRING[254]
The
designation
of
the
node
(object
or
tag)
depends
on
the
identifier
type:
Numeric
identifier:
The
node
is
labeled
with
a
num-
ber,
for
example
&quot;12345678&quot;.
String identifier: The node is labeled with a name,
for example &quot;MyTag&quot;. No distinction is made
between
upper
and
lower
case.
IdentifierType
UDINT
Type
of
identifier
0:
Numeric identifier
1:
String
identifier
2:
GUID
3:
Opaque
System
data
type
&quot;OPC_UA_QualifiedName&quot;
See
the
following
table
for
the
structure
of
the
system
data
type
&quot;OPC_UA_QualifiedName&quot;:
Name
S7
data
type
Meaning
NamespaceIndex
UINT
The
namespace
index
of
the
name.
Name
WSTRING[64]
Name
of
the
node
or
tag.
System
data
type
&quot;GUID&quot;
The
&quot;Guid&quot;
data
type
is
available
as
a
node
type
as
of
TIA
Portal
V19.
For
the
definition
of
this
OPC
UA
data
type,
see
also
OPC
10000-6
mappings.
The
figure
shows
the
assignment
of
the
&quot;Guid&quot;
data
type
for
a
tag
node
in
a
server
interface.
The
next
figure
shows
the
data
block
with
the
GUID
elements
that
is
created
automatically
with
&quot;General
local
data&quot;.
540004
155001
Figure
11-51
GUID
node
in
the
server
interface
294
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
The
next
figure
shows
the
data
block
with
the
GUID
elements
that
is
created
automatically
with
&quot;General
local
data&quot;.
1799970
129684
Figure
11-52
Data
block
with
SDT
GUID
UDT
for
basic
data
type
XmlElement
An
XmlElement
is
a
serialized
XML
fragment
(UTF-8
string).
For
the
basic
data
type
&quot;XmlElement&quot;,
create
the
following
PLC
data
type:
1813814
125011
Dynamic
arrays
Useful
information
on
dynamic
arrays
As
of
TIA
Portal
V19
and
S7-1500
CPU
FW
version
V3.1,
you
can
use
so-called
&quot;dynamic
arrays&quot;
for
your
OPC
UA
server
and
OPC
UA
client
interfaces.
The
following
description
explains the principle and functionality of the server interface. The structure of the
structure/UDT
for
a
dynamic
array
is
identical
for
client
and
server
applications.
With
dynamic
arrays,
it
is
possible
to
define
data
structures
whose
number
of
elements
can
be changed at runtime on the server interface side. On the CPU side, the dynamic array is
mapped
to
a
fixed-size
structure.
Example
: Process data from production for quality assurance purposes is transferred to a
higher-level management system. The number of process data elements is different,
depending
on
the
product
type.
If
the
product
type
is
changed
during
runtime,
the
number
of
process
data
elements
needed
also
changes.
In
STEP
7
(TIA
Portal),
an
array
is
a
data
type
that
you
can
assign
to
a
tag.
An
array
represents
a data structure that consists of a fixed number of components of the same data type. All
data
types
except
ARRAY
are
permitted
for
the
components.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
295
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
By
contrast,
OPC
UA
does
not
define
an
array
as
a
data
type.
Any
variable
value
(Value)
can
be
an
array.
The
following
attributes
and
properties
of
Variable
NodeClass
are
used
in
OPC
UA
to
define how a variable is structured with respect to its &quot;geometry&quot; as an array (except from
https://reference.opcfoundation.org/Core/Part3/v104/docs/5.6):
Attribute
/
Property
Data
type
Possible
values,
meaning
ValueRank
(Mandatory)
Int32
n
>
1:
Value
is
an
array
with
dimension
n.
1:
Value
is
an
array
with
one
dimension
0:
Value
is
an
array
with
one
or
more
dimen-
sions
-1:
Value
is
a
scalar
(not
an
array)
-2:
Value
is
a
scalar
or
an
array
with
any
num-
ber
of
dimensions
-3:
Value
can
be
a
scalar
or
a
one-dimension-
al
array
ArrayDimensions
(Optional)
UInt32[]
Maximum
supported
length
of
each
dimension.
0
or
empty:
Unknown
length.
MaxArrayLength
(Optional)
UInt32
For
DataVariables
with
ValueRank
attribute
not
set
to
scalar:
Maximum
length
of
the
array.
Example: A three-dimensional array with lengths
2x3x10
has
the
length
60.
The name &quot;dynamic array&quot; is used here to establish a counterpart on the SIMATIC data type
end
for
the
dynamics
of
the
variable
geometry
defined
in
OPC
UA,
so
that
mapping
of
array
data
is
possible.
You
can
change
the
geometry
of
a
mapped
array
during
runtime
using
your
STEP 7 program. On the OPC UA end, you define a node in the OPC UA server interface via
which
a
client
can
access
the
mapped
CPU
data
(the
dynamic
array).
Principle
In
order
for
OPC
UA
variables
to
be
mapped
to
CPU
tags
of
Array
type,
you
use
a
structure
or
UDT
with
the
new
system
data
type
&quot;OPC_UA_ArrayBoundaries&quot;.
The
structure
or
UDT
has
the
following
structure
elements
and
is
structured
as
follows:
The
first
structure
element
(array
size)
is
itself
an
array
and
defines
the
current
size
of
the
dynamic
array.
The
system
data
type
&quot;OPC_UA_ArrayBoundaries&quot;
defines
the
index
range
available in the server interface for each dimension (with lower and higher boundary
elements
in
each
case).
The second structure element (array data) contains all array elements with a selectable
data
type
permitted
for
OPC
UA.
STEP
7
(TIA
Portal)
automatically
ensures
that,
for
example,
negative
indexes
on
the
SIMATIC
end are converted to non-negative indexes (starting at &quot;0&quot;) on the OPC UA end (server
interface).
296
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Example
of
one-dimensional
array
The
following
example
shows
the
structure
for
a
simple,
one-dimensional
array
with
a
maximum of
10 elements.
The current
size
of
the
array is set
to 3 elements
[0..2].
Name
Data
type
Possible
values
/
Description
1-Dim-Struct
Struct
(UDT)
-
ArraySizeAct
Array [0..0] of
OPC_UA_ArrayBoundaries
Current
array
size
-
-
ArraySizeAct[0]
OPC_UA_Boundaries
One
dimension
-
-
-
Lower
DInt
0
(lower
index)
-
-
-
Upper
DInt
2 (possible upper index values:
0..9)
-
MyDataArray
Array[
0
..9]
of
Byte
Array
data (all array
ele-
ments)
-
-
MyDataArray[0]
Byte
First
element
...
...
...
-
-
MyDataArray[9]
Byte
Last
element
Example
of
two-dimensional
array
The following example shows the structure for a two-dimensional array with 10x6 = 60
elements.
The
lower
indexes
of
both
dimensions
are
not
&quot;0&quot;
in
this
case.
The
current
size
of
the
array
is
set
to
2x6
=
12
elements.
Name
Data
type
Possible
values
/
Description
2-Dim-Struct
Struct
(UDT)
-
ArraySizeAct
Array [0..1] of
OPC_UA_ArrayBoundaries
Current
array
size
-
-
ArraySizeAct[0]
OPC_UA_Boundaries
First
dimension
-
-
-
Lower
DInt
-9
(lower
index)
-
-
-
Upper
DInt
-8
(possible
upper
index
val-
ues:
-9..0)
-
-
ArraySizeAct[1]
OPC_UA_Boundaries
Second
dimension
-
-
-
Lower
DInt
5
(lower
index)
-
-
-
Upper
DInt
10
(possible
upper
index
val-
ues:
5..10)
-
MyDataArray
Array[-
9
..0,
5
..10]
of
Byte
Array
data (all array
ele-
ments)
-
-
MyDataArray[-9,5]
Byte
First
element
-
-
MyDataArray[-9,6]
Byte
Second
element
...
...
...
-
-
MyDataArray[0,9]
Byte
Second
to
last
element
-
-
MyDataArray[0,10]
Byte
Last
element
Communication
Function
Manual,
11/2024,
A5E03735815-AM
297
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Effects
on
the
server
interface
Appearance
in
the
server
interface:
If
you
drag
a
dynamic
array
(e.g.
2-Dim-Struct)
and
drop
it
onto the server interface in the editor for the server interface, STEP 7 (TIA Portal) creates a
node of the same name without the subelements. The node indicates type &quot;ARRAY&quot; in the
&quot;Node
type&quot;
column
with
the
maximum
possible
lengths
of
the
array.
Browse:
The
dynamic
array
is
available
as
a
node
in
the
OPC
UA
address
space.
Unlike
for
static
arrays,
the
subelements
of
the
array
are
not
visible
as
child
nodes.
Read:
The
dynamic
array
can
be
read
with
the
Read
service.
The
client
can
specify
whether
it
wants to read the entire array or only parts of it (IndexRange). Only the read parts that lie
within the boundaries of the current array range return the status &quot;Good&quot;. If the array size is
&quot;0&quot;
in
every
dimension,
an
empty
array
is
returned
with
status
&quot;Good&quot;.
If
an
array
of
size
&quot;0&quot;
is
read
in
a
dimension,
then
an
empty
array
with
status
&quot;Good&quot;
is
returned.
Write: If the range to be written is less than or equal to the maximum array size, all elements
are written (status &quot;Good&quot;). If the range to be written is greater than the maximum array size,
nothing is written and status 8074_0000 is returned (OpcUa_BadTypeMismatch). If part of an
array is written (IndexRange), the behavior is exactly the same: All dimensions of the array
range to be written must lie completely within the maximum array size. Only then is the data
written
and
the
status
&quot;Good&quot;
returned.
If
an
array
of
size
&quot;0&quot;
is
written
in
at
least
one
dimension,
then
this
value
is
set
correctly
in
the
CPU data. The elements &quot;Lower&quot; and &quot;Upper&quot; in the corresponding
OPC_UA_ArrayBoundaries
structure
are
adjusted
accordingly
(&quot;Upper&quot;
=
&quot;Lower-1&quot;).
Rules
and
specific
features
You
can
also
use
dynamic
arrays
for
input
parameters
and
output
parameters
in
methods.
Avoid
inconsistencies
caused
by
changing
the
current
size
of
the
array
while
a
client
is
accessing
the
array.
The
result
of
the
access
is
undefined
in
this
case.
Use
the
uninterruptible
instruction
UMOVE_BLK
for
changing
the
current
array
size.
In contrast to the SIMATIC data type Array, there can be &quot;empty&quot; arrays in OPC UA. You
define an array with 0 elements in one dimension with OPC_UA_ArrayBoundaries by
setting
the
highest
index
value
(Upper)
less
than
the
lowest
index
value
(Lower),
e.g.
with
the
following
values:
Upper
=
Lower-1.
If you define a multidimensional array in the server interface (or client interface) and at
least
one
dimension
is
&quot;0&quot;
(empty),
then
by
definition
it
is
an
empty
array
(all
dimensions
are
0).
The
values
for
the
current
array
size
and
the
values
for
the
array
data
must
be
consistent.
Otherwise,
error
code
803A_0000
(OpcUa_BadNotReadable)
is
output.
The
values
you
set
for
&quot;Lower&quot;
for
the
current
array
size
in
a
dimension
must
also
be
set
as
the
lower
index
value
in
the
range
of
the
array
data
in
the
corresponding
dimension.
The
values
you
have
set
for
&quot;Upper&quot;
for
the
current
array
size
for
a
dimension
must
also
lie
within
the
range
of
the
array
data
for
this
dimension.
If an OPC UA client writes a dynamic array in the server, the client must write an array with
the same dimension (ValueRank). Otherwise, the status 8074_0000 is returned
(OpcUa_BadTypeMismatch).
298
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Rules
for
OPC
UA
XML
files
Importing
exported
OPC
UA
XML
files
to
an
S7-1500
CPU
Please
note
the
following
information
when
importing
server
interfaces
that
come
from
the
OPC
UA
XML
export
of
an
S7-1500.
NOTE
Import
blocked
for
namespace
&quot;http://www.siemens.com/simatic-s7-opcua&quot;
You cannot import server interfaces with the namespace
&quot;http://
www.siemens.com/simatic-
s7-opcua&quot;
to
an
S7-1500
CPU
because
this
namespace
is
reserved
for
S7-1500
CPUs
(standard
SIMATIC
server
interface)
and
is
not
available
for
imports.
If you want to import a server interface with the namespace
&quot;http://www.siemens.com/simatic-s7-opcua&quot;,
open
the
server
interface
to
be
imported
(OPC
UA XML file) and change the namespace in the relevant places. The file thus changed can
then
be
imported.
Integrity
of
the
OPC
UA
XML
files
WARNING
OPC
UA
XML
files
represent
the
server
address
space.
These
files
are,
for
example,
imported
by you in the context of OPC UA Companion specifications as a server interface after
adaptation
to
the
application,
loaded
into
the
S7-1500
CPU
and
tested.
No
checking
of
imported
OPC
UA
XML
files
Protect
these
OPC
UA
XML
files
against
unauthorized
manipulation
since
STEP
7
does
not
check
the
integrity
of
these
files.
Recommendation
To
minimize
risks
in
the
case
of
an
extension
or
adaptation
of
the
server
address
space,
follow
these
steps:
Protect
the
project
(project
navigation:
Security
settings
>
Settings).
Export
the
corresponding
server
interface
before
the
extension
or
adaptation.
Revise
this
OPC
UA
XML
file.
Import
the
file
again
as
a
server
interface.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
299
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Creating
a
server
interface
for
reference
namespace
Companion
specifications
and
referenced
namespaces
A
series
of
OPC
UA
object
types
(as
well
as
additional
definitions)
are
defined
in
a
companion
specification. These object types are each defined in namespaces so that the names of the
object
types
(type
definitions)
are
unique.
To
use
a
companion
specification
in
your
project,
create
instances
of
object
types
of
this
companion
specification.
To do this the object definitions must be available in your STEP 7 project. If this is not the
case,
you
must
import
the
object
definitions.
To
import
all
definitions
of
a
namespace,
create
a
server
interface
of
type
&quot;Reference
namespace&quot;
for
each
namespace
in
STEP
7.
NOTE
EUROMAP
and
the
OPC
Foundation
have
established
the
Joint
Working
Group
&quot;OPC
UA
Plastics
and
Rubber
Machinery&quot;.
The existing EUROMAP recommendations EUROMAP 77 (data exchange between injection
moulding
machines
and
MES),
82.1
(temperature
control
devices)
und
83
(general
definitions)
were
published
under
the
neutral
umbrella
of
the
OPC
Foundation
as
OPC
40077,
40082-1 and 40083. However, the examples listed below use the previously valid
designations
and
references.
Example
Euromap
77
(currently
OPC
40077)
You
have
added
a
server
interface
for
the
companion
specification
Euromap
77
(currently
OPC
40077).
The
server
interface
uses
object
types
defined
in
OPC
UA
DI
as
well
as
in
Euromap
83
and
Euromap
77
in
their
corresponding
namespaces.
Therefore,
in
addition
to
the
server
interface
Euromap
77
of
the
&quot;Companion
Specification&quot;
type, create additional server interfaces of &quot;Reference namespace&quot; type in STEP 7, in each
case
for
the
following
namespaces:
http://opcfoundation.org/UA/DI/
http://www.euromap.org/euromap83/
http://www.euromap.org/euromap77/
The
following
description
shows
you
how
to
proceed.
300
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Creating
a
server
interface
for
a
reference
namespace
To
create
a
server
interface
for
a
namespace,
proceed
as
follows:
Select
the
CPU
that
you
want
to
use
as
an
OPC
UA
server.
Click
&quot;OPC
UA
communication
>
Server
interfaces&quot;.
Double-click
&quot;Add
new
server
interface&quot;.
STEP
7
(TIA)
now
displays
the
dialog
&quot;Add
new
server
interface&quot;.
A
general
name
for
the
new
server
interface
is
entered
in
the
dialog,
for
example
&quot;Server_Interface_1&quot;.
Assign
a
descriptive
name
for
the
new
server
interface.
In
the
example,
select
the
name
&quot;OPC.Ua.Di&quot;
or
a
similar
name
that
clearly
references
the
namespace
&quot;http://opcfoundation.org/UA/DI/&quot;.
This
namespace
must
be
imported
first.
It
contains
basic
definitions
(for
example,
the
UAObjectType
&quot;DeviceType&quot;).
Click
the
&quot;Companion
specification&quot;
button
and
select
the
&quot;Reference
namespace&quot;
type.
Click
the
three
dots
next
to
the
&quot;Import
XML
file&quot;
field.
Select
an
XML
file
that
contains
the
definitions
of
the
namespace
&quot;http://opcfoundation.org/UA/DI/&quot;.
Select the file &quot;Opc.Ua.Di.NodeSet2.xml&quot; in the example. You can download this file here:
Opc.Ua.Di.NodeSet2.xml
(
https://opcfoundation.org/UA/schemas/DI/
)
Note
: If the file cannot be imported, this may be because the OPC UA (&quot;CORE&quot;) model
version
available
in
TIA
Portal
does
not
match
the
OPC
UA
for
Devices
(&quot;DI&quot;)
model
version.
In
this
case,
select
a
different
version
of
the
DI
model
(for
example
a
previous
version).
The
figure
below
shows
the
dialog
with
the
entries:
900049
150740
Figure
11-53
Adding
a
reference
namespace
Click &quot;OK&quot;.
STEP
7
(TIA) now
generates the new
server interface.
You
can
find
the
server
interface
in
the
project
tree
of
STEP
7
(TIA
Portal)
under
&quot;OPC
UA
Communication
>
Server
interfaces
>
Reference
namespace&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
301
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
If
a
companion
specification
uses
additional
namespaces,
add
a
new
server
interface
for
each
namespace.
Add
additional
server
interfaces
for
Euromap77
For
Euromap
77,
you
still
need
the
following
namespaces:
http://www.euromap.org/euromap83/
http://www.euromap.org/euromap77/
First,
add
a
server
interface
for
the
namespace
&quot;http://
www.euromap.org/euromap83/&quot;.
This namespace contains basic definitions for Euromap 77, therefore it is required here first.
All definitions of this namespace are included in the XML file
&quot;Opc_Ua.EUROMAP83NodeSet2.xml&quot;,
which
you
can
download
from
the
Euromap
website
(
https://www.euromap.org/en/euromap83
).
Then add a server interface for the namespace
&quot;http://www.euromap.org/euromap77&quot;.
All
definitions of this namespace are included in the XML file
&quot;Opc_Ua.EUROMAP77.NodeSet2.xml&quot;,
which
you
can
also
download
from
the
Euromap
web-
site
(
https://www.euromap.org/en/euromap77
).
302
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Generating
OPC
UA
nodes
based
on
local
data
mappings
of
FB
types
and
UDTs
If
you
want
to
make
instance
data
from
FBs
or
UDTs
of
the
CPU
accessible
to
OPC
UA
clients
you can, as of TIA Portal version V17, have these instance data assignments automatically
made.
You only have to map the FB types or the UDTs to suitable OPC UA data types of imported
reference
namespaces.
Based
on
these
mappings
created
in
STEP
7
(TIA
Portal),
generate
the
required
nodes
in
the
server
interface
for
each
FB
instance
or
for
each
UDT
usage
during
the
compile.
If
you
extend
your
program
and
add
more
FB
instances
or
UDT
usages,
or
if
you
add
existing
instances delete, you do not need to worry about adapting the server interface: STEP 7
automatically
adjusts
the
server
interface
when
compiling
the
program.
Example
You
create
a
function
block
(FB)
in
the
user
program
of
the
CPU
and
define
in
the
&quot;Static&quot;
area of the interface of the FB the parameters that form the &quot;memory&quot; of the FB. The
instances
(values)
of
this
parameter
are
to
be
accessible
for
OPC
UA
clients.
You create an OPC UA data type (e.g. with SiOME) with elements that correspond to the
data type the parameters in the static area of interface of the FB. The order of the
elements does not matter. Then import the reference node set file (reference namespace)
as
a
reference
name
space.
The
following
figure
shows
the
assignment
of
elements
as
comparison
of
the
reference
namespace
view
(server
interface)
and
the
OPC
UA
elements
view
(program).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
303
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Mapping
of
data
types
(FB
interface
-
OPC
UA
interface):
Principle
The following figure shows the assignment of the elements from the user program of the
CPU
to
the
elements
of
the
OPC
UA
server
interface.
The
order
of
the
elements
does
not
have
to
match.
1683441
189695
Automatic
generation
of
the
OPC
UA
server
instances
in
the
server
interface:
Principle
The
figure
below
shows
the
compilation
of
the
project.
The
instances
of
the
user
program
are
also
generated
in
the
server
interface.
545973
166975
By mapping between FB type information / UDT type information and OPC UA type
information,
STEP
7
is
able
to
create
all
instances
present
in
the
program
as
nodes
in
the
server
interface.
1727387
219929
304
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Rules
Only
the
FB
elements
in
the
&quot;Static&quot;
area
of
an
FB
interface
can
be
mapped
to
OPC
UA
type
descriptions.
When
mapping
the
data
types,
OPC
UA
elements
from
the
same
FB
interface
or
from
the
same
UDT
must
always
be
selected
for
an
object.
Mapping
from
different
FBs
or
UDTs
to
an
object
is
not
permitted.
Requirement
The
FB
types
used,
defined
in
the
&quot;Static&quot;
area
of
an
FB,
must
be
configured
as
&quot;Accessible
for
OPC
UA&quot;.
The
UDTs
used
must
be
configured
as
&quot;Accessible
for
OPC
UA&quot;.
A
nodeset
file
(XML
file)
is
available
with
OPC
UA
data
type
definitions
that
match
the
FB
types
or
UDTs
defined
in
user
program
(can
be
mapped).
Use
the
&quot;SiOME&quot;
tool
to
create
your
node
set
file
(Siemens
Industry
Online
Support).
The
user
program
with
the
FB
instances
and
UDT
usages
is
available.
Procedure
To
map
a
data
type
from
a
reference
namespace
to
an
FB
type
or
UDT
data
type,
follow
these
steps:
Select
the
CPU
that
you
want
to
use
as
an
OPC
UA
server.
Import
the
prepared
node
set
file
(XML
file)
with
the
type
definitions
as
a
reference
namespace.
–
In
the
&quot;Add
new
server
interface&quot;
dialog,
enable
the
option
&quot;Generate
OPC
UA
nodes
based
on
the
local
data
mapping&quot;.
Only
when
this
option
is
enabled
can
you
map
FB
types
or
UDTs
by
dragging
them
to
the
OPC
UA
type
descriptions.
Double-click
the
icon
for
the
server
interface
of
the
&quot;Reference
namespace&quot;
type
that
you
just
generated.
The editor for mapping between OPC UA server interface and OPC UA elements opens. In
the
properties
area
of
the
editor,
in
the
&quot;Mapping
of
local
data&quot;
area,
the
option
&quot;Generate
OPC
UA
nodes
based
on
the
local
data
mapping&quot;
is
enabled.
If
not,
enable
the
option
now.
In the &quot;Interface name&quot; field, adapt the name of the server interface to be created. A new
server
interface
of
the
&quot;Companion
specification&quot;
type
with
this
name
is
created
during
the
compile.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
305
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Assign the existing FB types or UDTs to the nodes of the server interface (reference
namespace) by dragging the OPC UA element (right side of the editor) to the
corresponding
node
of
the
server
interface
(reference
namespace,
&quot;Local
data&quot;
column).
719962
155329
Compile
the
project.
After compilation, the newly generated nodes of the instances are located in the
generated
server
interface
of
the
&quot;Companion
specification&quot;
type.
STEP
7
creates
an
object
for
each
instance
DB.
The
generated
elements
are
located
under
each
of
these
objects.
Similarly,
STEP
7
also
creates
an
object
for
each
global
DB
that
is
created
when
a
UDT
is
instantiated.
The generated companion specification interface cannot be changed (no longer possible:
generating local data, importing companion specification). This measure provides
protection
against
data
loss
in
the
event
that
the
server
interface
was
manually
added
and
is then overwritten by a recompilation. Only the name of the generated companion
specification
interface
can
be
modified.
Furthermore,
group
folders
that
you
have
created
to
structure
your
data
in
the
project
tree
of your TIA project are applied as &quot;Folder&quot; (node type) in the generated companion
specification
interface.
Create
user
program
with
FB
types
or
UDT
How to create FBs and UDTs is not explained in detail here; for this purpose use the
description
for
creating
a
user
program,
e.g.
declare
block
interface
and
declare
PLC
data
types
(UDT).
Consistency
check
The
consistency
check
(&quot;Consistency
check&quot;
button
of
the
editor)
also
checks
the
mapping
of
the
data
types
and
updates
the
display
of
the
data
types
in
the
corresponding
column
of
the
editor.
306
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Notes
on
configuration
limits
when
using
server
interfaces
When
you
use
OPC
UA
server
interfaces,
you
must
comply
with
limits
for
the
following
objects
in
line
with
the
S7-1500
CPU
performance
class:
Number
of
server
interfaces
Number
of
OPC
UA
nodes
Load
object
data
volume
If
you
have
implemented
methods:
Number
of
server
methods
or
server
method
instances
Configuration
limits
for
OPC
UA
server
interfaces
and
methods
The
configuration
limits
of
the
OPC
UA
server
interfaces
and
the
methods
can
be
found
in
the
technical specifications of the Equipment Manuals for the respective CPUs. Up-to-date
technical
specifications
of
the
CPUs
can
be
found
on
the
Internet
(
https://support.industry.siemens.com/cs/ww/en/ps/td
).
A
violation
of
configuration
limits
results
in
an
error
message.
Providing
methods
on
the
OPC
UA
server
Useful
information
about
server
methods
Providing
user
program
for
server
methods
On the OPC UA server of an S7-1500 CPU (as of firmware V2.5), you have the option of
providing
methods
via
your
user
program.
These
methods
can
be
used
by
OPC
UA
clients,
for
example
to
start
a
manufacturing
job
using
the
method
call
of
the
S7-1500
CPU.
OPC
UA
methods,
an
implementation
of
&quot;Remote
Procedure
Calls&quot;,
provide
an
efficient
mechanism for interactions between different communication nodes. The mechanism
provides
both
job
confirmation
and
feedback
values
so
you
no
longer
have
to
program
handshaking
mechanisms.
Using
OPC
UA
methods,
you
can
transfer
data
consistently
without
trigger
bits/handshaking,
for
example,
or
trigger
specific
actions
on
the
controller.
How
does
an
OPC
UA
method
work?
An
OPC
UA
method
in
principle
operates
like
a
know-how
protected
function
block
that
is
called
by
an
external
OPC
UA
client
in
runtime.
The OPC UA client only &quot;sees&quot; the defined inputs and outputs. The content of the function
block,
the
method
or
algorithm,
remains
hidden
to
the
external
OPC
UA
client.
The
OPC
UA
client receives feedback on successful execution and values returned by the function block
(method),
or
an
error
message
if
execution
has
not
been
successful.
As
the
programmer,
you
have
full
control
over
and
responsibility
for
the
program
context
in
which
the
OPC
UA
method
runs.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
307
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Rules
for
programming
a
method
and
runtime
behavior
Make
sure
that
the
values
returned
by
the
OPC
UA
method
are
consistent
with
the
input
values
provided
by
the
OPC
UA
client.
Follow
the
rules
on
assigning
name
and
the
structure
of
parameters,
and
the
permitted
data
types
(see
description
of
the
OPC
UA
server
instructions).
Behavior during runtime: The OPC UA server accepts
one
call per instance. The method
instance
is
not
available
for
other
OPC
UA
clients
until
the
call
has
been
processed
by
the
user
program
or
has
timed
out.
The
basic
procedure
for
implementing
a
user
program
as
a
server
method
is
set
out
below.
Implementing
a
server
method
A
program
(function
block)
for
implementing
a
server
method
is
structured
as
follows:
Querying
the
server
method
call
with
OPC_UA_ServerMethodPre
You
first
call
the
&quot;OPC_UA_ServerMethodPre&quot;
instruction
in
your
user
program
(i.e.
in
your
server
method).
This
instruction
has
the
following
tasks:
With
this
instruction
you
ask
the
OPC
UA
server
of
the
CPU
whether
your
server
method
was
called
from
an
OPC
UA
client.
If
the
method
was
called
and
the
server
method
has
input
parameters,
your
server
method
now
receives
the
input
parameters.
The
input
parameters
of
the
server
method
come
from
the
calling
OPC
UA
client.
Editing
the
server
method
In
this
section
of
the
server
method,
you
provide
the
actual
user
program.
You
have
the
same
options
as
in
any
other
user
program
(for
example,
access
to
other
function
blocks
or
global
data
blocks).
If
the
server
method
uses
input
parameters,
these
parameters
are
available
to
you.
This
section
of
the
server
method
should
only
be
executed
if
an
OPC
UA
client
has
called
the
server
method.
After
successful
execution
of
the
method,
you
set
the
output
parameters
of
the
server
method
if
the
method
has
output
parameters.
Responding
to
server
method
with
OPC_UA_ServerMethodPost
To
complete
the
server
method,
call
the
&quot;OPC_UA_ServerMethodPost&quot;
instruction.
Use
the
parameters
to
notify
the
&quot;OPC_UA_ServerMethodPost&quot;
instruction
whether
or
not
the
user
program
has
been
processed.
If
the
user
program
has
been
successfully
executed,
the
OPC
UA
server
is
notified
via
the
relevant
parameters.
The
OPC
UA
server
then
sends
the
output
parameters
of
the
server
method
to
the
OPC
UA
client.
Always call the instructions &quot;OPC_UA_ServerMethodPre&quot; and &quot;OPC_UA_ServerMethodPost&quot;
as
a
pair
irrespective
of
whether
the
user
program
is
processed
by
both
instructions
or
continued
in
the
next
cycle.
You
will
find
an
example
of
a
server
method
implementation
in
the
STEP
7
online
help.
308
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Integrating
the
server
method
The
diagram
below
shows
how
an
OPC
UA
client
(A)
calls
the
server
method
&quot;Cool&quot;:
The
CPU
executes
the
instance
&quot;Cool1&quot;
of
the
server
method
&quot;Cool&quot;
in
the
cyclic
user
program
⑥
.
The
CPU
first
uses
the
instruction
&quot;OPC_UA_ServerMethodPre&quot;
to
query
④
whether
an
OPC
UA
client
has
called
the
server
method
&quot;Cool&quot;
①
.
If
the
server
method
has
not
been
called,
program
execution
returns
directly
to
the
cyclic
user
program
over
④
and
⑥
.
The
CPU
resumes
the
cyclic
user
program
after
&quot;Cool1&quot;.
If
the
server
method
has
been
called,
this
information
is
returned
to
the
server
method
&quot;Cool&quot; over
④
. The actual functionality is now executed in the Cool server method,
see&quot;<Method
Functionality>&quot;
in
the
graphic.
The
server
method
then
uses
the
instruction
&quot;OPC_UA_ServerMethodPost&quot;
⑤
to
notify
the
firmware
(B)
that
the
instruction
has
been
executed
③
.
1504719
1086388
2574622
1086388
The firmware returns this information over
②
to the calling OPC UA client (A).
The
CPU
resumes
the
cyclic
user
program
after
&quot;Cool1&quot;.
23&
8$
&OiHQW
$
1
)iUPZDUH
23&
8$
6HUYHU
%
3
23&B8$B6HU-
YHU0HWKRG3UH
&
4
&quot;0HWKRG&quot;
)%
&RRO
&DOO
IQVWDQFH;
&\FOiFDO
8VHU
SURJUDP
2
3
23&B8$B6HU-
YHU0HWKRG3RVW
5
<0HWKRGV)XQF
&DOO
IQVWDQFH;
6
&DOO
&RRO1(...);
&DOO
D
&RRO2(...);
67-1500
DV
23&
8$
6HUYHU
#23&...3UHB
WiRQDOiW\!
#23&...3RVWB
2574622
-725641
Call
of
the
server
method
and
management
of
the
&quot;Done&quot;
information
(method
complete)
①
Asynchronous
call
of
the
server
method
②
Asynchronous
&quot;Done&quot;
information
for
the
method
called
(method
complete)
Wait
for
OPC
UA
client
calls,
management
of
calls
in
the
queue,
forwarding
of
&quot;Done&quot;
information
from
the
cyclic
user
program
to
the
OPC
UA
client
③
Data
transfer
from
the
OPC
UA
server
to
the
method
instances
of
the
user
program
and
vice
versa
Check
whether
method
has
been
called.
If
it
has,
forwarding
of
input
data
from
the
OPC
UA
server
to
the
method
instance
of
the
user
program
and
feed-
back
to
the
method
instance
that
the
method
has
been
called
(&quot;called&quot;)
④
Synchronous
call
of
the
instruction
OPC_UA_ServerMethodPre
as
a
multi-instance
stating
the
storage
area
for
the
input
data
from
the
OPC
UA
server.
The
return
value
indicates
whether
or
not
the
method
has
been
called
by
the
OPC
UA
client.
1504813
5405125
Communication
Function
Manual,
11/2024,
A5E03735815-AM
309
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
⑤
Check
whether
the
method
has
been
completed
or
is
still
active
(&quot;busy&quot;).
Check
whether
the
method
has
been
completed.
If
it
has,
the
output
data
of
the
method
instance
is
forwarded
to
the
OPC
UA
server
and
the
method
instance
is
notified
that
the
method
has
been
completed.
The
OPC
UA
server
is
notified.
⑥
Call
of
the
method
FB
(in
this
case:
FB
Cool)
with
the
required
instance
and
the
process
parameters
Figure
11-54
Example:
Calling
the
&quot;Cool&quot;
server
method
Information
about
server
instructions
The
&quot;OPC_UA_ServerMethodPre&quot;
and
&quot;OPC_UA_ServerMethodPost&quot;
are
described
in
detail
in
the
help
to
the
Instructions
>
Communication
>
OPC
UA
>
OPC
UA
server.
Boundary
conditions
for
using
server
methods
Permitted
data
types
If
you
provide
server
methods,
observe
the
following
rule:
Assign
the
data
types
as
shown
below
(SIMATIC
data
type
-
OPC
UA
data
type).
Other
assignments
are
not
permitted.
STEP 7 does not check the observance of this rule and does not prevent an incorrect
assignment.
You
are
responsible
for
the
rule-compliant
selection
and
assignment
of
the
data
types.
You
can
also
use
the
listed
data
types,
for
example,
as
elements
of
structures/arrays/UDTs
for
input and output parameters of self-created server methods (UAMethod_InParameters and
UAMethod_OutParameters).
SIMATIC
data
type
OPC
UA
data
type
BOOL
Boolean
SINT
SByte
INT
Int16
DINT
Int32
LINT
Int64
USINT
Byte
UINT
UInt16
UDINT
UInt32
ULINT
UInt64
REAL
Float
LREAL
Double
LDT
DateTime
WSTRING
String
DINT
Enumeration
(Encoding
Int32)
and
all
derived
data
types
310
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
SIMATIC
data
type
OPC
UA
data
type
User-defined
data
type
required
(UDT,
user-defined
data
type)
The user-defined data type must be cre-
ated with the prefix &quot;Union_&quot;, for example
&quot;Union_MyDatatype&quot;.
The
first
element
(Selector)
in
this
UDT
must
have
the
data
type
&quot;UDINT&quot;.
UNION
and
all
derived
data
types
See
LocalizedText
and
ByteString
data
types
(Page
291)
LocalizedText
ByteString
GUID
See
Using
additional
OPC
UA
data
types
for
companion
specifications
(Page
293)
GUID
Number
of
implementable
server
methods
and
number
of
arguments
If you implement server methods via your user program, the number of usable methods is
limited
depending
on
the
CPU
type.
You
can
find
this
information
in
the
equipment
manuals
of
the
corresponding
CPUs
or
the
latest
technical
specifications
of
the
CPUs
on
the
Internet
(
https://support.industry.siemens.com/cs/ww/en/ps/td
).
Error
message
when
exceeded
If
the
maximum
number
of
server
methods
is
exceeded,
the
OPC_UA_ServerMethodPre
or
OPC_UA_ServerMethodPost instructions report the error code 0xB080_B000
(TooManyMethods).
Amount
of
data
which
can
be
transferred
using
server
method
to
an
S7-1500
CPU
Max. 2097152
bytes
(= 2.1
megabytes
MaxMessageSize).
Supply
of
structured
data
types
with
nested
arrays
If
a
structured
data
type
(Struct/UDT)
contains
an
array,
the
OPC
UA
server
does
not
provide
information
about
the
length
of
this
array.
If you use such a structure as the input or output parameter of a server method, for example,
you
must
ensure
that
the
nested
array
is
supplied
with
the
correct
length
when
the
method
is
called.
If
you
do
not
adhere
to
this
rule,
the
method
fails
with
the
error
code
&quot;BadInvalidArgument&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
311
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Providing
alarms
on
the
OPC
UA
server
Useful
information
on
alarms
Alarms
allow
you
to
detect
errors
in
process
control
in
the
automation
system
quickly,
to
localize them precisely, and to eliminate them. This leads to a significant reduction in
downtimes in a plant. The OPC UA information model &quot;Alarms & Conditions&quot; provides a
standardized
and
platform-independent
way
of
message
processing.
As of firmware version V2.9, the OPC UA server of an S7-1500 CPU supports the OPC UA
information
model
&quot;Alarms
and
Conditions&quot;.
In
this
way,
the
OPC
UA
server
provides
access
to
controller
alarms.
The
following
sections
describe
which
alarm
types
available
in
SIMATIC
are
supported
at
the
OPC
UA
interface
of
the
OPC
UA
server.
The
following
sections
also
describe
how
you
configure
the
OPC
UA
server
of
the
S7-1500
CPU for Alarms & Conditions, the main points of how the Alarms & Conditions model is
structured with OPC UA, and which special points must be taken into consideration when
using alarms from the address space of the OPC UA server as compared to the SIMATIC
controller
alarms
of
the
CPU
alarm
system.
Basis
for
the
converting
alarms
to
OPC
UA
Alarms
&
Conditions
The
Alarms
and
Conditions
information
model
is
specified
in
the
&quot;OPC
10000-9:
OPC
Unified
Architecture
Part
9:
Alarms
&
Conditions&quot;
specification.
Controller
alarms in SIMATIC
The
OPC
UA
server
of
the
S7-1500
CPUs
supports
the
controller
alarms
listed
below,
which
are available to S7-1500 CPUs. You configure or program these alarms in the usual way,
without
the
need
to
consider
additional
rules
for
use
of
these
alarms
by
OPC
UA
clients.
The added benefit of OPC UA Alarms and Conditions is that these alarm types can be
displayed
not
only
by
HMI
devices,
web
browsers,
the
CPU
display
or
the
TIA
Portal,
but
also
by
all
OPC
UA
clients
that
support
OPC
UA
Alarms
and
Conditions.
PLC
supervision
alarms
with
ProDiag
You can integrate simple supervisions in your program with just a few configuring steps
and
without
having
to
change
the
program
code.
The
configuration
of
the
supervisions
is
independent of the programming languages of the TIA Portal because only individual
operands
are
supervised,
and
you
do
not
need
any
additional
programming
sections.
System
diagnostics
alarms
Configuration-dependent
module
events
are
known
by
the
hardware
configuration
of
the
CPU and can be evaluated by connected display devices. They can only be viewed in the
alarm
editor
and
cannot
be
edited.
Program
alarms
(Program_Alarm
instruction)
For
reporting
program
synchronous
events,
program
alarms
are
assigned
to
one
block
at
a
time.
They
are
created
in
the
program
editor
and
edited
in
the
alarm
editor
(TIA
Portal).
GRAPH
alarms
For
GRAPH
function
blocks,
you
can
also
enable
alarms;
e.g.
for
interlocks,
supervisions
and
GRAPH
warnings
(step-time
supervisions).
312
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Important
information
on
the
alarm
types
The
following
characteristics
are
significant
to
the
differences
in
the
behavior
of
alarms:
Do
alarms
have
a
state
(e.g.
are
they
incoming,
outgoing
-
with
the
corresponding
time
stamps)?
Do
alarms
require
acknowledgment?
If none of these characteristics apply, which means the alarms have no state and do not
require acknowledgment, alarms simply provide information about an event that has
occurred
(&quot;Fire
and
Forget&quot;).
It
is
up
to
the
device
receiving
the
alarm
to
buffer
the
alarm
for
further
use
or
only
for
display.
Alarm
class
determines
acknowledgment
behavior
This section covers the setting options for program alarms. You can also set the behavior of
the
alarms
for
system
diagnostics
alarms
and
PLC
supervision
alarms
(e.g.
ProDiag
supervision
settings)
-
refer
to
the
linked
more
information
for
details.
You
can
find
the
setting
options
for
program
alarms
in
the
alarm
editor
(double-click
on
&quot;PLC
supervisions
and
alarms&quot;
in
the
project
tree,
select
the
&quot;Alarms&quot;
tab).
For the S7-1500 CPU, you set here via the alarm class whether an alarm needs to be
acknowledged or not. In addition to the acknowledgment behavior, when creating a new
alarm
class,
you
define
the
default
priority
of
alarms
of
this
alarm
class.
You
set
whether
an
alarm
has
a
state
or
not
by
means
of
the
&quot;Information
only&quot;
option,
for
example,
at
the
alarm
type;
this
results
in
&quot;Fire-and-Forget&quot;
behavior
of
the
alarm.
Here
is
an
example
with
settings
in
the
alarm
editor
with
different
alarm
classes
(&quot;PLC
supervisions
and
alarms&quot;
in
the
project
tree):
First
line
&quot;Program_Alarm&quot;:
Does
not
require
acknowledgment,
information
only
(&quot;Fire
and
Forget&quot;).
Second line &quot;Program_Alarm_1&quot;: Requires acknowledgment and has a state, which means
the
alarm
includes
information
on
whether
it
is
incoming
or
outgoing.
Third
line
&quot;Program_Alarm_2&quot;:
Does
not
require
acknowledgment
and
has
a
state,
which
means
the
alarm
includes
information
on
whether
it
is
incoming
or
outgoing.
719962
177863
Communication
Function
Manual,
11/2024,
A5E03735815-AM
313
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Display
of
alarms
in
the
TIA
Portal
During runtime, you have the option of viewing the alarms in the TIA Portal: The alarm
display
is
located
directly
under
the
alarm
editor
(&quot;Diagnostics&quot;
tab
>
&quot;Alarm
display&quot;
tab).
The
following
applies
to
the
state
and
acknowledgment
behavior:
When
you
click
on
the
&quot;Current
alarms&quot;
button,
alarms
that
have
been
recently
incoming,
outgoing or acknowledged are displayed. Only alarms with a state and alarms requiring
acknowledgment are displayed here. You can also acknowledge an alarm requiring
acknowledgment (blue font) in this view via the shortcut menu or using the
&quot;Acknowledge&quot;
button.
If you want to observe the chronological development (e.g. alarm came in, was
acknowledged and went out), you need to click the &quot;Alarm archive&quot; button. The three
events
that
belong
to
this
alarm
are
listed
one
after
another
only
in
this
view.
You
can
only
find
the
current
state
in
the
&quot;Current
alarms&quot;
view.
Info
reports
(alarms
with
the
&quot;Information
only&quot;
property)
are
only
displayed
in
the
&quot;Alarm
archive&quot;
view.
Because
these
alarms
are
only
triggered
once
and
not
buffered,
they
do
not
appear
in
the
&quot;Current
alarms&quot;
view.
PLC
supervisions
are
also
shown
in
the
alarm
display.
System alarms usually belong to the &quot;No Acknowledgement&quot; alarm class with the
&quot;Information only&quot; option. These alarms are logged in the diagnostics buffer in the CPU
and thus allow the sequence of system alarms to be analyzed over a limited period. In
contrast, operating state changes that are also logged in the diagnostics buffer have a
state,
which
means
it
is
indicated
that
or
when
a
CPU
went
into
STOP
state
and
if
or
when
it exited this state again, for example, entered RUN state. This information is displayed
with
the
states
&quot;incoming/outgoing&quot;.
540004
180357
Provision
of
controller
alarms
by
the
OPC
UA
server
When
an
OPC
UA
client
wants
to
receive
alarms
of
the
S7-1500
CPU,
it
needs
to
subscribe
to
OPC
UA
events
(MonitoredEventItems).
For this purpose, the address space of the OPC UA server of the S7-1500 CPU contains
corresponding
nodes
that
are
&quot;Event-Notifiers&quot;
and
create
a
subscription
for
the
OPC
UA
clients
to
receive
the
alarms.
For completeness, we also mention that further type definitions are contained in the server
address space for this purpose as nodes under &quot;Types&quot;. Type definitions under
&quot;BaseEventType&quot;
and
&quot;ConditionType&quot;
ensure
that
the
fields
used
by
SIMATIC
alarms
are
also
provided
in
the
OPC
UA
server.
314
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
After the activation of OPC UA Alarms and Conditions (CPU properties in the hardware
configuration),
the
OPC
UA
address
space
of
the
S7-1500
CPU
thus
reflects
the
various
alarm
types
(controller
alarms)
as
described
above:
ProcessDiagnostics
Corresponds
to
the
PLC
supervision
alarms
with
ProDiag
SystemDiagnostics
Corresponds
to
the
system
diagnostics
alarms
UserProgram
Corresponds
to
the
program
alarms
Graph
Corresponds
to
GRAPH
alarms
By
selecting
the
node
for
a
subscription,
you
determine
which
alarm
types
are
received
by
the
OPC UA client. For example, the &quot;Server&quot; node enables receipt of all alarms, the
&quot;UserProgram&quot;
node
only
the
receipt
of
program
alarms.
Details
about
the
OPC
UA
model
for
Alarms
and
Conditions
are
given
in
the
next
selection,
especially
for
the
&quot;Overloads&quot;
node,
you
can
find
more
information
here:
Handling
memory
limits
for
OPC
UA
Alarms
and
Conditions
(Page
333).
1799970
130726
Communication
Function
Manual,
11/2024,
A5E03735815-AM
315
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
More
information
on
the
alarm
types
The concepts and configuration options for controller alarms are not described further here.
For
information
on
alarm
configuration,
alarm
display
and
the
associated
instructions,
such
as
&quot;Progam_Alarm&quot;,
refer
to
the
STEP
7
online
help.
OPC
UA
Events
The
basic
concepts
for
alarm
processing
in
OPC
UA
are
expanded
on
here
-
the
basic
concept
of &quot;Events&quot; is covered here. The terms used in the various parts of the OPC UA specification
have
been
retained
here.
Properties
of
events
In the address model of the OPC UA server, as of CPU firmware version V2.9, you not only
have
the
option
to
access
PLC
tags
(read,
write)
via
nodes
and
to
use
methods
-
you
can
also
receive
events
or
alarms
via
nodes.
In
OPC
UA
terminology,
these
are
called
&quot;events&quot;.
An event includes an event text (Message), time stamp (Time) and event source
(SourceNode).
The
information
supplied
with
an
event
from
the
server
depends
on
the
event
type.
OPC
UA
defines
a
BaseEventType
in
part
5
of
the
specification
(Information
Model).
Other
event
types
that
provide
different
alarm
behavior
are
derived
from
the
BaseEventType.
This
type
information
of
the
different
event
types
is
visible
in
the
address
space
of
an
OPC
UA
server (&quot;Types&quot; folder). This also applies, for example, to the event types of &quot;Conditions&quot; and
&quot;Alarms&quot;,
which
are
discussed
in
the
next
section.
The
OPC
UA
specification
defines
for
the
BaseEventType
and
for
derived
EventTypes
which
properties
(fields)
of
an
event
are
mandatory
and
which
are
optional.
The
following
figure
shows
the
hierarchical
structure
of
BaseEventType.
The following sections show how specialized EventTypes are derived from the root of the
derivation hierarchy, the BaseEventType. The SIMATIC-specific derivations ensure that the
information
supplied
in
SIMATIC
with
an
alarm
and
displayed
on
an
HMI
device,
for
example,
can
also
be
subscribed
to
by
an
OPC
UA
client
in
the
address
space
of
the
OPC
UA
server.
An event itself is not available as a node in the address space. Events are only triggered by
nodes
or
objects
that
have
the
&quot;Event-Notifier&quot;
property.
These
nodes
are
often
also
referred
to as event signaling objects. Only nodes with this property can be specified as
EventMonitoredItem
in
a
subscription
to
receive
corresponding
events
in
the
client.
Nodes that can trigger events with an S7-1500 CPU are objects such as &quot;Server&quot;, the
&quot;SimaticAlarmsAndConditions&quot; object below it, and the three objects below that,
ProcessDiagnostics,
SystemDiagnostics
and
UserProgram.
The
&quot;EventNotifier&quot;
attribute
is
set
for
these
objects
in
the
address
space
of
the
OPC
UA
server
of
the
CPU.
316
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Definition
of
SimaticEventType
The
figure
below
shows
that
the
type
&quot;SimaticEventType&quot;
is
derived
directly
from
BaseEventType.
BaseEventType
is
the
basic
type
definition
for
events
with
OPC
UA.
All
event
types
for
OPC
UA
can
be
defined,
directly
or
indirectly,
based
on
BaseEventType.
BBTF&WFOU5ZQF
3:
4JNBUJD&WFOU5ZQF
The
&quot;SimaticEventType&quot;
type
is
defined
in
the
SIMATIC
namespace
(http://www.siemens.com/simatic-s7-opcua).
SimaticEventType
has
all
properties
of
BaseEventType
as
well
as
the
special
properties
which
are
an
image
of
the
field
structure
of
SIMATIC
alarms.
Description
of
the
event
fields
for
SimaticEventType
The following table contains information on the fields of SimaticEventType for alarms of the
type
&quot;Information
only&quot;.
Fields
that
are
optional
according
to
OPC
UA
and
are
not
used
by
the
OPC
UA
server
of
the
CPU
are
omitted.
You
can
also
find
a
general
description
of
the
fields
in
the specification OPC 10000-5: OPC Unified Architecture, Part 5: Information Model, Release
1.04.
BrowsePath
DataType
Explanations
EventId
ByteString
Unique
Event
ID
of
the
event
EventType
NodeId
Node
ID
of
the
event
type
Time
UtcTime
Time
stamp
of
the
event
(Event
occurrence)
ReceiveTime
UtcTime
Current
time
stamp
at
which
the
OPC
UA
event
was
generated.
Message
LocalizedText
Event
text
Severity
UInt16
Priority of the alarm from SIMATIC (0..16), spread
into a range from 1..1000 with OPC UA, see fol-
lowing
table.
The priority indicates the urgency with which the
event
needs
a
response.
3:AdditionalText_01
LocalizedText
Optional
additional
text
1
...
...
...
3:AdditionalText_09
LocalizedText
Optional
additional
text
9
3:AssociatedValue_01
3:SimaticAssociate-
dAlarmValue
Optional
associated
value
1
(not
for
system
dia-
gnostics)
...
...
...
3:AssociatedValue_10
3:SimaticAssociate-
dAlarmValue
Optional
associated
value
10
(not
for
system
dia-
gnostics)
3:InfoText
LocalizedText
Info
text
Communication
Function
Manual,
11/2024,
A5E03735815-AM
317
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
BrowsePath
DataType
Explanations
3:ID
UInt16
Alarm number - A number (ID) assigned by the
system
that
is
unique
within
the
CPU
and
identi-
fies
an
alarm.
3:DisplayClass
UInt16
Display
class
(used
by
HMI
devices.
Determines
the
events
displayed
on
specific
HMI
devices.
3:GroupID
UInt8
Acknowledgment
group
for
alarms
that
are
acknowledged
together.
Assignment
of
Priority
(SIMATIC)
-
Severity
(OPC
UA)
The
following
table
shows
how
the
17
priorities
that
you
can
assign
to
alarms
in
the
SIMATIC
environment are mapped to the 1000-level Severity with the OPC UA server of the S7-1500
CPU.
This
assignment
depends
on
the
manufacturer.
Different
assignments
may
apply
to
other
devices.
OPC
Range
Priority
0..16
(SIMATIC)
Severity
1..1000
(OPC
UA)
HIGH
(667
–
1
000)
16
1000
15
930
14
860
13
790
12
720
MEDIUM
(334
–
666)
11
650
10
600
9
550
8
500
7
450
6
400
5
350
LOW
(1
–
333)
4
300
3
225
2
150
1
75
0
1
318
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
OPC
UA
conditions
and
OPC
UA
alarms
The
following
goes
further
in
depth
about
the
basic
concepts
for
OPC
UA
Conditions
and
OPC
UA Alarms based on the explanations of events in the previous sections. Again, the terms
used
in
the
various
parts
of
the
OPC
UA
specification
have
been
retained
here.
Properties
of
Conditions
A
prerequisite
for
understanding
is
the
concept
of
&quot;Events&quot;
in
OPC
UA.
In
OPC
UA,
if
an
event
alarm
object
provides
status
information
in
addition
to
its
ability
to
fire
Events, we speak of Conditions. Conditions represent a state of a system or one of its
components. Basic states are &quot;enabled&quot; and &quot;disabled&quot;, other state definitions are also
possible.
In
turn,
interested
OPC
UA
clients
are
notified
of
state
changes
by
means
of
events
(Condition
Events).
An
example
of
a
Condition
is
state
information,
for
example,
that
a
device
requires
maintenance.
Properties
of
Alarms
However,
the
properties
of
ConditionType
are
not
sufficient
to
completely
map
the
characteristics
of
SIMATIC
alarms
in
the
OPC
UA
server.
From
the
ConditionType,
which
is
derived
from
the
BaseEventType,
OPC
UA
defines
further
derived
event
types
such
as
AcknowledgeableConditionType
and
AlarmConditionType.
AcknowledgeableConditionType
supplements
the
properties
of
ConditionType
with
the
&quot;Acknowledgeable&quot;
characteristic
(AckedState).
AlarmConditionType thus adds the &quot;ActiveState&quot; characteristic to the properties of
ConditionType and the AcknowledgeableConditionType. In SIMATIC terminology, this is an
incoming alarm. The ActiveState signals that the situation, which the Condition represents, is
currently
present
or
has
occurred.
Example: A temperature has exceeded a limit. If &quot;ActiveState&quot; is not set, the situation that
represents
the
condition
no
longer
exists
-
this
is
usually
referred
to
as
a
&quot;normal
state&quot;.
In
SIMATIC
terminology,
this
corresponds
to
an
outgoing
alarm.
In
OPC
UA,
other
statuses
such
as
SilenceState
and
ShelvingState
are
defined,
but
these
are
not relevant to mapping to the SIMATIC alarm system and will therefore not be described
further
here.
The
SimaticAlarmConditionType
is
derived
from
the
AlarmConditionType
and
contains
all
event
fields
to
map
the
state
and
acknowledgment
information
of
SIMATIC
messages.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
319
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Definition
of
SimaticAlarmConditionType
$POEJUJPO5ZQF
The
following
figure
shows
how
events
of
the
type
&quot;SimaticAlarmConditionType&quot;
are
defined
by
a
series
of
expansions
to
the
OPC
UA
&quot;BaseEventType&quot;.
BBTF&WFOU5ZQF
3:
4JNBUJDAMBSN$POEJUJPO5ZQF
AMBSN$POEJUJPO5ZQF
Description
of
the
event
fields
for
SimaticAlarmConditionType
The following table contains information about the fields of SimaticAlarmConditionType for
stateful and acknowledgeable alarms, which are added to the event fields such as
SimaticEventType.
Fields
that
are
optional
according
to
OPC
UA
and
are
not
used
by
the
OPC
UA server of the CPU are omitted. You can also find a description of the fields in the
specification OPC 10000-9: OPC Unified Architecture, Part 9: Alarms & Conditions, Release
1.04.
BrowsePath
DataType
Explanations
ConditionClassId
NodeId
Node
IDs
for
SystemConditionClassType,
ProcessConditionClassType or
BaseConditionClassType
are
possible
ConditionClassName
LocalizedText
Display
name
of
the
ConditionClassId
Retain
Boolean
Indicates
that
the
alarm
is
still
relevant
for
OPC
UA clients (set if alarm is still pending and not
acknowledged).
Comment
LocalizedText
Most recent comment entered using the
&quot;AddComment&quot;
or
&quot;Acknowledge&quot;
method.
ZERO
after
a
server
restart
and
if
no
com-
ment
was
entered.
Comment.SourceTimestamp
UtcTime
Time
stamp
for
the
last
change
of
the
com-
ment
field
AckedState
LocalizedText
&quot;Acknowledged&quot;
or
&quot;Unacknowledged&quot;
AckedState.Id
Boolean
Set,
if
acknowledged
ADIOPXMFEHFBCMF$POEJUJPO5ZQF
320
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
BrowsePath
DataType
Explanations
AckedState.TransitionTime
UtcTime
Time at which the alarm was acknowledged.
ZERO if not acknowledged or not acknow-
ledgeable.
ActiveState
LocalizedText
&quot;Active&quot;
or
&quot;Inactive&quot;
ActiveState.Id
Boolean
Set
when
&quot;active&quot;
Activating
Alarms
and
Conditions
Requirements
S7-1500
CPU
firmware
version V2.9 or
higher.
Runtime
license
for
OPC
UA
purchased
according
to
the
license
specifications
and
set
in
the
CPU
properties.
&quot;Central
alarm
management
in
the
PLC&quot;
parameter
is
enabled
(&quot;PLC
messages&quot;
area
in
the
CPU
properties).
Procedure
To
activate
alarms
through
OPC
UA
Alarms
and
Conditions,
follow
these
steps:
In
the
CPU
properties,
go
to
the
&quot;OPC
UA
>
Server
>
General&quot;
area.
Select
the
&quot;Enable
alarms
and
conditions
on
the
OPC
UA
server&quot;
option.
The
corresponding
types
and
objects
that
can
trigger
events
only
become
visible
in
the
address
space
when
the
option
is
activated.
If
required,
also
activate
the
option
&quot;Allow
message
acknowledgment
by
OPC
UA
client&quot;.
In this case, any connected OPC UA client can acknowledge an alarm requiring
acknowledgment
with
the
&quot;Acknowledge&quot;
method.
734313
176258
Recommendation:
Activate
diagnostics
&quot;Requests
of
a
remote
OPC
UA
client
failed&quot;
When
the
OPC
UA
server
cannot
allocate
sufficient
memory,
it
is
not
possible
to
generate
OPC
UA
alarms
in
this
state;
message
loss
for
OPC
UA
clients
may
occur.
Therefore,
you
should
activate
the
diagnostics
&quot;Requests
of
a
remote
OPC
UA
client
failed&quot;
to
diagnose
this
state
(Properties
of
the
CPU
>
OPC
UA
>
Server
>
Diagnostics).
In
addition,
you
should
also
activate
the
option
&quot;Summarize
diagnostics
in
case
of
high
message
volume&quot;.
As
soon
as
sufficient
memory
is
available
again,
OPC
UA
clients
should
call
the
ConditionRefresh
method
to
receive
the
current
state
of
the
alarm
system.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
321
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
More
information
You
can
find
information
on
methods
for
OPC
UA
Alarms
and
Conditions
in
the
section
Methods
for
OPC
UA
Alarms
and
Conditions
(Page
329).
You
can
find
information
on
failed
requests
of
a
remote
client
in
the
section
Request
of
a
remote
client
failed
(Page
341).
Subscribing
to
events
of
an
OPC
UA
server
Subscribing
to
all
events
via
the
&quot;Server&quot;
node
OPC
UA
servers
provide
events
via
the
&quot;Server&quot;
node
and
lower-level
nodes.
When
OPC
UA
clients subscribe to the &quot;Server&quot; node, they receive all events and alarms of the OPC UA
server.
The
&quot;Server&quot;
node
is
located
in
the
&quot;Objects&quot;
folder
below
&quot;Root&quot;.
OPC
UA
servers
inform
OPC
UA
clients
which
event
types
they
use
(under
&quot;Root
>
Types
>
EventTypes&quot;
in
the
address
space).
Filter
options
for
events
OPC
UA
clients
can
choose
and
only
subscribe
to
specific
nodes
under
the
&quot;Server&quot;
node
and
thus to specific event types, for example, only the &quot;UserProgram&quot; node. This reduces the
number
of
events
from
the
OPC
UA
server
to
program
alarms.
Another
way
of
filtering
is
to
select
the
event
fields,
known
as
&quot;Select
Clause&quot;
in
OPC
UA
terminology.
This
means
that
in
the
subscription,
the
OPC
UA
client
makes
a
selection
of
the
event
fields
in
addition to the event alarm object (e.g. the &quot;UserProgram&quot; node). You select the event fields
via
the
browse
name
of
the
corresponding
field.
OPC
UA
also
defines
so-called
&quot;Where
Clauses&quot;.
A
Where
Clause
in
the
event
filter
is
used
to
further limit the number of events that are supplied by the OPC UA server for the selected
object,
for
example,
by
filtering
to
a
severity
range.
322
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Example
client
UaExpert
The
example
of
the
UaExpert
OPC
UA
client
shows
how
events
of
an
OPC
UA
server
can
be
received via a subscription. Here is the most important information on the displayed
events/alarms:
Event
View
is
a
separate
view
of
events
in
addition
to
the
Data
Access
View.
The &quot;Configuration&quot; area contains the selected event signaling object with the fields for
the
Select
Clause.
A
configuration
of
Where
clauses
is
currently
not
possible
in
UaExpert.
In
the
&quot;Events&quot;
area,
&quot;Events&quot;
tab:
Corresponds
to
the
TIA
alarm
view
with
activated
&quot;Alarm
archive&quot; button; events of the &quot;Information only&quot; category and outgoing alarms are also
visible there, because UaExpert buffers them in the background for display. These events
are
not
visible
in
the
&quot;Alarms&quot;
tab.
In
the
&quot;Events&quot;
field,
&quot;Alarms&quot;
tab:
Corresponds
to
the
TIA
alarm
display
with
activated
&quot;Current alarms&quot; button; alarms are visible here with their status, e.g. &quot;active&quot;
(corresponds to &quot;incoming&quot;) and these alarms can also be acknowledged using the
shortcut
menu.
Outgoing
alarms
are
no
longer
visible
in
this
view.
In the columns of the Event area, a selection of event fields is offered, for example, the event
text
(Message)
and
whether
the
alarm
was
acknowledged
(A=Acknowledged).
1799970
129113
Special
features
of
the
display
of
alarms
via
the
OPC
UA
server
of
the
CPU
The
following
once
again
summarizes
the
special
features
of
the
alarm
display
via
OPC
UA
Alarms
and
Conditions
for
the
current
status.
Topic
Explanation
Comment
Via OPC UA, you can add a comment to a alarm using the
&quot;AddComment&quot;
method
or
the
&quot;Acknowledge&quot;
method.
This
com-
ment
is
no
longer
available
after
a
server
restart.
Pending
alarms
are
not
lost
after
a
server
restart
The OPC UA server supports
the &quot;ConditionRefresh&quot; method with
which
it
makes
the
current
state
of
the
system
available
to
the
OPC
UA client, for example, after download of a new data block
(requires
server
restart
and
re-establishment
of
the
connection).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
323
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Processing
associated
values
of
alarms
You
can
specify
placeholders
for
SIMATIC
alarms.
With
placeholders
you
can
integrate
up
to
10 associated values (SD_1 to SD_10) into the alarm text. Placeholders can also be specific
text
list
entries.
When
you
are
using
alarms
with
placeholder,
you
must
observe
the
following
rules:
Placeholders
that
represent
values
in
the
alarm
are
only
inserted
automatically
for
system
diagnostic alarms or security event alarms. For other categories of alarms (e.g. program
alarms), the placeholders for values are not resolved. The OPC UA clients must resolve
these
alarms.
Placeholders
that
reference
text
lists
are
resolved
by
the
CPU
(format,
e.g.:
%t#<name
of
the
text
list>).
Example
of
how
values
and
placeholders
are
assigned
through
UaExpert
Make
sure
that
you
have
selected
all
fields
that
you
need
in
the
UaExpert
configuration.
Note
that
each
field
that
is
not
needed
causes
a
communication
load.
Therefore,
you
should
avoid
a
complete
selection
as
shown
in
the
example
below.
722502
137783
Figure
11-55
ServerObject-Configuration_neutral120
In
the
&quot;Events&quot;
tab
of
UaExpert,
you
select
the
alarm
with
the
integrated
associated
values.
In the &quot;Details&quot; area of the alarm, you will find the value that is to be integrated into the
alarm.
Example:
&quot;AssociatedValue_01&quot;
is
assigned
to
SD_1
(format
@1%
...@).
You
will
find
explanations
on
the
formats
for
associated
values
in
the
TIA
Portal
information
system
(e.g.
by
searching
for
&quot;Example
of
associated
values&quot;).
324
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Support
of
simple
data
types
as
associated
values
The
field
type
from
&quot;AssociatedValue_01
to
..._10
is
of
the
Union
type
and
is
limited
to
some
simple types. The OPC UA data type is SimaticAssociatedAlarmValue. The following simple
data
types
are
supported:
1801748
143813
Figure
11-56
UnionDataTypes_neutral120
Mapping
to
SIMATIC
data
types
The
following
assignment
SIMATIC
data
type
=>
OPC
UA
data
type
applies:
Supported
data
types
for
SD_1 to
SD_10
Mapping
to
OPC
UA
BOOL
Boolean
BBOOL
Boolean
BYTE
Byte
CHAR
Byte
SINT
SByte
USINT
Byte
WORD
UInt16
WChar
UInt16
INT
Int16
UINT
UInt16
Communication
Function
Manual,
11/2024,
A5E03735815-AM
325
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Supported
data
types
for
SD_1 to
SD_10
Mapping
to
OPC
UA
DWORD
Uint32
DINT
Int32
UDINT
Uint32
REAL
Float
LREAL
Double
String
String
WString
String
Simultaneous
receipt
of
alarms
in
multiple
languages
Alarms are transmitted from the OPC UA server to the OPC UA client in the default or
reference
language.
In
the
&quot;Multilingual
support&quot;
area
of
the
CPU
parameters,
you
can
set
the
loaded
project
languages
in
which
the
alarms
are
to
be
transmitted.
As
of
Version
4.0
of
the
S7-1500
CPUs,
you
have
the
option
of
having
the
languages
of
connected
OPC
UA
clients
selected:
When
establishing
the
session,
a
client
can
request
message
texts
in
one
or
more
active
project languages using the parameter &quot;LocaleIds []&quot;; see OPC 10000-4: Services,
ActivateSession
Service
Parameters.
Only
message
texts
can
be
requested
from
the
OPC
UA
server
of
the
CPU
in
this
way;
the
parameter
has
no
effect
on
other
localized
texts
in
the
address
space.
Requirement:
The
&quot;Provide
multilingual
message
texts
corresponding
to
the
active
project
languages
in
the
device&quot;
option
has
been
enabled.
A client can request the message texts in all three active project languages
simultaneously, e.g. to collect the alarms on a central server, so that they can be
evaluated
by
people
in
different
languages.
Requirements
S7-1500
CPU
as
of
firmware
version 4.0
The
OPC
UA
client
supports
the
LocaleIds
&quot;mul&quot;
and
&quot;qst&quot;
for
multilingual
texts.
The &quot;Provide multilingual message texts corresponding to the active project languages in
the
device&quot;
option
has
been
enabled
(&quot;Alarms
and
Conditions&quot;
area
in
the
CPU
properties).
326
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Effect
of
LocaleId
&quot;mul&quot;
and
&quot;qst&quot;
OPC
UA
specification
(OPC
10000-3:
UA
Part
3:
Address
Space
Model)
describes
the
built-in
data
type
&quot;LocalizedText&quot;,
which
is
used
for
texts
in
different
languages.
The
elements
of
the
structure
for
the
data
type
LocalizedText
are
defined
as
follows:
Name
Type
Description
LocalizedText
Structure
Locale
LocaleId
Identifier for the language (language
code)
<language>-<Country/Region>,
e.g.
&quot;en-US&quot;
Specified
by
IETF
RFC
5646
Text
String
Localized text (language-specific
transla-
tion)
LocaleId
=
&quot;mul&quot;
When
an
OPC
UA
client
requests
a
LocalizedText
with
LocaleId
&quot;mul&quot;,
it
receives
the
message
texts in all loaded project languages on the CPU as a JSON text element, consisting of an
Array
of
locale/text
pairs.
In
the
following
example,
texts
are
specified
in
two
languages.
Spaces
and
breaks
are
not
transmitted;
they
have
been
added
here
to
facilitate
reading:
{
&quot;t&quot;:
[
[&quot;de-DE&quot;,&quot;mein
Text&quot;],
[&quot;en-US&quot;,&quot;my
text&quot;]
]
}
Resulting text:
de-DE: &quot;mein Text&quot;
en-US:
&quot;my
text&quot;
LocaleId
=
&quot;qst&quot;
&quot;qst&quot;
is
not
an
abbreviation
but
merely
a
defined
string
for
a
LocaleId,
which
contains
replacement
texts
in
addition
to
the
contents,
as
in
the
case
of
&quot;mul&quot;.
When an OPC UA client requests a LocalizedText with the LocaleId &quot;qst&quot;, it receives the
message
texts
in
all
loaded
project
languages
on
the
CPU.
In
addition
to
the
Array
of
LocaleId,
the JSON text element has a section with the definition of replacement texts (replacement
section).
The
client
must
carry
out
the
provided
replacements
in
the
message
text.
Example
texts
in
two
languages;
&quot;t&quot;
stands
for
&quot;text&quot;,
&quot;r&quot;
for
&quot;replacement&quot;:
{
&quot;t&quot;:
[
[&quot;de-DE&quot;,&quot;mein
Text
@1@
/2/&quot;],
[&quot;en-US&quot;,&quot;my
text
@1@
/2/&quot;]
],
&quot;r&quot;:
[
[&quot;@1@&quot;,
&quot;myCompany&quot;]
[&quot;/2/&quot;,
1.2345]
]
}
Communication
Function
Manual,
11/2024,
A5E03735815-AM
327
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Resulting text:
de-DE: &quot;mein Text myCompany 1,2345&quot;
en-US:
&quot;my
text
myCompany
1.2345&quot;
Because
the
decimal
number
1.2345
in
the
replacement
section
is
not
formatted
as
String,
it
can be written correctly in the different languages (with decimal point in en-US and with
decimal
comma
in
de-DE)
–
provided
that
this
function
has
been
implemented
in
the
client.
Rules
Alarm
texts
are
assembled
by
the
server
according
to
the
following
rules,
and
provided
to
the
client:
To
simplify
the
handling
of
multilingual
message
texts,
only
the
LocaleId
&quot;qst&quot;
is
allowed
for
the
server
of
the
S7-1500.
If
you
request
multilingual
message
texts
with
&quot;qst&quot;
and
there
are
placeholders
(associated
values) in the text, the placeholders are provided in the replacement section. If no
placeholders are present in the text, the text is returned as LocaleId &quot;mul&quot; without
replacement
section.
If only one language is returned (e.g. because there is only one active language or
alignment
with
the
requested
languages
results
in
a
single
language)
and
no
placeholder
is present in the text, the message text is not returned as JSON but rather is returned
directly
as
localized
text
in
the
appropriate
language.
A
client
can
retrieve
the
alarms
in
all
languages
provided
by
the
server
or
only
some
of
these languages. The client defines the selection through an Array of LocaleIds, which
follows the LocaleId &quot;qst&quot;. If no other LocaleIds follow the LocaleId &quot;qst&quot;, all available
languages
are
provided
by
the
server.
Multilingual replacement texts are not returned in the replacement section. You
implement
multilingual
replacement
tests
using
text
lists,
see
AUTOHOTSPOT.
Reading
out
supported
languages
The
OPC
UA
server
publishes
the
supported
languages
under
the
node
&quot;Server
Capabilities
>
LocaleIdArray&quot;.
328
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Methods
for
OPC
UA
Alarms
and
Conditions
The
OPC
UA
specification
Part
9
(OPC
10000-9:
Alarms
&
Conditions)
defines
methods
for
OPC
UA
servers
to
enable
OPC
UA
clients
to
react
to
state
changes,
for
example.
In
the
following,
the
methods
are
described
that
are
supported
by
the
OPC
UA
server
of
the
S7-1500
CPU
with
their
special
features.
Requirement
Using
the
relevant
methods
for
the
Alarms
and
Conditions
functionality
requires
the
following:
Alarms
and
Conditions
is
activated
For
the
&quot;Acknowledge&quot;
method,
the
acknowledgment
of
alarms
by
OPC
UA
clients
must
be
allowed
on
the
server
side.
Methods
for
OPC
UA
Alarms
and
Conditions
In the following, the methods are briefly explained with the special features and restrictions
caused
by
the
implementation
for
the
OPC
UA
server
of
the
S7-1500
CPU.
The
methods
are
visible
in
the
type
space.
The
OPC
UA
specification
listed
above
contains
the
general
description.
You
can
find
a
detailed
description
of
the
individual
methods
below
this
overview
table.
Method
Description
Acknowledge
Method
for
acknowledging
an
alarm
object
that
is
uniquely
identified
by
a
EventId.
ConditionRefresh
Method for requesting an update of all alarm objects (in
SIMATIC
language:
updating
of
all
pending
alarms).
All
mon-
itored
items
of
the
subscription
are
updated.
Synchronization of pending alarm objects from the OPC UA
server
of
the
CPU
is
indicated
e.g.
in
the
following
situations:
Connecting
for
the
first
time
or
resuming
the
connection
(after
interrupting
the
communication)
Screen
change
on
an
operator
screen
of
an
HMI
device
AddComment
Method
for
adding
comments
to
alarm
objects.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
329
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Calling
the
&quot;Acknowledge&quot;
and
&quot;AddComment&quot;
methods
Method
calls
in
OPC
UA
use
MethodId
and
ObjectId.
In
the
case
of
an
alarm
object,
ObjectId
is
the
node
ID
for
the
instance
of
the
alarm
object.
Since the address model of Simatic Alarms and Conditions does not provide instances for
alarm
objects,
the
OPC
UA
specification
provides
in
this
case
that
the
OPC
UA
client
uses
the
ConditionId
as
ObjectId.
You can find information on how to determine the ConditionId using a
SimpleAttributeOperands
in
the
SelectClause
of
the
event
filter,
see
also
the
OPC
UA
specification
Part
9
(OPC
10000-9:
Alarms
&
Conditions):
1657866
160865
Acknowledge
330
The
Acknowledge
method
(MethodId:
i=9111)
has
the
following
parameters:
Parameter
Data
type
Description
[in]
EventId
ByteString
EventId identifies a specific event notification.
Only
events
whose
AckedState.Id
field
has
the
value &quot;False&quot;, can be acknowledged with the
&quot;Acknowledge&quot;
method.
[in]
comment
LocalizedText
Text for commenting the acknowledgment, e.g.
by
an
operator.
See
also
supplementary
description
of
the
&quot;AddComment&quot;
method.
Method
Result
Codes
Result
Code
Description
Good
Method
was
successfully
executed.
BadNotSupported
Method cannot be called because the option for
acknowledging
for
Alarms
and
Conditions
by
OPC
UA
clients
is
deactivated
in
the
CPU
properties
for
OPC
UA.
BadConditionBranchAlreadyAcked
Acknowledgment
has
already
been
made.
BadNodeIdUnknown
Method
was
called
with
the
wrong
ConditionId
(see
notes
on
ObjectId).
BadEventIdUnknown
Method
was
called
with
the
wrong
EventId.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
ConditionRefresh
The
ConditionRefresh
method
(MethodId:
i=3875)
has
the
following
parameters:
Parameter
Data
type
Description
[in]
SubscriptionId
Uint32
SubscriptionId
of
the
subscription
to
be
updated.
Method
Result
Codes
Result
Code
Description
Bad_SubscriptionIdInvalid
The
SubscriptinId
is
not
valid.
Bad_RefreshInProgress
The
&quot;ConditionRefresh&quot;
is
currently
running.
Bad_UserAccessDenied
The
method
&quot;ConditionRefresh&quot;
runs
in
the
context
of a wrong session. This means that the subscrip-
tion
belongs
to
a
different
session.
NOTE
ConditionRefresh2
method
The OPC UA server of the S7-1500 CPU does not support the ConditionRefresh2 method
which can specifically synchronize a monitored item (MonitoredItem) in a subscription. In
this
case,
the
OPC
UA
Server
returns
the
result
code
&quot;Bad_MethodInvalid&quot;.
Use
the
method
&quot;ConditionRefresh&quot;
instead.
AddComment
You have the possibility to add comments to Alarms- objects of the
SimaticAlarmConditionType
type
because
the
support
of
comments
is
mandatory
for
OPC
UA
Alarms
and
Conditions
.
A
comment
was
save
in
the
&quot;Comment&quot;
event
field.
The
following
time
stamp
event
fields
belong
to
the
comment:
&quot;Comment.SourceTimestamp&quot;
for
the
time
when
the
comment
is
transferred
to
the
CPU
&quot;Time&quot;
for
the
time
when
the
Alarms
object
was
modified
When
the
&quot;AddComment&quot;
method
is
called,
&quot;Time&quot;
and
&quot;Comment.SourceTimestamp&quot;
are
identical.
Special
features
of
Alarms
and
Conditions
comments
for
the
OPC
UA
server
of
the
CPU
The
AddComment
method
(MethodId:
i=9029)
has
the
following
parameters:
Parameter
Data
type
Description
[in]
EventId
ByteString
EventId identifies the event notification for
which
a
state
was
reported.
[in]
comment
LocalizedText
Text
for
commenting
the
specified
Alarms
object.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
331
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Method
Result
Codes
Result
Code
Description
Good
Method
was
successfully
executed.
BadNodeIdUnknown
Method was called with the wrong ConditionId
(see
notes
on
calling
the
methods
&quot;Acknowlege&quot;
and
&quot;AddComment&quot;).
BadEventIdUnknown
Method
was
called
with
the
wrong
EventId.
Special
features
of
Alarms
and
Conditions
comments
for
the
OPC
UA
server
of
the
CPU
You have the possibility to add comments to alarm objects of the
&quot;SimaticAlarmConditionType&quot; type with the AddComment method. A comment is also set
when
the
Acknowledge
method
is
called.
The
&quot;AddComment&quot;
method
can
be
called
several
times.
A
comment
was
save
in
the
&quot;Comment&quot;
event
field.
The
&quot;Comment.SourceTimestamp&quot;
indicates
the
last
time
at
which
a
comment
was
set.
The &quot;Time&quot;
time stamp marks the
last
modification
time
of
the
alarm
object
.
When
the
&quot;AddComment&quot;
method
is
called,
&quot;Time&quot;
and
&quot;Comment.SourceTimestamp&quot;
are
identical.
When
the
&quot;Acknowledge&quot;
method
is
called,
the
two
time
stamps
may
differ,
since
the
acknowledgment
is
asynchronous.
The support of comments for OPC UA Alarms and Conditions is mandatory. The SIMATIC
alarm
system
does
not
know
corresponding
comments
for
alarms.
Therefore,
some
special
features
have
to
be
considered:
There
is
only
one
comment:
There
is
only
one
comment
for
an
alarm
object,
so
that
an
existing
comment
is
always
overwritten
when
several
method
calls
are
made
in
succession.
Lifetime
and
time
stamp:
Comments
are
only
stored
at
the
current
alarm
object.
If
the
alarm
object
no
longer
exists,
e.g. after a server restart, the comment no longer exists either. The corresponding
&quot;Comment&quot; and &quot;Comment.SourceTimestamp&quot; event fields are then reset (zero).
The
&quot;Time&quot;
event
field
is
then
set
as
if
the
method
call
&quot;AddComment&quot;
did
not
exist.
Example:
If
you
comment
on
an
unacknowledged
Alarms
object,
the
&quot;Time&quot;
event
field
receives
the
time
of
this
comment
change.
After
a
server
restart,
the
&quot;Time&quot;
event
field
does not show the time when the comment was set, but the time when the
corresponding
Event
arrived.
332
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Handling
memory
limits
for
OPC
UA
Alarms
and
Conditions
The
OPC
UA
server
of
the
S7-1500
CPU
has
product-specific
limited
memory
capacity
for
the
&quot;Alarms
and
Conditions&quot;
function
(see
CPU
specifications).
Two
memory
pools
for
different
categories
of
alarms
are
available:
Pool
only
for
ProgramAlarms
(corresponds
to
program-related
alarm
originators
(producers)
such
as
program
alarms
via
Program_Alarm,
ProDiag,
Graph)
Pool
only
for
SystemDiagnostics
(corresponds
to
system
diagnostic
alarms)
Under unfavorable conditions (e.g. alarm burst) the CPU cannot make all pending alarms
(ProgramAlarms
or
SystemDiagnostics)
from
the
SIMATIC
alarm
area
available
to
the
OPC
UA
Alarms
and
Conditions
system.
However,
alarms
are
not
lost
in
this
case.
You
have
the
possibility
to
react
to
this
overload
event
in
the
user
program.
According
to
your
application you can use the &quot;ConditionRefresh&quot; method to make alarms that &quot;did not make it
into the OPC UA Alarms and Conditions system&quot; available to the OPC UA Alarms and
Conditions
system
again.
Requirement
Alarms
and
Conditions
is
activated
Event
subscriptions
are
set
up
in
the
OPC
UA
client
Communication
Function
Manual,
11/2024,
A5E03735815-AM
333
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Principle
The following figure shows a simplified process for temporarily storing ProgramAlarms to
make
them
available
again
at
another
time
for
the
OPC
UA
Alarms
and
Condition
System.
The
nodes
mentioned
in
the
caption
are
visible
in
the
following
image
of
the
address
model.
4*MA5*$
AMBSNT
01$
6A
AMBSNT
BOE
$POEJUJPOT
$16 15YY
(01$
6A
4FSWFS)
1
100%
1SPHSBNAMBSNT
1SPHSBNAMBSNT
0WFSMPBEAMBSN
4ZTUFN%JBHOPTUJDT
4ZTUFN%JBHOPTUJDT
4VCTDSJQUJPO
4
3FGSFTI
M
F
U
IPE
3
01$
6A
$MJFOU
2
$16
JOTJEF
0VUTUBOEJOH
AMBSNT
①
Number
of
active
alarms
is
too
high
to
make
all
alarms
accessible
via
OPC
UA
Alarms
and
Conditions
②
Overloads
alarm
(overload
alarm)
is
triggered.
This
overload
alarm
is
active
until
the
following
situation
occurs:
No
more
alarms
are
pending
for
the
OPC
UA
Alarms
and
Conditions
system
(OutstandingProgramAlarms
=
0)
and
Number
of
alarms
in
the
OPC
UA
Alarms
and
Conditions
system
<
Hysteresis-cleaned
maximum
value
for
OPC
UA
alarms
(=
MaxAlarmsInQueue
-
OverloadHysteresis)
Alarms
that
are
not
available
in
the
OPC
UA
Alarms
and
Conditions
system
due
to
the
overload
situation
are
buf-
fered
by
the
CPU
as
&quot;OutstandingAlarms&quot;.
③
When
an
OPC
UA
client
executes
the
ConditionRefresh
method,
not
only
are
all
alarm
objects
of
the
relevant
sub-
scription synchronized, but also the alarms outstanding for OPC UA Alarms and Conditions (OutstandingAlarms)
are transferred to the Alarms and Conditions memory area - until the maximum number of alarms is reached.
&quot;Oldest&quot;
alarms
are
transferred
first.
After
that
every
subscription
to
these
alarms
receives
the
transferred
alarms
-
not
only
the
OPC
UA
client
that
called
the
ConditionRefresh
method.
④
The
OPC
UA
client
controls
the
handling
of
pending
alarms
via
the
information
of
the
Overloads
nodes.
334
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Address
model
for
Alarms
and
Conditions
The
following
figure
shows
the
nodes
of
the
OPC
UA
Alarms
and
Conditions
address
model.
1800225
125056
Special
features
When pending alarms go out or are acknowledged, they no longer enter the OCP UA
Alarms and Conditions system area via the ConditionRefresh method. They are then
&quot;invisible&quot;
to
OPC
UA
Alarms
and
Conditions
and
thus
to
the
connected
OPC
UA
clients.
This
fact
influences
e.g.
statistical
evaluations
of
alarm
progressions.
To
avoid
a
high
alarm
frequency
for
the
Overloads
Alarm
if
the
number
of
alarms
oscillates
around the maximum value, the limit for triggering the alarm is higher than the limit for
canceling this alarm: The value for this difference is displayed in the &quot;OverloadHysteresis&quot;
node.
Example:
Maximum
number
of
alarms:
200,
OverloadHysteresis:
3.
Overloads alarm is triggered starting with 200 alarms and is only canceled if there are
fewer than 197 alarms. If the number of alarms increases again, it will be triggered again
when
200
alarms
are
exceeded.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
335
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Using
diagnostics
options
Diagnostics
of
the
OPC
UA
server
Online
diagnostics
of
the
OPC
UA
server
The
S7-1500
CPU
OPC
UA
server
can
be
diagnosed
online
with
standard
OPC
UA
clients,
such
as
UaExpert.
The
diagnostic
information
is
subdivided
into
the
following
areas:
Server
Diagnostics
Sessions
Diagnostics
Subscriptions
Diagnostics
In
the
address
space
of
the
server,
for
example,
the
following
nodes
are
available
with
diagnostic
information:
ServerDiagnosticsSummary
:
Server
diagnostics
summary
CurrentSessionCount:
Number
of
active
sessions
SecurityRejectedSessionCount:
Number
of
sessions
rejected
due
to
mismatching
end
point
security
settings
between
client
and
server
SessionsDiagnosticsSummary
: Session
diagnostics
summary
–
ActualSessionTimeout:
Set
time
that
a
session
lasts,
e.g.
in
the
event
of
disconnection
SubscriptionsDiagnosticsArray
:
ARRAY
with
one
element
per
subscription
for
each
session
Figure
11-57
Server
diagnostics
336
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
The
SessionsDiagnosticsSummary
node
also
shows
the
properties
of
the
client
application
accessing
the
server
within
the
session.
Figure
11-58
Sessions
diagnostics
with
the
properties
of
the
client
application
Diagnostics
of
the
connection
between
client
and
server
To
diagnose
the
status
of
the
connection
during
program
runtime
in
the
client,
use
the
following
instruction:
OPC_UA_ConnectionGetStatus:
Read
connection
status.
Running
diagnostics
for
OPC
UA
servers
in
the
program
From
STEP
7
(TIA
Portal)
V18
onwards,
you
can
access
nodes
in
the
OPC
UA
address
space
of
an S7-1500 CPU (firmware version V3.0 onwards) to evaluate the contents for diagnostic
purposes
in
the
program.
Functional
principle
In
the
local
address
space
of
the
CPU,
there
are
numerous
nodes
where
the
OPC
UA
server
of
the
CPU
stores
data
and
states.
The
&quot;OPC_UA_ReadList&quot;
instruction
enables
you
to
access
this
information
and
evaluate
it
in
the
user
program.
Example:
&quot;ServerState&quot;
is
a
node
in
the
address
space
of
the
CPU
that
contains
values
for
the
server
state
or
for
state
transitions
(Running,
Shutdown,
Failed,
etc.).
You
do
not
use
the
instruction
as
a
client
instruction,
but
instead
as
an
instruction
for
reading
nodes of the own local OPC UA address space. In this regard, special rules and requirements
apply
to
this
application
case.
More
information
You
can
find
more
information
on
calling
the
&quot;OPC_UA_ReadList&quot;
instruction
for
diagnostic
purposes
in
the
TIA
Portal
help,
topic
&quot;Diagnosing
OPC
UA
servers
with
OPC_UA_ReadList&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
337
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Server
state
transition
diagnostics
Information
on
the
server
state
S7-1500
CPUs
as
of
firmware
version
V2.8
are
able
to
create
an
entry
in
the
diagnostic
buffer
upon
state
changes
of
the
OPC
UA
server.
The
diagnostic
buffer
displays
the
new
state.
The
cause
of
the
state
change
is
also
displayed,
such
as
download
to
the
CPU,
POWER
OFF
-
POWER
ON
transition,
user
program
instruction
or
service
request
from
a
partner
(client).
Requirement
The
&quot;Change
of
OPC
UA
server
status&quot;
option
is
selected
(OPC
UA
>
Server
>
Diagnostics)
in
the
OPC
UA
properties
of
the
CPU.
NOTE
If
this
option
is
selected,
the
CPU
also
automatically
enters
the
lowest
set
security
policy
into
the
diagnostic
buffer
after
startup.
Examples
If
the
OPC
UA
server
of
the
CPU
shuts
down
due
to
a
download
process
and
then
starts
with
a
valid new configuration, the diagnostic buffer shows new server state, e.g. Shutdown =>
Starting
=>
Running.
If the OPC UA server shuts down due to a download process and the server cannot start
because
the
type
dictionary
is
too
large,
the
diagnostic
buffer
finally
shows
the
state
&quot;Failed&quot;
(Shutdown
=>
Starting
=>
Failed).
338
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
1
3
R
Z
H
U
R
Q
6
K
X
W
G
R
Z
Q
6
W
D
U
W
i
Q
J
5
X
QQ
i
Q
J
Server
states
and
state
transitions
2
4
)
D
i
O
H
G
3
①,
④
POWER
ON
or
Load
in
RUN,
if
OPC
UA
relevant
data
could
be
affected.
②
Loading
the
hardware
configuration
with
deactivated
OPC
UA
server.
The
server
remains
shut
down.
Loading
the
hardware
configuration
with
activated
OPC
UA
server
and
faulty
OPC
UA
data
(for example, too many structures with the result that the type dictionary becomes too
large).
In
this
case,
the
server
cannot
start
(see
③).
③
OPC
UA
server
cannot
start
due,
for
example,
to
faulty
configuration.
Figure
11-59
Server
states
and
state
transitions
Description
of
the
server
states
The
individual
states
that
the
OPC
UA
server
can
assume
are
explained
below.
Server
states
Explanation
Shutdown
Initial
status
After
POWER ON
After
loading
the
hardware
configuration
with
activated
or
deactivated
OPC
UA
server.
After
loading
OPC
UA
relevant
data
Starting
OPC
UA
address
space
in
server
is
initialized.
Running
OPC
UA
server
running
(normal
productive
state
for
OPC
UA
server).
Failed
Error
state.
OPC
UA
server
cannot
start
due,
for
example,
to
faulty
configura-
tion.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
339
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Session
state
transition
diagnostics
Information
on
the
session
state
S7-1500
CPUs
as
of
firmware
version
V2.8
are
able
to
create
an
entry
in
the
diagnostic
buffer
for
state
changes
of
an
OPC
UA
session.
The
diagnostic
buffer
displays
the
new
state.
The
corresponding
session
ID
is
also
displayed.
Requirement
The
&quot;Change
of
session
states&quot;
option
(OPC
UA
>
Server
>
Diagnostics)
is
selected
in
the
OPC
UA
properties
of
the
CPU.
Example
A client transmits incorrect authentication data (for example, incorrect password) when a
connection
is
established.
The
new
state
of
the
&quot;ActivationFailed&quot;
session
is
entered
with
the
corresponding
session
ID
in
the
diagnostic
buffer.
Subscription
states
and
state
transitions
4
&
U
H
D
W
H
G
1
2
$
F
W
i
Y
D
W
H
G
&
O
R
V
H
G
3
7
i
P
H
G
2
X
W
$
F
W
i
Y
D
W
i
R
Q
)
D
i
O
H
G
①
Client
connects
to
server,
login
with
correct
authentication
data
(correct
credentials).
②
Client
closes
connection
correctly.
③
Client
no
longer
sends
messages;
session
ends
with
timeout.
④
Client connects to server, login with incorrect authentication data.
Figure
11-60
Session
states
and
state
transitions
340
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Check
for
security
events
If
the
CPU
diagnostics
detects
a
security
event
during
the
OPC
UA
communication,
it
can
enter
it
in
the
diagnostic
buffer.
Requirements
S7-1500
CPUs
as
of
firmware
version
2.8
The
&quot;Check
for
security
events&quot;
option
is
activated
(properties
of
the
CPU
>
OPC
UA
>
Server
>
Diagnostics).
Security
events
detected
in
diagnostics
S7-1500
CPUs
perform
diagnostics
on
the
following
OPC
UA
relevant
security
events:
Client-certificate is invalid (for example, syntactically or semantically incorrect, incorrect
signature,
current
date
is
not
in
the
validity
period)
User
name/password
login
failed
(deactivated
or
incorrect
data)
Client
wants
to
use
a
specific
security
policy
or
a
specific
message
security
mode;
the
server
does
not
support
the
security
policy
or
the
requested
security
mode.
Client
does
not
establish
connection
according
to
specification
(OPC
UA
Spec)
(for
example,
unexpected
SecureChannelID/SessionID/client
Nonce)
Example
If
an
attempt
is
made
to
compromise
communications
(for
example,
by
session
hijacking,
man-in-the-middle
attacks
etc.),
the
server
detects
this
via
analysis.
Request
of
a
remote
client
failed
S7-1500
CPUs
as
of
firmware
version
V2.8
are
able
to
create
an
entry
in
the
diagnostic
buffer
for
the
following
events:
Bad
client
requests
(incorrect
use)
Service
error
occurred
CPU-specific
high
limits
of
the
OPC
UA
server
were
violated
Example
of
a
faulty
client
request
For
example,
there
is
an
incorrect
request
when
a
client
addresses
a
node
(tag)
that
does
not
exist
or
if
a
resource
is
requested
that
does
not
exist.
In
this
case,
the
corresponding
service
that
caused
the
fault
is
entered
in
the
diagnostic
buffer
and
the
corresponding
session
ID
is
also
entered.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
341
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Service
fault
If a
service itself
fails, the
server returns
a
ServiceFault.
In this
case, the
status code
(Bad...)
and
the
according
session
ID
are
entered
in
the
diagnostics
buffer.
Example
of
limit
violations
If
a
service
request
exceeds
a
CPU-specific
limit,
for
example,
number
of
sessions,
number
of
monitored
items,
number
of
subscriptions,
etc.,
this
diagnostics
is
entered
in
the
diagnostics
buffer.
Together
with
the
message,
it
is
indicated
which
limit
has
been
violated.
Exception:
If
you
summarize
diagnostics
and
the
message
occurs
frequently,
the
limit
causing
the error is not entered. You receive general information that the supported configuration
limit
has
been
violated.
Possible
entries
for
the
service
that
is
causing
the
error
Depending on the client application used, requests to the server can be triggered differently
from
the
user&apos;s
viewpoint,
for
example,
by
an
online
tool
with
a
graphical
user
interface
or
by
instructions
in
a
client&apos;s
program.
With
its
service-oriented
architecture,
OPC
UA
follows
a
request-response
paradigm,
therefore
the respective client application converts the requests into the service requests defined in
OPC
UA.
The
names
of
these
services
are
defined
and
grouped
according
to
their
use,
see
also
opcfoundation.org.
In
the
case
of
an
incorrect
use,
you
can
find
precisely
these
names
of
the
services,
together
with the corresponding session ID, in the diagnostic buffer as the service that caused the
error.
The
services
available
with
OPC
UA
are
listed
below.
Discovery
Service
Set
FindServers
GetEndpoints
Session
Service
Set
CreateSession
ActivateSession
CloseSession
Cancel
View
Service
Set
Browse
BrowseNext
TranslateBrowsePathsToNodeIds
RegisterNodes
UnregisterNodes
342
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Attribute
Service
Set
Write
Read
Method
Service
Set
Call
Monitored
Item
Service
Set
CreateMonitoredItems
ModifyMonitoredItems
DeleteMonitoredItems
SetMonitoringMode
SetTriggering
Subscription
Service
Set
CreateSubscription
ModifySubscription
DeleteSubscriptions
TransferSubscriptions
Publish
Republish
SetPublishingMode
Subscription
diagnostics
Information
about
a
subscription
S7-1500
CPUs
as
of
firmware
version
V2.8
are
able
to
create
an
entry
in
the
diagnostic
buffer
at
state
changes
of
a
subscription.
The
diagnostic
buffer
displays
the
new
state;
exception:
&quot;KeepAlive&quot;.
Requirement
In
the
OPC
UA
properties
of
the
CPU,
the
option
&quot;Subscriptions:
Change
of
status&quot;
(OPC
UA
>
Server
>
Diagnostics)
is
selected.
Example
An
OPC
UA
client
is
connected
to
an
S7-1500
CPU
as
OPC
UA
server
and
generates
a
subscription
in
the
server.
The
diagnostic
options
for
subscriptions
are
selected
in
the
OPC
UA
properties
of
the
CPU.
The
&quot;Creating&quot;
and
&quot;Normal&quot;
states
are
entered
one
after
the
other
with
the
corresponding
subscription
ID
in
the
diagnostic
buffer.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
343
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
1
Subscription
states
and
state
transitions
3
1
R
U
P
D
O
K
H
H
S
$
O
i
Y
H
/
D
W
H
6
7
i
P
H
G
2
X
W
&
O
R
V
H
G
&
U
H
D
W
i
Q
J
4
2
①
Subscription
is
generated
and
is
then
active.
7
5
②
Status
change
is
not
entered
in
the
diagnostic
buffer
because
too
many
entries
may
be
made
in
the
diagnostic
buffer
depending
on
the
amount
of
data.
③
See
explanation
in
table
for
&quot;Late&quot;;
for
example,
no
requests
to
send
from
client.
④
Maximum
KeepAlive
value
reached.
⑤
See
explanation
in
table
for
&quot;TimedOut&quot;.
⑥
Maximum
lifetime
of
subscription
reached.
⑦
Client
has
deleted
subscription.
Figure
11-61
Subscription
states
and
state
transitions
Description
of
the
subscription
states
A
subscription
in
the
OPC
UA
server
can
have
the
following
states:
Status
Meaning
Creating
Client
has
requested
a
subscription
in
the
server;
the
server
creates
the
subscrip-
tion.
Normal
Subscription
is
created
in
the
server
and
active.
Closed
Client
has
deleted
the
subscription.
KeepAlive
Status
if
the
monitored
items
do
not
change
over
a
long
period
of
time.
These
state
transitions
are
not
entered
in
the
diagnostic
buffer.
Late
Client
has
generated
a
subscription
with
minimal
sampling
and
publishing
inter-
vals. The amount of monitored items is not transmitted to the client during this
time.
Client
no
longer
transmits
requests
to
send
(for
example,
due
to
failure).
TimedOut
The
client
has
requested
a
subscription.
The
server
can
only
honor
the
subscription
(send
Publish
Response)
when
there
is
a
sufficient
number
of
send
requests
(Publish
Requests)
from
the
client.
When
the
client
stops
sending
subscription
requests,
the
subscription
enters
the
&quot;TimedOut&quot;
state
after
a
certain
time.
344
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Subscription:
Error
in
the
sampling
times
As
of
firmware
V2.5
of
the
SIMATIC
S7-1500
CPU,
the
OPC
UA
server
can
transmit
the
status
code &quot;GoodOverload&quot; when using subscriptions, if an overload of the CPU occurs when
sampling
the
items.
As
of
firmware
V2.8
of
the
SIMATIC
S7-1500
CPU,
the
OPC
UA
server
can
also
enter
this
event
into
the
diagnostic
buffer.
Requirement
In
the
OPC
UA
properties
of
the
CPU,
the
option
&quot;Subscriptions:
Sampling
time
errors&quot;
(OPC
UA
>
Server
>
Diagnostics)
is
selected.
Error-free
subscription
In the case of an OPC UA subscription to various elements (such as tags), the OPC UA server
of the SIMATIC S7-1500 must check the elements for value changes at specified intervals
(sampling interval). This check, referred to as &quot;sampling&quot;, requires some time, which depends
on the number and the data type of the items. After the sampling is completed and a
publishing
request
has
been
received,
the
server
sends
the
elements
to
the
client.
W
VDPSOiQJ
W
VDPSOiQJ
W
VDPSOiQJ
6DPSOiQJ
6DPSOiQJ
6DPSOiQJ
1799973
-221552
7iPH
Figure
11-62
Error-free
subscription
Communication
Function
Manual,
11/2024,
A5E03735815-AM
345
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Subscription
with
error
If
there
are
too
many
elements
in
the
queue,
there
may
be
an
overload
of
the
communication
stack. The CPU cannot check all elements in the given sampling interval and must therefore
skip
the
next
sampling
job.
In
this
case,
the
CPU
sends
the
status
code
&quot;GoodOverload&quot;
(0x002F0000)
per
element,
even
though the elements were not checked. The meaning of the status code according to IEC
61131-3
is
as
follows:
&quot;Sampling
has
slowed
down
due
to
resource
limitations&quot;.
W
VDPSOiQJ
W
VDPSOiQJ
W
VDPSOiQJ
1
6DPSOiQJ
6DPSOiQJ
7iPH
①
Sampling job is skipped
Figure
11-63
Subscription
with
error
See
also
FAQ
109763090
(
https://support.industry.siemens.com/cs/ww/en/view/109763090
).
More
information
You
can
find
information
about
the
server
settings
for
subscriptions
in
the
section
Settings
of
the
server
for
subscriptions
(Page
252).
Summarizing
diagnostics
To prevent the diagnostics buffer being &quot;swamped&quot; by large numbers of identical OPC UA
diagnostics,
as
of
STEP
7
V16
service
pack
1,
you
can
set
parameters
so
that
these
diagnostics
are entered in the diagnostics buffer as group alarm. Per interval (monitoring time), the CPU
then
only
generates
one
group
alarm
per
OPC
UA
diagnostics.
The
following
sections
describe
which
diagnostics
the
CPU
groups
together
and
how
the
process
runs
with
a
high
message
volume.
Requirement
The
&quot;Summarize
diagnostics
in
case
of
high
message
volume&quot;
option
is
activated
in
the
OPC
UA
properties
of
the
CPU
(OPC
UA
>
Server
>
Diagnostics,
&quot;Summarize
diagnostics&quot;
area).
346
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.3
Using
the
S7-1500
as
an
OPC
UA
server
Example
An
OPC
UA
client
repeatedly
&quot;overloads&quot;
an
S7-1500
CPU
as
OPC
UA
server
with
a
sampling
rate
that
the
server
cannot
handle
(overload).
The
&quot;Summarize
diagnostics
in
case
of
high
message
volume&quot;
setting
is
activated.
A
message
appears
in
the
diagnostics
buffer
for
this
diagnostic
option.
It
states
that
the
sampling rate cannot be reached; followed by the number of these events within the
configured
interval.
OPC
UA
diagnostics
that
can
be
summarized
The diagnostics listed below each form their own groups (type). Diagnostic events from the
same
group
are
combined
using
the
setting
&quot;Summarize
diagnostics
in
case
of
high
message
volume&quot;:
Incorrect
use
of
an
OPC
UA
service
OPC
UA
Service
error
Subscription
status
has
changed
Sampling
rate
could
not
be
achieved
(subscriptions,
overload)
OPC
UA
security
check
failed
Configuration
limit
of
the
OPC
UA
server
violated
Communication
Function
Manual,
11/2024,
A5E03735815-AM
347
OPC
UA
communication
Using
the
S7-1500
as
an
OPC
UA
server
Principle
of
operation
The
CPU
enters
the
first
three
events
of
an
event
type
in
the
diagnostics
buffer.
It
then
ignores
all
subsequent
diagnostics
of
this
group.
At the end of the monitoring time (interval), the CPU generates a group alarm in which it
enters the diagnostics and the frequency of this diagnostics during the elapsed interval. If
these
diagnostics
also
occur
in
the
intervals
that
follow,
the
CPU
only
generates
one
group
alarm
per
subsequent
interval.
A diagnostic surge leaves the following pattern in the diagnostics buffer: Three individual
messages
followed
by
a
series
of
group
alarms.
This
series
can
consist
of
two,
three
or
more
group alarms depending on the selected monitoring time and duration of the diagnostic
surge.
1
2
3
4
①
Diagnostic
results
of
a
group
(of
a
type),
for
example
&quot;Sampling
rate
could
not
be
reached&quot;.
②
Interval (monitoring time): When a diagnostic event occurs the first time (or reoccurs), the
monitoring
time
is
started
(or
restarted).
③
Single alarms: The first three diagnostic events from the same group are entered in the dia-
gnostics
buffer
immediately.
Starting
with
the
fourth
diagnostic
event,
the
CPU
generates
only
group alarms. If a diagnostic event of this group occurs after a pause of at least one interval,
the
CPU
enters
a
single
alarm
in
the
diagnostics
buffer
and
restarts
the
monitoring
time.
④
Group alarms: After three diagnostic events, the CPU only generates a group alarm as a sum-
mary
of
all
additional
diagnostic
events
in
this
interval.
If
these
diagnostic
events
also
occur
in
the
intervals
that
follow,
the
CPU
only
generates
one
group
alarm
per
subsequent
interval.
Figure
11-64
Summary
of
diagnostics
348
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Overview
and
requirements
With STEP 7 (TIA Portal) Version V15.1 and higher, you can assign parameters and program
an OPC UA client that can read PLC tags in an OPC UA server. Furthermore it is possible to
transfer
new
values
for
PLC
tags
to
an
OPC
UA
server.
In
addition,
you
can
call
methods
that
an
OPC
UA
server
provides
in
your
user
program.
You
use
the
instructions
for
OPC
UA
clients
in
your
user
program
for
this.
The
instructions
of
the
OPC
UA
client
are
based
on
the
standard
&quot;PLCopen
OPC
UA
Client
for
IEC61131-3&quot;.
PLCopen
specification
With
these
standardized
instructions,
you
can
develop
an
OPC
UA
client
functions
in
your
user
program
that
can
be
executed
in
an
S7-1500
CPU.
In
addition,
it
is
possible
with
just
a
few
adaptations
to
run
this
user
program
in
controllers
of
other
manufacturers
if
these
manufacturers
have
also
implemented
the
OPC
UA
Specification
&quot;PLCopen
OPC
UA
client
for
IEC61131-3&quot;.
Convenient
editors
in
STEP
7
For
the
parameter
assignment
of
the
instructions
for
OPC
UA
clients,
a
convenient
editor
is
available
in
the
TIA
Portal
–
the
connection
parameter
assignment
(Page
246).
As of Version 15.1, STEP 7 also features an editor for client interfaces
(Page 355).
This
section
describes
how
you
work
with
these
editors.
First, you will be shown how to create and configure a new interface with the interface
editor,
because
you
need
this
type
of
interface
for
the
subsequent
connection
parameter
assignment.
(Page
354).
The
description
uses
an
example
for
better
comprehensibility,
see
Description
of
the
example
Requirements
You
have
the
required
runtime
license
for
OPC
UA
and
have
configured
the
license
in
STEP
7
(CPU
Properties
>
Runtime
Licenses).
The
client
of
the
S7-1500
CPU
is
activated.
To
use
the
client
of
the
S7-1500
CPU,
you
must
enable
it:
Select
the
area
&quot;OPC
UA
>
Client&quot;
in
the
properties
of
the
CPU.
Select
the
&quot;Enable
OPC
UA
client&quot;
option.
If you do not enable the client, the connection is not established. You receive a
corresponding
error
message
at
the
instructions,
for
example
&quot;OPC_UA_Connect&quot;.
For
information
about
the
application
name,
which
also
applies
to
the
server
and
the
client,
see
here
(Page
246).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
349
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Overview
To
use
the
editor
and
the
connection
parameter
assignment,
follow
these
steps:
First,
specify
a
client
interface.
Add
to
this
the
PLC
tags
and
PLC
methods
interface
that
you
want
to
access
(&quot;First
step
(Page
355)&quot;).
Next,
configure
the
connection
to
the
OPC
UA
server
(Second
step
(Page
370)).
(Page
Finally,
use
the
configured
connection
for
the
OPC
UA
client
instructions
(Third
step
377)).
Useful
information
about
the
client
instructions
With
the
standardized
OPC
UA
client
instructions
you
are
able
to
control
communication
for
the
following
tasks
with
the
S7-1500
CPU
as
an
OPC
UA
client:
Read/write
tags
of
the
OPC
UA
server
Call
methods
in
the
OPC
UA
server
Optional
instructions
can
be
used
to
determine
the
following
information:
The
status
of
the
connection
between
the
OPC
UA
client
and
OPC
UA
server
Node
IDs
of
nodes
with
known
hierarchy
of
the
address
space
Standardized
sequence
of
OPC
UA
communication
1
2
3
&
B
8
$
B
:
U
i
W
H
/
i
V
W
2
3
&
B
8
$
B
5
H
D
G
/
i
V
W
2
3
&
B
8
$
B
1
D
P
H
V
S
D
F
H
*
H
W
l
Q
G
H
[
/
i
V
W
2
3
&
B
8
$
B
&
R
Q
Q
H
F
W
2
3
&
B
8
$
B
1
R
G
H
*
H
W
+
D
Q
G
O
H
/
i
V
W
The
sequence
of
the
communication,
and
thus
the
order
of
the
instructions,
follows
a
pattern
that
is
illustrated
in
the
following.
2
3
2
3
&
B
8
$
B
D
i
V
F
R
Q
Q
H
F
W
2
3
&
B
8
$
B
1
R
G
H
5
H
O
H
D
V
H
+
D
Q
G
O
H
/
i
V
W
①
Instructions
for
preparation
of
read
and
write
operations
②
Read
and
write
instructions
③
Instructions
for
&quot;clean-up&quot;
after
a
completed
read
or
write
operation
Figure
11-65
Run
sequence
for
a
read
or
write
operation
350
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
2
3
2
3
&
B
8
$
B
D
i
V
F
R
Q
Q
H
F
W
2
3
&
B
8
$
B
0
H
W
K
R
G
5
H
O
H
D
V
H
+
D
Q
G
O
H
/
i
V
W
①
Instructions
for
preparation
of
method
calls
1
2
3
&
B
8
$
B
&
R
Q
Q
H
F
W
2
3
&
B
8
$
B
1
D
P
H
V
S
D
F
H
*
H
W
l
Q
G
H
[
/
i
V
W
2
3
&
B
8
$
B
0
H
W
K
R
G
&
D
OO
2
3
&
B
8
$
B
0
H
W
K
R
G
*
H
W
+
D
Q
G
O
H
/
i
V
W
②
Method
calls
③
Instructions for &quot;clean-up&quot; after completed method calls
Figure
11-66
Run
sequence
for
a
method
call
in
the
OPC
UA
server
Optional
instructions
(reading
out
the
status
of
a
connection
/
reading
out
node
IDs
of
nodes
with
known
hierarchy
of
the
address
space)
OPC_UA_ConnectionGetStatus
OPC_UA_TranslatePathList
1
2
3
2
3
&
B
8
$
B
:
U
i
W
H
/
i
V
W
2
3
&
B
8
$
B
5
H
D
G
/
i
V
W
2
3
&
B
8
$
B
1
R
G
H
*
H
W
+
D
Q
G
O
H
/
i
V
W
2
3
&
B
8
$
B
7
U
D
Q
V
O
D
W
i
R
Q
3D
W
K
/
i
V
W
2
3
&
B
8
$
B
1
D
P
H
V
S
D
F
H
*
H
W
l
Q
G
H
[
/
i
V
W
2
3
&
B
8
$
B
&
R
Q
Q
H
F
W
2
3
&
B
8
$
B
1
R
G
H
5
H
O
H
D
V
H
+
D
Q
G
O
H
/
i
V
W
2
3
&
B
8
$
B
D
i
V
F
R
Q
Q
H
F
W
2
3
&
B
8
$
B
&
R
Q
Q
H
F
W
i
R
Q
*
H
W
6
W
D
W
X
V
①
Instructions
for
preparation
of
read
and
write
operations
with
inserted
instruction
for
request-
ing,
for
example,
the
NodeIDs
of
nodes
of
the
OPC
UA
server.
②
You
can
determine
the
connection
status
between
the
establishment
and
termination
of
the
connection
in
parallel
with
other
instructions.
③
Instructions
for
&quot;clean-up&quot;
Figure
11-67
Run
sequence
of
optional
instructions
Convenient
editors
in
STEP
7
The OPC UA client instructions are described in detail in the reference part (STEP 7
information system). For parameter assignment of the instructions, a convenient editor is
available
in
the
TIA
Portal
–
the
connection
parameter
assignment
(Page
370).
We
recommend
starting
with
the
connection
parameter
assignment
for
the
first
program
draft
and
using
additional
instructions
and
manually
optimizing
the
program
as
required.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
351
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Information
about
the
client
instructions
The
client
instructions
are
described
in
detail
in
the
help
to
the
Instructions
>
Communication
>
OPC
UA
>
OPC
UA
client.
Application
example
in
Online
Support
This
application
example (
https://support.industry.siemens.com/cs/ww/en/view/109762770
)
provides you with an S7 user block &quot;OpcUaClient&quot; that summarizes the most important
functions of the OPC UA instructions, accelerates the implementation for you and simplifies
the programming. The OPC UA server in the example is an S7-1500 controller with a simple
simulation
program
for
process
values.
The
S7
user
block
performs
the
following:
Establishment
and
termination
of
the
connection
to
the
server
Diagnostics
of
the
connection
and
automatic
reconnection
after
connection
terminations
Registered
Read
Registered
Write
Registered
Method
Call
Number
of
client
instructions
that
can
be
used
simultaneously
SIMATIC
error
codes
for
OPC
UA
client
instructions
The
following
limits
apply
to
the
simultaneous
use
of
OPC
UA
client
instructions
(up-to-date
technical
specifications
of
the
CPUs
can
be
found
on
the
Internet
(
https://support.industry.siemens.com/cs/ww/en/ps/td
)):
Table
11-4
Quantity
structures
for
OPC
UA
client
instructions
OPC
UA
instruction
Maximum
number for
CPU
1510SP
(F)
CPU 1511
(C/F/T/TF)
CPU
1512C
CPU
1512SP
(F)
CPU
1513
(F)
Maximum
number for
CPU
1505
(S/SP/SP
F/SP
T/SP
TF)
CPU
1515
(F/T/TF)
CPU 1515 SP PC (F/T/TF)
CPU
1516
(F/T/TF)
Maximum
number for
CPU
1507S
(F)
CPU
1517
(F/T/TF)
CPU
1518
(F)
OPC_UA_Connect
4
10
40
OPC_UA_NamespaceGetIndexL-
ist
4*
10*
40*
OPC_UA_NodeGetHandleList
4*
10*
40*
OPC_UA_MethodGetHandleList
4*
10*
40*
OPC_UA_TranslatePathList
4*
10*
40*
OPC_UA_ReadList
20 in total (max. 5 per con-
nection, see
OPC_UA_Connect)
50 in total (max. 5 per con-
nection, see
OPC_UA_Connect)
200 in total (max. 5 per connec-
tion,
see
OPC_UA_Connect)
OPC_UA_WriteList
20 in total (max. 5 per con-
nection, see
OPC_UA_Connect)
50 in total (max. 5 per con-
nection, see
OPC_UA_Connect)
200 in total (max. 5 per connec-
tion,
see
OPC_UA_Connect)
* maximum
1
per
connection
352
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
OPC
UA
instruction
Maximum
number for
CPU
1510SP
(F)
CPU 1511
(C/F/T/TF)
CPU
1512C
CPU
1512SP
(F)
CPU
1513
(F)
Maximum
number for
CPU
1505
(S/SP/SP
F/SP
T/SP
TF)
CPU
1515
(F/T/TF)
CPU 1515 SP PC (F/T/TF)
CPU
1516
(F/T/TF)
Maximum
number for
CPU
1507S
(F)
CPU
1517
(F/T/TF)
CPU
1518
(F)
OPC_UA_MethodCall
20 in total (max. 5 per con-
nection, see
OPC_UA_Connect)
50 in total (max. 5 per con-
nection, see
OPC_UA_Connect)
200 in total (max. 5 per connec-
tion,
see
OPC_UA_Connect)
OPC_UA_NodeReleaseHandleList
4*
10*
40*
OPC_UA_MethodRelease-
HandleList
4*
10*
40*
OPC_UA_Disconnect
4*
10*
40*
OPC_UA_ConnectionGetStatus
4*
10*
40*
* maximum
1
per
connection
Maximum
number
of
usable
OPC
UA
client
interfaces
If
you
create
OPC
UA
client
interfaces
using
the
connection
parameter
assignment,
the
number
of
client
interfaces
is
limited
to
40.
Create
the
OPC
UA
client
interfaces
by
double-clicking
the
&quot;Add
new
client
interface&quot;
symbol
in
the
project
tree
of
the
&quot;OPC
UA
communication&quot;
area.
The
maximum
number
of
OPC
UA
client
interfaces
is
independent
of
whether
you
also
use
the
CPU
as
OPC
UA
server.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
353
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Example
configuration
for
OPC
UA
The
following
sections
describe
how
you
can
use
the
client
interfaces
editor
and
the
connection
parameter
assignment.
The
description
is
based
on
a
specific
example:
Two
S7-1500
CPUs
operate
in
the
system:
One
CPU
serves
as
the
OPC
UA
client
and
the
other
as
the
OPC
UA
server.
You
can,
of
course,
also
use
controllers,
sensors
and
IT
systems
of
other
manufacturers
as
OPC UA clients or servers. In particular, the data exchange between different systems
(interoperability)
is
a
major
advantage
of
OPC
UA.
Connection
parameter
assignment
using
an
example:
The
plant
produces
blanks
in
a
production
line.
The
following
controllers
are
used:
An
S7-1511
CPU
serves
as
the
controller
of
the
production
line.
The
controller
is
named
&quot;
Productionline
&quot;
in
the
example.
The
OPC
UA
server
of
the
controller
is
enabled.
The
CPU has
the IP address
192.168.1.1
in
the example.
This
CPU
publishes
the
values
of
following
tags
via
the
OPC
UA
server:
NewProduct
The
tag
has
the
data
type
&quot;BOOL&quot;.
When
this
PLC
tag
has
the
value
TRUE,
the
production
line
has
processed
a
blank.
The
blank
is
ready
for
pick-up.
ProductNumber
This
tag
contains
the
identification
number
of
the
blank.
The
tag
has
the
data
type
&quot;Int&quot;.
Temperature
This
tag
contains
temperature
values
recorded
during
the
production
of
the
blank.
The
tag
is
an
array
with
elements
of
the
&quot;Real&quot;
data
type.
In
addition,
this
CPU
provides
the
following
writable
tag:
ProductionEnabled
The
tag
is
set
by
the
OPC
UA
client.
The
tag
has
the
data
type
&quot;BOOL&quot;.
If
the
value
is
set
to
TRUE,
the
production
line
is
released
and
may
produce
blanks.
In
addition,
this
CPU
provides
the
following
method
via
the
OPC
UA
server:
OpenDoor
OPC
UA
clients
can
hereby
arrange
for
an
access
door
to
be
opened
to
the
production
line.
354
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
An
S7-1516
CPU
controls
the
interaction
with
other
production
lines.
This
CPU
is
named
&quot;
Supervisor
&quot;
in
the
example.
The
OPC
UA
client
of
this
CPU
is
enabled.
Using
OPC
UA,
this
CPU
can
read
the
NewProduct
and
ProductNumber
tags,
set
the
ProductionEnabled
tag
and
call
the
OpenDoor
method.
The
CPU has
the IP address
192.168.1.2
in
the example.
The
following
figure
shows
the
example
in
the
network
view
of
the
TIA
Portal:
1799970
126303
Figure
11-68
Example
of
assigning
connection
parameters
in
the
network
view
Creating
client
interfaces
As
of
Version
15.1,
the
TIA
Portal
has
an
editor
for
client
interfaces.
You
group
all
PLC
tags
that
you
want
to
read
or
write
from
an
OPC
UA
server
in
a
client
interface.
In
addition,
the
client
interface
contains
all
methods
that
the
OPC
UA
server
provides
and
that
you
want
to
call
with
your
user
program
(that
acts
as
an
OPC
UA
client).
If
you
create
a
client
interface,
STEP
7
also
creates
data
blocks
for
the
parameter
assignment
of the connection to the OPC UA server from which you want to read data or to which you
want
to
write
data.
Maximum
number
of
client
interfaces
You can
create a maximum
of
40 client interfaces.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
355
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Editor
for
client
interfaces
To
create
a
client
interface,
follow
these
steps:
Select
the
project
view
in
the
TIA
Portal.
In
the
&quot;Devices&quot;
area,
select
the
CPU
you
want
to
use
as
an
OPC
UA
client.
Click
&quot;OPC
UA
communication
>
Client
interfaces&quot;.
Double-click
&quot;Add
new
client
interface&quot;.
STEP
7
creates
a
new
client
interface
and
display
in
the
editor.
723645
150279
Figure
11-69
Adding
OPC
UA
client
interface
STEP 7 names the new interface &quot;Client interface_1&quot;. If a &quot;Client interface_1&quot; already exists,
the
new
interface
receives
the
designation
&quot;Client
interface_2&quot;
etc.
In
addition,
STEP
7
creates
the
following
data
blocks:
–    Client_Interface_1_Configuration
The
data
block
already
contains
all
system
data
types
that
are
needed
for
the
instructions
of
the
OPC
UA
client.
This
data
block
is
filled
when
you
configure
the
connection
to
the
OPC
UA
server.
You configure a connection in the properties of the client interface, see: Example
configuration
for
OPC
UA
(Page
354).
–
Client_Interface_1_Data
A
data
block
for
the
PLC
tags
that
you
want
to
read
or
write
from
an
OPC
UA
server
as
well
as
for
methods
that
you
want
to
call
in
the
OPC
UA
server.
You
use
this
data
block
in
your
user
program.
This
data
block
is
currently
still
empty.
Select a descriptive name for the new client interface.
Select
&quot;Productionline&quot;
in
the
example.
This
also
changes
the
names
of
the
associated
data
blocks
to:
Productionline_Data
Productionline_Configuration
356
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
To
import
an
OPC
UA
server
interface,
click
the
&quot;Import
interface&quot;
button
in
the
top
right
of
the
editor.
This
allows
you
to
import
an
XML
file
which
describes
the
server
interface
of
an
OPC
UA
server.
Alternative:
To
determine
online
the
server
interface
of
a
connected
OPC
UA
server,
see:
Determine
server
interface
online
(Page
363).
STEP
7
displays
a
dialog
with
which
you
can
select
an
XML
file.
This
XML
file
describes
a
address
space
of
an
OPC
UA
server.
The
address
space
of
an
OPC
UA
server
contains
all
PLC
tags
and
server
methods
published
by
an
OPC
UA
server.
OPC
UA
clients
can
access
this
address
space:
Read
PLC
tags
Write
PLC
tags
Calling
Server
Methods
(Page
278).
The
address
space
of
an
OPC
UA
server
can
be
divided
into
one
or
more
server
interfaces.
For
creating
server
interfaces,
see:
Creating
a
server
interface
for
companion
specification
Create
a
read
list
in
this
client
interface.
To
do
this,
follow
these
steps:
Click
&quot;Add
new
read
list&quot;
in
the
left
section
of
the
editor.
STEP
7
adds
a
new
list
named
&quot;ReadList_1&quot;.
For
the
example,
change
the
name
to
&quot;ReadListProduct&quot;
Now
add
the
new
read
list
of
the
PLC
tags
that
you
want
to
read
from
the
OPC
UA
server.
In
the
example
the
&quot;NewProduct&quot;
and
&quot;ProductNumber&quot;
tags
are
added
to
the
&quot;ReadListProduct&quot;
read
list.
Select the &quot;NewProduct&quot; tag in the right-hand field of the editor (&quot;OPC UA Server
interface&quot;).
Drag
the
&quot;NewProduct&quot;
tag
to
the
&quot;ReadProduct&quot;
read
list
in
the
middle
field
of
the
editor.
Follow
the
same
procedure
with
the
&quot;ProductNumber&quot;
tag.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
357
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
The
figure
below
shows
the
right
field
of
the
editor.
1799970
127660
Figure
11-70
Read
list
in
the
OPC
UA
server
interface
Alternative:
You
can
also
select
a
new
read
list
by
dragging
the
right
field
of
the
editor
(&quot;OPC
UA
Server
interface&quot;) to a node of the type Object or Folder and then dragging it to &quot;Add new read
list&quot; in the left field of the editor. The new read list then contains all PLC tags of the node
that
has
been
moved.
In the example, select the object &quot;Data_for_OPC_UA_Clients&quot;, which contains the tags
&quot;NewProduct&quot; and &quot;ProductNumber&quot;. STEP 7 generates the new read list
&quot;Data_for_OPC_UA_Clients&quot;.
In
addition,
the
object
contains
the
tag
&quot;Temperature&quot;.
Delete
the
&quot;Temperature&quot;
tag
from
the
read
list.
Since
they
should
not
be
read
in
the
example.
Change the name of the read list in &quot;ReadListProduct&quot;.
The
following
figure
shows
the
content
of
the
read
list:
1799970
89020
Figure
11-71
Read
list
NOTE
Read
and
write
lists
do
not
support
all
node
types.
The
OPC
UA
client
of
the
S7-1500
CPU
does
not
support
all
OPC
UA
data
types
(node
types) that can be made available via an OPC UA server interface. If you place an
unsupported node type, for example, in a read list or write list a corresponding error
signal
appears.
In
this
case,
you
cannot
include
the
corresponding
node
in
the
read
or
write
list.
(Page
225)
Which
types
are
supported
is
described
here:
Mapping
of
data
types
358
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
If
you
want
assign
new
values
to
PLC
tags,
create
a
write
list
in
this
client
interface.
To
do
this,
follow
these
steps:
Click
&quot;Add
new
write
list&quot;
in
the
left
section
of
the
editor.
STEP
7
adds
a
new
list
with
the
name
&quot;ReadList_1&quot;.
For
the
example,
change
the
name
to
&quot;WriteListStatus&quot;.
Now
add
the
new
write
list
of
all
OPC
UA
server
tags
to
which
you
want
to
assign
new
values.
In
the
example,
add
the
&quot;WriteListStatus&quot;
tag
to
the
write
list
&quot;ProductionEnabled&quot;.
Select
the
Tag
of
right
field
of
the
editor
(&quot;OPC
UA
Server
interface&quot;).
Drag
the
tag
to
the
write
list
in
the
middle
field
of
the
editor.
Alternative:
You
can
also
create
a
new
write
list
by
selecting
a
node
of
the
type
Object
or
Folder
in
the
right field of the editor (&quot;OPC UA server interface&quot;) and then dragging to &quot;Add new write
list&quot;
in
the
left
field
of
the
editor.
The
new
write
list
then
contains
all
tags
of
the
relevant
node.
In the example, select the object &quot;Data_from_OPC_UA_Clients&quot;, which contains the tag
&quot;ProductionEnabled&quot;.
STEP
7
generates
the
new
write
list
&quot;Data_from_OPC_UA_Clients&quot;.
Change
the
name
in
&quot;WriteListStatus&quot;.
The
following
figure
shows
the
content
of
the
write list:
1980057
124928
Figure
11-72
Write
list
If
you
want
to
call
a
method
of
this
OPC
UA
server,
generate
a
new
method
list.
To
do
this,
follow
these
steps:
In
the
left
section
of
the
editor,
click
&quot;Add
new
method
list&quot;.
STEP
7
adds
a
new
list
with
the
name
&quot;Method
list_1&quot;.
For
the
example,
change
the
name
to
&quot;MethodListOpenDoor&quot;.
Now
add
a
method
of
the
OPC
UA
server
to
the
new
method
list.
In
this
example,
add
the
method
&quot;OpenDoor&quot;
to
the
method
list
&quot;MethodListOpenDoor&quot;.
Select
the
method
of
right
field
of
the
editor
(&quot;OPC
UA
Server
interface&quot;).
Drag
the
method
to
the
method
list
in
the
middle
field
of
the
editor.
Alternative:
You
can
also
generate
a
new
method
list
by
selecting
a
method
(node
of
the
type
Object)
in
the
right
field
of
the
editor
(OPC
UA
Server
interface)
and
then
dragging
it
to
&quot;Add
new
method list&quot; in the left field of the editor. The new method list then contains the method
of
the
relevant
node.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
359
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
The
following
figure
shows
the
content
of
the
method
list:
1816100
124485
Figure
11-73
Methods
list
See
also
Useful
information
about
server
methods
(Page
307).
Compile
the
project.
To
do
so,
select
the
project
and
click
the
following
button
in
the
toolbar:
1805177
124834
STEP
7
compiles
the
project
and
updates
the
data
blocks
that
belong
to
the
&quot;Productionline&quot;
client
interface.
NOTE
During compilation, STEP 7 overwrites all data in the data blocks belonging to the client
interface.
For
this
reason,
you
should
neither
add
to
nor
correct
these
data
blocks
manually.
NOTE
Renaming
nod
names
(DisplayNames)
In
read
lists,
write
lists
and
method
lists
you
can
rename
the
name
of
a
node
by
means
of
the
shortcut
menu.
This
is
the
&quot;DisplayName&quot;
in
the
OPC
UA
language
usage.
If
you
rename
the
name
of
a
method
list
node
and
the
node
is
already
used
in
a
programmed
block for the method call &quot;OPC_UA_MethodCall&quot;, the compilation of the project leads to
consistency errors: During the compilation the UDTs of the method are generated with the
changed name. The references to the method used in the program are then no longer
correct.
To
correct
the
consistency
errors,
you
can
either
undo
the
name
change
of
the
method
in
the
client
interface
or
navigate
to
the
method
call
and
assign
the
relevant
parameters
again
there
under
&quot;Properties
>
Block
parameters&quot;
(&quot;Configuration&quot;
tab).
Data
blocks
of
client
interface
The
following
data
blocks
belong
to
the
&quot;Productionline&quot;
client
interface:
Productionline_Configuration
A
data
block
for
the
configuration.
In
the
example,
this
data
block
is
called
&quot;Productionline_Configuration&quot;.
The
data
block
already
contains
all
system
data
types
that
are
needed
for
the
instructions
of
the
OPC
UA
client.
In
addition,
the
data
block
contains
general
default
values
for
parameter
assignment
of
the
connection
to
an
OPC
UA
server.
If
you
are
working
with
connection
parameter
assignment,
this
data
block
will
be
filled.
360
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
ProductionLine_Data
A
data
block
for
the
PLC
tags
that
you
have
entered
in
the
client
interface
editor.
In
the
example,
this
data
block
is
called
&quot;Productionline_Data&quot;.
The
figure
below
shows
the
data
block.
1981326
125188
Figure
11-74
&quot;Productionline_Data&quot;
data
block
Use
the
&quot;Productionline_Data&quot;
data
block
in
your
user
program
and
access
the
read
values
of the &quot;NewProduct&quot; and &quot;ProductNumber&quot; PLC tags. This is explained in the following
section
using
an
example.
Reading
and
writing
PLC
tags
of
the
client
interface
Example:
Reading
the
&quot;ProductNumber&quot;
value
For
example,
you
write
in
an
SCL
program:
#MyLocalVariable :=
&quot;Productionline_Data&quot;.ReadListProduct.Variable.ProductNumber;
You
use
this,
for
example,
to
assign
the
number
of
the
blank
that
was
just
produced
in
the
production
line
to
the
local
tag
&quot;#MyLocalVariable&quot;.
Requirements:
A
connection
exists
to
the
OPC
UA
server
of
the
CPU,
which
controls
the
production
line.
The
OPC
UA
client
has
read
the
current
values.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
361
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
For
this
reason
you
check
whether
a
read
value
is
valid:
Check
whether
the
value
in
&quot;Productionline_Data&quot;.ReadListProduct.NodeStatusList[1]
is
equal
to
0.
Optional:
Check
when
this
value
was
sent
from
the
OPC
UA
server.
This
value
is
in
&quot;Productionline_Data&quot;.Product.TimeStamps[1]. If no time stamp is requested, the
communication
load
is
reduced.
Example:
Writing
the
&quot;ProductEnabled&quot;
value
Transfer
the
new
values
for
PLC
tags,
in
the
example
for
the
&quot;ProductionEnabled&quot;
tag,
to
the
OPC
UA
server
using
the
data
block.
With
the
following
assignment,
you
enable
the
production
line
in
the
example
plant:
&quot;Productionline_Data&quot;.WriteListStatus.Variable.ProductionEnabled
:=
TRUE;
This
is only
successful,
however, if the
following
requirements are met:
A
connection
exists
to
the
OPC
UA
server
of
the
CPU,
which
controls
the
production
line.
Current
values
are
being
written
via
the
OPC
UA
client
Consistency
check
Finally,
check
the
consistency
of
the
read/write
list
or
method
list.
Select
the
list
that
you
want
to
check.
Click
the
&quot;Consistency
check&quot;
button
above
the
&quot;OPC
UA
client
interface&quot;
area.
A
green
check
mark
indicates
an
error-free
assignment
of
the
tags
or
methods
to
the
corresponding
elements
of
the
server
interface.
1625091
128118
You
can
assume
that
the
data
exchange
between
client
and
server
and
method
calls
operate
without
problem
in
runtime.
In
the
event
of
an
error
a
list
appears
in
the
Inspector
window.
From
this
list
you
can
jump
to
the
respective
error.
During
the
consistency
check,
STEP
7
checks:
Whether
all
elements
that
you
use
in
the
respective
list
are
also
present
in
the
server.
Do
the
data
types
used
match?
For
methods:
Do
the
number,
name,
order,
and
data
types
of
method
arguments
match?
362
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Determine
server
interface
online
With STEP 7 (TIA Portal) you can determine the interface of an OPC UA server online. This
provides
information
on
which
tags
of
a
connected
OPC
UA
server
you
can
read
or
set
(write)
with OPC UA clients. It also provides information on which server methods of the OPC UA
server
are
available
for
OPC
UA
clients.
If
you
are
work
offline
you
can
create
the
interface
of
the
OPC
UA
server
by
means
of
an
OPC
UA
XML
file.
The
address
space
of
the
server
is
described
in
the
OPC
UA
XML
file,
see:
Export
OPC
UA
XML
file
(Page
244).
Determine
online
server
interfaces
To
determine
a
server
interface
online,
follow
these
steps:
In
the
STEP
7
project
tree,
select
the
CPU
which
is
configured
as
OPC
UA
client
(Supervisor
in
the
example).
Select
the
client
interface
(in
the
example,
OPC
UA
Communication
>
Client
interfaces
>
Productionline).
If
no
client
interface
has
been
created,
double-click
&quot;Add
new
client
interface&quot;.
Double-click the selected client interface.
The
editor
for
client
interfaces
is
displayed.
903605
113398
Figure
11-75
Editor
for
client
interface
In
the
left
section
of
the
editor,
click
&quot;Add
new
read
list&quot;,
&quot;Add
new
write
list&quot;,
or
&quot;Add
new
method
list&quot;.
In
the
right
field
of
the
editor,
select
&quot;Online[]&quot;
as
data
source
for
&quot;Source
of
server
data&quot;:
2031110
124550
Communication
Function
Manual,
11/2024,
A5E03735815-AM
363
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Click
the
&quot;Online
Access&quot;
button.
STEP
7
displays
the
&quot;Connect
to
OPC
UA
server&quot;
dialog.
723900
150002
Figure
11-76
&quot;Connect
to
OPC
UA
server&quot;
dialog
Tip:
When
establishing
an
online
connection
to
an
OPC
UA
server
for
the
first
time,
use
the
&quot;Online access&quot; button. When reconnecting after a disconnection, select the &quot;Connect to
Online
Server&quot;
button
next
to
the
&quot;Online&quot;
selection
field.
In
the
top
right,
enter
the
IP
address
of
the
OPC
UA
server
whose
server
interface
you
want
to
determine
online.
Click
&quot;Find
selected
server&quot;.
STEP
7
establishes
a
connection
to
the
OPC
UA
server
and
determines
all
security
settings
(server
endpoints)
that
the
server
holds
in
readiness.
STEP
7
displays
the
end
points
as
list:
1802510
124749
Figure
11-77
Found
OPC
UA
server
with
all
server
endpoints
Click
on
the
end
point
you
want
to
use
for
a
connection
of
STEP
7
to
the
OPC
UA
server.
364
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Do
you
want
to
use
a
secure
connection?
If
you
have
selected
a
secure
end
point,
then
select
the
entry
&quot;TIA
Portal&quot;
for
the
&quot;Certificate
location&quot;.
And
under
&quot;Certificate
(Client)&quot;,
select
a
client
certificate
for
your
PC
on
which
STEP
7
(TIA
Portal)
is
currently
running.
If
a
client
certificate
does
not
yet
exist
for
your
PC,
you
can
generate
a
client
certificate
here
in
the
TIA
Portal.
Proceed
as
follows
to
generate
a
certificate
for
your
PC:
Click
on
the
button
in
the
&quot;Certificate
(Client)&quot;
input
field.
Click
&quot;Add&quot;.
For
&quot;Certificate
owners&quot;
enter
&quot;STEP
7
(TIA
Portal)&quot;.
Select
the
&quot;OPC
UA
client&quot;
entry
at
&quot;Usage&quot;.
For &quot;Subject Alternative Name (SAN)&quot;, enter the IP address of your PC, on which you
are
currently
running
STEP
7
(TIA
Portal),
under
&quot;Value&quot;.
Overwrite
the
already
entered
IP
address.
If
your
PC
uses
a
second
IP
address,
enter
this
address
as
well.
If
your
PC
does
not
use
a
second
IP
address,
delete
the
second
IP
address
already
entered.
Click &quot;OK&quot;.
If
you
have
not
selected
a
secure
end
point,
then
keep
the
default
(&quot;None&quot;).
How
do
you
want
log
on?
If
you
want
to
log
onto
the
OPC
UA
server
as
guest,
then
apply
the
default
with
&quot;User
authentication&quot;.
If
you
want
to
log
on
with
user
name
and
password,
select
&quot;User
name
and
password&quot;.
Use
the
user
name
and
password
which
was
stored
during
the
configuration
of
the
OPC UA server in the properties of the CPU under &quot;General > OPC UA > Server >
Security
>
User
authentication
>
User
management&quot;.
Click
on
the
&quot;Go
online&quot;
button.
When a secure connection is established, a message appears that you must accept the
server
certificate
for
the
secure
connection
to
be
established.
In
the
message
window,
you
can
display
further
details
about
the
server
certificate
via
a
link.
This standard Windows window only provides information about the server certificate. If
you
click
on
the
button
to
install
the
server
certificate,
the
server
certificate
is
not
saved
to
the certificate memory of the TIA Portal, i.e. at the next connection attempt you will be
prompted
again
to
accept
the
server
certificate.
STEP
7
then
establishes
a
connection
to
the
OPC
UA
server
and
again
displays
the
editor
for
client
interfaces.
In
the
right
field
of
the
editor,
STEP
7
displays
the
uppermost
level
of
the
address
space
of
the
OPC
UA
server:
1987531
137332
Click
on
the
small
black
triangle
next
to
&quot;Objects&quot;.
STEP
7
now
also
displays
the
level
below
Objects.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
365
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Click
on
the
small
black
triangle
next
to
&quot;Productionline&quot;.
STEP
7
now
also
displays
the
level
below
Productionline.
Now
open
additional
lower-level
folders:
1799970
127738
Figure
11-78
Online
view
of
OPC
UA
server
interface
More
information
(Page
225).
You
can
find
information
about
mapping
of
data
types
in
the
section
Mapping
of
data
types
For
information
on
how
to
create
a
client
interface,
refer
to
the
section
Creating
client
interfaces
(Page
355).
Using
multilingual
texts
In the client interface editor, you are also importing texts that can be displayed in different
languages
with
the
OPC
UA
XML
files
(information
models).
Multilingualism
is
optional,
and
each
node
can
be
defined
differently
regarding
the
languages
it
offers.
In
the
XML
file,
these
are
the
following
fields
that
can
be
prepared
for
different
languages:
Display
name
Description
Example
for
multilingual
texts
in
an
OPC
UA
XML
file
In the XML file below, the display name and the description, for example, are entered with a
&quot;default&quot;
text
and
multiple
localizable
texts.
Default
text
is the
first
entry
without localization information.
Localized
text
is
the
text
after
&quot;Locale=&quot;
followed
by
a
language
code,
e.g.
&quot;it-IT&quot;
for
Italian
366
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
728091
127347
Figure
11-79
Example
of
multilingual
texts
in
an
OPC
UA
XML
file
Display
of
multilingual
texts
When importing a server interface, the available multilingual texts are saved internally and
downloaded
to
a
CPU
together
with
the
project.
The
client
editor
displays
the
text
from
the
OPC
UA
XML
file
in
the
columns
&quot;Name
of
the
node&quot;
(corresponds
to
&quot;DisplayName&quot;)
and
&quot;Description&quot;
(corresponds
to
&quot;Description&quot;).
The
following
cascading
rules
determine
which
language
is
shown
for
a
node:
When
the
node
contains
text
in
the
currently
used
editing
language,
the
text
is
also
displayed
in
the
editing
language.
(Setting
the
editing
language:
In
the
project
tree,
select
the
area
&quot;Languages
&
resources
>
Project
languages&quot;)
When
the
node
does
not
contain
text
in
the
editing
language
but
a
default
text
is
defined
there
(without
language
code),
the
default
text
is
displayed.
&quot;Name of the node&quot; column: If no default text is defined either but a text in any other
language
exists,
the
DisplayName
text
is
displayed
in
the
first
available
language.
This
rule
does
not
apply
to
description
texts.
If
none
of
the
conditions
listed
above
is
met,
no
text
is
displayed.
1799970
148721
Figure
11-80
Display
for
multilingual
texts
When
you
change
the
editing
language,
the
multilingual
text
in
the
imported
interface
will
also
change
according
to
the
rules
explained
above.
You can then apply the nodes in the corresponding lists (read list, write list, method list) with
drag
and
drop.
You cannot
change
the language in
the
lists (read list, write list,
method list).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
367
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Applying
the
displayed
description
texts
as
comment
in
PLC
data
types
When
you
compile
the
program,
STEP
7
automatically
creates
PLC
data
types
(UDTs)
for
each
read list, for each write list and for inputs or outputs of each method. These UDTs each have
one
element
for
each
node.
The
UDTs
apply
the
description
text
as
comment
according
to
the
rules
stated
above.
STEP
7
creates
the
comment
in
only
one
language,
just
like
the
texts
in
the
OPC
UA
server
interface
can
only
be
displayed
in
one
language.
Rules
for
the
access
to
structures
The
rules
for
the
access
to
structures
are
explained
below.
Note
these
rules
when
reading
and
writing
values
of
complete
structures
provided
by
an
OPC
UA
server.
How
the
client
of
the
S7-1500
CPU
accesses
structures
The
OPC
UA
client
of
the
S7-1500
CPU
uses
neither
TypeDictionaries
nor
DataTypeDefinition
attributes,
which
a
server
offers
for
the
resolution
of
these
structures.
These
options
of
the
OPC
UA
client
for
checking
structural
elements
in
runtime
are
limited
in
the
client.
Rules
for
the
access
to
structures
If you use the client interfaces to configure the read and write lists (connection
parameterization) and assign the PLC data types to the imported or online determined
address
model
of
the
server,
the
read
and
write
accesses
to
structures
operate
trouble-free
in
runtime.
The
configuration
by
means
of
client
interface
automatically
ensures
that
the
sequence
and
the
data
type
of
the
structural
elements
are
coordinated
on
client
and
server
side.
Recommendation: Update an S7-1500 CPU (as server) to the current firmware version (e.g.
V2.0
>
V2.5.2
or
higher).
In
runtime
the
OPC
UA
client
only
checks
the
total
length
of
the
transmitted
value;
more
detailed
checks
are
not
possible.
Strings
(WSTRING,
STRING
and
OPC
UA
ByteString)
are
also
permitted
in
structures.
Strings
do
have
a
variable
length,
but
OPC
UA
surmounts
this
variability:
At
the
time
of
transfer,
a
length
field
in
which
the
length
of
the
string
is
encoded
is
prefixed
to
each
string.
Therefore,
a
S7-1500 CPU as a OPC UA client can check the length of a string and determine whether the
string
&quot;fits
into&quot;
the
assigned
CPU
tag.
In
this
manner,
the
CPU
can
also
check
the
total
length
of
the
structure.
Mapping
rules
apply
to
the
assignment
of
OPC
UA
structures
to
PLC
tags
or
DB
tags
(see
Mapping
of
data
types
(Page
225)).
368
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Example
of
an
error-free
assignment
of
the
structure
elements
In
the
imported
node
set
file
(XML
export),
the
structure
is
defined
as
follows:
1799970
126408
The
structure
mapped
in
the
read
list
matches,
both
in
the
order
and
in
the
assigned
data
types,
the
corresponding
nodes
of
the
node
set
file.
1805432
128493
If
the
structure
now
changes
on
the
server,
for
example
tagA
and
tagB
are
swapped,
and
the
read
list
remains
the
same
in
the
client,
the
assignment
is
no
longer
correct:
The
total
length
of
the
data
remains
the
same
(only
the
order
has
changed)
WARNING
The
configuration
of
the
structure
is
different
for
client
and
server!
No
error
message
in
the
case
of
different
structure
configuration
between
client
and
server
If
the
structures
of
client
and
server
do
not
match,
this
rule
violation
will
possibly
not
generate
any
error
during
compilation
and
also
not
in
runtime.
Make
sure
not
to
change
the
configured
assignments
for
structures
in
runtime.
If
required,
reconfigure
the
assignment
in
the
read
and
write
lists!
Communication
Function
Manual,
11/2024,
A5E03735815-AM
369
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Using
connection
parameter
assignment
Creating
and
configuring
connections
With
the
instructions
for
OPC
UA
clients,
you
create
a
user
program
that
exchanges
data
with
an
OPC
UA
server.
A
series
of
system
data
types
are
required
for
this.
To
simplify
your
work
with
these
system
data
types,
a
connection
parameter
assignment
for
OPC
UA
clients
is
available
starting
in
STEP
7
(TIA
Portal)
Version
15.1.
Use
of
the
connection
parameter
assignment
is
optional
and
not
mandatory.
You
can
also
manually
create
the
required
system
data
types.
(Page
354).
We
use
an
example
to
make
the
description
easier
to
follow,
see
description
of
the
example
Opening
the
connection
parameter
assignment
To
configure
the
connection
to
an
OPC
UA
server,
follow
these
steps:
In
the
&quot;OPC
UA
communication&quot;
area,
double-click
the
client
interface
whose
parameters
you
want
to
assign
in
the
project
tree.
For
the
example
configuration:
Double-click
the
&quot;ProductionLine&quot;
client
interface.
1799970
127113
The
section
&quot;Create
client
interface
(Page
355)&quot;
describes
how
to
create
a
client
interface.
Click
the
&quot;Properties&quot;
tab
(Inspector
window)
if
the
tab
is
not
already
displayed.
STEP
7
now
displays
the
connection
parameter
assignment
for
the
instructions
of
the
OPC
UA
client.
The
&quot;General&quot;
tab
is
open.
Click
on
the
&quot;Configuration&quot;
tab
and
set
the
connection
to
the
OPC
UA
server.
Setting
the
connection
parameters
Select
a
descriptive
name
for
the
session.
For
the
example,
select
the
name
&quot;OPC
UA
Connection
to
ProductionLine&quot;.
In the &quot;Address&quot; field, enter the IP address of the OPC UA server to which your user
program (that operates as an OPC UA client) is to establish a connection. In the example
configuration, the CPU that controls the production line has the IP address &quot;192.168.1.1&quot;.
A connection to the OPC UA server of this CPU is to be established. For this reason, you
enter
this
IP
address
in
the
&quot;Address&quot;
field.
In
this
case,
the
OPC
UA
server
uses
the
default
port
4840.
Alternatively,
you
can
enter
a
valid
DNS
name
in
the
&quot;Address&quot;
field.
The
length
of
the
DNS
name
is
limited
to
242
characters.
If
the
address
is
not
valid,
the
error
message
is
shown:
&quot;Enter
a
valid
address&quot;.
If
the
string
of
the
&quot;Address&quot;,
&quot;Port&quot;
and
&quot;Path&quot;
fields
contains
more
than
254
characters,
an
error
message
is
also
displayed.
370
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Enter a path within the OPC UA server to restrict access to this path. The information is
optional.
However,
some
servers
only
establish
a
connection
if
a
server
path
is
specified.
When
you
specify
a
path,
it
is
automatically
entered
at
the
&quot;ServerEndpointUrl&quot;
entry
in
the
configuration DB for the client interface. The entry then consists of the components &quot;OPC
Schematic Prefix&quot;, &quot;IP address&quot;, &quot;Port number&quot; and &quot;Server path&quot;, for example:
&quot;opc.tcp://192.168.0.10:4840/example/path&quot;.
The
following
figure
shows
the
entry
of
the
IP
address
for
the
OPC
UA
server:
902969
150340
Figure
11-81
Connection
parameters
If
the
OPC
UA
server
is
not
using
the
standard
port
4840,
you
must
insert
the
port
number
here.
For example, enter the number 65535 in the field, if the OPC UA server to which you want
to
establish
a
connection
uses
this
port
number.
In
addition,
you
accept
the
default
settings
for
session
timeout
(30
seconds)
and
monitoring
time
(5
seconds).
Setting
the
security
parameters
1.
Click
the
&quot;Security&quot;
area
in
the
&quot;Configuration&quot;
tab.
This
area
contains
all
security
settings
for
the
connection
to
the
OPC
UA
server.
The
following
settings
are
possible,
for
example:
&quot;General&quot;
area
Security
mode:
Select
the
security
mode
that
the
connection
to
the
OPC
UA
server
must
meet
from
the
drop-
down
list.
If
the
server
does
not
meet
the
selected
mode,
a
session
is
not
established.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
371
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
The
following
settings
are
available:
No
security:
No
secure
connection!
Sign:
OPC
UA
server
and
OPC
UA
client
sign
the
data
transmission
(all
messages):
Manipulations
can
thus
be
detected.
Sign
&
Encrypt:
OPC
UA
server
and
OPC
UA
client
sign
and
encrypt
the
data
transmission
(all
messages):
Security
policy:
Set
the
encryption
techniques
for
the
signing
and
encryption
of
messages.
The
following
settings
are
possible:
No
security
Basic128Rsa15
Basic256
Basic256Sha256
To
configure
a
secure
connection,
you
must
observe
the
following
items:
A
certificate
is
required
for
the
client
for
a
secure
connection.
You
have
to
make
the
client
certificate
known
to
the
server.
(Page
To
find
out
how
to
proceed,
see
the
section
&quot;Handling
client
and
server
certificates
255)&quot;
under
&quot;Certificate
of
the
OPC
UA
client&quot;.
&quot;Certificates&quot;
area
Client
certificate:
The
certificate
confirms
the
authenticity
of
the
OPC
UA
client.
To
select
a
certificate,
click
the
following
symbol:
1623567
88300
STEP
7
displays
a
list
of
certificates.
1621155
537476
Select the certificate that you have made known to the server.
Click
the
symbol
with
the
green
check
mark:
Or,
create
a
new
certificate.
To
do
so,
click
the
&quot;Add&quot;
symbol.
If
you
create
a
new
certificate,
you
must
make
this
certificate
known
to
the
server.
&quot;User
authentication&quot;
area
The
following
settings
are
possible
for
user
authentication:
Guest
User
name
and
password
Users
(TIA
Portal
-
Security
Settings)
For
more
information,
see
Users
and
roles
with
OPC
UA
function
rights
(Page
265).
372
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Setting
languages
UA
tags
of
the
String
type
can
be
localized
with
OPC
UA,
that
is,
texts
(values
for
the
UA
tag)
can be available in different languages for the server. For example, localized texts can be
available
for
DisplayName
(Name
of
the
node)
and
Description
(Description).
In
the
&quot;Languages&quot;
area
of
the
&quot;Configuration&quot;
tab
you
can,
for
example,
influence
the
language
of
the
texts
returned
by
the
server
as
follows:
In
the
&quot;Languages&quot;
area,
enter
a
number
of
languages
that
the
server
transfers
to
the
client
during
connection
setup.
The
language
or
the
local
ID
(&quot;language
code&quot;)
associated
with
it
that
you
enter
in
the
first
line
is
the
language
preferred
by
the
client.
If
the
server
can
provide
the
UA
tag
in
the
requested
language,
it
is
transferred
to
the
client.
If
the
server
cannot
provide
the
UA
tag
in
the
requested
language,
it
checks
whether
it
can
provide the UA tag in the language you have entered in the second line (first substitute
language).
The server works its way down the list, and when it can provide neither the requested
language
nor
a
substitute
language,
it
will
provide
the
default
language.
More
information
(
https://support.industry.siemens.com/cs/ww/en/view/109766709
)
What
causes
the
connection
to
an
OPC
UA
server
to
fail?
FAQ.
Handling
of
the
client
certificates
of
the
S7-1500
CPU
Where
does
the
client
certificate
come
from?
If
you
are
using
the
OPC
UA
client
of
an
S7-1500
CPU
(OPC
UA
client
enabled),
you
can
create
certificates for these clients with STEP 7 V15.1 and higher as described in the following
sections.
When you use UA clients from manufacturers or the OPC Foundation, a client certificate is
generated
automatically
during
installation
or
upon
the
first
program
call.
You
have
to
import
these certificates with the global certificate manager in STEP 7 and use them for the
respective
CPU.
If
you
program
an
OPC
UA
client
yourself,
you
can
generate
certificates
through
the
program.
Alternatively, you can generate certificates with tools, for example with OpenSSL or the
certificate
generator
of
the
OPC
Foundation:
The
procedure
for
OpenSSL
is
described
here:
&quot;Generating
PKI
key
pairs
and
certificates
yourself
(Page
193)&quot;.
Working
with
the
certificate
generator
of
the
OPC
Foundation
is
described
here:
&quot;Creating
self-signed
certificates
(Page
192)&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
373
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Certificate
of
the
OPC
UA
client
of
the
S7-1500
CPU
A
secure
connection
between
the
OPC
UA
server
and
an
OPC
UA
client
is
only
established
if
the
server
classifies
the
certificate
of
the
client
as
trusted.
Therefore
you
have
to
make
the
client
certificate
known
to
the
server.
The
following
sections
describe
how
you
can
initially
generate
a
certificate
for
the
OPC
UA
client
of
the
S7-1500
CPU
and
then
make
it
available
to
the
server.
Generate
and
export
a
certificate
for
the
client
For
a
secure
connection
you
have
to
generate
a
client
certificate
and
-
if
the
server
and
client
are
located
in
different
projects
-
export
the
certificate.
If
client
and
server
are
in
the
same
project,
exporting
the
client
certificate
and
subsequent
import
are
not
necessary.
Requirements
The
IP
interface
of
the
CPU
is
configured,
an
IP
address
is
available.
Background:
The
IP
address
under
which
the
CPU
can
be
accessed
in
your
system
is
entered
under
&quot;Subject
Alternative
Name
(SAN)&quot;.
Creating
an
OPC
UA
Client
certificate
The
easiest
way
to
generate
a
client
certificate
for
an
S7-1500
CPU
is
to
configure
a
client
interface.
The
configuration
of
the
client
interface
provides
for
the
selection
or
generation
of
a
client
certificate,
see
Creating
and
configuring
connections
(Page
370
).
Alternatively,
you
can
generate
the
client
certificate
as
follows:
In
the
project
tree,
select
the
CPU
you
want
to
use
as
a
client.
Double-click
&quot;Device
configuration&quot;.
In
the
properties
of
the
CPU,
click
&quot;Protection
&
Security
>
Certificate
manager&quot;.
Double-click
&quot;<Add
new>&quot;
in
the
&quot;Device
certificates&quot;
table.
STEP
7
opens
a
dialog.
Click
the
&quot;Add&quot;
button.
Select
the
&quot;OPC
UA
client&quot;
entry
from
the
&quot;Usage&quot;
list.
Click &quot;OK&quot;.
STEP
7
now
shows
the
client
certificate
in
the
&quot;Device
certificates&quot;
table.
If
the
server
is
in
another
project:
Right-click
this
line
and
select
&quot;Export
certificate&quot;
from
the
shortcut
menu.
Select
a
directory
where
you
will
store
the
client
certificate.
374
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Announcing
the
client
certificate
to
the
server
You
have
to
make
the
client
certificate
available
to
the
server
to
allow
a
secure
connection
to
be
established.
To
do
this,
follow
these
steps:
If
the
client
was
configured
in
another
project
and
you
created
and
exported
the
client
certificate
there:
Select the &quot;Use global security settings for certificate manager&quot; option in the local
certificate
manager
of
the
server.
This
makes
the
global
certificate
manager
available.
You
will
find
this
option
under
&quot;Protection
&
Security
>
Certificate
manager&quot;
in
the
properties
of
the
CPU
that
is
acting
as
server.
If
the
project
is
not
yet
protected,
select
&quot;Security
settings
>
Settings&quot;
in
the
STEP
7
project
tree,
click
the
&quot;Protect
this
project&quot;
button
and
log
on.
The
&quot;Global
security
settings&quot;
item
is
now
displayed
under
&quot;Security
settings&quot;
in
the
STEP
7
project
tree.
Double
click
&quot;Global
security
settings&quot;.
Double
click
&quot;Certificate
manager&quot;.
STEP
7
opens
the
global
certificate
manager.
Click
the
&quot;Device
certificates&quot;
tab.
Right-click
in
the
tab
on
a
free
area
(not
on
a
certificate).
Select
the
&quot;Import&quot;
shortcut
menu.
The
dialog
for
importing
certificates
is
displayed.
Select
the
client
certificate
that
the
server
is
to
trust.
Click
&quot;Open&quot;
to
import
the
certificate.
The
certificate
of
the
client
is
now
contained
in
the
global
certificate
manager.
Note
the
ID
of
the
client
certificate
just
imported.
Click
the
&quot;General&quot;
tab
in
the
properties
of
the
CPU
that
is
acting
as
server.
Click
&quot;OPC
UA
>
Server
>
Security
>
Secure
Channel&quot;.
Scroll
down
in
the
&quot;Secure
Channel&quot;
dialog
to
the
section
&quot;Trusted
clients&quot;.
Double-click
in
the
table
on
the
empty
row
with
&quot;<add
new>&quot;.
A
browse
button
is
displayed
in
the
row.
Click
this
button.
Select
the
prepared
client
certificate.
Click
the
button
with
the
green
check
mark.
Compile
the
project.
Load
the
configuration
onto
the
S7-1500
CPU
(server).
Result
The
server
now
trusts
the
client.
If
the
server
certificate
is
also
considered
trusted,
the
server
and
client
can
establish
a
secure
connection.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
375
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
User
authentication
In
the
OPC
UA
client
interface
of
the
S7-1500,
you
can
set
what
authentication
is
required
for
a user of the OPC UA client wishing to access the server. To do so, you must select the
corresponding client interface in the project tree of the requested S7-1500 CPU under &quot;OPC
UA communication > Client interfaces&quot; and select the type of user authentication in the
Inspector
window
under
&quot;Properties
>
Configuration
>
Security&quot;.
Types
of
user
authentication
The
following
options
are
available
for
user
authentication:
Guest
The user does not need to verify authorization (anonymous access). The CPU creates an
anonymous
session
for
the
user,
and
the
OPC
UA
server
does
not
check
the
authorization
of
the
client
user.
User
name
and
password
The user must prove authorization (no anonymous access). The OPC UA server checks
whether
the
client
user
is
authorized
to
access
the
server.
Authorization
is
given
by
the
user name and the correct password. These inputs cannot be checked by the client
interface,
which
means
all
values
are
accepted
as
being
valid.
NOTE
STEP
7
stores
user
name
and
password
unencrypted
in
the
data
block/instance
data
block.
Recommendation: Use the user authentication for the &quot;User (TIA Portal - Security
Settings)&quot;
TIA
project.
Users
(TIA
Portal
-
Security
Settings)
You
can
enter
a
user
name
from
the
list
of
users
entered
in
the
project
for
authentication.
The names of the registered users for the current project are available in the user
administration in the project tree under &quot;Security Settings > Users and roles&quot;. There you
can
also
enter
additional
users.
You can also enter a name that is not listed in the user administration of the project or
leave
the
field
blank.
This
is
necessary
when
the
corresponding
user
name
is
only
provided
by a different source during runtime, for example, via HMI or from a different OPC UA
client.
376
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
&quot;No
Security&quot;
security
policy
and
authentication
via
user
name
and
password
You
can
set
the
following
combination:
Security
policy
=
&quot;No
Security&quot;
and
authentication
via
user
name
and
password.
The
OPC
UA
server
of
the
S7-1500
supports
this
combination.
OPC
UA
clients
can
connect
and
encrypt
the
authentication
data
or
not.
OPC
UA
client
of
the
S7-1500
CPU
also
supports
this
combination:
However,
in
runtime
it
only
connects
if
it
can
send
the
authentication
data
encrypted
via
cable!
Result:
With
the
following
configuration,
not
connection
can
be
established
in
runtime.
S7-1500
as
OPC
UA
client
OPC
UA
server
which
supports
no
encryption
of
authentication
data
when
&quot;No
Security&quot;
(=&quot;none&quot;)
is
set
as
security
policy.
More
information
You
can
find
information
about
the
users
and
roles
with
OPC
UA
function
rights
in
the
section
Users
and
roles
with
OPC
UA
function
rights
(Page
265).
Using
a
configured
connection
Introduction
This
section
shows
you
how
to
use
a
configured
connection
for
OPC
UA
instructions
(third
step).
Requirements
You
have
created
a
client
interface
and
added
PLC
tags
and
PLC
methods
to
this
interface,
see
(&quot;First
step
(Page
355)&quot;).
You
have
configured
a
connection
to
an
OPC
UA
server
(Second
step
(Page
370)).
Overview
To
read
data
from
an
OPC
UA
server
or
write
data
to
an
OPC
UA
server,
use
the
following
instructions:
OPC_UA_Connect
OPC_UA_NamespaceGetIndexList
OPC_UA_NodeGetHandleList
OPC_UA_ReadList
or
OPC_UA_WriteList
OPC_UA_NodeReleaseHandleList
OPC_UA_Disconnect
Communication
Function
Manual,
11/2024,
A5E03735815-AM
377
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Order
of
the
OPC
UA
instructions
1
2
3
&
B
8
$
B
:
U
i
W
H
/
i
V
W
2
3
&
B
8
$
B
5
H
D
G
/
i
V
W
2
3
&
B
8
$
B
1
R
G
H
*
H
W
+
D
Q
G
O
H
/
i
V
W
2
3
&
B
8
$
B
1
D
P
H
V
S
D
F
H
*
H
W
l
Q
G
H
[
/
i
V
W
2
3
&
B
8
$
B
&
R
Q
Q
H
F
W
The
following
figure
shows
the
order
in
which
the
OPC
UA
instructions
are
called
in
a
user
program
in
order
to
use
these
instructions
to
read
or
write
PLC
tags:
2
3
2
3
&
B
8
$
B
D
i
V
F
R
Q
Q
H
F
W
2
3
&
B
8
$
B
1
R
G
H
5
H
O
H
D
V
H
+
D
Q
G
O
H
/
i
V
W
①
Instructions
for
preparation
of
read
and
write
operations
②
Read
and
write
instructions
③
Instructions
for
&quot;clean-up&quot;
after
a
completed
read
or
write
operation
The
&quot;OPC_UA_NodeReleaseHandleList&quot;
instruction
can
be
omitted
if
&quot;OPC_UA_Disconnect&quot;
is
called
immediately
afterwards.
Figure
11-82
Call
sequence
for
write
and
read
operations
STEP
7
(TIA
Portal)
automatically
supplies
the
parameters
of
these
instructions
if
you
are
using
a
client
interface
and
a
configured
connection
to
an
OPC
UA
server.
The
procedure
is
shown
in
the
following
section.
Using
a
client
interface
and
configured
connection
To
use
a
configured
OPC
UA
connection,
follow
these
steps:
Open
your
user
program
in
the
TIA
Portal.
Using
drag-and-drop,
move
the
&quot;
OPC_UA_Connect
&quot;
instruction
into
the
program
editor.
You
will
find
the
instruction
under
&quot;Instructions
>
Communication
>
OPC
UA&quot;
in
the
TIA
Portal.
Select
a
call
option
for
the
instruction
The
example
uses
a
multi-instance.
STEP
7
displays
the
instruction
in
the
program
editor.
The
editor
for
the
Function
Block
Diagram
(FBD)
programming
language
uses
the
following
display:
378
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
2565879
154942
The
editor
for
the
Ladder
Logic
(LAD)
programming
language
displays
the
instruction
similarly.
Click the toolbox symbol in the editor for FBD or LAD.
The
symbol
is
located
in
the
heading
of
the
instruction:
1980057
91493
If
you
are
using
the
editor
for
STL
or
SCL:
Click
the
small
green
rectangle
below
the
first
character
of
the
instance
name:
2048624
158859
The
example
uses
&quot;#OPC_UA_Connect_Instance&quot;
as
the
instance
name.
(Page
354)
STEP
7
displays
the
properties
of
the
instruction
in
a
separate
dialog.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
379
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
For
&quot;Client
interface&quot;
select
the
client
interface
that
you
want
to
use
for
the
instruction.
In
the
example,
we
select
the
&quot;ProductionLine&quot;
client
interface.
STEP
7
now
interconnects
the
&quot;ProductionLine&quot;
client
interface
with
the
parameters
of
the
OPC_UA_Connect
instruction:
1839183
174048
&quot;ProductionLine&quot;
is
the
interface
that
the
OPC
UA
client
of
the
example
data
exchange
with
the
OPC
UA
server
&quot;ProductionLine&quot;.
uses
for
(Page
354)
Using drag-and-drop, move the &quot;
OPC_UA_NamespaceGetIndexList
&quot; instruction into the
program
editor.
You
will
find
the
instruction
under
&quot;Instructions
>
Communication
>
OPC
UA&quot;
in
the
TIA
Portal.
Select
the
&quot;Multi-instance&quot;
call
option.
Click
the
toolbox
symbol
(LAD
and
FBD)
or
the
small
green
box
below
the
instance
name
(STL
and
SCL)
if
the
editor
is
not
already
open.
Select
the
client
interface
that
you
want
to
use
(in
the
example
&quot;ProductionLine&quot;).
STEP 7 now automatically interconnects all parameters of the
&quot;OPC_UA_NamespaceGetIndexList&quot;
instruction:
Using
drag-and-drop,
move
the
&quot;
OPC_UA_NodeGetHandleList
&quot;
instruction
into
the
program
editor.
Select
the
&quot;Multi-instance&quot;
call
option.
Click
the
toolbox
symbol
(LAD
and
FBD)
or
the
small
green
box
below
the
instance
name
(STL
and
SCL)
if
the
editor
is
not
already
open.
Select
the
client
interface
that
you
want
to
use.
The
example
uses
the
&quot;ProductionLine&quot;
client
interface.
Under
&quot;Data
access
>
Read/Write
list&quot;
select
the
read
or
write
list
that
you
want
to
use
(in
the
example
the
read
list
&quot;Product&quot;).
380
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.4
Using
the
S7-1500
CPU
as
an
OPC
UA
client
STEP 7 now automatically interconnects all parameters of the
&quot;OPC_UA_NodeGetHandleList&quot;
instruction:
2059875
234827
If
you
want
to
write
data
to
an
OPC
UA
server,
select
the
write
list
you
want
to
use
under
&quot;Data
access
>
Write
list&quot;
(the
&quot;ProductionStatus&quot;
write
list
in
the
example).
Using
drag-and-drop,
move
the
&quot;
OPC_UA_ReadList
&quot;
instruction
into
the
program
editor.
Select
the
&quot;Multi-instance&quot;
call
option.
Click
the
toolbox
symbol
(LAD
and
FBD)
or
the
small
green
box
below
the
instance
name
(STL
and
SCL)
if
the
editor
is
not
already
open.
Select
the
client
interface
that
you
want
to
use.
The
example
uses
the
&quot;ProductionLine&quot;
client
interface.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
381
OPC
UA
communication
Using
the
S7-1500
CPU
as
an
OPC
UA
client
Under
&quot;Data
access
>
Read
list&quot;
select
the
read
list
that
you
want
to
use
(in
the
example
the
&quot;Product&quot;
read
list).
STEP
7
now
automatically
interconnects
all
parameters
of
the
&quot;OPC_UA_ReadList&quot;
instruction.
If
you
want
to
write
data
to
an
OPC
UA
server,
use
the
&quot;
OPC_UA_WriteList
&quot;
instruction
and
select
the
list
of
tags
you
want
to
send
to
the
server
under
&quot;Data
access
>
Write
list&quot;
(&quot;ProductionStatus&quot;
write
list
in
the
example).
If
you
use
different
read
lists
or
write
lists
as
program-controlled
lists
in
your
user
program,
move the &quot;
OPC_UA_NodeReleaseHandleList
&quot; instruction to the program editor using
drag-and-drop
operation.
Select the
client
interface that
you
want
to
use.
Now
select
a
read
list
or
write
list
that
you
want
to
release:
Only
release
read
or
write
lists
that
you
rarely
use,
since
re-registering
is
time-consuming.
Then,
repeat
the
steps
starting
with
step
7
with
the
&quot;OPC_UA_NodeGetHandleList&quot;
instruction.
Using
drag-and-drop,
move
the
&quot;
OPC_UA_Disconnect
&quot;
instruction
into
the
program
editor.
Select
the
&quot;Multi-instance&quot;
call
option.
Click
the
toolbox
symbol
(LAD
and
FBD)
or
the
small
green
box
below
the
instance
name
(STL
and
SCL)
if
the
editor
is
not
already
open.
Select
the
client
interface
that
you
want
to
use.
The
example
uses
the
&quot;ProductionLine&quot;
client
interface.
STEP
7
now
automatically
interconnects
all
parameters
of
the
&quot;OPC_UA_Disconnect&quot;
instruction.
Supported
instructions
For
the
following
instructions,
STEP
7
automatically
supplies
the
parameters
if
you
are
using
a
client
interface
and
a
configured
connection
to
an
OPC
UA
server:
OPC_UA_Connect
OPC_UA_NamespaceGetIndexList
OPC_UA_NodeGetHandleList
OPC_UA_MethodGetHandleList
OPC_UA_MethodReleaseHandleList
OPC_UA_ReadList
OPC_UA_WriteList
OPC_UA_MethodCall
OPC_UA_NodeReleaseHandleList
OPC_UA_Disconnect
382
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.5
Tips
and
recommendations
Compact
instructions
As
of
TIA
Portal
V17,
compact
instructions
are
available
for
OPC
UA
which
summarize
the
write
job/read
job/method
call
and
the
connection
establishment:
OPC_UA_ReadList_C
for
generating
a
connection
and
reading
tags
OPC_UA_WriteList_C
for
generating
a
connection
and
writing
tags
OPC_UA_MethodCall_C
for
generating
a
connection
and
calling
methods
You
will
find
information
about
the
compact
instructions
services
in
the
TIA
Portal
Help.
Tips
and
recommendations
Rules
for
subscriptions
The
following
rules
apply
to
subscriptions:
Group
subscriptions
in
the
client
according
to
different
sampling
and
publishing
intervals
and
distribute
the
monitored
elements
(variables)
to
these
groups.
Example:
Create
a
subscription
for
longer
publishing
intervals
(e.g.
5
seconds)
and
a
subscription
for
shorter
publishing
intervals
(e.g.
0.1
second).
Disable
unneeded
subscriptions.
Reason:
The
&quot;Deactivated&quot;
subscription
mode
reduces
resource
consumption.
To further optimize resource consumption, reduce the subscription timeout for the client.
The subscription timeout cannot be specified directly, this time results from the
subscription settings &quot;PublishingInterval&quot; and &quot;LifetimeCount&quot; confirmed by the server.
Background: When a client has created subscriptions and the session is terminated, the
subscriptions initially remain in the server and occupy memory resources. The OPC UA
server
only
releases
the
resources
needed
for
this
when
the
subscription
timeout
ends
the
lifetime
of
the
subscriptions.
Consider
the
maximum
number
of
monitored
items
of
subscriptions
for
the
corresponding
S7-1500
CPU.
The
information
can
be
found
in
the
technical
specification
of
the
respective
CPU.
The
information
is
based
on
a
sampling
/
publishing
interval
of
1
second.
You
can
find more
information
in
the
FAQ
109755846
(
https://support.industry.siemens.com/cs/us/en/view/109755846
).
Select
the
same
sampling
and
publishing
intervals
for
the
OPC
UA
client
and
for
the
OPC
UA
server.
Avoid
arrays
and
structures
as
elements
of
subscriptions
–
if
the
process
allows.
Reason:
If
even
one
value
of
an
array/structure
changes,
the
entire
structure
is
transferred,
creating
an
unnecessary
communication
load.
Occasional
non-compliance
with
the
required
sampling
rate
is
acknowledged
by
the
OPC
UA
server
of
the
S7-1500
CPU
according
to
OPC
UA
specification
with
a
&quot;GoodOverload&quot;
error
code,
see
also
TIA
Portal
Help.
Different
OPC
UA
clients
handle
&quot;Good&quot;
error
codes
unequal to &quot;0&quot; differently. Consider this behavior and, if needed, reduce the
communication
load
according
to
the
measures
described
above.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
383
OPC
UA
communication
11.5
Tips
and
recommendations
More
information
For
information
on
how
to
set
the
server
for
subscriptions,
refer
to
the
section
Settings
of
the
server
for
subscriptions
(Page
252).
Rules
for
the
user
program
User
programs
for
OPC
UA
The
following
rules
apply
to
user
programs:
If
your
application
allows
it
and
the
communication
load
is
high,
you
should
set
a
minimum
time
for
cycle
OBs.
Advantages:
The
cycle
time
remains
constant
for
the
most
part
The
CPU
has
more
time
for
communication
tasks
throughout
Tip:
Use
the
instruction
&quot;Runtime_Info&quot;;
mode
21
or
mode
25
(see
TIA
Portal
Help)
to
analyze
the
CPU
utilization
(e.g.
communication).
Reduce
the
number
of
variables
or
data
blocks
that
can
be
reached
from
OPC
UA/HMI.
By
default, all variables from OPC UA/HMI are accessible when creating
variables/DBs/IDBs.
This
measure
leads
to
improved
performance
when
loading
in
RUN.
Tip:
Using
the
detailed
object
display
in
the
TIA
Portal,
you
can
easily
mark
the
non-OPC-UA-relevant
data
blocks
as
&quot;not
accessible
from
OPC
UA&quot;.
Consistent
transfer
of
data
beyond
the
limits
of
simple
data
types
is
only
possible
with
OPC
UA methods. If you use other OPC UA functions (Subscriptions, Read/Write), you must
ensure
data
consistency
in
the
application.
OPC UA offers the &quot;RegisterNodes&quot; service for repeated read and write accesses to the
same variables. Servers can use this service to prepare for optimized access to variables.
The instruction &quot;OPC_UA_NodeGetHandleList&quot; of the S7-1500 as OPC UA client implicitly
calls
this
service
to
prepare
the
server
for
optimized
accesses
(in
OPC
UA
usage
&quot;Registered
Read/Write&quot;).
384
Communication
Function
Manual,
11/2024,
A5E03735815-AM
OPC
UA
communication
11.5
Tips
and
recommendations
Calling
detailed
object
display
in
the
TIA
Portal
To
call
up
the
detailed
object
display,
proceed
as
follows:
Switch
to
the
&quot;PLC
Programming&quot;
portal
in
the
portal
view.
Select
&quot;Show
all
objects&quot;.
Switch
to
the
&quot;Details&quot;
tab
in
the
selection
window.
In
the
&quot;DB
accessible
from
OPC
UA&quot;
column,
disable
the
accessibility
from
OPC
UA
for
individual
objects.
1985772
128564
Figure
11-83
Calling
detailed
object
display
in
the
TIA
Portal
Master
copies
for
OPC
UA
communication
Master
copies
for
the
OPC
UA
interfaces
Interfaces
of
OPC
UA
servers
and
OPC
UA
clients
that
you
want
to
use
multiple
times
can
be
stored either in the project library or in a global library. Master copies in the project library
can only be used within the project. When you create the master copy in a global library, it
can
be
used
in
different
projects.
The
OPC
UA
capable
CPUs
differentiate
between
3
interface
types
of
the
OPC
UA
server:
Standard
OPC
UA
server
interface
Companion
specification
interface
Namespace
reference
When
adding
the
OPC
UA
interface
in
the
project
tree
under
&quot;OPC
UA
Communication&quot;
each
interface
type
gets
its
own
symbol.
The
same
symbol
is
used
by
the
master
copy.
Create
either
single
master
copies
or
a
master
copy
with
multiple
interfaces.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
385
OPC
UA
communication
11.5
Tips
and
recommendations
Creating
multiple
master
copies
from
selection
You
select
one
or
more
elements
and
create
individual
master
copies
from
them
Open
the
library
in
the
&quot;Libraries&quot;
task
card.
Select
the
desired
elements.
Using
a
drag-and-drop
operation,
move
the
elements
to
the
&quot;Master
copies&quot;
folder
or
any
subfolder
of
&quot;Master
copies&quot;.
Creating
a
master
copy
from
selection
You
select
multiple
elements
and
create
a
single
master
copy
from
them
that
contains
all
selected
elements.
Copy
to
the
clipboard
the
elements
that
you
want
to
create
as
master
copies.
Right-click
on
the
&quot;Master
copies&quot;
folder
or
any
of
its
subfolders
in
the
library.
In
the
shortcut
menu,
select
&quot;Paste
as
a
single
master
copy&quot;
command.
If
multiple
interfaces
are
added
to
a
master
copy
from
the
OPC
UA
server
or
OPC
UA
client,
the
label
and
the
symbol
in
the
library
are
changed
accordingly.
A
symbol
with
&quot;+&quot;
is
displayed
instead
of
the
simple
symbol.
1620011
126221
Figure
11-84
Create
copy
template
in
STEP
7
More
information
For
information
on
how
to
create
a
user-defined
server
interface,
refer
to
the
section
Creating
a
user-defined
server
interface
(Page
283).
386
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Addressing
via
DHCP
12
In order to provide future-proof, efficient and flexible automation, more and more
components from the production area support IT standards. Worldwide Ethernet standards,
integrated communication and versatility make IT-supported automation an economical
solution for your requirements. Functional expansions of the communication options of the
S7-1500
CPUs
in
this
direction
give
you
more
freedom
for
the
possible
uses
of
your
system
or
machine. You use IT technology to automate efficiently. With the introduction of DHCP and
the
expansions
of
DNS
for
S7-1500
CPU
as
of
firmware
version
V2.9,
you
gain
more
flexibility
for
the
design
of
your
automation
solution.
For
the
interfaces
of
an
S7-1500
CPU
you
can
set
that
address
parameters
such
as
the
IP
address
with
subnet
mask,
can
be
got
from
a
DHCPv4
server
(hereinafter
DHCP
server).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
387
Addressing
via
DHCP
D+&3
VHUYHU
D16
VHUYHU
173
VHUYHU
5
R
X
W
H
U
D+&3 VHUYHU
G
i
V
W
U
i
E
X
W
H
G
:
3
D16
+
R
V
W
D
R
P
D
i
Q
1
H
W
Z
R
U
N
3/&3
3/&1
3/&2
3
5
2
)
I
1
(
7
I3
17
Figure
12-1
Overview
of
DHCP
388
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Addressing
via
DHCP
12.1
Principle
of
address
assignment
via
DHCP
Areas
of
application
Use
of
the
S7-1500
CPU
in
a
managed
IT
environment
Adding
new
devices
in
a
modular
manufacturing
structure
Principle
of
address
assignment
via
DHCP
Requirement
configuration
The
following
requirements
must
be
met
so
that
a
PROFINET
interface
of
the
S7-1500
CPU
can
obtain
IP
address
parameters
via
a
DHCP
server:
(Page
395)
The
address
assignment
via
a
DHCP
server
is
configured.
Activate
DHCP
No
PROFINET
IO
communication
may
be
configured
for
the
interface.
Principle
of
DHCP
address
assignment
The
process
begins
as
soon
as
the
project
is
loaded
into
the
CPU
or
the
CPU
is
switched
on
with
configured
DHCP
address
assignment
and
started
up,
the
process
of
DHCP
assignment
begins:
D
+
&
3
F
O
i
H
Q
W
D
+
&
3
-
D
i
V
F
R
Y
H
U
D
+
&
3
-
2
I
I
H
U
D
+
&
3
-
5
H
T
X
H
V
W
D
+
&
3
-
$
F
N
Q
R
Z
O
H
G
J
H
P
H
Q
W
(67-1500)
D+&3Y4
VHUYHU
DHCP Discover
The
DHCP
client
searches
for
a
suitable
DHCP
server
via
broadcast.
The
DHCP
client
identifies itself to the DHCP server with the configured client ID or with its MAC
address.
DHCP Offer
The
DHCP
server
offers
the
DHCP-client
IP
address
parameters
(IPv4
address,
subnet
mask,
optional
default
router)
and
if
necessary
further
data
(options).
DHCP
Request
The
DHCPclient
requests
the
IP
address
parameters
and
options
offered
in
the
DHCP
offer.
The
DHCP
client
of
the
S7-1500
CPU
always
accepts
the
first
DHCP
offer
of
a
DHCP
server
that
meets
the
requirements
(IP
address
with
subnet
mask).
DHCP Acknow-
ledgment
The
DHCP
server
confirms
and
transmits
the
IP
address
parameters
and
options
offered
in
the
DHCP
offer.
The
DHCP
server
also
notifies
the
DHCP
client
how
long
the
DHCP
client
can
use
the
address
parameters
(lease
time).
Figure
12-2
Principle
of
address
assignment
with
DHCP
Communication
Function
Manual,
11/2024,
A5E03735815-AM
389
Addressing
via
DHCP
Principle
of
address
assignment
via
DHCP
The IP address parameters and options are stored in the load memory of the CPU. After a
general
reset
or
restart
of
the
CPU,
the
IP
address
parameters
and
options
are
obtained
again
via
DHCP.
DHCP
address
assignment
options
For
the
S7-1500
CPU
you
can
configure
that
the
following
options
are
obtained
via
a
DHCP
server:
Addresses
of
up
to
four
DNS
servers
(Page
397)
Get
addresses
of
the
DNS
servers
via
DHCP
Address
of
up
to
four
NTP
servers
(Page
398)
Get
addresses
of
the
NTP
servers
via
DHCP
Host
and
domain
name
(Page
398)
Obtain
host
and
domain
name
via
DHCP
If
necessary,
the
DHCP
server
also
supplies
the
address
of
a
router
(default
gateway)
as
option.
How
long
can
the
S7-1500
CPU
use
the
DHCP
address
parameters?
In
addition
to
the
address
parameters,
the
DHCP
server
also
notifies
the
S7-1500
CPU
(DHCP
client)of the lease time. The lease time defines how long the CPU can use the address
parameters.
When
the
lease
time
has
fully
expired,
the
CPU
returns
the
assigned
address
parameters.
The
CPU
has
an
internal
time
monitoring
for
the
lease
time.
At
certain
times
when
the
lease
time
expires,
the
CPU
has
the
option
of
extending
the
lease
time:
Renewal: Half of the lease time has expired: The CPU contacts the original DHCP server
and
asks
for
an
extension
of
the
lease
time.
The
original
DHCP
server
can
either
confirm
the existing lease time or assign a new lease time. With a new lease time, the time
monitoring
in
the
CPU
is
reset.
Rebinding:
7/8
of
the
lease
term
has
expired:
The
CPU
contacts
all
available
DHCP
servers
via broadcast and asks for an extension of the lease time. A DHCP server can either
confirm the existing lease time or assign a new lease time. With a new lease time, the
time
monitoring
in
the
CPU
is
reset.
In
the
event
of
a
negative
response
from
DHCP
server
during
rebinding
or
if
no
DHCP
server
replies,
the
CPU
returns
the
address
parameters
after
8/8
of
the
lease
time.
If
the
CPU
has
returned
the
address
parameters
after
the
lease
time
has
expired,
the
CPU
starts
a
new
cycle
for
DHCP
addressing
with
a
new
DHCP
discover.
More
information
For
information
on
how
to
configure
client
ID,
refer
to
the
section
Configuring
the
client
ID
(Page 396).
390
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Addressing
via
DHCP
12.2
DHCP
with
DNS
DHCP
with
DNS
As
of
STEP
7
V17,
the
S7-1500
CPU
supports
the
host
name
and
domain
address
parameters
used
in
name-based
communication
(DNS).
For
specific
communication
services,
name-based
addressing
via
the
complete
name
consisting
of
host
name
and
domain,
is
useful:
The CPU is addressable under the complete name, for example at OPC UA, Open User
Communication.
In
the
case
of
dynamic
IP
address
assignment
by
the
DHCP
server,
unique
addressing
is
always
possible
through
the
DNS
name.
Certificates
of
the
S7-1500
CPU
may
contain
the
complete
name,
for
example,
for
OPC
UA
communication,
web
server,
secure
communication.
Only
if
you
configure
host
name
and
domain
for
the
S7-1500
CPU
in
STEP
7,
then
the
complete
name
is
entered
in
the
device
certificates
in
the
project
as
subject
alternate
name
(SAN).
As
soon
as
you
obtain
the
host
name
and/or
domain
via
DHCP
or
assign
it
via
the
user
program,
the
complete
name
is
not
stored
in
the
device
certificates
in
the
project.
How
you
set
the
DNS
configuration
for
your
CPU
depends
on
how
you
assign
the
host
name
and
domain
in
your
network
.
Central
assignment
of
host
name
and
domain
You assign the host name and domain centrally in your network, for example via a
configured
DNS
server.
In
STEP
7
you
configure
that
the
CPU
obtains
the
host
name
and
domain
via
DHCP.
In
the
following
configuration,
only
the
client
ID
is
configured
in
the
S7-1500
CPU.
At
the
DHCP
address
assignment
the
DHCP-server
returns
the
host
name
and
domain
options
to
the
CPU.
&
O
i
H
Q
W
I
D
+
R
V
W
Q
D
P
H
+
D
R
P
D
i
Q
3/&
1
D+&3
VHUYHU
Figure
12-3
Obtain
host
and
domain
name
via
DHCP
For
this
configuration,
you
must
first
activate
the
host
name
and
domain
configuration
in
STEP
7.
You
then
configure
that
the
host
and
domain
name
are
obtained
via
DHCP.
(Page
398)
Obtain
host
and
domain
name
via
DHCP
Communication
Function
Manual,
11/2024,
A5E03735815-AM
391
Addressing
via
DHCP
DHCP
with
DNS
Local
assignment
of
host
name
and
domain
You
can
configure
the
host
name
and
domain
in
STEP
7
or
assign
them
in
the
user
program.
NOTE
Validity
of
the
data
obtained
from
DHCP
If
you
change
the
host
name
and/or
domain
in
the
user
program,
then
all
data
obtained
via DHCP (IP suite, host name, domain, NTP server, DNS server) becomes invalid and is
retrieved again from DHCP server. Therefore, you should only change the Hostname
and/or
Domain
in
urgent
cases
and
not
during
operation.
All
connections
can
be
dropped
if
the
IP
address
of
the
interface
changes.
In
the
following
configuration,
the
host
name
and
its
domain
are
configured
in
the
S7-1500
CPU
in
addition
to
its
client
ID.
When
assigning
DHCP
addresses,
the
CPU
supplies
the client ID as well as the host name and the domain to the DHCP server.. The DHCP
server
receives
the
information
to
update,
for
example
a
DNS
server
with
the
address
data
of
the
CPU.
3/&
1
O
i
H
Q
W
I
D
&
D+&3
VHUYHU
DR
+R
V
W
Q
D
P
H
+
P
D
i
Q
D
+
&
3
/
D
1
6
X
S
G
D
W
H
D16
VHUYHU
Figure
12-4
Configure
host
and
domain
name
For
this
configuration,
you
must
first
activate
the
host
name
and
domain
configuration
in
STEP
7.
You
then
configure
the
host
name
and
domain
in
STEP
7.
Central
assignment
of
the
domain
and
local
assignment
of
host
name.
You
configure
in
STEP
7
that
the
CPU
gets
the
domain
via
DHCP.
You
can
configure
the
host
name
in
STEP
7
or
assign
it
via
the
user
program.
In the following configuration, the host name is also configured in the S7-1500 CPU in
addition
to
its
client
ID.
When
assigning
DHCP
addresses,
the
CPU
supplies
the
client
ID
as
392
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Addressing
via
DHCP
12.2
DHCP
with
DNS
well
as
the
host
name
to
the
DHCPv4
server.
The
DHCP
server
supplies
the
domain
option
to
the
CPU.
&
V
W
Q
D
P
H
+R
O
i
H
Q
W
I
D
D
R
P
D
i
Q
3/&
1
D+&3
VHUYHU
Figure
12-5
Configure
host
name,
obtain
domain
name
via
DHCP
For this configuration, you must first activate the host name and domain configuration in
STEP
7.
Then
configure
the
host
name
in
STEP
7
and
configure
that
the
domain
is
obtained
via
DHCP.
Requirements
You
have
activated
the
address
assignment
via
DHCP
for
at
least
one
interface
of
the
S7-1500
CPU.
Configuration
of
host
and
domain
name
To
activate
the
host
name
and
domain
configuration
in
STEP
7,
follow
these
steps:
Select
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
CPU,
navigate
to
&quot;Advanced
configuration&quot;
>
&quot;Host
and
domain
name&quot;
>
&quot;Host
and
domain
name
configuration&quot;.
Select
the
&quot;Enable
host
name
and
domain&quot;
check
box.
Configuring
the
host
name
in
STEP
7
To
configure
the
host
name
in
STEP
7,
follow
these
steps:
Select
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
CPU,
navigate
to
&quot;Advanced
configuration&quot;
>
&quot;Host
and
domain
name&quot;
>
&quot;Host
and
domain
name
configuration&quot;>
&quot;Host
name&quot;.
For
&quot;Host
name
configuration:&quot;
select
&quot;Set
host
name
in
the
project&quot;
from
the
drop-down
list.
Enter
the
host
name
for
&quot;Host
name:&quot;.
Enter
your
desired
host
name.
If
you
select
the
&quot;Host
name
identical
to
device
name&quot;
check
box,
STEP
7
automatically
assigns
the
device
name
as
the
host
name.
Only
if
you
have
configured
the
host
and
domain
name
in
STEP
7,
the
full
name
is
displayed
for
&quot;Full
name:&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
393
Addressing
via
DHCP
DHCP
with
DNS
Assign
host
name
in
the
user
program
To
assign
the
host
name
in
the
user
program,
follow
these
steps:
Select
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
CPU,
navigate
to
&quot;Advanced
configuration&quot;
>
&quot;Host
and
domain
name&quot;
>
&quot;Host
and
domain
name
configuration&quot;
>
&quot;Host
name&quot;.
Under
&quot;Host
name
configuration:”
select
&quot;Set
hostname
directly
on
the
device
(e.g.
PLC
program,
display)&quot;
in
the
drop-down
list.
Call
the
instruction
&quot;CommConfig&quot;
in
the
user
program.
The
DATA
parameter
must
point
to
a
UDT
&quot;Conf_Hostname&quot;
where
the
host
name
is
defined.
You
can
find
more
information
on
the
&quot;CommConfig&quot;
instruction
and
on
the
UDT
&quot;Conf-Hostname&quot;
in
the
STEP
7
online
help.
Configuring
a
domain
in
STEP
7
To
configure
the
domain
in
STEP
7,
follow
these
steps:
Select
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
CPU,
navigate
to
&quot;Advanced
configuration&quot;
>
&quot;Host
and
domain
name&quot;
>
&quot;Host
and
domain
name
configuration&quot;
>
&quot;Domain&quot;.
For
&quot;Domain
configuration:&quot;
select
&quot;Set
domain
in
the
project&quot;
from
the
drop-down
list.
Enter
your
desired
domain
under
&quot;Domain:&quot;.
Only
if
you
have
configured
the
host
and
domain
name
in
STEP
7,
the
full
name
is
displayed
for
&quot;Full
name:&quot;.
Assigning
a
domain
in
the
user
program
To
assign
the
domain
in
the
user
program,
follow
these
steps:
Select
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
CPU,
navigate
to
&quot;Advanced
configuration&quot;
>
&quot;Host
and
domain
name&quot;
>
&quot;Host
and
domain
name
configuration&quot;
>
&quot;Domain&quot;.
Under
&quot;Hostname
configuration:&quot;
select
&quot;Set
domain
directly
on
the
device
(for
example
PLC
program,
display)&quot;
in
the
drop-down
list.
Call
the
instruction
&quot;CommConfig&quot;
in
the
user
program.
The
DATA
parameter
must
point
to
a
UDT
&quot;Conf_Domainname&quot;
where
the
domain
name
is
specified.
You
can
find
more
information
on
the
&quot;CommConfig&quot;
instruction
and
on
the
UDT
&quot;Conf-Domainname&quot;
in
the
STEP
7
online
help.
394
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Addressing
via
DHCP
12.3
Activate
DHCP
Rules
for
maximum
lengths
of
host
name,
domain
and
client
ID
Note
the
following
maximum
lengths
in
bytes.
One
byte
corresponds
to
one
character:
Host
name:
Maximum
63
bytes
Domain:
Maximum
252
bytes
Client
ID:
Maximum
254
bytes
Host
+
Domain
name:
Maximum
254
bytes
Host
+
Domain
name
+
Client
ID:
Maximum
260
bytes
Applies
only
when
host
and
domain
name
must
be
sent
to
the
DHCP
server.
Activate
DHCP
Requirements
S7-1500
CPU
firmware
V2.9
or
higher
Procedure
To
activate
DHCP
for
the
PROFINET
interface
of
an
S7-1500
CPU,
follow
these
steps:
Select
the
PROFINET
interface
of
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
interface,
navigate
to
&quot;Ethernet
addresses&quot;
>
&quot;Internet
Protocol
Version
4
(IPv4)&quot;.
Select
the
option
&quot;IP
address
of
DHCP
server&quot;.
Result
You
have
set
the
interface
so
that
it
obtains
your
IP
address
via
a
DHCP
server.
&quot;Use
MAC
address
as
client
ID&quot;
is
set
as
the
operating
mode
for
DHCP
on
the
S7-1500
CPU.
How
to
adjust
the
client
ID
is
described
under
Configuring
the
client
ID
(Page
396).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
395
Addressing
via
DHCP
12.4
Configuring
the
client
ID
Configuring
the
client
ID
The
client
ID
The
S7‑1500
CPU
always
identifies
itself
to
a
DHCP
server
with
the
client
ID
(DHCP
option
61).
The
client
ID
is
interface
specific.
The
S7-1500
CPU
supports
the
following
two
operating
modes
with
regard
to
the
client
ID:
Use
the
MAC
address
as
the
client
ID:
The
MAC
address
of
the
CPU
is
used
as
the
client
ID
for the DHCP client. Note, if you execute a device exchange of the CPU in this operating
mode,
the
MAC
address
and
therefore
also
the
client
ID
changes.
User-defined client ID: With this option you specify the client ID in the configuration in
STEP
7.
You
also
have
the
option
of
adapting
the
client
ID
during
runtime,
for
example,
in
the
user
program
using
the
&quot;CommConfig&quot;
instruction.
If
you
perform
a
device
exchange
of
the
CPU
in
this
operating
mode,
the
new
CPU
is
assigned
the
configured
client
ID.
Requirement
You
have
activated
address
assignment
via
DHCP
for
the
interface.
Configuring
the
client
ID
To
configure
the
client
ID
in
STEP
7,
follow
these
steps:
Select
the
PROFINET
interface
of
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
interface,
navigate
to
&quot;Ethernet
addresses&quot;
>
&quot;Internet
Protocol
Version
4
(IPv4)&quot;>
&quot;IP
address
of
DHCP
server&quot;.
For
&quot;Operating
mode:&quot;
select
the
required
operating
mode
from
the
drop-down
list:
Use
MAC
address
as
client
ID
(default
setting)
User-defined
client
ID
If
you
have
selected
the
option
&quot;Use
MAC
address
as
client
ID&quot;,
then
you
are
already
finished
here.
For
&quot;User-defined
client
ID&quot;,
continue
with
step
4.
Enter
a
valid
client
ID
for
&quot;Client
ID&quot;.
A
character
string
with
7-bit
ASCII
characters
is
allowed
in
the
area
from
0x21
to
0x7e.
Some
DHCP
servers
expect
a
leading
&quot;0&quot;
(e.g.
some
SCALANCE
devices).
In
this
case,
enter
&quot;\
0&quot;
followed
by
your
client
ID.
You
can
also
leave
the
field
blank.
In
this
case,
you
must
select
the
&quot;Client
ID
can
be
changed
at
runtime&quot;
check
box.
In
order
to
make
the
user-defined
client
ID
adaptable
during
runtime,
select
the
&quot;Client
ID
can
be
changed
during
runtime&quot;
check
box.
396
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Addressing
via
DHCP
12.5
Get
addresses
of
the
DNS
servers
via
DHCP
Adapting
the
client
ID
during
runtime
You
can
use
the
&quot;CommConfig&quot;
instruction
to
adapt
the
client
ID
via
the
user
program.
Call
the
instruction.
The
DATA
parameter
must
point
to
a
UDT
&quot;Conf_ClientId&quot;
or
a
UDT
&quot;Conf_ClientId_Opaque&quot;.
The
client
ID
must
be
specified
in
the
UDT.
If
you
have
left
the
user-defined
client
ID
free
in
the
configuration
in
STEP
7,
then
the
CPU
uses
the
MAC
address
as
the
client
ID
until
the
client
ID
is
adapted
for
the
first
time.
NOTE
Validity
of
data
obtained
via
DHCP
If
you
change
ClientId
with
&quot;CommConfig&quot;,
all
data
obtained
via
DHCP
will
be
invalid:
IP
Suite,
domain name, NTP server, DNS server. Therefore, you should only change ClientId in urgent
cases
and
not
during
operation.
You
can
find
more
information
on
the
instruction
&quot;CommConfig&quot;
and
the
UDTs
&quot;Conf_ClientId&quot;
and
&quot;Conf_ClientId_Opaque&quot;
in
the
STEP
7
online
help.
Get
addresses
of
the
DNS
servers
via
DHCP
Requirements
You
have
activated
the
address
assignment
via
DHCP
for
at
least
one
interface
of
the
S7-1500
CPU.
Get
addresses
from
DNS
servers
via
DHCP
To
obtain
the
addresses
of
up
to
4
DNS
servers
via
DHCP,
follow
these
steps:
Select
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
CPU,
navigate
to
&quot;Advanced
configuration&quot;
>
&quot;DNS
configuration&quot;
>
&quot;Server
list&quot;.
For
&quot;Name
resolution
via
DNS:&quot;
select
&quot;Set
DNS
server
remotely
(e.g.
DHCP)&quot;
in
the
drop-
down
list.
Result:
If
the
DHCP
server
supplies
addresses
from
DNS
servers
as
option,
the
CPU
uses
up
to
4
addresses.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
397
Addressing
via
DHCP
12.7
Obtain
host
and
domain
name
via
DHCP
Get
addresses
of
the
NTP
servers
via
DHCP
Requirements
You
have
activated
the
address
assignment
via
DHCP
for
at
least
one
interface
of
the
S7-1500
CPU.
Obtaining
addresses
from
NTP
servers
via
DHCP
To
obtain
the
addresses
of
up
to
four
NTP
servers
via
DHCP,
follow
these
steps:
Select
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
CPU,
navigate
to
&quot;Time
of
day&quot;
>
&quot;Time
synchronization&quot;>
&quot;NTP
mode&quot;.
For
&quot;Time
synchronization:&quot;
select
&quot;Set
NTP
server
remotely
(e.g.
DHCP)&quot;
in
the
drop-down
list.
Result:
If
the
DHCP
server
supplies
addresses
from
NTP
servers
as
option
,
the
CPU
uses
up
to
4
addresses.
Obtain
host
and
domain
name
via
DHCP
Requirement
You
have
activated
the
address
assignment
via
DHCP
for
at
least
one
interface
of
the
S7-1500
CPU.
You
have
activated
the
host
name
and
domain
configuration
in
STEP
7.
Obtain
host
name
via
DHCP
To
obtain
the
host
name
via
DHCP,
follow
these
steps:
Select
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
CPU,
navigate
to
&quot;Advanced
configuration&quot;
>
&quot;Host
and
domain
name&quot;>
&quot;Host
and
domain
name
configuration&quot;>
&quot;Host
name&quot;.
For
&quot;Host
name
configuration:&quot;
select
&quot;Set
host
name
remotely
(e.g.
DHCP)&quot;
in
the
drop-
down
list.
Result:
If
the
DHCP
server
supplies
a
host
name
as
option,
the
CPU
uses
this
host
name.
398
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Addressing
via
DHCP
12.7
Obtain
host
and
domain
name
via
DHCP
Obtaining
a
domain
via
DHCP
To
obtain
the
domain
via
DHCP,
follow
these
steps:
Select
the
S7-1500
CPU
in
STEP
7.
In
the
properties
of
the
CPU,
navigate
to
&quot;Advanced
configuration&quot;
>
&quot;Host
and
domain
name&quot;
>
&quot;Host
and
domain
name
configuration&quot;
>
&quot;Domain&quot;.
For
&quot;Domain
configuration:&quot;
select
&quot;Set
domain
remotely
(e.g.
DHCP)&quot;
in
the
drop-down
list.
Result:
If
the
DHCP
server
delivers
a
domain
as
option,
the
CPU
uses
this
domain.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
399
Routing
13
Overview
of
the
routing
mechanisms
of
S7-1500
CPUs
Routing
mechanism
Description
Applications
Section
S7
routing
S7 routing is the transfer of data
beyond S7 subnet boundaries.
You
can
send
information
from
a
transmitter to a receiver across
several
s7
subnets.
Download user programs
Load
hardware
configuration
Execute
testing
and
diagnostics
functions
S7
routing
(Page
401)
IP
forwarding
IP forwarding is a function of
devices to forward IP packets
between
two
connected
IP
sub-
nets.
Simple access from the control
level
to
the
field
level
for
config-
uration and parameter assign-
ment of devices, e.g. via PDM or
Web
browser.
Simplified integration of devices
for remote access, e.g. for dia-
gnostics
during
remote
mainten-
ance
or
firmware
update.
IP
forwarding
(Page
405)
Data
record
routing
Data
can
be
sent
over
PROFINET
from an engineering station to
field devices via multiple net-
works. Since the engineering
station addresses the field
devices using standardized
records and these records are
routed via S7 devices, the term
&quot;data record routing&quot;
is used to
refer
to
this
type
of
routing.
Data
record
routing
is
used,
for
example, when field devices of
different manufacturers are
used. The field devices are
addressed using
standardized
data records ( PROFINET) for
configuration
and
diagnostics.
Data
record
routing
(Page
412)
The
following
table
gives
an
overview
of
the
routing
mechanisms
of
the
S7-1500
CPU.
400
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Routing
13.2
S7
routing
S7
routing
Definition
of
S7
routing
S7 routing is the transfer of data beyond S7 subnet boundaries. You can send information
from
a
transmitter
to
a
receiver
across
several
s7
subnets.
The
gateway
from
one
S7
subnet
to
one or more other subnets is provided by the S7 router The S7 router is a device which has
interfaces to the respective S7 subnets. S7 routing is possible via various S7 subnets
(PROFINET/Industrial
Ethernet
and/or
PROFIBUS).
Requirements
for
S7
routing
All
devices
that
can
be
reached
in
a
network
have
been
configured
in
a
project
in
STEP
7
and
downloaded.
All devices involved in the S7 routing must receive routing information about the S7
subnets that can be reached through specific S7 routers. The devices obtain the routing
information
by
downloading
the
hardware
configuration
to
the
CPUs,
since
the
CPUs
play
the
role
of
an
S7
router.
In a topology with several consecutive S7 subnets, the following order must be kept to
when downloading: First download the hardware configuration to the CPU(s) directly
connected
to
the
same
S7
subnet
as
the
PG/PC,
then
download
one
by
one
the
CPUs
of
the
S7 subnets beyond this starting with the nearest S7 subnet through to the S7 subnet
furthest
away.
The
PG/PC
you
want
to
use
to
establish
a
connection
via
a
S7
router
must
be
assigned
to
the
S7
subnet
it
is
physically
connected
to.
You
can
assign
the
PG/PC
to
a
PG/PC
in
STEP
7
under
Online
&
Diagnostics
>
Online
accesses
>
Connection
to
interface/subnet.
For
S7
subnets
of
the
type
PROFIBUS:
Either
the
CPU
must
be
configured
as
DP
master
or,
if it is configured as a DP slave, the &quot;Test, commissioning, routing&quot; check box must be
selected
in
the
properties
of
the
DP
interface
of
the
DP
slave.
S7
routing
for
HMI
connections
is
possible
as
of
STEP
7
V13
SP1.
NOTE
Firewall
and
S7
routing
A
firewall
does
not
recognize
the
IP
address
of
the
sender
during
S7
routing
when
the
sender
is
located
outside
the
S7
subnet
adjacent
to
the
firewall.
An
overview
of
the
devices
that
support
the
&quot;S7
routing&quot;
function
is
provided
in
this
FAQ
(
https://support.industry.siemens.com/cs/ww/en/view/584459
).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
401
540004
214599
Routing
S7
routing
S7
routing
for
online
connections
With
the
PG/PC,
you
can
reach
devices
beyond
S7
subnets,
for
example
to
do
the
following:
Download
user
programs
Download
a
hardware
configuration
Execute
test
and
diagnostics
functions
In
the
following
figure,
CPU
1
is
the
S7
router
between
S7
subnet
1
and
S7
subnet
2.
&38
1516-3
31/D3
&38
1516-3
31/D3
&38
1
&38
2
3
*
/
3
&
31
31
31
6
7
6
X
E
Q
H
W
2
(
3
5
2
)
I
1
(
7
)
6
7
6
X
E
Q
H
W
1
(
3
5
2
)
I
1
(
7
)
Figure
13-1
S7
routing:
PROFINET
-
PROFINET
The following figure shows the access from a PG via PROFINET to PROFIBUS. CPU 1 is the S7
router
between
S7
subnet
1
and
S7
subnet
2;
CPU
2
is
the
S7
router
between
S7
subnet
2
and
S7
subnet
3.
&0
1542-5
&38
2
&38
3
31
31
31
D3
(
D
3
P
D
V
W
H
U
)
D3
(
D
3
V
O
D
Y
H
D
F
W
i
Y
H
)
6
7
6
X
E
Q
H
W
2
(
3
5
2
)
I
1
(
7
)
6
7
6
X
E
Q
H
W
3
(
3
5
2
)
I
%
8
6
)
6
7
6
X
E
Q
H
W
1
(
3
5
2
)
I
1
(
7
)
&38
1516-3
31/D3
&38
1516-3
31/D3
&38
1513-1
31
&38
1
3
*
/
3
&
Figure
13-2
S7
routing:
PROFINET
-
PROFIBUS
402
Communication
Function
Manual,
11/2024,
A5E03735815-AM
719962
214599
Routing
13.2
S7
routing
S7
routing
for
HMI
connections
You have the option of setting up an S7 connection from an HMI to a CPU via different
subnets
(PROFIBUS
and
PROFINET
or
Industrial
Ethernet).
In
the
following
figure,
CPU
1
is
the
S7
router
between
S7
subnet
1
and
S7
subnet
2.
&38
1516-3
31/D3
&38
1516-3
31/D3
&38
1
&38
2
+0I
31
31
31
6
7
6
X
E
Q
H
W
2
(
3
5
2
)
I
1
(
7
)
6
7
6
X
E
Q
H
W
1
(
3
5
2
)
I
1
(
7
)
Figure
13-3
S7
routing
via
HMI
connections
S7
routing
for
CPU-CPU
communication
4396219
394600
You
have
the
option
of
setting
up
an
S7
connection
from
a
CPU
to
another
CPU
via
different
subnets
(PROFIBUS
and
PROFINET
or
Industrial
Ethernet).
The
procedure
is
described
based
on
examples
in
the
section
S7
communication
(Page
155).
&0
1542-5
31
31
D3
(
D
3
P
D
V
W
H
U
)
D3
(
D
3
V
O
D
Y
H
D
F
W
i
Y
H
)
&38
3
&38
2
&38
1516-3
31/D3
&38
1516-3
31/D3
&38
1513-1
31
&38
1
6
7
6
X
E
Q
H
W
1
(
3
5
2
)
I
1
(
7
)
6
7
6
X
E
Q
H
W
2
(
3
5
2
)
I
%
8
6
)
Figure
13-4
S7
routing
via
CPU-CPU
communication
Using
S7
routing
For
the
CPU,
select
the
PG/PC
interface
and
the
S7
subnet
in
the
&quot;Go
online&quot;
dialog
of
STEP
7.
S7
routing
is
performed
automatically.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
403
540004
214599
Routing
S7
routing
Number
of
connections
for
S7
routing
The
number
of
connections
available
for
S7
routing
in
the
S7
routers
(CPUs,
CMs
or
CPs)
can
be
found
in
the
technical
specifications
in
the
manuals
of
the
relevant
CPU/CM/CP.
S7
routing:
Example
of
an
application
The
figure
below
shows
the
example
of
an
application
for
remote
maintenance
of
a
system
using
a
PG.
The
connection
is
made
here
beyond
two
S7
subnets
via
a
modem
connection.
You
configure
a
remote
connection
via
TeleService
in
STEP
7
using
&quot;Online
access&quot;
or
&quot;Go
online&quot;.
3
*
/
3
&
I
2
F
R
Q
W
U
R
O
O
H
U
(H.J.
&38
1516-3
31/D3)
GHYiFH
(H.J.
&38
1516-3
31/D3)
31
31
31
0RGHP
0RGHP
7
H
O
H
6
H
U
Y
i
F
H
$
G
D
S
W
H
U
6
7
6
X
E
Q
H
W
2
(
H
.
J
.
3
5
2
)
I
1
(
7
)
6
7
6
X
E
Q
H
W
1
(
H
.
J
.
3
5
2
)
I
1
(
7
)
Figure
13-5
Remote
maintenance
of
a
plant
using
TeleService
More
information
3754615
260615
The
allocation
of
connection
resources
with
S7
routing
is
described
in
the
section
Allocation
of
connection
resources
(Page
421).
You
can
find
more
information
on
setting
up
TeleService
in
the
STEP
7
online
help.
129).
(Page
For
information
on
HMI
communication,
refer
to
the
section
HMI
communication
You
can
find
more
information
on
S7
routing
and
TeleService
adapters
when
you
search
the
Internet
using
the
following
links:
(
https://support.industry.siemens.com/cs/us/en/view/51311100
)
Device
manual
Industrial
Software
Engineering
Tools
TS
Adapter
IE
Basic
(
https://support.industry.siemens.com/cs/us/en/ps/16006/dl
)
Downloads
for
the
TS
Adapter
404
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Routing
13.3
IP
forwarding
IP
forwarding
Forwarding of
IP
packets
with
IP
forwarding
IP
forwarding
is
a
function
of
devices
to
forward
IP
packets
between
two
connected
IP
subnets.
Enable/disable the IP forwarding function in STEP 7. When IP forwarding is enabled, the
S7‑1500
CPU
forwards
received
IP
packets
not
addressed
to
the
CPU
to
locally
connected
IP
subnets
or
to
a
configured
router.
The following figure shows how a programming device accesses data of an HMI device.
Programming
device
and
HMI
device
are
located
in
different
IP
subnets.
The
IP
subnets
are
connected
to
the
two
interfaces
X1
and
X2
of
the
CPU.
1(I1$
I
3
V
X
E
Q
H
W
$
92
&
3
8
Z
i
W
K
D
F
W
i
Y
D
W
H
G
I
3
I
R
U
Z
D
U
G
i
Q
J
91
I
3
S
D
F
N
H
W
V
I
3
V
X
E
Q
H
W
%
+0I
Figure
13-6
Access
of
a
programming
device
to
an
HMI
via
IP
forwarding
Areas
of
application
Easy
access
from
the
control
level
to
the
field
level
for
configuration
and
parameter
assignment
of
field
devices,
e.g.
via
PDM
or
web
browser
Simplified
integration
of
devices
for
remote
access,
e.g.
for
diagnostics
during
remote
maintenance
or
firmware
update
Communication
Function
Manual,
11/2024,
A5E03735815-AM
405
Routing
IP
forwarding
Requirements
for
using
IP
forwarding
S7‑1500
CPU
as
of
firmware
version
V2.8
Number
of
Ethernet
interfaces:
The
CPU
has
at
least
two
Ethernet
interfaces.
Or
the
CPU
has
one
Ethernet
interface,
and
a
CP
1543-1
as
of
firmware
version
V2.2
provides the other Ethernet interface. In this case, the &quot;Access to PLC via
communication
module&quot;
function
must
be
enabled
for
the
CP
in
the
CPU.
IP
forwarding
is
enabled.
Suitable
standard
gateways/routes
are
configured
in
each
participating
device
along
the
outgoing
and
return
paths
of
the
IP
packets.
IP
route
table
When
IP
forwarding
is
enabled,
the
CPU
forwards
received
IP
packets
that
are
not
addressed
to
itself.
How
the
CPU
forwards
the
IP
packets
is
defined
in
its
internal
IP
route
table.
The
CPU
automatically
creates
the
IP
route
table
from
the
following
information
of
the
loaded
hardware
configuration:
IP
configuration
of
the
Ethernet
interfaces
Configured
router
Example
of
a
configuration
with
IP
forwarding
The
following
figure
shows
a
sample
configuration
along
with
the
required
IP
address
settings
and
router
settings.
A
PC
on
the
IP
subnet
192.168.4.0
communicates
with
an
HMI
device
on
the
IP
subnet
192.168.2.0.
The
IP
address
of
a
router
(&quot;Standard
Gateway&quot;)
is
configured
at
the
CPU,
Ethernet
interface
X3;
in
the
figure
below
it
is
the
device
that
is
designated
as
&quot;IP
Router&quot;.
In
STEP
7,
you
configure
a
router
in
the
interface
properties
under
&quot;Ethernet
Addresses&quot;
>
&quot;IP
Protocol&quot;.
1805051
128408
Figure
13-7
Configuring
the
router
For
the
PC,
the
IP
router,
the
IO
device
and
the
HMI
device,
the
IP
addresses
of
a
standard
gateway
or
the
corresponding
routes
are
also
entered.
406
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Routing
13.3
IP
forwarding
92.168.4.20
I3
DGGUHVV
3&
5
R
X
W
H
U
1
I
3
U
R
X
W
H
U
192.168.4.20l24
92
192.168.4.12l24
10.10.0.10
91
10.10.0.1l24
10.10.0.10l2
93
10.10.0.1
92
91
4
&
3
8
Z
i
W
K
D
F
W
i
Y
D
W
H
G
I
3
I
R
U
Z
D
U
G
i
Q
J
192.168.1.1l24
192.168.2.1l24
192.168.1.2l24
192.168.2.2l24
I
3
S
D
F
N
H
W
V
91
91
192.168.1.1
I2
GHYiFH
Figure
13-8
Sample
configuration
192.168.2.1
+0I
This
example
configuration
results
in
the
following
IP
routing
table
for
the
CPU.
Table
13-1
IP
route
table
of
the
CPU
Network
destination
Interface
Gateway
0.0.0.0/0
10.10.0.10
10.10.0.1
192.168.1.0/24
192.168.1.1
-
192.168.2.0/24
192.168.2.1
-
10.10.0.0/24
10.10.0.10
-
For
IP
communication
between
the
PG/PC
and
the
HMI
device,
you
need
to
set
up
additional
IP routes to the IP subnet of the HMI device both in the PC and in the IP router. In the HMI
device,
you
configure
the
IP
address
of
the
CPU
interface
X1
as
the
standard
gateway.
In
a
Windows
computer,
for
example,
you
set
up
an
additional
IP
route
from
the
command
prompt
using
the
command
&quot;route
add
<destination
IP
subnet>
mask
<subnet
mask>
<gateway>&quot;.
However,
you
need
certain
access
rights
for
this.
For
this
example,
enter
the
following
prompt:
&quot;route
add
192.168.2.0
mask
255.255.255.0
192.168.4.20&quot;
Communication
Function
Manual,
11/2024,
A5E03735815-AM
407
Routing
IP
forwarding
In an IP router, you set up additional routes, e.g. via a web interface. Set up the following
route
for
this
example:
Destination
IP
subnet:
192.168.2.0
Subnet
mask:
255.255.255.0
Gateway: 10.10.0.10
408
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Routing
13.3
IP
forwarding
Restrictions
You
cannot
configure
any
additional
IP
routes
other
than
the
router
(&quot;Standard
Gateway&quot;)
for
an S7-1500 CPU. The network destination is either a connected IP subnet, or the network
destination can be reached via exactly one configurable router. Because the S7‑1500 CPU
does
not
support
additional
IP
routes,
you
cannot
build
bi-directional
IP
router
cascades.
In
the
following
configuration,
you
can
configure
either
&quot;Router
1&quot;
or
&quot;Router
2&quot;
in
the
CPU.
&quot;Router
1&quot;
is
configured
as
an
example.
In
this
case,
you
cannot
configure
&quot;Router
2&quot;.
IP
communication
between
the
PC
and
the
HMI
device
is
not
possible
because
the
route
is
not
continuous
in
both
directions.
3&
I
3
V
X
E
Q
H
W
$
5
R
X
W
H
U
1
I
3
V
X
E
Q
H
W
%
&
3
8
Z
i
W
K
D
F
W
i
Y
D
W
H
G
I
3
I
R
U
Z
D
U
G
i
Q
J
91
I
3
V
X
E
Q
H
W
&
5
R
X
W
H
U
2
I
3
V
X
E
Q
H
W
D
+0I
Figure
13-9
Unsupported
IP
router
cascade
Communication
Function
Manual,
11/2024,
A5E03735815-AM
409
Routing
13.3
IP
forwarding
IP
forwarding
via
the
interface
of
a
CP
IP
forwarding
also
works
via
the
interface
of
a
CP.
For
this
you
have
to
activate
the
&quot;Access
to
PLC
via
communication
module&quot;
function
for
this
CP
in
the
CPU.
How
you
enable
the
&quot;Access
to
PLC
via
communication
module&quot;
function
is
described
in
the
online
help
of
STEP
7.
IP
forwarding
via
the
interface
of
a
CP
is
not
supported
by
the
CPs
(IE)
for
the
ET
200SP
CPUs.
Reaching
C/C++
Runtime
of
the
CPU
1518
4
PN/DP
MFP
via
interfaces
X1
or
X2
If you activate PN/DP MFP IP forwarding for the CPU 1518 4 PN/DP, you will not only reach
devices in the IP subnet of interface X3 via interfaces X1 and X2, but also C/C++ Runtime.
From
the
C/C++
Runtime
of
the
CPU
1518
4
PN/DP
MFP,
you
reach
all
devices
in
the
IP
subnets
of
the
interfaces
X1,
X2
and
X3.
Conditions:
IP
forwarding
is
enabled
for
the
CPU
1518
4
PN/DP
MFP.
The
IP
address
of
C/C++
Runtime
and
the
IP
address
of
interface
X3
are
located
in
the
same
IP
subnet.
The
routes
to
the
IP
subnets
at
X1
and
X2
are
entered
in
C/C++
Runtime.
In
C/C++
Runtime,
enter
a
route
with
the
following
command:
&quot;Route
add-net
<destination
IP
subnet>
mask
<subnet
mask>
gw
<gateway>
The
following
figure
shows
a
configuration
in
which
a
PC
accesses
the
C/C++
Runtime
of
CPU
1518-4
PN/DP
MFP
via
interface
X2.
I3
DGGUHVV
5
R
X
W
H
3&
3PVUF
BEE
192.168.15.0
NBTL
255.255.255.0
192.168.4.10
I
3
S
D
F
N
H
W
V
91
192.168.4.11l2
&38
1518-4
31/D3
0)3
Z
i
W
K
D
F
W
i
Y
D
W
H
G
I
3
I
R
U
Z
D
U
G
i
Q
J
4
$
l
$
+
+
3
V
O
U
J
N
F
1
9
2
.
1
6
8
.
1
5
.
1
8
(
%
F
G
B
V
M
U
)
3PVUF
BEE-OFU
192.168.4.0
NBTL
255.255.255.0
HX
192.168.15.10
92
91
192.168.4.10l24
93
192.168.15.10l24
192.168.2.10l24
Figure
13-10
Access
to
C/C++
Runtime
via
interface
X2
410
Communication
Function
Manual,
11/2024,
A5E03735815-AM
719962
214599
Routing
13.3
IP
forwarding
Take
network
security
into
account
for
IP
forwarding
If you activate IP forwarding for a CPU, you enable &quot;external&quot; access to devices that are
actually
only
accessible
and
controlled
by
the
CPU.
These
devices
are
therefore
usually
not
protected
against
attacks.
The
following
figure
shows
how
to
protect
your
automation
system
against
unauthorized
access.
2162648
242040
3&
3&
I
3
V
X
E
Q
H
W
$
6
&
$
/
$
1
&
(
6
I
3
V
X
E
Q
H
W
%
8
92
91
I
3
V
X
E
Q
H
W
D
1
$1
1543-1
&
3
8
Z
i
W
K
D
F
W
i
Y
D
W
H
G
I
3
I
R
U
Z
D
U
G
i
Q
J
I
3
V
X
E
Q
H
W
&
I
3
S
D
F
N
H
W
V
I2
GHYiFH
I2
GHYiFH
+0I
Figure
13-11
Network
security
for
IP
forwarding
The
CPU
accesses
all
devices
within
the
dark
green
IP
subnets
B
and
C
close
to
the
CPU
via
the
interfaces
X1
and
X2.
A
SCALANCE
S
router
is
configured
in
the
CPU.
The
CPU
accesses
the
devices
in
the
remote,
light
green
IP
subnet
A
via
the
router.
The
&quot;Access
to
PLC
via
communication
module&quot;
function
is
enabled
for
the
CP
1543
in
the
CPU.
The
CPU
reaches
all
devices
within
the
IP
subnet
D
via
W1
interface.
If
IP
forwarding
is
activated
in
the
CPU,
a
device
from
IP
subnet
A
can
access
any
device
within
IP
subnets
B,
C
and
D
close
to
the
CPU.
Protect
your
automation
system
and
connected
devices
against
unauthorized
access
from
outside.
Separate
the
CPU-related
IP
subnets
from
the
remote
IP
subnets
with
a
firewall.
For
example,
use
the
SCALANCE
S
security
modules
with
integrated
firewall.
3250380
18509
This application example (
https://support.industry.siemens.com/cs/ww/en/view/22376747
)
describes
how
to
protect
an
automation
cell
with
a
firewall
using
the
SCALANCE
S602
V3
and
SCALANCE
S623
security
modules.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
411
Routing
13.4
Data
record
routing
Enabling/disablng
IP
forwarding
To
enable
IP
forwarding,
proceed
as
follows:
Select
the
CPU
in
the
network
view
of
STEP
7
(TIA
Portal).
In
the
properties
of
the
CPU
of
the
Inspector
window,
navigate
to
&quot;General&quot;
>
&quot;Advanced
Configuration&quot;
>
&quot;IP
forwarding&quot;.
In
the
&quot;Configuration
IPv4
Forwarding&quot;
area,
select
the
check
box
&quot;Activate
IPv4
for
interfaces
of
this
PLC&quot;.
1814195
128058
Figure
13-12
Enabling
IP
forwarding
Result:
IP
forwarding
is
enabled
for
all
interfaces
of
the
S7-1500
CPU.
You
disable
IP
forwarding
by
clearing
the
check
box
&quot;Enable
IPv4
forwarding
for
interfaces
of
this
PLC&quot;.
13.4
Data
record
routing
Definition
of
data
record
routing
Data can be sent over PROFINET from an engineering station to field devices via multiple
networks. Since the engineering station addresses the field devices using standardized
records
and
these
records
are
routed
via
S7
devices,
the
term
&quot;data
record
routing&quot;
is
used
to
refer
to
this
type
of
routing.
The data sent using data record routing include the parameter assignments for the
participating field devices (slaves) and device-specific information (e.g. setpoint values, limit
values).
Data record routing is used, for example, when field devices of different manufacturers are
used. The field devices are addressed using standardized data records ( PROFINET) for
configuration
and
diagnostics.
Data
record
routing
with
STEP
7
You
can
perform
data
routing
with
STEP
7
by
calling
a
device
tool
(for
example,
PCT)
via
the
TCI interface (Tool Calling Interface) and passing call parameters. The device tool uses the
communication
paths
that
STEP
7
also
uses
for
communication
with
the
field
device.
No
configuration
is
required
for
this
type
of
routing
except
the
installation
of
the
TCI
tools
on
the
STEP
7
computer.
412
Communication
Function
Manual,
11/2024,
A5E03735815-AM
719962
214599
Routing
13.4
Data
record
routing
Example:
Data
record
routing
with
the
Port
Configuration
Tool
(PCT)
You
can
use
the
Port
Configuration
Tool
(PCT)
to
configure
the
IO
link
master
of
the
ET200
and assign parameters to connected IO link devices. The subnets are connected via data
record
routers.
Data
record
routers
are,
for
example,
CPUs,
CPs,
IMs,
IO
link
master.
2108269
225392
You
can
learn
about
the
constellations
of
data
record
routers
supported
by
the
PCT
in
this
FAQ
(
https://support.industry.siemens.com/cs/us/en/view/87611392
).
The
figure
below
shows
an
example
configuration
with
the
data
record
routing
with
PCT.
67-3&7
897589
21294
+0I
Automation System S7-1500 with
CP
1543-1
PROFINET
ET
200SP
with
IO
Link
Master
PROFIBUS
IO-Link
SIRIUS
Relay
3UG48
SIRIUS
Compac
Feeder
3RA6
SIRIUS
Load
Feeder
3RA2
with
3RA27
Function
Modules
SIRIUS
Relay
3RS14/
3RS15
SIMATIC
ET
200AL
with
IO Link Master
Actuators
Figure
13-13
Example
configuration
for
data
record
routing
with
PCT
RFID
System RF200
RFID
System
RF200
Additional
information
2659830
252951
The
differences
that
exist
between
&quot;normal&quot;
routing
and
data
record
routing
are
described
in
this
FAQ
(
https://support.industry.siemens.com/cs/ww/en/view/7000978
).
Whether
or
not
the
CPU,
CP
or
CM
you
are
using
supports
data
record
routing
can
be
found
in
the
relevant
manuals.
3934701
243470
The
allocation
of
connection
resources
with
data
record
routing
is
described
in
the
section
Allocation
of
connection
resources
(Page
421).
You
can
find
additional
information
on
configuration
with
STEP
7
in
the
STEP
7
online
help.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
413
Routing
13.5 Virtual interface
for IP-based applications
13.5
Virtual
interface
for
IP-based
applications
As of firmware version 2.8, the S7‑1500 CPU offers the option of reaching its IP-based
applications,
such
as
OPC
UA,
not
only
via
its
local
(PN)
interfaces,
but
also
via
the
interfaces
of communications processors in the same station. The supported communications
processors
can
be
found
in
the
requirements.
A
communication
partner
can
access
these
IP-based
applications
via
a
virtual
interface
that
can
be
configured
in
the
TIA
Portal
as
of
version
V16.
The
virtual
interface
is
called
W1
(according
to
IEC
81346-2).
Features
of
the
virtual
interface
The virtual interface is not a fully diagnosable interface with the familiar properties of
conventional interfaces. The virtual interface is not displayed in the graphical views, because
the
internal
connection
via
the
backplane
bus
does
not
represent
an
S7
subnet
and
does
not
have any ports. Therefore, a physical connection by means of a network cable cannot be
established.
The
IP
address
of
the
virtual
interface
is
displayed
(in
the
CPU
display
in
the
TIA
Portal)
and
can
be
configured.
The
following
communication
options
can
be
used
via
the
virtual
interface
W1:
OPC
UA
(client
and
server)
Programmed
OUC
connections
Programming
device/HMI
communication
Partner
access
from
S7
CPUs
via
PUT/GET
instructions
The
activated
interface
can
be
used
in
dialogs
where
IP-based
connections
are
configured.
&38
&3
W1
X2
X3
X1
X1
I
Q
G
X
V
W
U
i
D
O
(
W
K
H
U
Q
H
W
3
D
U
W
Q
H
U
23&
8$
6
Z
i
W
F
K
Figure
13-14
Principle
of
the
virtual
interface
414
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Routing
13.5
Virtual
interface
for
IP-based
applications
Compared
to
conventional
interfaces,
the
virtual
interface
has
the
following
restrictions:
No
access
to
the
web
server
over
the
virtual
interface.
Online
backup
is
not
possible
via
a
connected
programming
device
with
the
TIA
Portal.
If
the
CPU
and
communication
partners
are
connected
via
the
virtual
interface,
they
cannot
exchange
data
via
LLDP
(Link
Layer
Discovery
Protocol).
The
S7
routing
service
does
not
use
the
virtual
interface
W1.
Requirement
For
a
CPU
service
to
be
accessible
via
the
Ethernet
interface
of
a
CP,
the
following
requirements
must
be
fulfilled:
S7‑1500
CPU
as
of
firmware
version
V2.8
CP
1543‑1 as
of
firmware
version
V2.2
Recommendation: Use a CP 1543‑1 as of firmware version V3.0. As of this version, the
security functions (firewall) are also available for the virtual interface and no additional
firewall
needs
to
be
installed
between
the
station
and
an
insecure
network.
Configuration
of
the
virtual
interface
W1
In the properties of an S7‑1500 CPU as of firmware version V2.8, you can assign a plugged
communications module to the W1 virtual interface under &quot;Advanced configuration > Access
to
PLC
via
communication
module&quot;.
You
can
then
use
this
for
external
access
to
the
CPU.
If
no
CPs are plugged in or the plugged CPs do not support access to the CPU, the selection is
empty.
719962
158182
Figure
13-15
Selecting
the
CP
in
the
CPU
properties
After selecting the CP, the specifications and parameters for the virtual interface are
displayed.
You
can
edit
the
settings
for
the
IP
protocol
and
the
PROFINET
parameters
here.
The
IP
subnet
is
freely
selectable,
just
like
with
the
CP.
The
IP
subnet
is
entered
via
the
subnet
mask
and
IP
address
of
the
virtual
interface.
When
entering
the
IP
subnet
for
the
virtual
interface,
note
that
you
are
not
using
the
same
IP
subnet
as
for
the
local
interfaces
of
the
CPU.
Once
the
IP
address
is
entered,
it
is
shown
in
the
properties
dialog
of
the
OPC
UA
server
in
the
list of server addresses. These settings provide the CPU with the new W1 virtual interface, via
which
the
CPU
services
described
above,
such
as
the
OPC
UA
server,
can
be
accessed
via
a
Communication
Function
Manual,
11/2024,
A5E03735815-AM
415
Routing
13.5 Virtual interface
for IP-based applications
communications module. The corresponding connections and S7 communication (e.g. HMI
and
BSEND,
BRCV)
are
made
via
this
interface.
The
OPC
UA
server
does
not
allow
selection
of
a
specific
interface
(selection
via
an
IP
address),
it
is
only
possible
to
select
either
all
or
none.
NOTE
The IP address of the virtual interface is not listed as W1 in the device display under the
currently
displayed
local
interfaces
(Xn)
but
is
available
under
&quot;Addresses&quot;
in
the
&quot;Settings&quot;
section. The virtual interface is also visible when no CP is plugged or when the virtual
interface
is
not
activated.
If
no
IP
suite
is
available,
the
IP
address
and
the
subnet
mask
are
0.0.0.0.
If
you
change
the
configured
and
loaded
IP
address
parameters
of
the
virtual
interface
via
display,
T_CONFIG
instruction,
or
online,
the
loaded
configuration
is
active
again
after
the
CPU
restarts.
Configuration
changes
on
the
CP
A
change
in
the
assigned
communications
module
may
have
an
effect
on
the
configuration
of
the
virtual
interface:
In
the
properties
of
the
CPU:
Assignment
of
a
different
CP:
The
configuration
is
used
for
the
new
CP.
Deselect
the
assigned
CP:
The
virtual
interface
W1
is
deactivated
and
the
configuration
is
lost.
When
a
CP
is
assigned
again,
the
configuration
must
be
performed
again.
On
the
device:
Moving
the
CP:
If
the
CP
is
only
moved
to
another
slot
of
the
device,
the
configuration
continues
to
be
valid.
Removing the CP: If the CP is deleted or moved to another device, the configuration is
retained.
In
the
drop-down
list
of
the
CPU,
the
CP
is
displayed
as
missing
and
compiling
the configuration indicates an error. The missing CP can be deselected or assigned to
another
CP.
Display
in
the
diagnostics
and
the
system
constants
The
virtual
interface
W1
is
displayed
in
the
diagnostics
view
under
&quot;Online
&
Diagnostics&quot;.
The
hardware
ID
of
the
virtual
interface
is
displayed
in
the
system
constants
of
the
CPU
properties.
416
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Routing
13.5
Virtual
interface
for
IP-based
applications
Settings
in
the
communications
module
(CP
1543‑1
as
of
FW
version
V3.0)
Starting with firmware version V3.0 you can use the CP internal firewall to secure the data
traffic via the virtual interface. To activate the firewall in the communications module, follow
these
steps
in
the
protected
project:
Select
the
communications
module
in
the
STEP
7
work
area.
In
the
Inspector
window,
go
to
&quot;Properties
>
Security&quot;.
Activate
the
&quot;Enable
security
functions&quot;
option.
The
configurable
security
functions
now
appear
in
the
Inspector
window.
Activate
the
options
&quot;Enable
firewall&quot;.
In
the
Inspector
window
you
can
now
allow
the
use
of
the
virtual
interface
W1.
You
can
only
secure
data
traffic
via
the
W1
virtual
interface
of
the
CPU
for
the
OPC
UA
service.
NOTE
Checking
the
manual
configuration
If the firewall is enabled, you need to manually check whether the desired services are
allowed by the firewall. Only enable those services for the IP and MAC filters that you also
want
to
access
via
the
CP
interface.
See
the
notes
on
security
settings
and
firewall
rules
of
the
S7‑1500
CPs
in
the
information
system
of
the
TIA
Portal.
Settings
in
the
communications
module
(CP
1543‑1,
FW
version
V2.2,
<
V3.0)
The security functions of the CP 1543‑1 with a firmware version lower than V3.0 cannot
secure data traffic via the virtual interface. Although you can activate the security functions in
the
TIA
Portal,
it
is
not
possible
to
compile
such
a
configuration.
Connecting
to
non-secure
networks
If
you
connect
the
CP
to
a
non-secure
network,
it
is
imperative
that
you
place
an
additional
firewall between the CP and the non-secure network. You can use the SCALANCE S602 V3
and
SCALANCE
S623
Security
Modules
with
integrated
firewall,
for
example.
NOTICE
Communication
Function
Manual,
11/2024,
A5E03735815-AM
417
Connection
resources
14
14.1
Connection
resources
of
a
station
Introduction
Some communications services require connections. Connections occupy resources in the
automation
system
(station).
The
connection
resources
are
made
available
to
the
station
by
the
CPUs,
communications
processors
(CPs)
and
communications
modules
(CMs).
Connection
resources
of
a
station
The
connection
resources
available
depend
on
the
CPUs,
CPs
and
CMs
being
used
and
must
not
exceed
a
maximum
number
per
station.
The
maximum
number
of
resources
of
a
station
is
determined
by
the
CPU.
Reserved
connection
resources
Each CPU has reserved connection resources for PG, HMI and Web server communication.
This ensures, for example, that a PG can always establish at least one online connection with
the
CPU
regardless
of
how
many
other
communications
services
are
already
using
connection
resources.
Dynamic
connection
resources
In addition, dynamic resources exist. The difference between the maximum number of
connection
resources
and
the
number
of
reserved
connection
resources
is
the
maximum
number
of
dynamic
connection
resources.
The communications services PG Communication, HMI Communication, S7 Communication,
Open
User
Communication,
Web
Communication,
OPC
UA
Client/Server
Communication
and
other
communication
from
the
pool
of
dynamic
connection
resources
are
used.
418
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Connection
resources
14.1
Connection
resources
of
a
station
The
figure
below
shows
an
example
of
how
individual
components
make
connection
resources
available
to
an
S7-1500
station.
B
1
2
%
$
A
①         Available connection resources of the station, of which
A
Reserved
connection
resources
of
the
station
A
+
B
Connection
resources
of
CPU
1518
C
Connection resources of communications module CM 1542‑1
D
Connection
resources
of
communications
processor
CP
1543‑1
②
Maximum
communications
resources
of
the
station
using
the
example
of
a
configuration
from
CPU
1518,
CM
1542‑1
and
CP
1543‑1
Figure
14-1
Connection
resources
of
a
station
Number
of
connection
resources
of
a
station
Table
14-1
Maximum
number
of
connection
resources
supported
for
some
CPU
types
Connection
resources
of
a
sta-
tion
1511C
1511
1512C
1513
1515
1516
1517
1518
Maximum
connection
resources
of
the
station
96
128
256
320
384
of
which
reserved
10
of
which dynamic
86
118
246
310
374
Communication
Function
Manual,
11/2024,
A5E03735815-AM
419
Connection
resources
Connection
resources
of
a
station
Connection
resources
of
a
sta-
tion
1511C
1511
1512C
1513
1515
1516
1517
1518
Connection
resources
of
the
CPU
64
88
128
288
320
Max.
additionally
usable
connec-
tion resources by plugging in
CMs/CPs
32
40
128
32
64
Additional connection
resources
CM
1542-1
64
Additional connection
resources
CP
1543-1
118
Additional connection
resources
CM
1542-5
48
Additional
connection
resources
CP
1542-5
16
The
number
of
connection
resources
supported
by
a
CPU
or
a
communications
module
is
described
in
the
technical
specifications
section
of
the
Equipment
Manuals.
Example
You
have
configured
a
CPU
1516-3
PN/DP
with
a
CM
1542-1
communications
module
and
a
CP
1542-5
communications
processor.
Maximum
connection
resources
of
the
station:
256
Available
connection
resources:
–
CPU
1516-3
PN/DP:
128
–
CM
1542-1:
64
–
CP
1542-5:
16
Total:
208
The
setup
provides
208
connection
resources.
By
adding
further
communications
modules,
the
station
can
support
a
maximum
of
48
additional
connection
resources.
Reserved
connection
resources
10
connection
resources
are
reserved
for
stations
with
S7‑1500
CPU,
ET
200SP
CPU
and
ET
200pro
CPU
based
on
S7-1500:
4
for
PG
communication
required
by
STEP
7,
for
example,
for
test
and
diagnostics
functions
or
downloading
to
the
CPU
4
for
HMI
communication
which
are
occupied
by
the
first
HMI
connections
configured
in
STEP
7
2
for
communication
with
the
Web
server
420
Communication
Function
Manual,
11/2024,
A5E03735815-AM
719962
214599
Connection
resources
Allocation
of
connection
resources
More
information
5769216
242200
Information
on
the
connection
resources
of
the
S7-1500R/H
redundant
system
is
available
in
the
section
Connection
resources
of
the
redundant
system
S7-1500R/H
(Page
446).
14.2
Allocation
of
connection
resources
Overview
-
occupation
of
connection
resources
The
following
figure
shows
how
different
connections
occupy
the
resources
of
the
S7-1500.
:
H
E
V
H
U
Y
H
U
2014104
-54673
+0I
1
4
67-1500
2
67-1500
3
7
6
5
23&
8$
VHUYHU
2
3
&
8
$
F
O
i
H
Q
W
3
*
/
3
&
①
HMI
communication:
See
below.
②
Open
User
Communication:
Connections
of
Open
User
Communication
occupy
a
connection
resource
in
every
end
point.
③
S7
communication:
Connections
of
S7
communication
occupy
a
connection
resource
in
every
end
point.
④
Web
communication:
The
Web
server
connection
occupies
at
least
one
connection
resource
in
the
station.
The
number
of
occupied
connections
depends
on
the
browser.
⑤
PG
communication:
The
PG
connection
occupies
one
connection
resource
in
the
station.
⑥
OPC
UA
client/server
communication:
Connection
resource
allocation
for
the
server,
see
below
⑦
OPC
UA
client/server
communication:
Connection
resource
allocation
for
the
client,
see
below
Connection
resource
for
HMI
communication
Connection
resource
for
Open
User
Communication
Connection
resource
for
S7
communication
Connection
resource
for
Web
communication
Connection
resource
for
PG
communication
Connection
resources
for
OPC
UA
server
communication
Figure
14-2
Allocation
of
connection
resources
Communication
Function
Manual,
11/2024,
A5E03735815-AM
421
Connection
resources
Allocation
of
connection
resources
Connection
resources
for
HMI
communication
With
HMI
communication,
the
occupation
of
connection
resources
in
the
station
depends
on
the
HMI
device
being
used.
Table
14-2
Maximum
occupied
connection
resources
for
different
HMI
devices
HMI
device
Maximum
occupied
connection
resources
of
the
station
per
HMI
connection
Basic
Panel
1
Unified
Basic
Panel
3
Comfort
Panel
2
1
Unified
Comfort
Panel
3
Mobile
Panel
2
1
RT
Advanced
2
1
RT
Professional
3
Unified
PC
3
1
If
you
do
not
use
system
diagnostics
or
alarm
configuration,
the
station
occupies
only
one
connec-
tion
resource
per
HMI
connection.
Example
:
You
have
configured
the
following
HMI
connections
for
a
CPU
1516‑3
PN/DP:
Two
HMI
connections
to
an
HMI
TP700
Comfort.
(2
connection
resources
each)
One
HMI
connection
to
an
HMI
KTP1000
Basic.
(1
connection
resource)
In
total
5
connection
resources
are
occupied
for
HMI
communication
in
the
CPU.
Connection
resources
for
OPC
UA
client
communication
Each
connection
that
the
OPC
UA
client
of
the
CPU
has
established
to
an
OPC
UA
server
occupies
a
connection
resource
in
the
station.
When
establishing
and
closing
an
OPC
UA
connection,
the
OPC
UA
client
temporarily
occupies
an
additional
connection
resource.
According
to
RFC
793,
this
connection
resource
is
released
again
after
a
wait
of
approx.
60
seconds.
NOTE
Lack
of
resources
due
to
temporary
connection
resources
A
lack
of
connection
resources
occurs
in
the
following
situation:
The
OPC
UA
client
of
the
CPU
establishes
or
closes
several
connections
simultaneously.
The
number
of
available
connection
resources
of
the
station
is
insufficient
for
permanent
and
temporary
connection
resources
of
the
OPC
UA
client
communication.
Ensure
that
there
are
always
enough
available
connection
resources
in
the
station
to
establish
and
end
OPC
UA
connections.
Measures:
Plan
enough
reserve
for
the
OPC
UA
client
connections.
If
necessary,
establish
or
close
the
OPC
UA
connections
one
after
the
other.
422
Communication
Function
Manual,
11/2024,
A5E03735815-AM
719962
214599
Connection
resources
Allocation
of
connection
resources
Connection
resources
for
routing
To
transfer
data
beyond
S7
subnets
(&quot;S7
routing&quot;),
an
S7
connection
is
established
between
two
CPUs.
The
S7
subnets
are
connected
via
gateways
known
as
S7
routers.
CPUs,
CMs
and
CPs
in
S7‑1500
are
S7
routers.
The
following
applies
for
a
routed
S7
connection:
A
routed
connection
occupies
one
connection
resource
each
in
both
end
points.
STEP
7
shows
these
connection
resources
in
the
&quot;Connection
resources&quot;
table.
On the S7 router, two special connection resources are occupied for S7 routing. STEP 7
does not show the special connection resources for S7 routing in the &quot;Connection
resources&quot; table. The number of resources for S7 routing depends on the CPU. You will
find
the
resources
for
S7
routing
in
the
technical
specifications
of
the
CPU
in
&quot;Number
of
S7
routing
connections&quot;.
(
Q
G
S
R
i
Q
W
6
7
U
R
X
W
H
U
(
Q
G
S
R
i
Q
W
Connection
resource
for
S7
communication
Special
connection
resources
for
S7
routing
Figure
14-3
Connection
resources
with
S7
routing
Data
record
routing
also
enables
transfer
of
data
beyond
S7
subnets
from
an
engineering
station
connected
to
PROFINET
to
various
field
devices
via
PROFIBUS.
With
data
record
routing,
as
with
S7
routing,
two
of
the
special
connection
resources
for
S7
routing
are
also
occupied
on
every
data
record
router.
NOTE
Connection
resources
with
data
record
routing
With
data
record
routing,
on
the
data
record
router,
two
special
connection
resources
for
S7
routing are occupied. Neither the data record connection nor the allocated connection
resources
are
displayed
in
the
table
of
connection
resources.
When
are
connection
resources
occupied?
4026649
242200
The
time
for
the
occupation
of
connection
resources
depends
on
how
the
connection
is
set
up
(see
section
Setting
up
a
connection
(Page
45)).
Programmed
setup
of
a
connection
:
As
soon
as
an
instruction
to
establish
a
connection
is
called
in
the
user
program
(TSEND_C/TRCV_C
or
TCON),
a
connection
resource
is
occupied.
With suitable parameter assignment of the CONT parameter of the TSEND_C/TRCV_C
instructions or by calling the TDISCON instruction, the connection can be terminated
following data transfer and the connection resource is available again. When the
connection
is
terminated,
the
connection
resources
on
the
CPU/CP/CM
are
available
again.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
423
Connection
resources
Allocation
of
connection
resources
Configured
connections
(e.g.
S7
connection):
If
you
have
configured
a
connection
in
STEP
7,
the
connection
resource
is
occupied
as
soon
as
the
hardware
configuration
is
downloaded
to
the
CPU.
After using a configured connection for data transfer, the connection is not terminated.
The connection resource is permanently occupied. To release the connection resource
again,
you
need
to
delete
the
configured
connection
in
STEP
7
and
download
the
modified
configuration
to
the
CPU.
PG
connection
:
As
soon
as
you
have
connected
the
PG
to
a
CPU
online
in
STEP
7,
connection
resources
are
occupied.
Web
server
:
As
long
as
you
have
opened
the
Web
server
of
the
CPU
in
a
browser,
connection
resources
are
occupied
in
the
CPU.
OPC
UA
server
Each
connection
to
the
OPC
UA
server
of
the
CPU
occupies
a
connection
resource
in
the
station. This connection resource is released immediately when the connection is
terminated.
OPC
UA
client
Each connection that the OPC UA client of the CPU has established to an OPC UA server
occupies
a
connection
resource
in
the
station.
When
an
OPC
UA
connection
is
established,
the OPC UA client temporarily occupies an additional connection resource. When an OPC
UA connection is terminated, the connection resource is not released again until after a
wait
time
of
approx.
60
seconds
in
accordance
with
RFC
793.
Monitoring
the
maximum
possible
number
of
connection
resources
Offline
During configuration of connections, STEP 7 monitors the occupation of the connection
resources.
If
the
maximum
possible
number
of
connection
resources
is
exceeded,
STEP
7
signals
this
with
a
suitable
warning.
Online
The
CPU
monitors
the
use
of
connection
resources
in
the
automation
system.
If
you
establish
more connections in the user program than those provided by the automation system, the
CPU
acknowledges
the
instruction
to
establish
the
connection
with
an
error.
S7-1500
and
S7-300
comparison
You will find a comparison of how the communication resources of the S7-1500 and S7-300
are
managed
in
this
FAQ
(
https://support.industry.siemens.com/cs/ww/en/view/109747092
).
424
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Connection
resources
Display
of
the
connection
resources
Display
of
the
connection
resources
Display
of
the
connection
resources
in
STEP
7
(offline
view)
You can display the connection resources of an automation system in the hardware
configuration. You will find the connection resources in the Inspector window in the
properties
of
the
CPU.
1
2
Figure
14-4
Example:
Reserved
and
available
connection
resources
(offline
view)
①
Station-specific
connection
resources
The
columns
of
the
station-specific
connection
resources
provide
information
about
the
used
and
available
connection
resources
of
the
station.
In
the
example,
a
maximum
of
256
station-specific
connection
resources
are
available
for
the
automation
system.
10 reserved connection resources, of which 4 are already in use and a further 6 available.
The
used
resources
are
divided
up
as
follows:
4
Resources
for
HMI
communication
246 dynamic connection resources, of which 26 are already in use and a further 220
available.
The
used
resources
are
divided
up
as
follows:
6
resources
for
HMI
communication
7
resources
for
S7
communication
13
resources
for
Open
User
Communication
Communication
Function
Manual,
11/2024,
A5E03735815-AM
425
Connection
resources
14.3
Display
of
the
connection
resources
The
warning
triangle
in
the
column
of
the
dynamic
station
resources
is
displayed
because
the
sum of the maximum available connection resources of CPU, CP and CM (= 310 connection
resources)
exceeds
the
station
limit
of
256.
NOTE
Available
connection
resources
exceeded
STEP
7
signals
the
exceeding
of
the
station-specific
connection
resources
with
a
warning.
To
make
full
use
of
the
connection
resources
from
the
CPU,
CP
and
CM,
either
use
a
CPU
with
a
higher maximum number of available station-specific connection resources or reduce the
number
of
communications
connections.
②
Module-specific
connection
resources
The
columns
of
the
module-specific
connection
resources
provide
information
about
the
use
of
resources
on
the
CPUs,
CPs
and
CMs
of
an
automation
system:
The
display
is
per
module
and
not
per
interface.
In the example, the CPU makes a maximum of 128 connection resources available, of which
18
are
already
in
use
and
110
still
available.
The
used
resources
are
divided
up
as
follows:
6
resources
for
HMI
communication
4
resources
for
S7
communication
8
resources
for
Open
User
Communication
Display
of
the
connection
resources
in
STEP
7
(online
view)
If
you
are
connected
to
the
CPU
online,
you
can
also
see
how
many
resources
are
currently
being
used
under
&quot;Connection
information&quot;.
543433
153985
Figure
14-5
Connection
resources
-
online
426
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Connection
resources
14.3
Display
of
the
connection
resources
The online view of the &quot;Connection resources&quot; table in addition to the offline view also
contains columns with the connection resources currently being used. Thus, the online view
displays
all
used connection resources in the automation system, regardless of how the
connection
was
set
up.
The
&quot;Other
communication&quot;
row
displays
connection
resources
assigned
for
communication
with
external
devices.
The
table
is
updated
automatically.
NOTE
If
a
routed
S7
connection
goes
through
a
CPU,
the
required
connection
resources
of
the
CPU
do
not
appear
in
the
table
of
connection
resources.
Display
of
the
connection
resources
for
HMI
For
information
regarding
the
availability
and
assignment
of
connection
resources
for
HMI
connections,
refer
to
the
&quot;Connection
resources&quot;
properties
in
the
Inspector
window
of
the
offline
view
(in
the
context
of
the
HMI
device).
719962
156891
Figure
14-6
Connection
resources
-
HMI
communication
The
following
is
displayed
in
the
connection
resources
area:
Number
of
available
connections
on
the
HMI
reserved
for
HMI
communication
and
HTTP
communication
Number
of
connection
resources
for
HMI
communication
and
HTTP
communications
used
offline
in
the
HMI
If
the
maximum
number
of
available
connection
resources
for
an
HMI
device
is
exceeded,
a
corresponding
message
is
output
by
STEP
7.
&quot;Maximum
number
of
used
PLC
resources
per
HMI
connection&quot;.
This
parameter
is
a
factor
that
is
to
be
multiplied
by
the
number
of
HMI
connections
used
offline.
The
product
is
the
number
of
HMI
resources
occupied
on
the
CPU.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
427
Connection
resources
14.3
Display
of
the
connection
resources
Displaying
the
connection
resources
in
the
Web
server
You
can
display
the
connection
resources
not
only
in
STEP
7,
but
also
with
a
browser
that
displays
the
relevant
page
of
the
Web
server.
You
will
find
information
on
displaying
connection
resources
in
the
Web
server
in
the
Web
Server
(
https://support.industry.siemens.com/cs/us/en/view/59193560
)function
manual.
428
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Diagnostics
and
fault
correction
15
15.1
Connection
diagnostics
Connections
table
in
the
online
view
After
selecting
a
CPU
in
the
Devices
&
networks
editor
of
STEP
7,
you
will
see
the
status
of
your
connections
displayed
in
the
online
view
of
the
connections
table.
722502
169229
Figure
15-1
Online
view
of
the
connections
table
After
selecting
the
connection
in
the
connections
table,
you
obtain
detailed
diagnostic
information
in
the
&quot;Connection
information&quot;
tab.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
429
Diagnostics
and
fault
correction
Connection
diagnostics
&quot;Connection
information&quot;
tab:
Connection
details
541908
163801
Figure
15-2
Diagnostics
of
connections
-
connection
details
430
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Diagnostics
and
fault
correction
15.1
Connection
diagnostics
&quot;Connection
information&quot;
tab:
Address
details
722502
163928
Figure
15-3
Diagnostics
of
connections
-
address
details
Diagnostics
via
web
server
You
can
evaluate
diagnostic
information
from
the
CPU
using
a
web
browser
via
the
integrated
web
server
of
a
CPU.
On
the
&quot;Communication&quot;
Web
page,
you
will
find
the
following
information
about
communication
via
PROFINET
in
various
tabs:
Information
on
the
PROFINET
interfaces
of
the
CPU
(for
example
addresses,
subnets,
physical
properties).
Information
on
the
quality
of
the
data
transfer
(for
example
number
of
data
packets
sent/received
error-free).
Information
about
the
allocation/availability
of
connection
resources.
The
&quot;Connection
status&quot;
page
is
similar
to
the
online
view
in
STEP
7
and
also
provides
an
overview
of
all
connections
with
detail
view.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
431
Diagnostics
and
fault
correction
15.2
Emergency
address
Diagnostics
with
the
user
program
When
you
program
the
T_DIAG
instruction,
you
can
evaluate
diagnostic
information
about
the
configured
and
programmed
connections
of
the
CPU
using
the
user
program.
Additional
information
You
will
find
the
description
of
the
web
server
functionality
in
the
function
manual
Web
serv-
er
(
https://support.industry.siemens.com/cs/us/en/view/59193560
).
Emergency
address
If you cannot reach the CPU via the IP address, you can set a temporary emergency address
(emergency
IP)
for
the
CPU.
Via
this
emergency
address,
you
can
re-establish
the
connection
with
a
CPU
in
order
to
load
a
device
configuration
with
a
valid
IP
address.
You
can
set
an
emergency
address
regardless
of
the
protection
level
of
the
CPU
When
do
you
need
an
emergency
address?
Your
CPU
cannot
be
reached
in
the
following
cases:
The
IP
address
of
your
PROFINET
interface
is
assigned
twice.
The
subnet
mask
is
set
incorrectly.
Requirements
•
You
have
selected
&quot;Set
IP
address
in
the
project&quot;
for
the
IP
protocol
in
the
device
configuration
in
STEP
7.
•
No
configuration
with
enabled
DCP
write
protection
loaded.
•
The
CPU
is
in
STOP
mode.
Restoring
a
valid
device
configuration
with
an
emergency
address
Set
the
emergency
address
for
the
interface
of
the
CPU
with
a
DCP
tool.
For
example,
the
SIMATIC
Automation
Tool
has
a
DCP
command
&quot;Define
IP
address&quot;.
The
maintenance
LED
of
the
CPU
lights
up.
The
diagnostic
buffer
also
shows
that
an
emergency
address
was
activated
for
an
Ethernet
interface.
Load
a
STEP
7
project
with
a
valid
IP
address
into
the
CPU.
Switch
the
CPU
off
and
on
again.
The
emergency
address
is
reset.
Result
The
CPU
starts
up
with
the
valid
IP
address.
432
Communication
Function
Manual,
11/2024,
A5E03735815-AM
16
Communication
with
the
redundant
system
S7-1500R/H
Introduction
Communication
with
the
S7‑1500R/H
redundant
system
basically
functions
as
with
the
S7‑1500
standard
system.
This
chapter
describes
the
special
features
and
restrictions
for
communication
with
the
S7‑1500R/H
redundant
system.
Communication
options
for
the
S7‑1500R/H
redundant
system
Open
User
Communication
via
TCP/IP,
UDP,
ISO
on-TCP
and
Modbus/TCP
Secure
Open
User
Communication
with
exception
of
the
&quot;Secure
OUC
via
e-mail&quot;
function
(see
also
Secure
Open
User
Communication
(Page
90))
S7
communication
as
server
HMI
communication,
PG
communication
Data
exchange
via
OPC
UA
as
server
Secure
PG/HMI
communication
(see
also
Secure
PG/HMI
communication
(Page
107))
SNMP
Time-of-day
synchronization
via
NTP
Web
server
(only
via
Web
API)
Support
of
the
CP
1543‑1
communications
processor
as
central
plugged
module
(see
also
S7‑1500R/H
System
Manual
(
https://support.industry.siemens.com/cs/us/en/view/109754833
))
Restrictions
for
communication
with
the
S7‑1500R/H
redundant
system
Open
User
Communication:
no
configured
connections
Email:
The
S7-1500R/H
CPUs
support
only
the
versions
<
V5.0
of
the
&quot;TMAIL_C&quot;
instruction.
Versions
from
V5.0
are
not
supported.
No
support
of
connection
descriptions
according
to
&quot;TCON_Param&quot;
no
S7
communication
as
client
PG
communication:
It
is
not
possible
to
access
two
CPUs
online
at
the
same
time.
You
can
either
access
the
primary
CPU
or
the
backup
CPU.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
433
Communication
with
the
redundant
system
S7-1500R/H
16.1
System IP
addresses for
R/H CPUs
16.1
System
IP
addresses
for
R/H
CPUs
Introduction
In
addition
to
the
device
IP
addresses
of
the
CPUs,
the
S7‑1500R/H
redundant
system
also
supports
these
system
IP
addresses:
•
System
IP
address
for
the
PROFINET
interfaces
X1
of
the
two
CPUs
(system
IP
address
X1)
•
System
IP
address
for
the
PROFINET
interfaces
X2
of
the
two
CPUs
(system
IP
address
X2)
•
System
IP
address
for
the
PROFINET
interfaces
X3
of
the
two
CPUs
(system
IP
address
X3)
You use the system IP addresses for communication with other devices (for example, HMI
devices, CPUs, PCs). The devices always communicate over the system IP address with the
primary CPU of the redundant system. This ensures, for example, that the communication
partner
can
communicate
with
the
new
primary
CPU
(previously
backup
CPU)
in
the
RUN‑Solo
system
state
after
failure
of
the
original
primary
CPU
in
redundant
operation.
There
is
a
virtual
MAC
address
for
each
system
IP
address.
You
enable
the
system
IP
addresses
in
STEP
7.
Advantages
of
system
IP
addresses
compared
to
device
IP
addresses
•
The
communication
partner
communicates
specifically
with
the
primary
CPU.
•
The
S7‑1500R/H
redundant
system
can
continue
to
communicate
over
a
system
IP
address
even
if
the
primary
CPU
fails.
Applications
You
use
the
system
IP
addresses
for
the
following
applications:
•
HMI
communication
with
the
S7‑1500R/H
redundant
system:
You
can
use
an
HMI
device
to
control
or
monitor
the
process
on
the
redundant
S7
1500R/H
system.
•
Open
User
Communication
with
the
S7‑1500R/H
redundant
system:
Another
CPU
or
an
application
on
a
PC
accesses
data
of
the
S7‑1500R/H
redundant
system.
The
S7‑1500R/H
redundant
system
accesses
a
different
device.
TCP,
UDP
and
ISO‑on‑TCP‑connections
are
possible.
•
IP
forwarding:
If
you
use
the
system
IP
addresses
as
the
gateway/default
route
for
IP
routes
through
the
S7‑1500R/H
redundant
system,
IP
packets
are
forwarded
even
if
a
CPU
fails.
Requirements
•
The
interface
of
the
communication
partner
is
connected
to
both
CPUs,
each
via
the
same
interface
(e.g.
X2).
•
The
system
IP
address
for
the
interfaces
of
the
S7‑1500R/H
system
is
enabled.
434
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.1
System
IP
addresses
for
R/H
CPUs
Communication
via
the
system
IP
addresses
X2
and
X3
If
the
CPUs
of
the
redundant
S7‑1500R/H
system
have
two
or
three
PROFINET
interfaces,
it
is
preferable
to
use
the
PROFINET
interface
X2
or
X3
for
communication
with
other
devices.
The following figure shows a configuration in which the communication partners are
connected
via
the
respective
PROFINET
interfaces
X2
with
the
CPUs
of
the
S7‑1500R/H
redundant
system.
3&
&38
+0I
I
Q
G
X
V
W
U
i
D
O
(
W
K
H
U
Q
H
W
1
2
3
5-&38
3
U
i
P
D
U
\
6
\
V
W
H
P
I
3
D
G
G
U
H
V
V
;
2
5-&38
%DFNXS
;
2
;
1
;
2
;
1
I2-DHYiFH
3
5
2
)
I
1
(
7
I
2
①
Open
User
Communication
between
another
CPU
and
the
S7‑1500R
redundant
system
②
HMI
communication
with
the
S7‑1500R
redundant
system
③
Open
User
Communication
between
the
S7‑1500R
redundant
system
and
a
PC
Figure
16-1
Example:
Communication
of
the
S7‑1515R
redundant
system
via
the
system
IP
address
X2
Communication
Function
Manual,
11/2024,
A5E03735815-AM
435
Communication
with
the
redundant
system
S7-1500R/H
16.1
System IP
addresses for
R/H CPUs
Communication
via
the
system
IP
address
X1
The following diagram shows a configuration where the communication partners are
connected
with
a
switch
to
the
PROFINET
ring
of
the
S7‑1500R/H
redundant
system.
The
PROFINET
ring
connects
the
communication
partners
with
the
respective
PROFINET
interfaces
X1
of
the
two
CPUs.
Since
the
CPU
1513R‑1
PN
only
has
one
PROFINET
interface,
connection
via
the
PROFINET
ring
is
the
only
possibility
of
communicating
via
the
system
IP
address
X1.
&38
+0I
3&
I
Q
G
X
V
W
U
i
D
O
(
W
K
H
U
Q
H
W
1
2
3
6
\
V
W
H
P
I
3
D
G
G
U
H
V
V
;
1
5-&38
5-&38
(
3
U
i
P
D
U
\
)
(
%
D
F
N
X
S
)
;
1
;
1
6
Z
i
W
F
K
I2-DHYiFH
①
Open
User
Communication
between
the
S7‑1500R
redundant
system
and
another
CPU
②
HMI
communication
with
the
S7‑1500R
redundant
system
③
Open
User
Communication
between
the
S7‑1500R
redundant
system
and
a
PC
Figure
16-2
Example:
Communication
of
the
S7‑1513R
redundant
system
via
the
system
IP
address
X1
436
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.1
System
IP
addresses
for
R/H
CPUs
Communication
via
the
system
IP
addresses
X1,
X2,
and
X3
You
can
use
one
system
IP
address
for
each
PROFINET
interface
of
the
redundant
S7‑1500R/H
system.
PROFINET
devices
which
are
connected
to
X1
interfaces
of
the
CPUs
communicate
via
the
system
IP
address
X1.
PROFINET
devices
which
are
connected
to
X2
interfaces
of
the
CPUs
communicate
via
the
system
IP
address
X2.
PROFINET
devices
which
are
connected
to
the
X3
interfaces
of
the
CPUs
communicate
via
the
system
IP
address
X3.
&38
+0I
3&
I
Q
G
X
V
W
U
i
D
O
(
W
K
H
U
Q
H
W
1
2
3
6
\
V
W
H
P
I
3
D
G
G
U
H
V
V
;
2
5-&38
5-&38
(
3
U
i
P
D
U
\
)
(
%
D
F
N
X
S
)
;
2
;
1
;
2
6
\
V
W
H
P
I
3
D
G
G
U
H
V
V
;
1
2
;
1
3
5
2
)
I
1
(
7
I
2
+0I
I2-DHYiFH
6
Z
i
W
F
K
①
Open
User
Communication
between
the
S7‑1500R
redundant
system
and
another
CPU
②
HMI
communication
with
the
S7‑1500R
redundant
system
③
Open
User
Communication
between
the
S7‑1500R
redundant
system
and
a
PC
Figure 16-3 Example: Communication of the S7‑1515R redundant system via the system IP
addresses
X1
and
X2
With
an
S7‑1500H(F)
system,
you
also
have
the
option
of
dividing
your
system
into
several
PROFINET
rings.
In
this
case,
you
must
connect
the
required
S1/S2
devices
in
a
separate
PROFINET
ring
behind
a
Y‑switch.
Recommendation: For increased availability of the S1/S2 devices, you need two Y-switches
with
DNA
redundancy
(SCALANCE
XF204‑2BA
DNA).
One
Y‑switch
takes
on
the
roles
of
MRP
manager and DNA manager. Another Y‑switch takes on the roles of MRP client and DNA
client.
DNA
redundancy
is
only
possible
with
a
connected
PROFINET
ring.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
437
Communication
with
the
redundant
system
S7-1500R/H
System
IP
addresses
for
R/H
CPUs
You can find more information on configuration scenarios with Y‑switches in the S7-1500R/H
Redundant System (
https://support.industry.siemens.com/cs/ww/en/view/109754833
)
System
Manual.
IP
forwarding
via
system
IP
addresses
If
you
use
the
system
IP
addresses
as
gateway/default
routes
for
IP
routes
through
the
S7-1500R/H
redundant
system,
IP
packets
are
forwarded
even
if
a
CPU
fails.
In the following figure, the PC is connected to the two X2 interfaces of the S7‑1500R CPUs.
Enter the system IP address X2 as a gateway in the PC for the route to the HMI device. The
HMI
device
is
connected
to
the
PROFINET
ring
of
the
S7‑1500
redundant
system
via
a
switch.
The
system
IP
address
X1
is
configured
as
the
router
in
the
HMI
device.
3&
*
D
W
H
Z
D
\
I
3
V
X
E
Q
H
W
$
5-&38
6
\
V
W
H
P
I
3
D
G
G
U
H
V
V
;
2
5-&38
I
3
S
D
F
N
H
W
V
(
Q
D
E
O
H
I
3
I
R
U
Z
D
U
G
i
Q
J
;
1
;
2
;
2
;
1
6
\
V
W
H
P
I
3
D
G
G
U
H
V
V
;
1
*
D
W
H
Z
D
\
6
Z
i
W
F
K
I
3
V
X
E
Q
H
W
%
+0I
Figure
16-4
Example:
IP
forwarding
via
system
IP
addresses
438
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.1
System
IP
addresses
for
R/H
CPUs
Enable
system
IP
addresses
Requirements:
STEP 7
from
V15.1
S7‑1500R/H
redundant
system
with
two
CPUs,
e.g.
two
1513R-1
PN
CPUs
If
the
CPUs
of
the
S7‑1500R/H
redundant
system
have
two
PROFINET
interfaces
(X1
and
X2),
then
you
can
use
a
system
IP
address
for
both
PROFINET
interfaces.
The
following
describes
how
to
enable
the
system
IP
address
for
the
X1
interface.
To
activate
the
system
IP
address
for
your
S7‑1500R/H
redundant
system,
follow
these
steps:
In
the
network
view
of
STEP
7,
select
the
X1
interface
of
one
of
the
two
CPUs.
In
the
Inspector
window,
navigate
to
&quot;Properties
>
General
>
Ethernet
addresses&quot;
in
the
&quot;System
IP
address
for
switched
communication&quot;
area.
3
4
5
Select
the
check
box
&quot;Enable
the
system
IP
address
for
switched
communication&quot;.
STEP
7
automatically
creates
a
system
IP
address.
Figure
16-5
Configuring
the
system
IP
address
Adjust
the
system
IP
address
as
required.
If
necessary,
change
the
virtual
MAC
address.
To
do
this,
in
&quot;Virtual
MAC
address&quot;,
assign
a
project-wide
unique
value
(value
range
01
H
to
FF
H
)
for
the
last
byte.
NOTE
Uniqueness
of
the
virtual
MAC
address
The
S7-1500R/H
redundant
system
uses
a
MAC
address
from
the
address
range
00-00-5E-00-01-00
to
00-00-5E-00-01-00
for
each
system
IP
address.
This
address
range
is
also
used
for
VRRP
(Virtual
Redundancy
Protocol).
If
you
use
devices
with
VRRP,
e.g.
switches,
ensure
the
uniqueness
of
the
MAC
addresses
within
an
Ethernet
broadcast
domain.
Result:
The
X1
system
IP
address
for
the
X1
PROFINET
interface
of
the
two
CPUs
is
enabled.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
439
Communication
with
the
redundant
system
S7-1500R/H
16.2
System
IP
addresses
for
communications
processors
System
IP
addresses
for
communications
processors
Introduction
As of STEP 7 V19, you have the option of expanding redundant S7‑1500R/H systems as of
FW‑version V3.1 with CP 1543‑1 communications processors as of FW‑version V3.0. When
extended
with
CP
1543‑1
communications
processors,
R/H‑CPUs
support
the
configuration
of
a W1 virtual interface with device and system IP‑addresses. The communication partners
connected
to
the
CPs
communicate
with
the
R/H-CPUs
via
these
IP
addresses.
You can enable the system IP address of W1 in STEP 7.
There
is
a
virtual
MAC
address
for
each
system
IP
address.
Failure
of
a
communications
processor
In
the
event
of
a
CP
1543-1
communications
processor
failure,
the
S7-1500R/H
redundant
system
behaves
as
follows:
S7-1500R:
When
a
CP
fails,
the
corresponding
CPU
changes
to
STOP
mode.
The
S7‑1500R
system
changes
to
the
RUN-Solo
system
state.
When
the
CP
at
the
primary
CPU
fails,
the
S7‑1500R
redundant
system
performs
a
primary-
backup switchover. The assigned system IP address changes to the new primary CPU.
Establishing
the
new
communication
connection
then
takes
place
via
the
redundant
CP.
If
the
CP
at
the
backup
CPU
fails,
this
failure
has
no
effect
on
the
existing
communication
via
the
system
IP
address.
S7-1500H
with
active
backplane bus:
When
a
CP
fails,
the
S7‑1500H
system
remains
in
the
RUN-Redundant
system
state.
If the CP at the primary CPU fails, the redundant S7‑1500H system does not perform a
primary-backup
switchover.
The
system
IP
address
W1
is
assigned
to
the
failed
CP
via
the
primary
CPU.
To
switch
the
system
IP
address
W1
to
the
backup
CPU,
call
the
&quot;RH_CTRL&quot;
instruction with mode=15 in the user program. As a result, the system IP address W1 is
assigned
to
the
backup
CPU.
The
new
communication
connection
is
then
established
via
the
redundant
CP
of
the
backup
CPU.
If
another
CP
on
the
primary
CPU
fails,
the
establishment
of
a
new
communication
connection
at
the
redundant
CP
is
only
possible
via
the
assigned
device
IP
address.
NOTE
If you communicate with the redundant system via the device IP addresses, you should
preferably
use
the
device
IP
address
of
the
primary
CPU.
The
transfer
rate
is
better
and
the
communication
load
is
lower
via
the
device
IP
address
of
the
primary
CPU.
You
can
find
more
information
about
the
&quot;RH_CTRL&quot;
instruction
in
the
online
help
for
STEP
7.
You
can
find
information
about
configuring
the
system
IP
address
for
the
W1
virtual
interface
and the virtual MAC address in the Redundant System S7‑1500R/H
(
https://support.industry.siemens.com/cs/us/en/view/109754833
)
System
Manual.
440
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.2
System
IP
addresses
for
communications
processors
Advantages
of
expansion
with
CP
1543‑1
communications
processors
If
you
expand
your
redundant
system
with
CP
1543‑1
communications
processors,
additional
communications
interfaces
become
available.
Use
this
advantage
for
a
CPU
1513R-1
PN
with
only
one
PROFINET
interface,
e.g.
for
a
network
separation.
Requirements
for
using
the
W1
system
IP
address
A
CP
1543‑1
is
assigned
to
the
W1
virtual
interface.
The
system
IP
address
of
the
W1
virtual
interface
is
activated.
A
system
IP
address
is
assigned
to
the
W1
virtual
interface.
A
communication
partner
reaches
both
CPs
via
the
assigned
system
IP
address.
Communication
via
the
W1
system
IP
address
The following figure shows the configuration of an S7‑1513R redundant system with
expansion
by
CPs.
The
communication
partners
communicate
with
the
redundant
system
via
the
assigned
W1
system
IP
address.
$16
)M*
1$
*OEVTUSJBM
&UIFSOFU
(1SJNBSZ)
3-$16
81
81
91
91
91
91
*0 EFWJDF
$1
3-$16
(BBDLVQ)
*1
BEE
S
F
T
T
81
PG
U
IF
$16T
4
Z
T
U
FN
3
2
1
①
Communication
between
the
S7‑1500R
redundant
system
and
another
CPU
②
HMI
communication
with
the
S7‑1500R
redundant
system
③
Communication
between
the
S7‑1500R
redundant
system
and
a
PC
Figure 16-6 Example: Communication of the S7‑1513R redundant system via the assigned W1 system IP
address
Communication
Function
Manual,
11/2024,
A5E03735815-AM
441
Communication
with
the
redundant
system
S7-1500R/H
System
IP
addresses
for
communications
processors
IP
forwarding
via
system
IP
addresses
If
you
use
the
system
IP
addresses
as
gateway/default
routes
for
IP
routes
through
the
redundant
S7‑1500R
system,
IP
packets
are
forwarded
even
if
a
CP
fails.
NOTE
Primary-backup
switchover
in
S7‑1500H
systems
with
an
active
backplane
bus
If
there
is
a
failure
of
a
CP
in
an
S7‑1500H
system
with
an
active
backplane
bus,
no
primary-
backup switchover takes place. In this case, set up the primary-backup switchover in your
user
program
if
required.
In the following figure, the PC is connected to the two X1 interfaces of the CPs 1543‑1. For
the route to the HMI device, the assigned W1 system IP address is entered in the PC as the
router. The HMI device is connected via a switch to the PROFINET ring of the S7‑1500R
redundant
system.
In
the
HMI
device,
the
X1
system
IP
address
of
the
CPUs
is
entered
as
the
router.
3&
I3
VXEQHW
$
*DWHZD\
I3
FRPPXQiFDWiRQ
3-$16
(QSJNBSZ)
6\VWHP
I3
DGGUHVV
:1
RI
WKH
&38V
3-$16
(CBDLVQ)
(QDEOH
I3
IRUZDUGiQJ
81
81
91
91
91
91
6\VWHP
I3
DGGUHVV
;1
RI
WKH
&38V
*DWHZD\
6ZiWFK
*1
TVCOFU
B
+0I
Figure
16-7
Example:
IP
forwarding
via
the
system
IP
addresses
of
CPUs
and
CPs
442
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.2
System
IP
addresses
for
communications
processors
Assigning
the
system
IP
address to
the
W1
virtual
interface of
R/H
CPUs
Starting with STEP 7 V19, it is possible to assign a system IP address to the W1 virtual
interface
of
R/H-CPUs.
The
communication
partners
that
you
have
connected
to
the
CPs
communicate
with
the
R/H
system
via
the
assigned
system
IP
address.
To
change
the
system
IP
address
of
the
W1
virtual
interface
of
the
R/H
CPUs,
follow
these
steps:
Select
the
R/H
CPU
on
rail_0
in
the
device
view.
In
the
Inspector
window,
navigate
to
&quot;Advanced
configuration
>
Access
to
PLC
via
communications
module&quot;.
Select
the
required
CP
from
the
&quot;Select
communication
module&quot;
selection
list
in
the
&quot;Assign
interface
[W1]&quot;
section.
After
selection,
a
warning
message
appears
to
inform
you
of
possible
risks
associated
with
this setting. If you confirm the warning message, the configuration options for the W1
virtual
interface
are
displayed.
Navigate
to
the
&quot;Internet
protocol
version
4
(IPv4)&quot;
area.
Accept
the
suggestion
or
assign
a
new
IP
address.
Navigate
to
the
&quot;System
IP
address
for
switched
communication&quot;
area.
Select
the
option
&quot;Enable
the
system
IP
address
for
switched
communication&quot;.
Accept
the
suggestion
or
assign
a
new
system
IP
address
(and
virtual
MAC
address).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
443
Communication
with
the
redundant
system
S7-1500R/H
System
IP
addresses
for
communications
processors
The
R/H
CPU
on
rail_1
automatically
adopts
the
settings.
1802892
124485
Figure
16-8
Configuring
the
system
IP
address
of
W1
Result:
You
have
assigned
a
CP
1543‑1
to
the
W1
virtual
interface
and
configured
the
device/system
IP
address.
444
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.4
Response
to
Snycup
Improved
accessibility
by
switching
the
system
IP
address
Switching
the
system
IP
address
when
CPU
cannot
be
accessed
By
default,
the
system
IP
address
is
assigned
to
the
primary
CPU.
As
of
TIA
Portal
V20
(CPU
firmware
version
V4.0
or
higher),
you
can
use
additional
modes
to
assign the system IP address of the backup CPU to the &quot;RH_CTRL&quot; instruction so that, for
example,
communication
can
be
maintained
when
the
primary
CPU
is
not
accessible.
More
information
A
description
of
the
program-controlled
switching
of
the
system
IP
address
can
be
found
under the special instructions for redundant systems S7-1500R/H in the System Manual
S7-1500R/H
(
https://support.industry.siemens.com/cs/us/en/view/109754833
).
Response
to
Snycup
Response
of
communication
connections
via
the
system
IP
address
in
the
system
state
SYNCUP
HMI,
PG‑
and
S7‑connections
are
temporarily
closed.
For
a
short
time
during
the
SYNCUP
it
is
not
possible
to
establish
connections
to
the
S7‑1500R/H
redundant
system.
All
existing
connections
of
Open
User
Communication
are
interrupted:
Connections
set
up
by
the
CPUs
of
the
redundant
system
as
an
active
connection
partner
are
set
up
again
after
the
SYNCUP.
The
S7‑1500R/H
redundant
system
sets
up
connection
endpoints
again
for
the
passive
connection
establishment
after
the
SYNCUP.
The
processing
of
running
instances
of
the
instructions
TSEND
and
TRCV
is
stopped.
The
block
parameter
STATUS
returns
80C4
H
(temporary
communication
error).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
445
Communication
with
the
redundant
system
S7-1500R/H
16.6
Connection
resources
of
the
redundant
system
S7-1500R/H
Response
to
primary-backup
switchover
Response
of
communication
connections
via
the
system
IP
address
during
a
primary‑backup
switchover
Running
instances
of
the
instructions
TSEND
and
TRCV
are
stopped
and
return
the
status
80C4
H
(temporary
communication
error).
Connections
successfully
established
by
the
S7‑1500R/H
redundant
system
are
established
again
by
the
new
primary
CPU.
The
new
primary
CPU
sets
up
connection
endpoints
again
for
the
passive
connection
establishment.
NOTE
Increased
duration
of
connection
interruption
If the remote system does not transmit actively after the primary-backup switchover, the
connection
monitoring
(e.g.
TCP-Keep-Alive
or
application)
may
have
to
be
performed
by
the
remote
system
until
the
connection
can
be
re-established.
Connection
resources
of
the
redundant
system
S7-1500R/H
Maximum
number
of
connection
resources
of
the
S7‑1500R/H
redundant
system
The
S7‑1500R/H
redundant
system
supports
a
maximum
number
of
connection
resources.
The
CPU
used
determines
the
maximum
number
of
resources
for
the
redundant
system:
CPU
1513R:
max.
88
connection
resources
CPU
1515R:
max.
128
connection
resources
(as
of
V3.0),
max.
108
connection
resources
(up
to
V2.9.x)
CPU
1517H: max. 288 connection resources
CPU
1518HF:
max.
320
connection
resources
446
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.6
Connection
resources
of
the
redundant
system
S7-1500R/H
Allocation
of
connection
resources
Communication
connections
occupy
communication
resources
in
the
S7‑1500R/H
redundant
system.
Each communication connection to the redundant system S7 1500R/H occupies connection
resources
in
the
S7
1500R/H
station.
The
S7-1500R/H
station
comprises
the
hardware
setup
of
both
CPUs
of
the
redundant
S7-1500R/H
system.
Depending on the IP address used, a communication connection also uses connection
resources
in
one
or
both
CPUs
of
the
redundant
S7-1500R/H
system.
The
S7-1500R/H
station
can
also
be
used
to
establish
a
communication
connection.
The
following
table
shows
in
which
CPU
a
communication
connection
occupies
connection
resources
depending
on
the
IP
address
used.
Connect
via...
Connection
resources
of
the
station
Connection
resources
CPU
with redundancy
ID 1
Connection
resources
CPU
with
redundancy
ID 2
a
system
IP
address
X
X
X
a
device
IP
address
of
the
CPU
with
redundancy
ID
1
X
X
-
a
device
IP
address
of
the
CPU
with
redundancy
ID
2
X
-
X
Display
of
the
occupied
connection
resources
in
STEP
7
Requirement:
Online
connection
to
the
redundant
system
S7-1500R/H
You will find the online display of the connection resources in the inspector window under
&quot;Diagnostics&quot;
>
&quot;Connection
information&quot;.
STEP
7
always
displays
the
connection
resources
of
the
selected
CPU
and
the
S7‑1500R/H‑station.
726312
154182
Figure
16-9
Display
of
the
connection
resources
of
the
S7‑1500R/H
redundant
system
in
STEP
7
Communication
Function
Manual,
11/2024,
A5E03735815-AM
447
Communication
with
the
redundant
system
S7-1500R/H
16.7
HMI
communication
with
the
redundant
system
S7-1500R/H
HMI
communication
with
the
redundant
system
S7-1500R/H
HMI
connection
via
the
system
IP
address
Requirements
•
A
S7-1500R/H
redundant
system,
e.g.
CPU
1513R‑1PN
•
System
IP
address
is
enabled
•
HMI
device
with
PROFINETI
interface
Procedure
To
set
up
a
HMI
connection
to
an
S7‑1500R/H
redundant
system,
follow
these
steps:
In
the
network
view
of
STEP
7,
select
a
PROFINET
interface
of
the
HMI
device.
Using
a
drag&drop
operation,
draw
a
line
between
the
PROFINET
interface
of
the
HMI
device
and
a
PROFINET
interface
of
the
S7‑1500R/H
redundant
system.
The
HMI
device
and
the
S7‑1500R/H
redundant
system
are
networked
together.
1799970
132809
Figure
16-10
Networking
an
HMI
device
with
the
S7‑1500R/H
redundant
system
In
the
list
of
functions,
click
the
&quot;Connections&quot;
icon.
This
activates
connection
mode.
Using
a
drag-and-drop
operation,
draw
a
line
between
the
HMI
device
and
a
CPU
of
the
S7‑1500R/H
redundant
system.
The
list
&quot;Connection
partners&quot;
opens.
1803019
162800
Figure
16-11
Setting
up
an
HMI
connection
to
the
S7‑1500R/H
redundant
system
Select
the
S7‑1500R/H
redundant
system
in
the
list
&quot;Connection
partners&quot;.
Result: You have set up a HMI connection between the HMI device and the S7‑1500R/H
redundant
system.
The
HMI
connection
uses
the
system
IP
address.
The
HMI
device
always
connects
to
the
primary
CPU.
448
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.7
HMI
communication
with
the
redundant
system
S7-1500R/H
Changing
the
HMI
connection
over
to
the
device
IP
address
To permanently change the HMI connection over to the selected CPU, clear the check box
&quot;Use the system IP address for switched communication&quot; in the properties of the HMI
connection.
The
HMI
connection
then
uses
the
device
IP
address
of
the
PROFINET
interface.
In
the
event
of
the
failure
of
this
CPU,
then
the
HMI
connection
to
this
CPU
permanently
fails.
Figure
16-12
Properties
of
the
HMI
connection
NOTE
Automatic
setup
of
HMI
connection
When
you
drag-and-drop
a
tag
from
the
S7‑1500R/H
redundant
system
into
an
HMI
screen
or
into
the
HMI
tag
table,
STEP
7
automatically
sets
up
an
HMI
connection.
This
HMI
connection
exists by default between the PROFINET interface of the HMI device and the PROFINET
interface X1 of the CPU with redundancy ID 1. The connection uses the device IP address of
the
PROFINET
interface
X1.
You
can
change
the
HMI
connection
to
a
system
IP
address
in
the
properties
of
the
HMI
connection.
More
information
You can set up an HMI connection to the S7‑1500R/H redundant system via the devices IP
address. With help of scripts in the HMI configuration, the connection of the failed CPU are
switched
automatically
to
the
still
running
CPU.
A
description
to
this
procedure
can
be
found
in
the
following
FAQ
(
https://support.industry.siemens.com/cs/us/en/view/109781687
).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
449
Communication
with
the
redundant
system
S7-1500R/H
16.8
Open
User
Communication
with
the
redundant
system
S7-1500R/H
Open
User
Communication
with
the
redundant
system
S7-1500R/H
Introduction
S7‑1500R/H
systems
as
of
FW
version
V3.1
also
support
Secure
Open
User
Communication
(Secure
OUC).
If
you
extend
an
S7‑1500R/H
system
as
of
FW
version
V3.1
with
CP
1543‑1
communications
processors,
you
can
also
use
Secure
OUC
via
these
connected
CPs.
Requirements:
•
STEP
7
as
of
V19
•
CP
1543‑1
as
of
FW
version
V3.0
Secure
Open
User
Communication
protocols
for
the
S7‑1500R/H
redundant
system
The
following
table
shows
which
protocols
of
the
Open
User
Communication
you
can
use
for
the
S7‑1500R/H
redundant
system
and
the
matching
system
data
types
and
instructions.
Table
16-1
Protocols,
system
data
types,
and
instructions
that
can
be
used
for
Open
User
Communica-
tion
with
the
S7‑1500R/H
redundant
system
Protocol
System
data
type
Instructions
TCP
TCON_QDN
TCON_QDN_SEC
TCON_IP_v4
TCON_IP_V4_SEC
Establish
connection
and
send/receive
data
via:
TSEND_C/TRCV_C
or
TCON,
TSEND/TRCV
or
TCON, TUSEND/TURCV
(connection
can
be
terminated
via
TDISCON)
TLS
over
TCP
ISO-on-TCP
TCON_IP_RFC
UDP
TCON_IP_v4
TADDR_Param
TADDR_SEND_QDN
TADDR_RCV_IP
Establish
connection
and
send/receive
data
via:
TSEND_C/TRCV_C
TUSEND/TURCV/TRCV
(connection
can
be
terminated
via
TDISCON)
Modbus TCP
TCON_IP_v4
TCON_IP_V4_SEC
TCON_QDN
TCON_QDN_SEC
MB_CLIENT
MB_RED_CLIENT
MB_SERVER
MB_RED_SERVER
450
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.8
Open
User
Communication
with
the
redundant
system
S7-1500R/H
Setting
up
the
connection
of
the
Open
User
Communication
with
the
redundant
S7-1500R/H
system
Open
User
Communication
via
integrated
PROFINET
interfaces
of
the
CPU
The
S7‑1500R/H
redundant
system
can
communicate
with
other
devices
via
Open
User
Communication.
You
set
up
the
connections
in
the
user
program,
e.g.
via
the
&quot;TSEND_C&quot;
instruction.
The
S7‑1500R/H
redundant
system
does
not
support
configured
connections.
You
can
set
up
the
connections
via
the
following
IP
addresses
of
the
integrated
PROFINET
interfaces:
Device
IP
addresses:
In
redundant
mode,
the
redundant
system
can
establish
or
terminate
connections
and
send
or
receive
data
via
all
device
IP
addresses
of
the
redundant
system.
If you set up the connection via a device IP address, communication is routed via the
associated
CPU.
If
the
CPU
fails,
then
all
communication
through
the
device
IP
addresses
of
that
CPU
fails.
System
IP
addresses:
If
you
set
up
the
connection
via
a
system
IP
address,
communication
is
always
routed
via
the
primary
CPU.
Decide
how
you
want
to
set
up
the
connections
based
on
your
use
case.
Open
User
Communication
via
CP
1543‑1
communications
processors
If
you
extend
an
S7‑1500R/H
redundant
system
with
CP
1543‑1
communications
processors,
you
can
then
also
use
the
following
communication
options:
Local
X1
interface
of
the
CP
1543‑1
Own
device
IP
address
for
the
W1
virtual
interface
of
each
R/H
CPU
Common
system
IP
address
for
the
W1
virtual
interface
of
the
R/H
system
You
can
find
information
on
how
to
use
a
CP
1543‑1
for
a
S7‑1500R/H
system
in
the
System
(Page
440)
IP
addresses
for
communications
processors
section.
Setting
up
a
connection
via
a
system
IP
address
The
following
describes
how
to
set
up
a
connection
to
a
partner
CPU
via
a
system
IP
address
of
an
integrated
PROFINET
interface
of
the
redundant
S7‑1500R/H
system.
You
can
set
up
the
connection
in
the
user
program
of
the
redundant
S7‑1500R/H
system,
e.g.
with a TSEND_C instruction. In the user program of the partner CPU, create a corresponding
TRCV_C
instruction.
The
procedure
is
described
using
the
example
of
a
TCP
connection
between
the
S7‑1500R/H
redundant
system
and
a
CPU
1516‑3PN/DP.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
451
Communication
with
the
redundant
system
S7-1500R/H
16.8
Open
User
Communication
with
the
redundant
system
S7-1500R/H
Requirements
A
redundant
S7‑1500R/H
system
as
TCP
client,
e.g.
2
CPUs
1513‑1PN
System
IP
address
of
the
PROFINET
interface
X1
is
enabled
Connection
partner
as
TCP
server,
e.g.
CPU
1516‑3
PN/DP
The X1 PROFINET interfaces of the redundant 1513R CPUs and the X2
PROFINET
interface
of
the
CPU
1516‑3PN/DP
are
located
in
the
same
subnet.
1803019
151389
Figure
16-13
Example
configuration
for
TCP‑connection
TSEND_C instruction
in
the
user
program
of
the
S7‑1500R/H
redundant
system
To
set
up
a
TCP‑connection
to
a
different
CPU,
follow
these
steps:
Create
a
&quot;TSEND_C&quot;
instruction
in
the
user
program.
1799970
163402
Figure
16-14
S7‑1500R/H:
&quot;TSEND_C&quot;
instruction
Select
the
&quot;TSEND_C&quot;
instruction.
In the Inspector window, go to &quot;Properties&quot; > &quot;Configuration&quot; > &quot;Connection parameters&quot;.
On
the
left-hand
side
you
can
see
the
S7‑1500R/H
redundant
system
as
a
local
end
point
of
the
connection:
&quot;Interface:&quot;: X1 is the
preset
interface.
&quot;Subnet:&quot;:
If
the
interface
X1
is
assigned
to
an
S7‑subnet,
then
STEP
7
displays
the
name
of
the
S7‑subnet.
The
&quot;Use
system
IP
address&quot;
check
box
is
enabled.
The
system
IP
address
of
the
S7‑1500R/H
redundant
system
is
in
&quot;Address&quot;.
452
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.8
Open
User
Communication
with
the
redundant
system
S7-1500R/H
4
5
6
7
Figure
16-15
S7-1500R/H:
Assigning
parameters
to
the
TSEND_C
instruction
in
STEP
7
In
&quot;Partners&quot;
under
&quot;End
point:&quot;
select
the
CPU
1516‑3PN/DP
as
the
communication
partner.
In
&quot;Partners&quot;
under
&quot;Interface:&quot;
select
the
PROFINET
interface
X2
of
the
CPU
1516‑3PN/DP.
In
&quot;Local&quot;
under
&quot;Connection
data&quot;
select
the
setting
&quot;<new>&quot;.
STEP
7
creates
a
data
block
for
the
connection
data
in
the
user
program
of
the
S7‑1500R/H
redundant
system,
for
example
&quot;PLC_1_Send_DB&quot;.
&quot;TCP&quot;
is
set
by
default
as
the
connection
type.
In
&quot;Partners&quot;
under
&quot;Connection
type&quot;
select
the
setting
&quot;NEW&quot;.
STEP
7
creates
a
data
block
for
the
connection
data
in
the
user
program
of
the
other
CPU,
for
example
&quot;PLC_3_Receive_DB&quot;.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
453
Communication
with
the
redundant
system
S7-1500R/H
16.8
Open
User
Communication
with
the
redundant
system
S7-1500R/H
TRCV_C
instruction
in
the
user
program
of
the
CPU
1516
3PN/DP
Create
a
TRCV_C
instruction
in
the
user
program
of
the
CPU
1516‑3PN/DP
and
assign
parameters
as
below:
540004
154639
Figure
16-16
S7‑1500‑3PN/DP:
Assigning
parameters
to
the
TRCV_C
instruction
in
STEP
7
454
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.8
Open
User
Communication
with
the
redundant
system
S7-1500R/H
Setting
up
a
connection
via
a
device
IP
address
To
set
up
an
OUC‑connection
via
a
device
IP
address
of
one
of
the
two
CPUs:
Select
a
suitable
PROFINET
interface
of
the
S7‑1500R/H
redundant
system.
Clear
the
&quot;Use
system
IP
address&quot;
check
box.
Figure
16-17
OUC‑connection
via
a
device
IP
address
More
information
You can find more information on system states in the S7‑1500R/H
(
https://support.industry.siemens.com/cs/ww/en/view/109754833
)
system
manual.
You
can
find
more
information
on
the
configuration
and
parameter
assignment
of
your
PROFINET
IO
system
in
the
PROFINET
Function
Manual
(
https://support.industry.siemens.com/cs/ww/en/view/49948856
).
Communication
Function
Manual,
11/2024,
A5E03735815-AM
455
Communication
with
the
redundant
system
S7-1500R/H
Open
User
Communication
with
the
redundant
system
S7-1500R/H
Open
User
Communication
with
CP
1543-1
communications
processors
Introduction
You
can
use
both
Open
User
Communication
(OUC)
as
well
as
Secure
OUC
via
the
CP
1543‑1
communications
processors.
If
you
want
to
use
Secure
OUC,
the
following
additional
requirements
must
be
met
so
that
you
can
handle
the
device
and
CA
certificates:
•
Project
protection
is
activated
•
Security
functions
are
enabled
in
each
CP
1543‑1
you
want
to
use
for
Secure
OUC.
•
Same
security
settings
in
each
CP
on
both
primary
and
backup
CPUs
in
the
same
slot
•
The
same
CA
certificates
are
configured
for
both
CPs
•
The
device
certificates
of
the
CPs
each
refer
to
both
CPs,
e.g.
configure
an
Subject
Alternative
Name
(SAN)
in
both
device
certificates
NOTE
No
automatic
synchronization
of
the
security
settings
In STEP 7, the security settings are not automatically synchronized between the CPs.
Therefore,
configure
the
CPs
in
the
same
slot
of
the
primary
and
backup
CPUs
identically.
Connection
options
for
Open
User
Communication
via
CPs
For
the
following
configurations,
the
OUC
connection
to
a
partner
always
goes
via
the
local
CP
interface,
regardless
of
whether
OUC
or
Secure
OUC
is
being
used.
Depending
on
which
configuration you use, you have to adapt the connection parameters when setting up the
communication connection. Select the corresponding HW identifier of the interface at the
connection
parameters
using
one
of
the
following
options:
•
Use
the
CP
interface
with
a
local
IP
address:
For
the
&quot;InterfaceId&quot;
connection
parameter,
specify
the
HW
identifier
of
the
local
Ethernet
interface of a CP, e.g. &quot;Local1~CP_1543-1_1~Ethernet_interface_1&quot;. Use the CP interfaces
of
both
primary
and
backup
CPUs
in
the
RUN-Redundant
system
state.
•
Use
the
W1
virtual
interface
of
the
CPU
with
a
configured
device
IP
address:
For the &quot;InterfaceId&quot; connection parameter, specify the HW identifier of the virtual
interface of a CPU, e.g. &quot;Local1~Virtual_communication_interface&quot;. Use the virtual W1
interfaces
of
both
the
primary
and
backup
CPUs
in
the
RUN-Redundant
system
state
•
Use
the
virtual
W1
interface
of
the
CPU
with
a
configured
system
IP
address:
For the &quot;InterfaceId&quot; connection parameter, specify the HW identifier of the object with
the string &quot;...HSystemIPRef...&quot; and the &quot;Virtual&quot; identifier in the default name, e.g.
&quot;Local1~Virtual_communication_interface~HsystemIPRef_1&quot;.
This object then references
the
system
IP
address
of
the
virtual
W1
interface
of
the
CPU.
456
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Creating
a
connection
via
CPs
You
can
create
the
connection
as
for
an
integrated
PROFINET
interface
of
the
S7‑1500R/H
redundant system. However, you have to adapt the connection parameters accordingly.
Select
the
CP
1543‑1
communications
processor
to
be
used
in
the
&quot;Interface&quot;
selection
list.
If
you
want
to
use
the
&quot;Use
system
IP
address&quot;
option,
a
system
IP
address
must
be
configured
for
the
W1
virtual
interface.
Selecting
certificates
for
Secure
Open
User
Communication
via
CPs
Depending
on
how
you
configure
the
S7‑1500R/H
station
with
a
CP
1543‑1,
the
following
certificate
rules
are
valid
for
communication
with
connection
partners:
•
Communication
via
CP
interface
with
local
IP
address:
Use the device certificate of the CP for authentication. For the connection partner to be
able
to
validate
the
device
certificate,
the
CA
certificate
of
the
CP
must
be
available
there
under
&quot;Certificates
of
the
partner
devices&quot;.
•
Communication
via
the
virtual
W1
interfaces
of
the
CPUs
with
configured
system
IP
address:
Use
a
device
certificate
of
the
CPU
for
authentication.
So
that
the
connection
partner
can
validate the device certificate, the certificate authority of the CPU must be present there
under
&quot;Certificates
of
the
partner
devices&quot;.
More
information
(Page
64)
You
can
find
information
on
how
to
create
or
assign
certificates
in
the
Managing
certificates
section.
You
can
find
information
about
Secure
Open
User
Communication
via
a
CP
interface
in
the
(Page
97)
Secure
OUC
via
CP
interface
section.
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Information worth
knowing
on
the
OPC
UA
server
in
the
S7-1500R/H
system
As
of
firmware
version
V3.1,
S7-1500R/H
CPUs
support
OPC
UA
server
functions.
An
OPC
UA
client
is
not
supported.
The
extensions
for
the
OPC
UA
server
of
S7-1500R/H
systems
comply
with
the
OPC
10000-4
specification:
Services
(Rel.
1.04),
taking
into
account
the
restrictions
described
below.
The
OPC
UA
server
is
accessible
via
all
the
integrated
interfaces
of
the
CPUs
as
well
as
via
a
CP
1543-1. To this end, the CP must be connected via the virtual interface W1 of the CPU (area
&quot;Access
to
PLC
via
communication
module&quot;
in
the
CPU
properties).
An
OPC
UA
server
facilitates
open
and
standardized
access
to
the
CPU.
In
the
R/H
system,
an
OPC
UA
server
runs
on
each
of
the
two
CPUs.
The
OPC
UA
servers
of
the
primary
and
backup
CPUs
synchronize
via
redundancy
mechanisms.
In
redundant
operation,
from
the
perspective
of
an
OPC
UA
client,
it
is
a
server
application.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
457
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Compared
to
standard
CPUs,
S7-1500R/H
CPUs
offer
an
advanced
information
model.
With
this advanced information model, it is possible for clients to take into account the specific
features
of
the
redundant
system.
From
the
perspective
of
an
OPC
UA
client,
the
same
mechanisms
are
used
to
access
the
S7-1500R/H
system
(e.g.
Discovery
Service)
as
when
accessing
standard
S7-1500
CPUs.
Restrictions
for
the
OPC
UA
servers
When
the
OPC
UA
server
is
used
in
the
S7-1500R/H
system,
there
are
restrictions
as
compared
to
the
scope
of
capabilities
of
standard
S7-1500
CPUs:
Data access only via server interfaces. The standard SIMATIC server interface is not
supported.
Therefore,
a
nodeset
export
(OPC
UA
XML
file
of
the
standard
SIMATIC
server
interface)
is
also
not
supported.
No
support
of
GDS
(certification
management
in
runtime).
No
support
of
Alarms
&
Conditions.
No
access
to
the
address
space
of
a
CPU&apos;s
own
OPC
UA
server
via
the
OPC_UA_ReadList
and
OPC_UA_WriteList
instructions.
That
is,
the
functions
described
in
the
following
sections
of
the
TIA
Portal
information
system
are
not
possible:
Diagnosing
the
OPC
UA
server
with
OPC_UA_ReadList
Set
OPC
UA-DataValue
with
OPC_UA_WriteList
The
resolution
of
the
time
stamps
provided
by
the
server
is
1
ms
(standard
CPU:
1
ns).
An
overview
of
the
general
restrictions
of
the
S7-1500R/H
redundant
system
compared
to
the
S7-1500
automation
system
can
be
found
in
the
section
&quot;Application
planning
>
Restrictions&quot;
in
the
S7-1500R/H
redundant
system
System
Manual
(
https://support.industry.siemens.com/cs/ww/en/view/109754833
).
(Page
168)
You
can
find
a
description
of
how
to
configure
an
OPC
UA
server
(e.g.
creating
server
interfaces)
in
the
OPC
UA
communication
the
TIA
Portal.
section
or
in
the
information
system
of
458
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Influence
on
cycle
and
response
times
If
you
enable
the
OPC
UA
server
of
an
S7-1500R/H
system,
this
will
affect
the
cycle
and
response
times.
You
must
consider
the
following
effects:
The
cycle
time
for
an
S7-1500R/H
system
in
the
RUN-Redundant
system
state
is
extended
by
activating
the
OPC
UA
server.
The accuracy with which higher-priority alarms interrupt a cycle OB, for example,
decreases.
Example:
The
&quot;Jitter&quot;
for
a
cyclic
interrupt
increases.
CAUTION
Otherwise,
the
basic
rules
from
the
following
document
apply:
Function
Manual
&quot;Cycle
and
Response
Times&quot;
(
https://support.industry.siemens.com/cs/us/en/view/59193558
).
Thorough
testing
of
the
maximum
cycle
time
during
the
commissioning
phase
During
the
commissioning
phase,
check
whether
the
S7-1500R/H
system
works
reliably
with
the
set
maximum
cycle
time
even
under
worst-case
conditions
(alarms,
communication
load
from
maximum
number
of
clients
including
connection/disconnection).
Requirements
TIA
Portal
V19
with
installed
Hardware
Support
Package
(HSP)
&quot;HSP_V19_0445_001_S71500_RH_3.1&quot;.
The
S7-1500R/H
CPUs
are
installed
with
this
HSP.
Redundancy
at
OPC
UA
The
redundant
system
consisting
of
two
or
more
servers
is
called
a
&quot;Redundant
Server
Set&quot;
in
OPC UA. Server redundancy in accordance with the OPC UA specification recognizes the
following
operating
modes
(Modes
of
Redundancy):
Transparent
Mode
(transparent
Redundancy)
In transparent operating mode, the server is solely responsible for failover in the event of
an error (Failover). The OPC UA client does not require any redundancy knowledge to
continue
the
data
exchange.
To
work
in
Transparent
Mode,
the
client
must
connect
to
the
system IP address of the CPU interface. If you are using a CP 1543-1, use the virtual
interface
W1
of
the
CPU
with
the
configured
system
IP
address.
Non-transparent
Mode
(non-transparent
Redundancy)
In non-transparent mode, the client is responsible for switching from one server to the
other in the event of an error (Failover). The client must initiate the required actions in
order
to
benefit
from
the
redundant
system.
To
work
in
non-transparent
Mode,
the
client
must
connect
to
the
corresponding
device
IP
addresses
of
the
R/H
CPUs.
If
you
are
using
a
CP
1543-1,
use
the
virtual
interfaces
W1
of
the
CPUs
with
configured
device
IP
addresses
An
S7-1500R/H
system
supports
both
operating
modes.
The
Redundant
Server
Set
provides
access
to
information
on
availability
via
the
&quot;ServiceLevel&quot;
variable;
a
byte
that
numerically
reflects
the
&quot;Health
status&quot;
of
a
server.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
459
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
(Page
462).
The ServiceLevel allows conclusions to be drawn about the redundancy status, e.g. whether
the
CPU
is
the
primary
or
backup
CPU
or
whether
the
system
is
in
the
RUN-Redundant
system
state.
You
can
find
information
on
the
ServiceLevel
in
the
section
on
non-transparent
mode
More
information
You
can
find
additional
and
up-to-date
information
on
using
the
OPC
UA
server
with
S7-1500R/H
systems
in
the
following
entry:
FAQ
How
do
you
use
the
OPC
UA
server
in
an
S7-1500
R/H
system?
(
https://support.industry.siemens.com/cs/ww/en/view/109822965
)
Transparent
Mode
(transparent
Redundancy)
Details on transparent redundancy are explained below - an operating mode that allows a
client
to
deal
with
the
redundant
system
as
with
a
single
system
or
with
an
OPC
UA
server
of
a
standard
CPU.
Primary
CPU always accessible
via system IP
address
For an S7-1500R/H station, use the system IP address for transparent redundancy. With the
system
IP
address,
a
client
accesses
the
primary
CPU,
i.e.
the
CPU
that
is
currently
hosting
this
IP
address.
The
following
figure
shows
an
example
of
the
use
of
the
transparent
redundancy
according
to
OPC
UA
10000‑4.
7UDQVSDUHQW
5HGXQGDQW
6HW
6HUYHU
1
&OiHQW
&OiHQW
DQG
SURFHVV
iQIR
6KDUHG
6HUYHU
85,
DQG
(QGSRiQW 85/
6HUYHU
2
&OiHQW
DQG
SURFHVV
iQIR
Response
upon
loss
of
primary
CPU
(RUN-Redundant
>
RUN-Solo)
In the event of an error (failover), communication between the client and server is briefly
interrupted.
All
established
sessions
and
subscriptions
are
retained
and
can
be
resumed
-
with
the
new
primary
CPU.
In
this
case,
the
behavior
from
the
client&apos;s
point
of
view
corresponds
to
the behavior in the event of temporary communication errors in which the session is also
resumed.
As
soon
as
the
new
primary
CPU
can
be
accessed
after
the
failover
via
the
system
IP
address,
the
client
can
resume
communication
(reactivate
session).
460
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Behavior
when
restoring
redundancy
(SYNCUP
>
RUN-Redundant)
If the initial state of the redundant system is restored after a failover, e.g. after replacing the
faulty
CPU,
the
system
performs
a
SYNCUP.
During
SYNCUP,
the
OPC
UA
servers
are
restarted
in
both
CPUs.
All
existing
sessions
and
subscriptions
are
deleted.
As
soon
as
the
server
of
the
primary
CPU
is
accessible
again,
the
client
must
recreate
the
sessions
and
subscriptions.
Relevant
nodes
in
the
information
model
for
transparent
redundancy
Information
in
the
information
model
on
transparent
mode
of
the
R/H
station
can
be
found
under the &quot;ServerRedundancy&quot; object (namespace index &quot;0&quot; or namespace
&quot;http://opcfoundation.org/UA/&quot;).
1837966
130773
You
can
determine
the
ServerState
and
ServiceLevel
of
the
redundant
servers
using
the
RedundantServerArray:
1873583
128506
You
can
find
more
information
on
the
ServiceLevel
in
the
next
section.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
461
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Non-transparent
Mode
(non-transparent
Redundancy)
In
the
following,
details
on
non-transparent
redundancy
are
explained.
In
this
operating
mode,
OPC
UA
provides
the
following
information
for
a
client:
Which
servers
are
available
in
the
Redundant
Server
Set
Which
types
of
failover
between
the
available
servers
are
supported
This information allows the client to determine what it needs to do to achieve switchover.
The
client
must
not
only
be
able
to
interpret
the
ServerRedundancy
attribute,
but
also
know
the
extended
information
model
of
the
redundant
server.
Address
parameters
of
the
redundant
OPC
UA
server
in
an
R/H
system
In
contrast
to
transparent
redundancy,
the
servers
in
the
R/H
system
are
addressed
via
their
unique
IP
address
(device
IP
address
or
virtual
IP
address
in
the
case
of
a
configured
CP
1543-1).
&
O
i
H
Q
W
The
following
figure
shows
an
example
of
the
use
of
the
non-transparent
redundancy
according
to
OPC
UA
10000‑4.
1
R
Q
-
7
U
D
Q
V
S
D
U
H
Q
W
5
H
G
X
Q
G
D
Q
W
6
H
W
6HUYHU
1
6
(
HUYHU 85, 1
Q
G
S
R
i
Q
W
8
5
/
1
&
O
i
H
Q
W
D
Q
G
S
U
R
F
H
VV
i
Q
I
R
6HUYHU
2
6
(
HUYHU 85, 2
Q
G
S
R
i
Q
W
8
5
/
2
&
O
i
H
Q
W
D
Q
G
S
U
R
F
H
VV
i
Q
I
R
Response
upon
loss
of
primary
CPU:
Failover
modes
According
to
OPC
1000-4:
Services,
servers
can
support
different
failover
modes:
Cold,
Warm,
Hot
and
HotAndMirrored.
The
OPC
UA
server
of
an
S7-1500R/H
CPU
supports
&quot;HotAndMirrored&quot;
failover
mode.
The
client
must
know
that
the
OPC
UA
server
is
a
redundant
server
and
must
perform
the
failover
process
in
a
certain
way
due
to
the
supported
Failover
modes.
The way in which the failover process should take place is described in the OPC 10000-4
specification: Services, section &quot;Client failover behavior - HotAndMirrored&quot;. The client is
responsible for tracking the status of the server, i.e. periodically querying the ServiceLevel
and
switching
to
the
alternative
server
(in
the
case
of
an
S7-1500R/H
system,
this
means
the
backup CPU) in the event of an error. This type of redundancy control offers the following
advantages:
The
client
has
full
control
in
the
selection
of
the
alternative
server.
The
client
can
access
the
OPC
UA
server
via
separate
networks.
462
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
The following figure from the specification OPC 10000-4: Services shows the steps that the
client
goes
through
when
it
receives
the
signal
to
switch
to
the
&quot;Alternate
server&quot;
due
to
a
low
ServiceLevel
value
for
the
&quot;Source
server&quot;.
+RW
DQG
2SHQ6HFXUH&KDQQHO
$FWiYDWH6HVViRQ
6XEVFUiSWiRQV
UHVXPH
6RXUFH
6HUYHU
0iUURUHG
$OWHUQDWH
6HUYHU
6WDUWXS
$FWiYDWH3XEOiVKiQJ
$FWiYDWH6DPSOiQJ
&UHDWH6XEVFUiSWiRQ
&UHDWH0RQiWRUHG,WHPV
6ZiWFK6HUYHUV
0RQiWRU&RQQHFWiRQ
2SHQ6HFXUH&KDQQHO
&UHDWH6HVViRQ
$FWiYDWH6HVViRQ
(UURU
6WDWXV
2K
ServiceLevel
ServiceLevel
is
a
variable
that
is
modeled
as
a
property
of
the
ServerType
object
in
the
address
space of the server. You use the ServiceLevel to find out whether the addressed server is still
supplying data, for example. The ServiceLevel is a numerical value for the &quot;Health status&quot; of
the
server
and
thus
provides
the
client
with
a
trigger
for
switching
the
server.
The
structure
of
the
ServerType
object
is
described
in
the
OPC
10000-5:
Information
Model
specification,
section
&quot;ServerType&quot;.
For
S7-1500R/H,
the
following
ServiceLevel
values
apply
to
the
respective
OPC
UA
server:
RUN-Redundant
:
ServiceLevel
primary
CPU
=
255
(CPU
in
RUN),
service
level
backup
CPU
=
227
(CPU
in
RUN).
CPU
in
STOP
:
ServiceLevel
of
the
failed
CPU
(RUN
STOP
transition)
=
1
(NoData).
This
is
the
trigger
for
the
client
for
the
failover.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
463
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Example
for
a
primary
CPU
in
RUN:
1659455
124485
Application
of
non-transparent
redundancy
If
a
client
accesses
the
OPC
UA
server
via
different,
i.e.
independent
subnets,
transparent
redundancy
using
the
system
IP
address
is
not
possible.
The
following
figure
shows
a
configuration
with
an
H
system
that
is
connected
to
a
client
via
two
subnets.
3
4
4
5
2
1
The
client
can
connect
to
the
H
system
via
the
two
independent
networks.
The
two
H
CPUs
are not connected via one of the networks. In this way, the failure of a network can be
tolerated.
Independent
subnets
are
not
a
requirement
for
non-transparent
mode.
You
can
also
use
non-
transparent
mode
for
configurations
with
a
subnet.
464
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Relevant
nodes
in
the
information
model
for
non-transparent
redundancy
The information in the information model of the R/H station that is relevant for non-
transparent
mode
is
located
under
the
&quot;VendorServerInfo&quot;
object,
a
placeholder
object
for
vendor-specific information about the OPC UA server. This vendor-specific node and the
nodes
below
it
are
located
in
the
namespace
for
the
local
server,
e.g.
urn:
SIMATIC.S7‑1500.OPC‑UA.Application:PLC_1
with
namespace
index
1.
1855145
124790
In
the
ServerRedundancy
object
below,
a
client
can
find
all
the
required
information
to
connect
to
the
R/H
system.
The ServerUriArray-Property allows a client to select a suitable server. The information on
which network paths can be used to access the servers can be found via the object type
NonTranparentNetworkRedundancyType
-
a
subtype
of
NonTransparentRedundancyType.
The
object type NonTranparentNetworkRedundancyType references the ServerNetworkGroups
variable, which contains an array of servers (EndpointUrlList) together with information on
which
redundant
network
paths
exist
for
each
server
(NetworkPaths).
1838044
130738
You
can
find
a
detailed
description
of
the
relevant
nodes
with
their
references
below
the
VendorServerInfo
node
in
the
OPC
UA
specification
(OPC
10000‑5:
Information
Model).
For
an
S7-1500R/H
system,
the
EndpointUrlList
contains
an
entry
for
each
device
IP
address
or
virtual
device
IP address
(if
configured together
with
a
CP
1543-1)
via
which
the
servers of
the S7-1500R/H system can be accessed. In the event of a failure, the client can decide
whether to connect to the same server via a different path or whether to choose the
redundant
server.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
465
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Information
model
in
detail
The
following
sections
show
the
structure
of
the
information
model
of
an
S7-1500R/H
system
in detail. The information model is suitable for both clients that access the R/H system like a
standard
CPU
and
clients
that
want
to
have
full
control
over
the
R/H
system.
Advanced
information
model
for
redundant
systems
The
following
figure
shows
by
way
of
example
how
the
R/H
system
is
modeled
in
the
DeviceSet
node
as
a
separate
object
next
to
the
individual
R/H
CPUs.
1642830
129650
R/H
system
as
a
separate
node
in
the
information
model
Under
the
DeviceSet
node,
in
addition
to
the
nodes
for
each
R/H
CPU,
there
is
also
a
node
as
a
representative
for
the
R/H
system.
The
OPC
UA
server
is
temporarily
not
available
in
the
SYNCUP
system
state
(RUN-Syncup
mode
for
primary
CPU).
The
server
restarts
in
this
state.
The
nodes
represent
the
following
information:
Node
<configured
name>
Contents
Accessible
data
in
the
RUN-Redund-
ant
system
state
Accessible
data
in
the
RUN-Solo
system
state
<R/H
system>
Information
regarding
the
R/H
system
Server interface data (identical for
both
CPUs)
CPU-specific
information
of
the
primary
CPU
Client
is
connected
with:
Primary
CPU:
Data
of
the
server
inter-
face
of
the
primary
CPU.
Backup CPU: Server interface data (if
ServiceLevel
=
NoData:
server
interface
data
is
invalid
or
not
available).
<PLC
1>
Information
via
R/H
CPU
with
redundancy
ID
1
Server interface data (identical for
both
CPUs)
CPU-specific
information
of
the
CPU
with
redundancy
ID
1
Client
is
connected
with:
PLC
1
(=
primary
CPU):
Data
of
the
serv-
er
interface
of
the
primary
CPU.
PLC
1
(=
backup
CPU):
Server
interface
data (ServiceLevel = NoData signifies
the
data
is
invalid
or
not
available).
PLC
2
(=
backup
CPU):
No
data
(access
error BadInvalidState /
(BadResourceUnavailable))
466
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Node
<configured
name>
Contents
Accessible
data
in
the
RUN-Redund-
ant
system
state
Accessible
data
in
the
RUN-Solo
system
state
<PLC
2>
Information
via
R/H
CPU
with
redundancy
ID
2
Server interface data (identical for
both
CPUs)
CPU-specific
information
of
the
CPU
with
redundancy
ID
2
Client
is
connected
with:
PLC
2
(=
primary
CPU):
Data
of
the
serv-
er
interface
of
the
primary
CPU.
PLC
2
(=
backup
CPU):
Server
interface
data (ServiceLevel = NoData signifies
the
data
is
invalid
or
not
available).
PLC
1
(=
backup
CPU):
No
data
(access
error BadInvalidState /
(BadResourceUnavailable))
Nodes
below
the
device
nodes
Device
nodes
are
the
nodes
below
the
DeviceSet
node
(R/H
system,
PLC
1,
PLC
2).
The
&quot;OperatingMode&quot;
and
&quot;RedundancyMode&quot;
attributes
are
of
particular
interest.
Operating
mode
The
OperatingMode-Property
below
the
R/H
system
node
shows
the
operating
mode
of
the
primary
CPU
for
the
R/H
system
node.
The
following
values
are
defined
for
the
individual
CPUs
of
the
R/H
system
and
for
the
R/H
system:
OperatingMode
R/H
system
R/H
CPU
1
(STOP
-
FW
update)
x
x
3
(STOP
-
Initialization)
x
x
4
(STOP)
x
x
6
(Startup)
x
x
8
(RUN)
x
x
9
(Run
Redundant)
x
x
10
(HOLD)
x
x
13
(Defective)
x
x
14
(Troubleshooting)
x
x
15
(No
power)
x
x
17
(STOP
-
no
de-energized/substitute
value
switch
for
outputs)
x
x
18
(RUN
-
de-energized/substitute
value
switch
for
out-
puts)
x
x
19
(Program
test)
x
x
20
(Run
program
test)
8
(RUN)
x (primary; backup in
test
mode)
Communication
Function
Manual,
11/2024,
A5E03735815-AM
467
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
OperatingMode
R/H
system
R/H
CPU
21
(RUN
Syncup)
8
(RUN)
x
22
(Syncup)
8
(RUN)
x
31
(Remote
unknown)
x
-
Example
with
node
attributes
for
OperatingMode:
1711343
126132
RedundancyMode
The
RedundancyMode-Property
shows
the
system
status
of
the
R/H
system
and
is
only
available
in
the
R/H
system
node.
RedundancyMode
R/H
system
R/H
CPU
32
(No
power)
x
-
33
(STOP)
x
-
34
(HOLD)
x
-
35
(Startup)
x
-
37
(Run
solo)
x
-
38
(Syncup)
x
-
39
(Program
test)
x
-
40
(Redundant)
x
-
468
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Example
with
node
attributes
for
RedundancyMode:
1864824
124485
Updated
instructions
for
server
methods
To
implement
server
methods
in
an
S7-1500
CPU,
use
the
&quot;OPC_UA_ServerMethodPre&quot;
and
&quot;OPC_UA_ServerMethodPost&quot; instructions. Details of the new version V1.1 of these two
instructions
are
explained
below.
For
S7-1500R/H
CPUs
as
of
FW
version
V3.1,
version
V1.1
of
the
server
instructions
is
mandatory
-
the
use
of
version
V1.0
is
not
permitted.
The
recommendation
applies
to
S7-1500
standard
CPUs:
For
new
projects
starting
from
TIA Portal V19 and CPU firmware version V3.1, always use the new server instruction
version
V1.1
or
higher.
Within a project, you can use both the instructions with version V1.0 and the instructions
with
version
V1.1.
You
can
only
use
one
version
within
a
CPU
user
program.
To
implement
server
methods
in
the
user
program,
use
the
example
program
published
here
and
not
the
example
from
the
TIA
Portal
help
system.
Implementing
server
methods
in
the
user
program
First,
here
is
a
brief
summary
of
the
procedure
for
providing
an
OPC
UA
method
to
the
OPC
UA server of an S7-1500 CPU via the user program. This method can then be called by any
OPC
UA
client.
A
function
block
(FB)
represents
the
server
method
in
the
user
program.
This
FB
must
be
called
cyclically
(e.g.
by
OB
1).
In
the
FB,
the
&quot;OPC_UA_ServerMethodPre&quot;
instruction
must
first
be
called
in
order
to
map
the input parameters of the method that the client has given to the call to the
corresponding
CPU
variables
(input
data
transfer).
After the &quot;OPC_UA_ServerMethodPre&quot; instruction has been called, the programmed
algorithm
(the
method
itself
with
processing
of
the
input
parameters
and
preparation
of
the
output
parameters)
is
processed.
Once the programmed algorithm has been run and the output parameters have been
calculated, the &quot;OPC_UA_ServerMethodPost&quot; instruction must be called. The
&quot;OPC_UA_ServerMethodPost&quot;
instruction
ensures
that
the
valid
output
data
of
the
method
is
made
available
to
the
client.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
469
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Observe
the
naming
conventions
when
creating
the
OPC
UA
methods:
When
calling
the
server
methods,
the
function
must
be
created
as
a
multi-instance;
the
name of the multi-instance must be
&quot;OPC_UA_ServerMethodPre_Instance&quot;/&quot;OPC_UA_ServerMethodPost_Instance&quot;
so
that
the
method
is
created
in
the
address
space.
When
defining
input
parameters
for
the
OPC
UA
method
in
the
static
area
of
the
block,
the name of the variable must be &quot;UAMethod_InParameters&quot; so that the input
parameters
of
the
method
are
displayed.
When defining the output parameters of the OPC UA method in the static area of the
block,
the
name
of
the
variable
must
be
&quot;UAMethod_OutParameters&quot;
so
that
the
output
parameters
of
the
method
are
displayed.
Sequence
of
the
user
program
The
two &quot;OPC_UA_ServerMethodPre&quot;
and
&quot;OPC_UA_ServerMethodPost&quot;
instructions
are
asynchronous instructions that do not have a &quot;REQ input&quot; that triggers the start of the
respective
instruction.
The
&quot;OPC_UA_ServerMethodPre&quot;
instruction
is
triggered
implicitly
by
the
OPC
UA
client
calling
the OPC UA method (edge trigger). This means that, whenever the method has not been
called
by
the
client
in
a
cycle
and
is
called
in
the
following
cycle,
the
following
happens:
The
STATUS
changes from 0x7000
(no call) to 0x7001
(first call).
The
BUSY output
parameter
is
set
to
&quot;1&quot;.
If the data transfer takes longer than one cycle, the status changes to 0x7002
(intermediate
call)
after
the
first
cycle.
When
the
input
data
transfer
is
complete:
DONE
changes
to
&quot;1&quot;.
UAMethodCalled
changes
to
&quot;1&quot;.
BUSY
is
reset
to
&quot;0&quot;.
&quot;OPC_UA_ServerMethodPre&quot;
and
&quot;OPC_UA_ServerMethodPost&quot;:
When
the
output
data
transfer
is
completed
for
the
OPC_UA_ServerMethodPost
instruction,
DONE
changes
to
&quot;1&quot;.
This
is
the
condition
for
resetting
the
input
parameters
&quot;UAMethod_Finished&quot;
and
&quot;UMethod_Result&quot;
(see
example
program).
After
a
further
cycle,
all
output
parameters
are
reset
(corresponds
to
a
falling
edge
for
REQ-triggered
instructions).
The respective instances of the instructions are then released again (max. 20 instances
can
be
active
at
the
same
time).
470
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
Compatibility
between
version
V1.0
and
V1.1
of
the
instructions
There are the following differences between version V1.0 and V1.1 with regard to the server
instructions:
Resetting
the
output
parameter
&quot;UAMethod_Called&quot;
of
the
server
instruction
&quot;OPC_UA_ServerMethodPre&quot;:
V1.0: &quot;UAMethod_Called&quot; is automatically reset if both &quot;DONE&quot; of the
&quot;OPC_UA_ServerMethodPre&quot; instruction and &quot;DONE&quot; of the
&quot;OPC_UA_ServerMethodPost&quot;
instruction
are
reset.
&quot;UAMethod_Called&quot;
is
therefore
only
reset
when
&quot;OPC_UA_ServerMethodPost&quot;
is
completed.
V1.1:
&quot;UAMethod_Called&quot;
is
automatically
reset
when
output
parameter
&quot;DONE&quot;
of
the
&quot;OPC_UA_ServerMethodPre&quot;
instruction
is
reset.
Release
of
the
instances
of
&quot;OPC_UA_ServerMethodPre&quot;
and
&quot;OPC_UA_ServerMethodPost&quot;:
V1.0:
No
cyclic
call
of
the
server
instructions
required.
V1.1:
Mandatory
cyclical
call
of
the
server
instructions
required.
NOTE
When
switching
to
the
OPC
UA
server
methods
from
version
V1.0
to
version
V1.1,
check
whether your user program takes into account the described rules and the adapted
functionality.
Adjust
the
program
if
necessary.
Example
program
FUNCTION_BLOCK
&quot;mySERVER_METHOD&quot;
{ S7_Optimized_Access := &apos;TRUE&apos; }
VERSION
:
0.1
VAR
DB_SPECIFIC
UAMethod_InParameters : Struct
IN_BOOL
:
Bool;
IN_INT
:
Int;
END_STRUCT;
UAMethod_OutParameters : Struct
OUT_BOOL
:
Bool;
OUT_INT
:
Int;
END_STRUCT;
END_VAR
VAR
OPC_UA_ServerMethodPre_Instance {InstructionName :=
&apos;OPC_UA_ServerMethodPre&apos;; LibVersion := &apos;1.1&apos;} :
OPC_UA_ServerMethodPre;
DONE_PRE { S7_SetPoint := &apos;True&apos;} : Bool;
BUSY_PRE
:
Bool;
ERROR_PRE : Bool;
STATUS_PRE
:
DWord;
UAMethod_Called : Bool;
OPC_UA_ServerMethodPost_Instance
{InstructionName
:=
&apos;OPC_UA_ServerMethodPost&apos;; LibVersion := &apos;1.1&apos;} :
OPC_UA_ServerMethodPost;
UAMethod_Result { S7_SetPoint := &apos;True&apos;} : DWord;
UAMethod_Finished
:
Bool;
DONE_POST { S7_SetPoint := &apos;True&apos;} : Bool;
BUSY_POST
:
Bool;
ERROR_POST
:
Bool;
Communication
Function
Manual,
11/2024,
A5E03735815-AM
471
Communication
with
the
redundant
system
S7-1500R/H
16.9
Using
an
OPC
UA
server
in
an
S7-1500R/H
system
STATUS_POST : DWord;
END_VAR
BEGIN
#OPC_UA_ServerMethodPre_Instance(Done => #DONE_PRE,
Busy
=>
#BUSY_PRE,
Error => #ERROR_PRE,
Status
=>
#STATUS_PRE,
UAMethod_Called => #UAMethod_Called,
UAMethod_InParameters
:=
#UAMethod_InParameters);
//Method
is
called
IF
#UAMethod_Called
AND
NOT
#ERROR_PRE
THEN
(*
Functionality:
InParameters
are
valid
and
copied
to
OutParameters
*)
#UAMethod_OutParameters.OUT_BOOL := #UAMethod_InParameters.IN_BOOL;
#UAMethod_OutParameters.OUT_INT
:=
#UAMethod_InParameters.IN_INT;
(*
If
Method
is
finished
without
errors
prepare
output
parameters
of
OPC_UA_ServerMethodPost
accordingly
*)
#UAMethod_Result := 0;
#UAMethod_Finished := TRUE;
END_IF;
#OPC_UA_ServerMethodPost_Instance(UAMethod_Result
:=
#UAMethod_Result,
UAMethod_Finished := #UAMethod_Finished,
Done
=>
#DONE_POST,
Busy => #BUSY_POST,
Error => #ERROR_POST,
Status
=>
#STATUS_POST,
UAMethod_OutParameters
:=
#UAMethod_OutParameters);
//Reset Input Parameters after OPC_UA_ServerMethodPost is done
IF
#DONE_POST
OR
#ERROR_POST
THEN
#UAMethod_Finished := FALSE;
#UAMethod_Result
:=
0;
END_IF;
END_FUNCTION_BLOCK
472
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Industrial
Ethernet
Security
with
CP
1543-1
17
All-round
protection
-
the
task
of
Industrial
Ethernet
Security
With
Industrial
Ethernet
Security,
individual
devices,
automation
cells
or
network
segments
of
an Ethernet network can be protected. Data transfer can also be protected by a combination
of
different
security
measures:
Data
espionage
Data
manipulation
Unauthorized
access
Security
measures
Firewall
IP
firewall
with stateful
packet inspection (layer
3 and
4)
Firewall
also
for
Ethernet
&quot;non-IP&quot;
frames
according
to
IEEE
802.3
(layer
2)
Bandwidth
limitation
Global
firewall
rules
All network nodes located in the internal network segment of a CP 1543‑1 are protected
by
its
firewall.
Exception:
If
you
access
the
CPU
via
the
interface
of
the
CP
with
the
&quot;Access
to
PLC
via
communication
module&quot;
function,
the
firewall
does
not
protect
this
connection.
Logging
To
allow
monitoring,
events
can
be
stored
in
log
files
that
can
be
read
out
using
the
configuration
tool
or
can
be
sent
automatically
to
a
Syslog
server.
HTTPS
For
encrypted
transfer
of
websites,
for
example
during
process
control.
FTPS
(explicit
mode)
For
encrypted
transfer
of
files.
Secure
NTP
For
secure
time-of-day
synchronization
and
transmission.
SNMPv3
For
secure
transmission
of
network
analysis
information
safe
from
eavesdropping.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
473
Industrial
Ethernet
Security
with
CP
1543-1
Firewall
VPN
groups
You can combine the CP 1543-1 with other security modules into VPN groups through
configuration. IPsec tunnels are established between all the security modules of a VPN
group
(VPN).
All
internal
nodes
of
these
security
modules
can
communicate
securely
with
each
other
through
this
tunnel.
Protection
for
devices
and
network
segments
The
firewall
and
VPN
groups
protective
functions
can
be
applied
to
the
operation
of
single
devices,
multiple
devices,
or
entire
network
segments.
Additional
information
An
overview
with
links
to
the
most
important
contributions
on
Industrial
Security
is
available
in
this
FAQ
(
https://support.industry.siemens.com/cs/ww/en/view/92651441
).
Firewall
Tasks
of
the
firewall
The
purpose
of
the
firewall
functionality
is
to
protect
networks
and
stations
from
outside
influences and disturbances. This means that only certain previously specified
communications
relations
are
permitted.
To
filter
the
data
traffic,
IPv4
addresses,
IPv4
subnets,
port
numbers
or
MAC
addresses
among
other
things
can
be
used.
The
firewall
functionality
can
be
configured
for
the
following
protocol
levels:
IP
firewall
with stateful
packet inspection (layer
3 and
4)
Firewall
also
for
Ethernet
&quot;non-IP&quot;
frames
according
to
IEEE
802.3
(layer
2)
Firewall
rules
Firewall
rules
describe
which
packets
are
permitted
or
forbidden
in
which
direction.
474
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Industrial
Ethernet
Security
with
CP
1543-1
17.3
NTP
client
Logging
Functionality
For
test
and
monitoring
purposes,
the
security
module
has
diagnostics
and
logging
functions.
Diagnostics
functions
These
include
various
system
and
status
functions
that
you
can
use
in
online
mode.
Logging
functions
This involves the recording of system and security events. Depending on the event type,
the
recording
is
made
in
volatile
or
non-volatile
local
buffer
areas
of
the
CP
1543‑1.
As
an
alternative,
it
is
also
possible
to
record
on
a
network
server.
The
parameter
assignment
and
evaluation
of
these
functions
is
only
possible
with
a
network
connection.
Recording
events
with
logging
functions
You
specify
which
events
should
be
recorded
with
the
log
settings.
Here
you
can
configure
the
following
recording
variants:
Local
logging
With this variant, you record the events in local buffers of the CP 1543‑1. In the online
dialog
of
the
Security
Configuration
Tool,
you
can
then
access
these
recordings,
visualize
them
and
archive
them
on
the
service
station.
Network
Syslog
With
the
network
Syslog,
you
use
a
Syslog
server
in
the
network.
This
records
the
events
according
to
the
configuration
in
the
log
settings.
NTP
client
Functionality
To
check
the
time
validity
of
a
certificate
and
the
time
stamp
of
log
entries,
the
date
and
time
are
maintained
on
the
CP
1543‑1
as
on
the
CPU.
This
time
can
be
synchronized
with
NTP.
The
CP 1543-1 forwards the synchronized time to the CPU via the backplane bus of the
automation
system.
This
way
the
CPU
also
receives
a
synchronized
time
for
the
time
events
in
program
execution.
The
automatic
setting
and
periodic
synchronization
of
the
time
takes
place
either
via
a
secure
or non-secure NTP server. You can assign a maximum of 4 NTP servers to the CP 1543‑1. A
mixed
configuration
of
non-secure
and
secure
NTP
servers
is
not
possible.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
475
Industrial
Ethernet
Security
with
CP
1543-1
17.5
VPN
SNMP
Functionality
Like the CPU, the CP 1543‑1 supports the transfer of management information using the
Simple
Network
Management
Protocol
(SNMP).
To
achieve
this,
an
&quot;SNMP
agent&quot;
is
installed
on the CP/CPU that receives and responds to the SNMP queries. Information about the
properties of devices capable of SNMP is contained in so-called MIB files (Management
Information
Base)
for
which
the
user
needs
to
have
the
appropriate
rights.
With
SNMPv1,
the
&quot;community
string&quot;
is
also
sent.
The
&quot;community
string&quot;
is
like
a
password
that is sent along with the SNMP query. The requested information is sent when the
&quot;community
string&quot;
is
correct.
The
request
is
discarded
when
the
string
is
incorrect.
With
SNMPv3,
data
can
be
transferred
encrypted.
To
do
this,
select
either
an
authentication
method
(e.g.
SHA)
or
an
authentication
and
encryption
method
(e.g
AES).
You
can
activate
and
deactivate
the
use
of
SNMP
for
the
CP/CPU.
Deactivate
SNMP
if
the
security guidelines in your network do not permit SNMP or if you use your own SNMP
solution.
(Page
To
find
out
how
to
activate
and
deactivate
SNMP
for
the
CPU,
refer
to
section
SNMP
119).
VPN
Functionality
For
security
modules
that
protect
the
internal
network,
VPN
(Virtual
Private
Network)
tunnels
provide
a
secure
data
connection
through
the
non-secure
external
network.
The
module
uses
the
IPsec
protocol
(tunnel
mode
of
IPsec)
for
tunneling.
In
STEP
7
you
can
assign
VPN
groups
to
security
modules.
VPN
tunnels
are
automatically
established
between
all
modules
of
a
VPN
group.
A
module
in
one
project
can
belong
to
several
different
VPN
groups
at
the
same
time
in
the
process.
476
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Glossary
Automation
system
Programmable
logic
controller
for
the
open-loop
and
closed-loop
control
of
process
chains
of
the process engineering industry and manufacturing technology. The automation system
consists of different components and integrated system functions according to the
automation
task.
Backup CPU
If
the
R/H
system
is
in
RUN-Redundant
system
state,
the
primary
CPU
controls
the
process.
The
backup CPU processes the user program synchronously and can take over process control if
the
primary
CPU
fails.
Bus
Transmission
medium
that
connects
several
devices
together.
Data
transmission
can
be
performed
electrically
or
via
optical
fibers,
either
in
series
or
in
parallel.
Client
Device
in
a
network
that
requests
a
service
from
another
device
in
the
network
(server).
CM
→
Communications
module
Communications
module
Module
for
communications
tasks
used
in
an
automation
system
as
an
interface
expansion
of
the
CPU
(for
example
PROFIBUS)
and
providing
additional
communications
options
(PtP).
Communications
processor
Module
for
expanded
communications
tasks
covering
special
applications,
for
example
in
the
area
of
security.
Consistent
data
Data
that
belongs
together
in
terms
of
content
and
must
not
be
separated
when
transferred.
CP
→
Communications
processor
Communication
Function
Manual,
11/2024,
A5E03735815-AM
477
Glossary
CPU
C
entral
P
rocessing
U
nit
-
Central
module
of
the
S7
automation
system
with
a
control
and
arithmetic
unit,
memory,
operating
system
and
interface
for
programming
device.
Device
Generic
term
for:
Automation
systems
(PLC,
PC,
for
example)
Distributed
I/O
systems
Field
devices
(for
example,
PLC,
PC,
hydraulic
devices,
pneumatic
devices)
and
Active network components
(for example,
switches,
routers)
Gateways
to
PROFIBUS,
AS
interface
or
other
fieldbus
systems
Device
certificates
Such
certificates
are
signed
by
a
certificate
authority
(CA).
The
signature
of
an
end-entity
certificate
is
checked
with
the
public
key
of
the
certificate
authority
certificate.
The
&quot;Subject&quot;
attribute
must
not
be
identical
to
the
&quot;Issuer&quot;
attribute.
The
&quot;Subject&quot;,
for
example,
contains
the
name
of
a
program
as
with
the
OPC
UA
application
certificate.
&quot;Issuer&quot;
is
the
certificate
authority
that
signed
the
certificate.
The
&quot;CA&quot;
field
must
be
set
to
&quot;False&quot;.
DP
master
Within
PROFIBUS
DP,
a
master
in
the
distributed
I/O
that
behaves
according
to
the
EN
50170
standard,
Part
3.
→
See
also
DP
slave
DP
slave
Slave
in
the
distributed
I/O
that
is
operated
on
PROFIBUS
with
the
PROFIBUS
DP
protocol
and
behaves
according
to
the
EN
50170
standard,
Part
3.
→
See
also
DP
master
Duplex
Data
transmission
system;
a
distinction
is
made
between
full
and
half
duplex.
Half
duplex:
One
channel
is
available
for
alternate
data
exchange
(sending
or
receiving
alternately
but
not
at
the
same
time).
Full
duplex:
Two
channels
are
available
for
simultaneous
data
exchange
in
both
directions
(simultaneous
sending
and
receiving
in
both
directions).
478
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Glossary
End-entity
certificate
→
See
also
device
certificate
Ethernet
International
standard
technology
for
local
area
networks
(LAN)
based
on
frames.
It
defines
types of cables and signaling for the physical layer and packet formats and protocols for
media
access
control.
Ethernet
network
adapter
Electronic circuitry for connecting a computer to an Ethernet network. It allows the exchange
of
data
/
communication
within
the
network.
FETCH/WRITE
Server services using TCP/IP, ISO-on-TCP and ISO for access to system memory areas of S7
CPUs.
Access
(client
function)
is
possible
from
a
SIMATIC
S5
or
a
third-party
device/PC.
FETCH:
Read
data
directly;
WRITE:
Write
data
directly.
Field
device
→
Device
Freeport
Freely
programmable
ASCII
protocol;
here
for
data
transfer
via
a
point-to-point
connection.
FTP
F
ile
T
ransfer
P
rotocol;
a
network
protocol
for
transferring
files
via
IP
networks.
FTP
is
used
to
download
files
from
the
server
to
the
client
or
to
upload
files
from
the
client
to
the
server.
FTP
directories
can
also
be
created
and
read
out
and
directories
and
files
can
be
renamed
or
deleted.
HMI
H
uman
M
achine
I
nterface,
device
for
visualization
and
control
of
automation
processes.
IE
→
Industrial Ethernet
IM
→
Interface
module
Communication
Function
Manual,
11/2024,
A5E03735815-AM
479
Glossary
Industrial
Ethernet
Guideline for setting up an Ethernet network in an industrial environment. The essential
difference
compared
with
standard
Ethernet
is
the
mechanical
ruggedness
and
immunity
to
noise
of
the
individual
components.
Instruction
The
smallest
self-contained
unit
of
a
user
program
characterized
by
its
structure,
function
or
purpose as a separate part of the user program. An instruction represents an operation
procedure
for
the
processor.
Interface
module
Module in the distributed I/O system. The interface module connects the distributed I/O
system
via
a
fieldbus
to
the
CPU
(IO
controller/DP
master)
and
prepares
the
data
for
the
I/O
modules.
Intermediate
CA
certificate
This
is
a
certificate
authority
certificate
that
is
signed
with
the
private
key
of
a
root
certificate
authority.
An
intermediate
certificate
authority
signs
end-entity
certificates
with
its
private
key.
The
signature
of
these
end-entity
certificates
is
verified
with
the
public
key
of
the
intermediate
certificate
authority.
The
&quot;Subject&quot;
and
&quot;Issuer&quot;
attributes
of
the
intermediate
CA
certificate
must
not
be
identical.
This
certificate
authority
has
after
all
not
signed
its
certificate
itself.
The
&quot;CA&quot;
field
must
be
set
to
&quot;True&quot;.
IO
controller,
PROFINET
IO
controller
Central
device
in
a
PROFINET
system,
usually
a
classic
programmable
logic
controller
or
PC.
The IO controller sets up connections to the IO devices, exchanges data with them, thus
controls
and
monitors
the
system.
IO
device,
PROFINET
IO
device
Device
in
the
distributed
I/O
of
a
PROFINET
system
that
is
monitored
and
controlled
by
an
IO
controller (for example distributed inputs/outputs, valve islands, frequency converters,
switches).
IP
address
Binary
number
that
is
used
as
a
unique
address
in
computer
networks
in
conjunction
with
the
Internet
Protocol
(IP).
It
makes
these
devices
uniquely
addressable
and
individually
accessible.
An
IPv4
address
can
be
evaluated
using
a
binary
subnet
mask
that
results
in
a
network
part
or
a host part as a structure. The textual representation of an IPv4 address consists, for example,
of 4 decimal numbers with the value range 0 to 255. The decimal numbers are separated by
periods.
480
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Glossary
IPv4
subnet
mask
Binary
mask,
with
which
an
IPv4
address
(as
a
binary
number)
is
divided
into
a
&quot;network
part&quot;
and
a
&quot;host
part&quot;.
ISO
protocol
Communications protocol for message or packet-oriented transfer of data in an Ethernet
network. This protocol is hardware-oriented, very fast and allows dynamic data lengths. The
ISO
protocol
is
suitable
for
medium
to
large
volumes
of
data.
ISO-on-TCP
protocol
Communications
protocol
capable
of
S7
routing
for
packet-oriented
transfer
of
data
in
an
Ethernet network; provides network addressing. The ISO-on-TCP protocol is suitable for
medium
and
large
volumes
of
data
and
allows
dynamic
data
lengths.
Linear
bus
topology
Network
topology
characterized
by
the
arrangement
of
the
devices
in
a
line
(bus).
MAC
address
Worldwide
unique
device
identification
for
all
Ethernet
devices.
The
MAC
address
is
assigned
by the manufacturer and has a 3-byte vendor ID and 3-byte device ID as a consecutive
number.
Master
Higher-level,
active
participant
in
the
communication/on
a
PROFIBUS
subnet.
The
master
has
rights
to
access
the
bus
(token)
and
can
request
and
send
data.
→
See
also
DP
master
Modbus
RTU
R
emote
T
erminal
U
nit;
Open
communications
protocol
for
serial
interfaces
based
on
a
master/slave
architecture.
Modbus
TCP
T
ransmission
C
ontrol
P
rotocol;
Open
communications
protocol
for
Ethernet
based
on
a
master/slave
architecture.
The
data
are
transmitted
as
TCP/IP
packets.
Network
A
network
consists
of
one
or
more
interconnected
subnets
with
any
number
of
devices.
Several
networks
can
exist
alongside
each
other.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
481
Glossary
NTP
The
N
etwork
T
ime
P
rotocol (NTP) is a standard for synchronizing clocks in automation
systems
via
Industrial
Ethernet.
NTP
uses
the
connectionless
UDP
transport
protocol
for
the
Internet.
OPC
UA
OPC
U
nified
Automation
is
a
protocol
for
communication
between
machines,
developed
by
the
OPC
Foundation.
Operating
states
Operating
states
describe
the
behavior
of
a
single
CPU
at
a
specific
time.
The
CPUs
of
the
SIMATIC
standard
systems
have
the
STOP,
STARTUP
and
RUN
operating
states.
The primary CPU of the redundant system S7-1500R/H has the operating states STOP,
STARTUP,
RUN,
RUN-Syncup
and
RUN-Redundant.
The
backup
CPU
has
the
operating
states
STOP,
SYNCUP
and
RUN-Redundant.
Operating
system
Software that allows the use and operation of a computer. The operating system manages
resources
such
as
memory,
input
and
output
devices
and
controls
the
execution
of
programs.
PG
→
Programming
device
PNO
→
PROFIBUS
user
organization
Point-to-point
connection
Bidirectional data exchange via communications modules with a serial interface between two
communications
partners
(and
two
only).
Port
Physical
connector
to
connect
devices
to
PROFINET.
PROFINET
interfaces
have
one
or
more
ports.
Primary
CPU
If
the
R/H
system
is
in
RUN-Redundant
system
state,
the
primary
CPU
controls
the
process.
The
backup CPU processes the user program synchronously and can take over process control if
the
primary
CPU
fails.
482
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Glossary
Process
image
(I/O)
The CPU transfers the values from the input and output modules to this memory area. At the
start
of
the
cyclic
program,
the
CPU
transfers
the
process
image
output
as
a
signal
state
to
the
output modules. The CPU then reads the signal states of the input modules into the process
image
input.
The
CPU
then
executes
the
user
program.
PROFIBUS
Pro
cess
Fi
eld
Bus
-
European
Fieldbus
standard.
PROFIBUS
address
Unique
identifier
of
a
device
connected
to
PROFIBUS.
The
PROFIBUS
address
is
sent
in
the
frame
to
address
a
device.
PROFIBUS
device
Device
with
at
least
one
PROFIBUS
interface
either
electrical
(for
example
RS-485)
or
optical
(for
example
Polymer
Optical
Fiber).
PROFIBUS
user organization
Technical
committee
dedicated
to
the
definition
and
development
of
the
PROFIBUS
and
PROFINET
standard.
PROFIBUS
DP
A PROFIBUS with DP protocol that complies with EN 50170. DP stands for distributed I/O =
fast,
real-time
capable,
cyclic
data
exchange.
From
the
perspective
of
the
user
program,
the
distributed
I/O
is
addressed
in
exactly
the
same
way
as
the
centralized
IO.
PROFINET
Open
component-based
industrial
communications
system
based
on
Ethernet
for
distributed
automation systems. Communications technology promoted by the PROFIBUS user
organization.
PROFINET
device
Device
that
always
has
a
PROFINET
interface
(electrical,
optical,
wireless).
PROFINET
interface
Interface of a module capable of communication (for example CPU, CP) with one or more
ports.
A
MAC
address
is
assigned
to
the
interface
in
the
factory.
Along
with
the
IP
address
and
the device name (from the individual configuration), this interface address ensures that the
PROFINET device is identified uniquely in the network. The interface can be electrical, optical
or
wireless.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
483
Glossary
PROFINET
IO
IO stands for input/output; distributed I/O (fast, cyclic data exchange with real-time
capability).
From
the
perspective
of
the
user
program,
the
distributed
I/O
is
addressed
in
exactly
the
same
way
as
the
centralized
IO.
PROFINET IO as the Ethernet-based automation
standard of PROFIBUS & PROFINET
International
defines
a
cross-vendor
communication,
automation,
and
engineering
model.
With PROFINET IO, a switching technology is used that allows all devices to access the
network at any time. In this way, the network can be used much more efficiently through the
simultaneous
data
transfer
of
several
devices.
Simultaneous
sending
and
receiving
is
enabled
via
the
full-duplex
operation
of
Switched
Ethernet.
PROFINET
IO
is
based
on
switched
Ethernet
with
full-duplex
operation
and
a
bandwidth
of
100
Mbps.
Programming
device
Programming devices are essentially compact and portable PCs which are suitable for
industrial
applications.
They
are
identified
by
a
special
hardware
and
software
configuration
for
programmable
logic
controllers.
Protocol
Agreement
on
the
rules
by
which
the
communication
between
two
or
more
communication
partners
transpires.
PtP
P
oint-
t
o-
P
oint,
interface
and/or
transmission
protocol
for
bidirectional
data
exchange
between
two
(and
only
two)
communications
partners.
Redundant
systems
Redundant
systems
have
multiple
(redundant)
instances
of
key
automation
components.
Process
control
is
maintained
if
a
redundant
component
fails.
Ring
topology
All
devices
of
a
network
are
connected
together
in
a
ring.
Root
CA
certificates
→
See
also
root
certificate
Root
certificate
This
is
the
certificate
of
a
certificate
authority:
It
signs
end-entity
certificates
and
intermediate
CA
certificates
with
its
private
key.
The
&quot;Subject&quot;
attribute
and
the
&quot;Issuer&quot;
of
this
certificate
must
be
identical.
This
certificate
authority
has
signed
its
certificate
itself.
The
&quot;CA&quot;
field
must
be
set
to
&quot;True&quot;.
484
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Glossary
TIA
Portal
V14
has
such
a
root
CA
certificate:
If
you
configure
the
OPC
UA
server
of
an
S7-1500
in
the
TIA
Portal,
the
TIA
Portal
generates
an
end-entity
certificate
for
the
OPC
UA
server
and
signs
that
certificate
with
its
own
private
key.
The
signature
of
this
end-entity
certificate
can
be
verified
with
the
public
key
of
the
TIA
Portal.
This
key
can
be
found
in
the
root
CA
certificate
of
the
TIA
Portal.
Router
Network
node
with
a
unique
identifier
(name
and
address)
that
connects
subnets
together
and allows transportation of data to uniquely identified communications nodes in the
network.
RS232,
RS422
and
RS485
Standard
for
serial
interfaces.
RTU
Modbus
RTU
(RTU:
R
emote
T
erminal
U
nit,
transfers
the
data
in
binary
form;
allows
a
good
data throughput. The data must be converted to a readable format before it can be
evaluated.
S7
routing
Communication
between
S7
automation
systems,
S7
applications
or
PC
stations
in
different
S7
subnets
via
one
or
more
network
nodes
functioning
as
S7
routers.
SDA
service
Send Data with Acknowledge. SDA is an elementary service with which an initiator (for
example
DP
master)
can
send
a
message
to
other
devices
and
then
receives
acknowledgment
of
receipt
immediately
afterwards.
SDN
service
Send Data with No Acknowledge. This service is used primarily to send data to multiple
stations
and
the
service
therefore
remains
unacknowledged.
Suitable
for
synchronization
tasks
and
status
messages.
Security
Generic
term
for
all
the
measures
taken
to
protect
against
Loss
of
confidentiality
due
to
unauthorized
access
to
data
Loss
of
integrity
due
to
manipulation
of
data
Loss
of
availability
due
to
the
destruction
of
data
Self-signed
certificates
These
are
certificates
that
you
sign
with
your
private
key
and
use
as
end-entity
certificates.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
485
Glossary
The
signature
of
these
end-entity
certificates
is
verified
with
your
public
key.
The
&quot;Subject&quot;
and
&quot;Issuer&quot;
attributes
of
self-signed
certificates
must
be
identical:
You
have
signed
your
certificate
yourself.
The
&quot;CA&quot;
field
must
be
set
to
&quot;False&quot;.
You
can,
for
example,
use
self-signed
certificates
as
application
certificates
for
an
OPC
UA
client.
The
procedure
required
to
generate
a
self-signed
certificate
with
the
certificate
generator
of
the
OPC
Foundation
is
described
here
(Page
%getreference).
Server
A
device
or
more
generally
an
object
that
can
provide
certain
services;
the
service
is
performed
at
the
request
of
a
client.
Slave
Distributed
device
in
a
fieldbus
system
that
can
only
exchange
data
with
a
master
after
the
master
has
requested
this.
→
See
also
DP
slave
SNMP
S
imple
N
etwork
M
anagement
P
rotocol, uses the wireless UDP transport protocol. SNMP
works
in
much
the
same
way
as
the
client/server
model.
The
SNMP
manager
monitors
the
network nodes. The SNMP agents collect the various network-specific information in the
individual
network
nodes
and
makes
this
information
available
in
a
structured
form
in
the
MIB (
M
anagement
I
nformation
B
ase). This information allows a network management
system
to
run
detailed
network
diagnostics.
Subnet
Part of a network whose parameters must be matched up on the devices (for example in
PROFINET).
A
subnet
includes
the
bus
components
and
all
connected
stations.
Subnets
can
be
linked
together,
for
example
using
gateways
or
routers
to
form
one
network.
Switch
Network
components
used
to
connect
several
terminal
devices
or
network
segments
in
a
local
network
(LAN).
Switched
communication
In
addition
to
the
device
IP
addresses
of
the
CPUs,
the
redundant
system
S7‑1500R/H
supports
system
IP
addresses:
System
IP
address
for
the
X1
PROFINET
interfaces
of
the
two
CPUs
(system
IP
address
X1)
System
IP
address
for
the
X2
PROFINET
interfaces
of
the
two
CPUs
(system
IP
address
X2)
You use the system IP addresses for communication with other devices (for example, HMI
devices,
CPUs,
PG/PC).
The
devices
always
communicate
over
the
system
IP
address
with
the
primary
CPU
of
the
redundant
system.
This
ensures
that
the
communication
partner
can
486
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Glossary
communicate
with
the
new
primary
CPU
(previously
backup
CPU)
in
the
RUN-Solo
system
state
after
failure
of
the
original
primary
CPU
in
redundant
operation.
System
states
The system states of the redundant system S7-1500R/H result from the operating states of
the primary and backup CPUs. The term system state is used as a simplified expression that
refers
to
the
operating
states
that
occur
simultaneously
on
both
CPUs.
The
redundant
system
S7-1500R/H
has
the
system
states
STOP,
STARTUP,
RUN-Solo,
SYNCUP
and
RUN-Redundant.
TCP/IP
T
ransmission
C
ontrol
P
rotocol
/
I
nternet
P
rotocol,
connection-oriented
network
protocol,
generally
recognized
standard
for
data
exchange
in
heterogeneous
networks.
Time-of-day
synchronization
Capability
of
transferring
a
standard
system
time
from
a
single
source
to
all
devices
in
the
system
so
that
their
clocks
can
be
set
according
to
the
standard
time.
Tree
topology
Network
topology
characterized
by
a
branched
structure:
Two
or
more
bus
nodes
are
connected
to
each
bus
node.
Twisted-pair
Fast Ethernet via twisted-pair cables is based on the IEEE 802.3u standard (100 Base-TX). The
transmission medium is a shielded 2x2 twisted-pair cable with an impedance of 100 Ohms
(22 AWG). The transmission characteristics of this cable must meet the requirements of
category
5.
The maximum length of the connection between the terminal and the network component
must
not
exceed
100
m.
The
connectors
are
designed
according
to
the
100Base-TX
standard
with
the
RJ-45
connector
system.
UDP
U
ser
D
atagram
P
rotocol;
communications
protocol
for
fast
and
uncomplicated
data
transfer,
without
acknowledgment.
There
are
no
error
checking
mechanisms
as
found
in
TCP/IP.
User
program
In
SIMATIC,
a
distinction
is
made
between
the
CPU
operating
system
and
user
programs.
The
user program contains all instructions, declarations and data by which a system or process
can be controlled. The user program is assigned to a programmable module (for example,
CPU,
FM)
and
can
be
structured
in
smaller
units.
USS
Universal
Serial
Interface
protocol
(
U
niverselles
S
erielles
S
chnittstellen-Protokoll);
defines
an
access
method
according
to
the
master-slave
principle
for
communication
via
a
serial
bus.
Communication
Function
Manual,
11/2024,
A5E03735815-AM
487
Glossary
Web
server
Software/communications service for data exchange via the Internet. The web server
transfers
the
documents
using
standardized
transmission
protocols
(HTTP,
HTTPS)
to
a
Web
browser.
Documents
can
be
static
or
put
together
dynamically
from
different
sources
by
the
web
server
on
request
from
the
Web
browser.
488
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Index
A
57
Advanced
Encryption
Algorithm,
AES,
57
60
Applicant,
58
Asymmetric
encryption,
156
156
B
BRCV,
BSEND,
C
60
60
Certificate authorities,
Certificate subject,
CM,
28
Communication
129
127
PG communication,
HMI
communication,
132
131
155
131
Open
User
Communication,
Open communication,
Communication protocols,
S7
communication,
401
163
Point-to-point
connection,
S7
routing,
412
Data
record
routing,
Communication options
Overview,
33
Communications
154
Establishment
and
termination,
28
Communications module,
28
Communications processor,
Communications
services
Connection
resources,
44
157
Communication via PUT/GET instruction
Creating
and
configuring
a
connection,
Connection
429
134
Instructions
for
Open
User
Communication,
Diagnostics,
429
Connection
diagnostics,
Connection resources
Overview,
Overview,
44
418
423
422
HMI
communication,
S7
routing,
423
423
Data
record
routing,
occupying,
426
425
Station specific,
Module-specific,
49
28
Consistency of data,
CP,
D
60
412
Data consistency,
49
Data record routing,
Digital
certificates,
E
33
Email,
150
E-mail,
133,
End-entity
certificate,
63
244
154
Establishment and termination of communications,
Export
file
for
OPC
UA,
F
133
FDL,
474
Fetch,
33
Firewall,
151
163
Freeport
protocol,
FTP,
33,
133,
150,
G
156
204
GDS,
199,
GET,
204
Global
Discovery
Server (GDS),
199,
Communication
Function
Manual,
11/2024,
A5E03735815-AM
489
Index
H
Handshake
Protocol,
59
129
HMI
communication,
33,
I
IM,
32
473
Industrial
Ethernet
Security,
Interface
module,
32
Interfaces for communication,
29
Interfaces
of
communications
modules
Point-to-point
connection,
31
30
Interfaces
of
communications
processors,
405
432
IP
address,
emergency
address
(temporary),
IP
forwarding,
132
ISO,
33,
140
ISO-on-TCP,
132,
L
475
Logging,
M
60
133
163
Man-in-the-middle
attack,
Modbus protocol (RTU),
Modbus
TCP,
N
475
NTP,
33,
O
423
Occupation
of
connection
resources,
OPC
UA
173
178
pace,
178
179
Introduction,
NodeId,
Names
Identifier,
186
Security mechanisms,
Signing and encryption,
189
192
191
196
196
197
193
X.509 certificates,
Certificate generator,
OpenSSL,
Secure channel,
Secure
connection,
Layer
model,
GDS,
199
GDS,
204
223
ts,
22
3
235
35
Security settings,
End
poin
PLC tags,
DB
tags,
2
183
cate,
374
376
OPC
UA
client
Basics,
Certifi
Authentication,
180
221
OPC UA server
Address space,
Basics,
235
243
243
244
246
247
ng,
24
8
250
ion,
250
252
Write and read rights,
Performance,
Performance
increase,
XML export file,
Commissioning,
Application name,
Addressi
TCP port,
Subscript
TCP
port,
253
253
Publishing interval,
Sampling
interval,
258
255
Generating a server certificate,
Security
settings,
264
261
Customizing the server certificate,
Authentication,
Runtime
licenses,
268
Runtime
licenses,
269
140
Open communication
Connection
configuration,
150
140
Setting
up
TCP,
ISO-on-TCP,
UDP
,
Setting
up
e-mail,
Setting
up
FTP,
151
490
Communication
Function
Manual,
11/2024,
A5E03735815-AM
Index
193
OpenSSL,
131
132
134
Open User Communication
Features,
Protocols,
Instructions,
P
413
PCT,
127
PG communication,
33,
163
Point-to-point
connection,
33,
163
Private Key,
53
Procedure
3964(R),
53
132
Protocols
for
Open
User
Communication,
Public
Key,
156
PUT,
R
59
Record
Protocol,
RFC 5280,
53
63
Root
certificate,
S
401
423
S7
communication,
33,
155,
S7
routing,
423
Connection
resources,
53
59
473
Secure
communication,
Secure Socket Layer,
Security,
475
474
473
Security
measures,
Firewall,
Logging,
475
NTP,
SNMP,
476
61
45
261
Self-signed certificates,
Server
certificate,
Setting
up
a
connection,
143
By
configuring,
144
ISO
connection
with
CP
1543-1,
62
Signature,
SNMP,
33,
476
SSL,
59
57
475
Symmetric
encryption,
Syslog,
135
System
data
type,
T
134
TCON,
134
140
TCP,
33,
132,
TDISCON,
33
Time-of-day
synchronization,
TLS,
59
59
134
Transport Layer Security,
TRCV,
134
134
134
TRCV_C,
TSEND,
TSEND_C,
U
156
156
140
UDP,
33,
132,
URCV,
USEND,
163
USS
protocol,
W
33
33
Web
server,
Write,
X
53
X.509,
Communication
Function
Manual,
11/2024,
A5E03735815-AM
491